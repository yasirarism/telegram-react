(this.webpackJsonptelegram_react=this.webpackJsonptelegram_react||[]).push([[3],Array(444).concat([function(e,t,a){"use strict";class n{constructor(e,t=[]){this.start=()=>{this.stopped=!1,this.id=requestAnimationFrame(this.startInternal)},this.startInternal=e=>{var t=this.startTime,a=this.duration;this.startTime=e,this.endTime=t+a,this.draw(e)},this.draw=e=>{var t=this.stopped,a=this.duration,s=this.startTime,i=this.options;if(e-s>a&&i.every(e=>e.to===e.last)&&(this.stopped=!0),!t){var r=Math.min(e-s,a),o=0===a?1:r/a,l=n.outSine(o);i.forEach(e=>{var t=e.from,a=e.to,n=e.func;e.last=t+(a-t)*l,n(e.last)}),this.id=requestAnimationFrame(this.draw)}},this.stop=()=>{this.stopped=!0,cancelAnimationFrame(this.id)},this.options=t,this.duration=e}static outSine(e){return Math.sin(e*Math.PI/2)}}t.a=n},function(e,t,a){"use strict";var n=a(0),s=a.n(n),i=a(158),r=a(3),o=a(2);a(455);class l extends s.a.Component{constructor(...e){super(...e),this.state={emoji:null,prevPropsSticker:null},this.loadStickerEmojis=e=>{var t=e.sticker.id;o.a.send({"@type":"getStickerEmojis",sticker:{"@type":"inputFileId",id:t}}).then(t=>{this.props.sticker===e&&this.setState({emoji:t.emojis.join(" ")})})}}static getDerivedStateFromProps(e,t){var a=e.sticker,n=t.prevPropsSticker;return a&&n?{prevPropsSticker:a,emoji:null}:null}componentDidUpdate(e,t,a){var n=this.props.sticker;n&&n!==e.sticker&&this.loadStickerEmojis(n)}componentDidMount(){var e=this.props.sticker;e&&this.loadStickerEmojis(e)}render(){var e=this.props.sticker,t=this.state.emoji;return e?s.a.createElement("div",{className:"sticker-preview"},s.a.createElement("div",{className:"sticker-preview-emoji"},t),s.a.createElement(i.b,{sticker:e,displaySize:r.Db,source:i.a.PREVIEW})):null}}t.a=l},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";var n=a(0),s=a.n(n),i=a(28);t.a=Object(i.a)(s.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M6.66607426,13.6501686 C7.13342047,13.4117012 7.7055954,13.5972442 7.94406273,14.0645904 C8.71613228,15.5776856 10.2710663,16.5499921 12,16.5499921 C13.7262991,16.5499921 15.2792455,15.5806677 16.0525854,14.0711462 C16.2918118,13.6041881 16.8642875,13.419575 17.3312456,13.6588014 C17.7982037,13.8980278 17.9828168,14.4705034 17.7435904,14.9374615 C16.6482438,17.0755242 14.4462205,18.4499921 12,18.4499921 C9.55003677,18.4499921 7.34521255,17.0713067 6.2516524,14.928157 C6.01318507,14.4608108 6.19872805,13.8886359 6.66607426,13.6501686 Z M8.75,8 C9.44035594,8 10,8.67157288 10,9.5 C10,10.3284271 9.44035594,11 8.75,11 C8.05964406,11 7.5,10.3284271 7.5,9.5 C7.5,8.67157288 8.05964406,8 8.75,8 Z M15.25,8 C15.9403559,8 16.5,8.67157288 16.5,9.5 C16.5,10.3284271 15.9403559,11 15.25,11 C14.5596441,11 14,10.3284271 14,9.5 C14,8.67157288 14.5596441,8 15.25,8 Z"}),"Smile")},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var n=a(5),s=a.n(n),i=a(11),r=a(0),o=a.n(r),l=a(17),c=a.n(l),h=a(53),d=a(200),p=a(437),u=a(3);var m=function(e){class t extends o.a.Component{render(){return o.a.createElement(p.a,{maxSnack:u.u},o.a.createElement(e,this.props))}}return t.displayName="WithSnackbarNotifications(".concat(Object(h.b)(e),")"),t},f=a(251),g=a(125),C=a(101),v=a(74),b=a(213),E=a(214),S=a(182),y=a(215),M=a(10),I=a(126),U=a(1),k=a(15),x=a(2);a(466);class w extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaShortcut=e=>{var t=e.event;t&&this.onKeyDown(t)},this.onKeyDown=e=>{var t=e.key,a=e.code,n=e.altKey,s=e.ctrlKey,i=e.metaKey,r=e.shiftKey,o=this.props.video;if(o){var l=!1;switch(a){case"Escape":n||s||i||r||(this.handleClose(),l=!0);break;case"ArrowLeft":n||s||i||r||(this.handleSeek(o.currentTime-u.Y),l=!0);break;case"KeyJ":n||s||i||r||(this.handleSeek(o.currentTime-u.X),l=!0);break;case"ArrowRight":n||s||i||r||(this.handleSeek(o.currentTime+u.Y),l=!0);break;case"KeyL":n||s||i||r||(this.handleSeek(o.currentTime+u.X),l=!0);break;case"ArrowUp":n||s||i||r||(this.handleVolume(o.volume+u.db),l=!0);break;case"ArrowDown":n||s||i||r||(this.handleVolume(o.volume-u.db),l=!0);break;case"Space":case"KeyK":n||s||i||r||(this.handleClick(),l=!0);break;case"KeyM":n||s||i||r||(this.handleMute(),l=!0);break;case"KeyF":n||s||i||r||(this.handleFullScreen(),l=!0);break;case"KeyI":n||s||i||r||(l=!0);break;case"Digit0":case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":case"Digit6":case"Digit7":case"Digit8":case"Digit9":if(!n&&!s&&!i&&!r){var c=new Number(t.replace("Digit",""))/10;this.handleSeekProgress(c),l=!0}break;case"Home":n||s||i||r||(this.handleSeek(0),l=!0);break;case"End":n||s||i||r||(this.handleSeek(o.duration-1),l=!0);break;case"Comma":n||s||i||!r||(this.handlePlaybackRate(o.playbackRate-u.T),l=!0);break;case"Period":n||s||i||!r||(this.handlePlaybackRate(o.playbackRate+u.T),l=!0)}l&&(e.stopPropagation(),e.preventDefault())}},this.handleVolume=e=>{var t=this.props.video;t&&(e=Object(M.d)(e,u.bb,u.ab),t.volume=e,this.showMediaHint("".concat(Math.round(100*t.volume),"%")))},this.handlePlaybackRate=e=>{var t=this.props.video;t&&(e=Object(M.d)(e,u.R,u.Q),t.playbackRate=e,this.showMediaHint("".concat(e,"x")))},this.handleSeekProgress=e=>{var t=this.props.video;t&&this.handleSeek(e*t.duration)},this.handleSeek=e=>{var t=this.props.video;t&&(e=Object(M.d)(e,0,t.duration||0),t.currentTime=e,this.setState({currentTime:e}))},this.onFullScreenChange=()=>{var e=(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)===document.getElementById("pip-player-wrapper");this.setState({fullscreen:e})},this.onWindowResize=()=>{if(!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)){var e=document.getElementById("pip-player"),t=parseInt(e.style.left,10),a=parseInt(e.style.top,10),n=this.normalizePosition(t,a,!0),s=n.left,i=n.top;t===s&&a===i||(e.style.left=s+"px",e.style.top=i+"px")}},this.handleLoadedData=e=>{e.target},this.handleLoadedMetadata=e=>{var t=e.target;if(t){var a=this.state.currentTime,n=t.duration,s=t.volume,i=t.buffered;this.setState({duration:n,volume:s,waiting:!0,buffered:i},()=>{a&&(t.currentTime=a)})}},this.handleCanPlay=e=>{var t=e.target;this.setState({waiting:!1},()=>{t&&(this.state.play?t.play():t.pause())})},this.handlePlay=e=>{var t=this.props.onPlay;this.setState({play:!0,hidden:!0}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerPlay"}),t&&t(e)},this.handlePause=e=>{var t=this.props.onPause;this.setState({play:!1,hidden:!1}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerPause"}),t&&t(e)},this.handleEnded=e=>{var t=this.props.onEnded;x.a.clientUpdate({"@type":"clientUpdateMediaViewerEnded"}),t&&t(e);var a=this.props.video;this.setCurrentTime({currentTime:0,duration:a.duration})},this.handleTimeUpdate=e=>{var t=e.target;if(t){var a=this.props.fileId,n=t.currentTime,s=t.duration,i=t.volume,r=t.buffered;this.setState({duration:s,currentTime:n,volume:i,buffered:r}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerTimeUpdate",fileId:a,currentTime:n,duration:s,volume:i,buffered:r}),this.setCurrentTime({currentTime:n,duration:s})}},this.handleVolumeChange=e=>{var t=this.props.onVolumeChange,a=e.target;if(a){var n=a.volume;this.setState({volume:n}),x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:n}),t&&t(e)}},this.handleProgress=e=>{var t=e.target;if(t){var a=this.props.fileId,n=t.buffered;this.setState({buffered:n}),x.a.clientUpdate({"@type":"clientUpdateMediaViewerProgress",fileId:a,buffered:n})}},this.handleWaiting=()=>{this.setState({waiting:!0})},this.handleClick=()=>{this.startStopPlayer()},this.startStopPlayer=()=>{var e=this.props.video;e&&(this.state.waiting?this.setState({play:!this.state.play,hidden:!1}):e.paused?e.play():e.pause())},this.handlePlayerMouseDown=e=>{var t=document.getElementById("pip-player-wrapper");t&&t.focus(),this.mouseDownRoot=!0,e.preventDefault(),1===e.nativeEvent.which&&(this.offsetX=e.nativeEvent.offsetX,this.offsetY=e.nativeEvent.offsetY,document.onmousemove=this.handleMouseMove,document.onmouseup=this.handleMouseUp,this.setState({windowDragging:!0}))},this.handleMouseUp=e=>{e.preventDefault(),document.onmousemove=null,document.onmouseup=null,this.setState({windowDragging:!1})},this.handleMouseMove=e=>{e.preventDefault();var t=this.normalizePosition(e.clientX-this.offsetX,e.clientY-this.offsetY,!1),a=t.left,n=t.top,s=document.getElementById("pip-player");s.style.left=a+"px",s.style.top=n+"px"},this.handleMouseDown=e=>{e.stopPropagation();var t=this.props.video;t&&this.setState({dragging:!0,draggingTime:t.currentTime})},this.handleChange=(e,t)=>{var a=this.props.video;a&&this.setState({draggingTime:t*a.duration})},this.handleChangeCommitted=()=>{var e=this.state,t=e.dragging,a=e.draggingTime;t&&this.setState({dragging:!1,currentTime:a,draggingTime:0},()=>{var e=this.props.video;e&&Number.isFinite(a)&&(e.currentTime=a)})},this.handlePanelEnter=()=>{this.panelEnter=!0},this.handlePanelLeave=()=>{this.panelEnter=!1},this.handleMouseOver=e=>{this.mouseDownRoot=!1,this.state.hidden&&this.setState({hidden:!1}),clearTimeout(this.mouseOverTimeout),this.mouseOverTimeout=setTimeout(()=>{this.panelEnter||this.state.play&&this.state.duration&&this.setState({hidden:!0})},1e3)},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdatePictureInPicture",videoInfo:null})},this.handleVolumeSliderChange=(e,t)=>{t!==this.state.volume&&this.setState({volume:t},()=>{var e=this.props.video;e&&(e.volume=t)})},this.handleVolumeSliderChangeCommitted=e=>{this.props.video&&document.activeElement.blur()},this.handleMute=()=>{var e=this.props.video;e&&(0===e.volume?e.volume=this.prevVolume||.5:(this.prevVolume=e.volume,e.volume=0))},this.handleFullScreen=e=>{e&&e.stopPropagation();var t=document.getElementById("pip-player-wrapper");t&&(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?this.exitFullscreen():this.requestFullscreen(t))},this.getCurrentTime=()=>{var e=this.props.fileId,t=U.a.get(e);if(t){var a=t.remote;if(a){var n=a.unique_id;if(n)return k.b.getCurrentTime(n)}}},this.setCurrentTime=e=>{var t=this.props.fileId,a=U.a.get(t);if(a){var n=a.remote;if(n){var s=n.unique_id;s&&(e?k.b.setCurrentTime(s,e):k.b.clearCurrentTime(s))}}},this.handlePanelDoubleClick=e=>{e.preventDefault(),e.stopPropagation()},this.handleClickRoot=e=>{e.stopPropagation(),this.mouseDownRoot&&this.startStopPlayer()},this.handleDoubleClick=e=>{e.stopPropagation(),this.mouseDownRoot&&this.handleFullScreen(e)},this.handleFocus=()=>{I.b.add(this.keyboardHandler)},this.handleBlur=()=>{I.b.remove(this.keyboardHandler)},this.keyboardHandler=new I.a(this.onKeyDown),this.state={}}static getDerivedStateFromProps(e,t){var a=e.video,n=e.duration,s=e.currentTime,i=e.volume,r=e.play,o=e.buffered,l=e.waiting;return t.prevVideo!==a?{prevVideo:a,duration:n,currentTime:s,volume:i,play:r,buffered:o,waiting:l,dragging:!1,hidden:!1,fullscreen:!1}:null}componentDidMount(){var e=this.props.video;this.connectPlayer(e),window.addEventListener("resize",this.onWindowResize),document.addEventListener("fullscreenchange",this.onFullScreenChange),k.b.on("clientUpdateMediaShortcut",this.onClientUpdateMediaShortcut)}componentWillUnmount(){var e=this.props.video;this.disconnectPlayer(e),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("fullscreenchange",this.onFullScreenChange),k.b.off("clientUpdateMediaShortcut",this.onClientUpdateMediaShortcut),I.b.remove(this.keyboardHandler)}showMediaHint(e){var t=this.props.fileId;x.a.clientUpdate({"@type":"clientUpdateMediaHint",fileId:t,text:e})}componentDidUpdate(e,t,a){var n=this.props.video;e.video!==n&&(this.disconnectPlayer(e.video),this.connectPlayer(n))}connectPlayer(e){if(e){var t=document.getElementById("pip-player"),a=this.normalizePosition(k.b.pipParams.left,k.b.pipParams.top,!1),n=a.left,s=a.top;t.style.left=n+"px",t.style.top=s+"px",document.getElementById("pip-player-wrapper").focus();var i=document.getElementById("pip-player-container");i&&(e.onloadedmetadata=this.handleLoadedMetadata,e.onloadeddata=this.handleLoadedData,e.oncanplay=this.handleCanPlay,e.onplay=this.handlePlay,e.onpause=this.handlePause,e.onended=this.handleEnded,e.ontimeupdate=this.handleTimeUpdate,e.onvolumechange=this.handleVolumeChange,e.onprogress=this.handleProgress,e.onwaiting=this.handleWaiting,i.innerHTML="",i.appendChild(e))}}disconnectPlayer(e){e&&(e.onloadedmetadata=null,e.onloadeddata=null,e.oncanplay=null,e.onplay=null,e.onpause=null,e.onended=null,e.ontimeupdate=null,e.onvolumechange=null,e.onprogress=null,e.onwaiting=null)}normalizePosition(e,t,a=!0){var n=document.getElementById("pip-player"),s=n?n.clientWidth:300,i=n?n.clientHeight:300,r=document.documentElement.clientWidth,o=document.documentElement.clientHeight;return a&&this.glueLeft?e=0:a&&this.glueRight?e=r-s:(e=(e=e<u.M?0:e)>r-s-u.M?r-s:e,e=Object(M.d)(e,0,r-s)),a&&this.glueTop?t=0:a&&this.glueBottom?t=o-i:(t=(t=t<u.M?0:t)>o-i-u.M?o-i:t,t=Object(M.d)(t,0,o-i)),this.glueLeft=0===e,this.glueRight=e===r-s,this.glueTop=0===t,this.glueBottom=t===o-i,k.b.pipParams={left:e,top:t},{left:e,top:t}}requestFullscreen(e){var t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen;t&&t.call(e)}exitFullscreen(){var e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen;e&&e.call(document)}render(){var e=this.props.fileId,t=this.state,a=t.windowDragging,n=t.dragging,s=t.draggingTime,i=t.currentTime,r=t.duration,l=t.play,h=t.waiting,d=t.buffered,p=t.hidden,u=t.volume,m=t.fullscreen,I=n?s:i,U=r>0?I/r:0,k=S.a.getBufferedTime(I,d),x=r>0?k/r:0,w=Object(M.h)(Math.floor(I)||0),O=Object(M.h)(Math.floor(r)||0),L=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;return o.a.createElement("div",{id:"pip-player",className:c()("pip-player",{"pip-player-dragging":a,"pip-player-fullscreen":m}),onMouseDown:this.handlePlayerMouseDown,onMouseMove:this.handleMouseOver,onClick:this.handleClickRoot,onDoubleClick:this.handleDoubleClick},o.a.createElement("div",{id:"pip-player-wrapper",className:c()({"pip-player-wrapper-hidden":p}),onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0},o.a.createElement("div",{id:"pip-player-container"}),o.a.createElement(E.a,{fileId:e}),o.a.createElement("button",{onMouseDown:e=>e.stopPropagation(),className:c()("player-button","player-button-close",{"player-panel-hidden":p}),onClick:this.handleClose},o.a.createElement(g.a,null)),o.a.createElement("div",{className:c()("player-panel",{"player-panel-hidden":p}),onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onDoubleClick:this.handlePanelDoubleClick,onMouseEnter:this.handlePanelEnter,onMouseLeave:this.handlePanelLeave},o.a.createElement("div",{className:"player-slider"},o.a.createElement("span",{className:"player-slider-buffer-track",style:{width:100*x+"%"}}),o.a.createElement(f.a,{value:U,min:0,max:1,step:.001,classes:{root:"player-slider-root",rail:"player-slider-rail",track:"player-slider-track",thumb:"player-slider-thumb",active:"player-slider-active"},onChange:this.handleChange,onChangeCommitted:this.handleChangeCommitted,onMouseDown:this.handleMouseDown})),o.a.createElement("div",{className:"player-controls"},o.a.createElement("button",{className:"player-button",onClick:this.handleClick},l?o.a.createElement(C.a,null):o.a.createElement(v.a,null)),o.a.createElement("div",{className:"player-time"},"".concat(w," / ").concat(O)),o.a.createElement("div",{className:"player-volume"},o.a.createElement(f.a,{value:u,min:0,max:1,step:.001,classes:{root:"player-volume-root",rail:"player-volume-rail",track:"player-volume-track",thumb:"player-volume-thumb",active:"player-volume-active"},onChange:this.handleVolumeSliderChange,onChangeCommitted:this.handleVolumeSliderChangeCommitted})),o.a.createElement("button",{className:"player-button",onClick:this.handleMute},S.a.getVolumeIcon(u)),o.a.createElement("button",{className:"player-button",disabled:!L,onClick:this.handleFullScreen},o.a.createElement(b.a,null)))),o.a.createElement(y.a,{waiting:h})))}}var O=w,L=a(34),_=a(154),N=a(248),P=a(377),j=a(385),D=a(376),R=a(373),T=a(28),F=Object(T.a)(o.a.createElement("path",{d:"M17,2 C19.209139,2 21,3.790861 21,6 L21,20.2543508 C21,21.3589203 20.1045695,22.2543871 19,22.2543871 C18.5225775,22.2543871 18.0609035,22.0835665 17.6984173,21.772864 L12,16.8885064 L6.30158275,21.772864 C5.46293106,22.4917083 4.2003311,22.3945852 3.4814868,21.5559335 C3.17078432,21.1934473 3,20.7317733 3,20.2543508 L3,6 C3,3.790861 4.790861,2 7,2 L17,2 Z M17,4 L7,4 C5.8954305,4 5,4.8954305 5,6 L5,20.2543508 L10.6984173,15.3699931 C11.4473967,14.7280108 12.5526033,14.7280108 13.3015827,15.3699931 L19,20.2543508 L19,6 C19,4.8954305 18.1045695,4 17,4 Z"}),"Saved"),A=a(210),B=a(29),V=a(37),H=a(19);a(467);class z extends o.a.Component{constructor(e){super(e),this.onUpdateUserStatus=e=>{var t=this.state.userId;if(e.user_id===t){var a=H.a.get(t);a&&this.setState({online:Object(B.i)(a)})}};var t=Object(V.z)(e.chatId),a=H.a.get(t);this.state={userId:t,online:Object(B.i)(a)}}componentDidMount(){H.a.on("updateUserStatus",this.onUpdateUserStatus)}componentWillUnmount(){H.a.off("updateUserStatus",this.onUpdateUserStatus)}render(){var e=this.props,t=e.size,a=e.borderSize;return this.state.online?o.a.createElement("div",{className:"online-status",style:{width:t,height:t}},o.a.createElement("div",{className:"online-status-icon",style:{padding:a}},o.a.createElement("div",{className:"online-status-indicator"}))):null}}z.defaultProps={size:14,borderSize:2};var W=z,G=a(9),Z=a(8);a(468);class q extends r.Component{constructor(...e){super(...e),this.state={},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onClientUpdateChatBlob=e=>{var t=this.props.chatId,a=this.state,n=a.fileId,s=a.loaded;if(t===e.chatId&&n===e.fileId&&!s){var i=Z.a.get(t);if(!i)return null;var r=i.photo,o=Object(G.m)(r?r.small:null);this.setState({src:o})}},this.onUpdateChatPhoto=e=>{var t=this.props.chatId,a=e.chat_id,n=e.photo;if(a===t){var s=Z.a.get(t),i=s&&s.photo?s.photo.small:null,r=i?i.id:-1,o=Object(G.m)(i),l=this.state.src===o&&""!==o||-1===r;if(this.setState({fileId:r,src:o,loaded:l}),n){var c=U.a.getStore();Object(G.w)(c,t)}}},this.onUpdateChatTitle=e=>{var t=this.props,a=t.chatId,n=t.t;if(e.chat_id===a){var s=Object(V.o)(a,n);this.setState({letters:s})}},this.handleSelect=e=>{var t=this.props,a=t.chatId,n=t.onSelect;n&&(e.stopPropagation(),n(a))},this.handleLoad=()=>{this.setState({loaded:!0})}}static getDerivedStateFromProps(e,t){var a=e.chatId,n=e.t;if(t.prevChatId!==a){var s=Z.a.get(a),i=s&&s.photo?s.photo.small:null,r=i?i.id:-1,o=Object(G.m)(i);return{prevChatId:a,fileId:r,src:o,loaded:t.src===o&&""!==o||-1===r,letters:Object(V.o)(a,n)}}return null}shouldComponentUpdate(e,t){var a=this.props.chatId,n=this.state,s=n.fileId,i=n.src,r=n.loaded,o=n.letters;return e.chatId!==a||(t.fileId!==s||(t.src!==i||(t.loaded!==r||t.letters!==o)))}componentDidMount(){Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("updateChatPhoto",this.onUpdateChatPhoto),Z.a.on("updateChatTitle",this.onUpdateChatTitle),U.a.on("clientUpdateChatBlob",this.onClientUpdateChatBlob)}componentWillUnmount(){Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("updateChatPhoto",this.onUpdateChatPhoto),Z.a.off("updateChatTitle",this.onUpdateChatTitle),U.a.off("clientUpdateChatBlob",this.onClientUpdateChatBlob)}render(){var e=this.props,t=e.chatId,a=e.showOnline,n=e.showSavedMessages,s=e.onSelect,i=e.small,r=e.dialog,l=e.big,h=e.size,d=this.state,p=d.src,u=d.loaded,m=d.letters,f=null;if(h&&(f={width:h,height:h}),Object(V.ab)(t))return o.a.createElement("div",{className:c()("chat-tile",{"tile-small":i},{"tile-dialog":r},{"tile-big":l}),style:f,onClick:this.handleSelect},o.a.createElement("div",{className:c()("tile-photo","tile_color_0",{pointer:s})},o.a.createElement("div",{className:"tile-saved-messages"},o.a.createElement(A.a,{fontSize:l?"large":"default"}))));if(Object(V.cb)(t)&&n)return o.a.createElement("div",{className:c()("chat-tile",{"tile-small":i},{"tile-dialog":r},{"tile-big":l}),style:f,onClick:this.handleSelect},o.a.createElement("div",{className:c()("tile-photo","tile_color_6",{pointer:s})},o.a.createElement("div",{className:"tile-saved-messages"},o.a.createElement(F,{fontSize:l?"large":"default"}))));if(!Z.a.get(t))return null;var g=p&&u,C=Object(V.x)(t),v="tile_color_".concat(Math.abs(C)%7+1);return o.a.createElement("div",{className:c()("chat-tile",{[v]:!g},{pointer:s},{"tile-dialog":r},{"tile-small":i},{"tile-big":l}),style:f,onClick:this.handleSelect},!g&&o.a.createElement("div",{className:"tile-photo"},o.a.createElement("span",{className:"tile-text"},m)),p&&o.a.createElement("img",{className:"tile-photo",src:p,onLoad:this.handleLoad,draggable:!1,alt:""}),a&&Object(V.db)(t)&&o.a.createElement(W,{chatId:t}))}}q.defaultProps={showSavedMessages:!0,showOnline:!1};var K=Object(_.a)()(q);a(469);class J extends o.a.Component{render(){var e=this.props,t=e.chatId,a=e.selected,n=e.onSelect,s=e.t,i=Object(V.s)(t,!0,s);return o.a.createElement("div",{className:c()("forward-target-chat",{"forward-target-chat-selected":a}),onClick:n},o.a.createElement("div",{className:"forward-target-chat-tile"},o.a.createElement("div",{className:"forward-target-chat-tile-wrapper"},o.a.createElement(K,{chatId:t})),a&&o.a.createElement("div",{className:"forward-target-chat-selection"}),o.a.createElement("div",{className:c()("forward-target-chat-mark",a?"forward-target-chat-mark-selected":"forward-target-chat-mark-unselected")}),o.a.createElement("div",{className:"forward-target-chat-mark-icon"})),o.a.createElement("div",{className:"forward-target-chat-title"},i))}}var Y=Object(_.a)()(J);function X(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.clipboard){e.next=5;break}return e.next=4,navigator.clipboard.writeText(t);case 4:return e.abrupt("return",!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("[clipboard] unable to copy with clipboard.writeText",e.t0);case 10:return e.abrupt("return",$(t));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function $(e){var t,a;try{if((t=document.createElement("textarea")).contentEditable=!0,t.readOnly=!0,t.value=e,t.style.all="unset",t.style.position="fixed",t.style.top=0,t.style.clip="rect(0, 0, 0, 0)",t.style.whiteSpace="pre",t.style.webkitUserSelect="text",t.style.MozUserSelect="text",t.style.msUserSelect="text",t.style.userSelect="text",document.body.appendChild(t),t.focus(),t.select(),!(a=document.execCommand("copy")))throw new Error;return!0}catch(n){console.error("[clipboard] unable to copy with document.execCommand",a)}finally{t&&document.body.removeChild(t)}return!1}var ee=a(68),te=null;function ae(e){if(!e)return!1;var t=e.value;return!!t&&"ru"===t.value}function ne(e){if(!e)return null;if(!e.length)return null;var t=ee.a.get("language_pack_id"),a=ee.a.get("suggested_language_pack_id");if(!(ae(t)||ae(a)))return null;te=te||new Map([["q","\u0439"],["w","\u0446"],["e","\u0443"],["r","\u043a"],["t","\u0435"],["y","\u043d"],["u","\u0433"],["i","\u0448"],["o","\u0449"],["p","\u0437"],["[","\u0445"],["]","\u044a"],["a","\u0444"],["s","\u044b"],["d","\u0432"],["f","\u0430"],["g","\u043f"],["h","\u0440"],["j","\u043e"],["k","\u043b"],["l","\u0434"],[";","\u0436"],["'","\u044d"],["\\","\u0451"],["z","\u044f"],["x","\u0447"],["c","\u0441"],["v","\u043c"],["b","\u0438"],["n","\u0442"],["m","\u044c"],[",","\u0431"],[".","\u044e"]]);for(var n="",s=0;s<e.length;s++){if(!te.has(e[s]))return null;n+=te.get(e[s])}return""===n?null:n}var se=null;function ie(e){if(!e)return null;if(!e.length)return null;se=se||new Map([["\u0439","q"],["\u0446","w"],["\u0443","e"],["\u043a","r"],["\u0435","t"],["\u043d","y"],["\u0433","u"],["\u0448","i"],["\u0449","o"],["\u0437","p"],["\u0445","["],["\u044a","]"],["\u0444","a"],["\u044b","s"],["\u0432","d"],["\u0430","f"],["\u043f","g"],["\u0440","h"],["\u043e","j"],["\u043b","k"],["\u0434","l"],["\u0436",";"],["\u044d","'"],["\u0451","\\"],["\u044f","z"],["\u0447","x"],["\u0441","c"],["\u043c","v"],["\u0438","b"],["\u0442","n"],["\u044c","m"],["\u0431",","],["\u044e","."]]);for(var t="",a=0;a<e.length;a++){if(!se.has(e[a]))return null;t+=se.get(e[a])}return""===t?null:t}var re=a(30),oe=a(62),le=a(16);a(470);class ce extends o.a.Component{constructor(e){var t;super(e),t=this,this.loadContent=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.getPublicMessageLink(),a=[],n=x.a.send({"@type":"getChats",offset_order:"9223372036854775807",offset_chat_id:0,limit:100}),a.push(n),i=x.a.send({"@type":"createPrivateChat",user_id:H.a.getMyId(),force:!0}),a.push(i),e.next=8,Promise.all(a.map(e=>e.catch(e=>null)));case 8:r=e.sent,o=Object(L.a)(r,2),l=o[0],c=o[1],t.setState({chatIds:l.chat_ids,savedMessages:c}),h=U.a.getStore(),Object(G.x)(h,l.chat_ids);case 15:case"end":return e.stop()}}),e)}))),this.getPublicMessageLink=Object(i.a)(s.a.mark((function e(){var a,n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageIds,n){e.next=3;break}return e.abrupt("return");case 3:if(i){e.next=5;break}return e.abrupt("return");case 5:if(!(i.length>1)){e.next=7;break}return e.abrupt("return");case 7:if(Object(V.eb)(n)){e.next=9;break}return e.abrupt("return");case 9:if(Object(V.A)(n)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,x.a.send({"@type":"getPublicMessageLink",chat_id:n,message_id:i[0],for_album:!1});case 13:r=e.sent,t.setState({publicMessageLink:r});case 15:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(re.e)(null)},this.handleCopyLink=()=>{var e=this.props.t,t=this.state.publicMessageLink;t&&t.link&&(X(t.link),this.handleScheduledAction(e("LinkCopied")))},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(g.a,null))]})},this.getForwardPhotoSize=(e,t)=>{if(1!==t.length)return null;var a=le.a.get(e,t[0]);if(!a)return null;var n=a.can_be_forwarded,s=a.content;if(!n&&"messageChatChangePhoto"===s["@type"]){var i=s.photo;if(!i)return null;var r=i.sizes;if(r&&r.length)return r[r.length-1]}return null},this.handleSend=()=>{this.handleClose(),Object(re.a)();var e=this.props,t=e.chatId,a=e.messageIds,n=e.inputMessageContent;if(t||a||n){var s=this.getInnerText(this.messageRef.current);this.targetChats.forEach(e=>{if(n)return s&&("caption"in n?n.caption={"@type":"formattedText",text:s,entities:null}:x.a.send({"@type":"sendMessage",chat_id:e,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:s,entities:null},disable_web_page_preview:!1,clear_draft:!1}})),void x.a.send({"@type":"sendMessage",chat_id:e,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:n});var i=this.getForwardPhotoSize(t,a);if(i){var r=i.width,o=i.height,l=i.photo;x.a.send({"@type":"sendMessage",chat_id:e,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessagePhoto",photo:{"@type":"inputFileId",id:l.id},thumbnail:null,added_sticker_file_ids:[],width:r,height:o,caption:{"@type":"formattedText",text:s,entities:null},ttl:0}})}else s&&x.a.send({"@type":"sendMessage",chat_id:e,reply_to_message_id:0,disable_notifications:!1,from_background:!1,reply_markup:null,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:s,entities:null},disable_web_page_preview:!1,clear_draft:!1}}),x.a.send({"@type":"forwardMessages",chat_id:e,from_chat_id:t,message_ids:a,disable_notifications:!1,from_background:!1,as_album:!1})})}},this.handleChangeSelection=e=>{this.targetChats.has(e)?this.targetChats.delete(e):this.targetChats.set(e,e),this.forceUpdate()},this.getInnerText=e=>{var t=e.innerHTML;return"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null),e.innerText},this.handleSearchKeyDown=e=>{13===e.keyCode&&e.preventDefault()},this.handleSearchKeyUp=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d,p,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state,n=a.chatIds,i=a.savedMessages,r=t.searchRef.current){e.next=4;break}return e.abrupt("return");case 4:if("<br>"!==(o=r.innerHTML)&&"<div><br></div>"!==o||(r.innerHTML=null),l=t.getInnerText(r).trim()){e.next=10;break}return t.setState({searchText:null,searchResults:[],globalSearchResults:[]}),e.abrupt("return");case 10:return c=ie(l),h=ne(l),d=i?[i.id].concat(n.filter(e=>e!==i.id&&Object(V.f)(e))):n,p=d.filter(e=>t.hasSearchText(e,l)||c&&t.hasSearchText(e,c)||h&&t.hasSearchText(e,h)),t.setState({searchText:l,searchResults:p}),e.next=17,x.a.send({"@type":"searchChatsOnServer",query:l,limit:100});case 17:if(u=e.sent,t.state.searchText===l){e.next=20;break}return e.abrupt("return");case 20:t.setState({globalSearchResults:u.chat_ids});case 21:case"end":return e.stop()}}),e)}))),this.handleSearchPaste=e=>{var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleMessageKeyUp=()=>{var e=this.messageRef.current;if(e){var t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null)}},this.handleMessagePaste=e=>{var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.hasSearchText=(e,t)=>{var a=this.props.t,n=this.state.savedMessages;if(n&&e===n.id&&-1!==(Object(V.v)(e,!0,a)||"").toLocaleLowerCase().indexOf(t.toLowerCase()))return!0;return-1!==(Object(V.v)(e,!1,a)||"").toLocaleLowerCase().indexOf(t.toLowerCase())||-1!==(Object(V.A)(e)||"").toLocaleLowerCase().indexOf(t.toLowerCase())},this.setSearchFocus=()=>{setTimeout(()=>{this.searchRef.current&&this.searchRef.current.focus()},100)},this.state={chatIds:[],savedMessages:null},this.searchRef=o.a.createRef(),this.messageRef=o.a.createRef(),this.targetChats=new Map}componentDidMount(){this.loadContent(),this.setSearchFocus()}render(){var e=this.props.t,t=this.state,a=t.chatIds,n=t.searchText,s=t.searchResults,i=t.globalSearchResults,r=t.savedMessages,l=t.publicMessageLink,c=(r?[r.id].concat(a.filter(e=>e!==r.id&&Object(V.f)(e))):a).map(e=>o.a.createElement(Y,{key:e,chatId:e,selected:this.targetChats.has(e),onSelect:()=>this.handleChangeSelection(e)})),h=new Map((s||[]).map(e=>[e,e])),d=(i||[]).filter(e=>e!==r.id&&Object(V.f)(e)&&!h.has(e)),p=(s||[]).concat(d).map(e=>o.a.createElement(Y,{key:e,chatId:e,selected:this.targetChats.has(e),onSelect:()=>this.handleChangeSelection(e)}));return o.a.createElement(j.a,{open:!0,manager:oe.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"forward-dialog-title","aria-describedby":"forward-dialog-description",className:"forward-dialog"},o.a.createElement(R.a,{id:"forward-dialog-title"},e("ShareSendTo")),o.a.createElement("div",{ref:this.searchRef,id:"forward-dialog-search",className:"scrollbars-hidden",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("Search"),onKeyDown:this.handleSearchKeyDown,onKeyUp:this.handleSearchKeyUp,onPaste:this.handleSearchPaste}),o.a.createElement("div",{className:"forward-dialog-content"},o.a.createElement("div",{className:"forward-dialog-list"},c),n&&o.a.createElement("div",{className:"forward-dialog-search-list"},p)),this.targetChats.size>0&&o.a.createElement("div",{ref:this.messageRef,id:"forward-dialog-message",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("ShareComment"),onKeyUp:this.handleMessageKeyUp,onPaste:this.handleMessagePaste}),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleClose,color:"primary"},e("Cancel")),this.targetChats.size>0&&o.a.createElement(N.a,{onClick:this.handleSend,color:"primary",autoFocus:!0},e("Send")),!this.targetChats.size&&l&&o.a.createElement(N.a,{onClick:this.handleCopyLink,color:"primary"},e("CopyLink"))))}}var he=Object(h.a)(Object(_.a)(),p.b)(ce),de=a(489),pe=a.n(de),ue=a(219),me=a.n(ue),fe=a(488),ge=a.n(fe),Ce=Object(T.a)(o.a.createElement("path",{d:"M12.1715729,2 C12.9672223,2 13.7302841,2.31607052 14.2928932,2.87867966 L21.1213203,9.70710678 C21.6839295,10.2697159 22,11.0327777 22,11.8284271 L22,19 C22,20.6568542 20.6568542,22 19,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,5 C2,3.34314575 3.34314575,2 5,2 L12.1715729,2 Z M11,4 L5,4 C4.44771525,4 4,4.44771525 4,5 L4,19 C4,19.5522847 4.44771525,20 5,20 L19,20 C19.5522847,20 20,19.5522847 20,19 L20,13 L14,13 C12.4023191,13 11.0963391,11.75108 11.0050927,10.1762728 L11,10 L11,4 Z M19.586,11 L13,4.414 L13,10 C13,10.5128358 13.3860402,10.9355072 13.8833789,10.9932723 L14,11 L19.586,11 Z"}),"Document2"),ve=a(382),be=a(415),Ee=a(652),Se=a(653),ye=Object(T.a)(o.a.createElement("path",{d:"M19,2 C20.6568542,2 22,3.34314575 22,5 L22,19 C22,20.6568542 20.6568542,22 19,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,5 C2,3.34314575 3.34314575,2 5,2 L19,2 Z M8.95903938,14.4653367 L8.89694708,14.4202095 C8.68789701,14.291568 8.42133316,14.3352159 8.26303498,14.5116789 L8.2090719,14.5840012 L4.88033327,19.9929138 L4.93969424,19.9982115 L4.93969424,19.9982115 L12.446,20 L9.05890452,14.5810435 C9.0316623,14.5374559 8.99794603,14.4984621 8.95903938,14.4653367 L8.89694708,14.4202095 L8.95903938,14.4653367 Z M15.6580762,12.1926572 C15.4476303,12.0663122 15.1815603,12.1128758 15.0252035,12.2910614 L14.9720355,12.3639701 L12.551,16.396 L14.803,20 L19,20 C19.5410622,20 19.9817615,19.5702952 19.9994483,19.0335352 L15.8247114,12.3563345 C15.7828678,12.2893847 15.7257647,12.2332952 15.6580762,12.1926572 Z M19,4 L5,4 C4.44771525,4 4,4.44771525 4,5 L4,17.606 L6.50573804,13.5358344 C7.19919591,12.4089238 8.64230264,12.0252274 9.79631538,12.6320827 L9.94511393,12.7168756 C10.2187146,12.885239 10.4567799,13.1044297 10.6467737,13.3619985 L10.7549011,13.5210456 L11.361,14.492 L13.2573282,11.3345145 C13.9384069,10.2000794 15.3772263,9.80060652 16.5378139,10.3947912 L16.6875318,10.4779499 C16.9695672,10.6472749 17.2148477,10.8702509 17.409849,11.1335934 L17.5207081,11.2963367 L20,15.264 L20,5 C20,4.44771525 19.5522847,4 19,4 Z"}),"SharedMedia"),Me=a(155),Ie=a(177),Ue=Object(T.a)(o.a.createElement("path",{d:"M23,12L20.56,9.22L20.9,5.54L17.29,4.72L15.4,1.54L12,3L8.6,1.54L6.71,4.72L3.1,5.53L3.44,9.21L1,12L3.44,14.78L3.1,18.47L6.71,19.29L8.6,22.47L12,21L15.4,22.46L17.29,19.28L20.9,18.46L20.56,14.78L23,12M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"}),"Verified");a(471);class ke extends o.a.Component{constructor(...e){super(...e),this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdateChatTitle=e=>{var t=this.props.chatId;e.chat_id===t&&this.forceUpdate()}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.t;return e.chatId!==n||e.t!==s}componentDidMount(){Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("updateChatTitle",this.onUpdateChatTitle)}componentWillUnmount(){Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("updateChatTitle",this.onUpdateChatTitle)}render(){var e=this.props,t=e.t,a=e.chatId,n=e.showSavedMessages,s=Object(V.Y)(a),i=Object(V.v)(a,n,t);return o.a.createElement("div",{className:"dialog-title"},o.a.createElement("span",{className:"dialog-title-span"},i),s&&o.a.createElement(Ue,{className:"dialog-title-icon"}))}}ke.defaultProps={showSavedMessages:!0};var xe=Object(_.a)()(ke),we=a(63),Oe=a(39);a(472);class Le extends o.a.Component{constructor(e){super(e),this.onUpdateUserStatus=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a&&a.type){var n=!1;switch(a.type["@type"]){case"chatTypeBasicGroup":var s=we.a.getFullInfo(a.type.basic_group_id);if(s&&s.members)s.members.find(t=>t.user_id===e.user_id)&&(n=!0);break;case"chatTypePrivate":case"chatTypeSecret":a.type.user_id===e.user_id&&(n=!0)}n&&this.updateSubtitle(t)}},this.updateSubtitle=e=>{this.setState({subtitle:Object(V.u)(e),isAccent:Object(V.Q)(e)})},this.onUpdateUserFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a){var n=a.type;n&&(!n||"chatTypePrivate"!==n["@type"]&&"chatTypeSecret"!==n["@type"]||n.user_id!==e.user_id||this.updateSubtitle(t))}},this.onUpdateBasicGroupFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a){var n=a.type;n&&n&&"chatTypeBasicGroup"===n["@type"]&&n.basic_group_id===e.basic_group_id&&this.updateSubtitle(t)}},this.onUpdateSupergroupFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a){var n=a.type;n&&n&&"chatTypeSupergroup"===n["@type"]&&n.supergroup_id===e.supergroup_id&&this.updateSubtitle(t)}},this.onUpdateBasicGroup=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a){var n=a.type;n&&n&&"chatTypeBasicGroup"===n["@type"]&&n.basic_group_id===e.basic_group.id&&this.updateSubtitle(t)}},this.onUpdateSupergroup=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a){var n=a.type;n&&n&&"chatTypeSupergroup"===n["@type"]&&n.supergroup_id===e.supergroup.id&&this.updateSubtitle(t)}};var t=this.props.chatId;this.state={prevChatId:t,subtitle:Object(V.u)(t),isAccent:Object(V.Q)(t)}}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){var a=e.chatId;return{prevChatId:a,subtitle:Object(V.u)(a),isAccent:Object(V.Q)(a)}}return null}shouldComponentUpdate(e,t){var a=this.props.chatId,n=this.state,s=n.subtitle,i=n.isAccent;return e.chatId!==a||(t.subtitle!==s||t.isAccent!==i)}componentDidMount(){H.a.on("updateUserStatus",this.onUpdateUserStatus),we.a.on("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.on("updateSupergroup",this.onUpdateSupergroup),H.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}componentWillUnmount(){H.a.off("updateUserStatus",this.onUpdateUserStatus),we.a.off("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.off("updateSupergroup",this.onUpdateSupergroup),H.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}render(){var e=this.props.subtitle,t=this.state,a=t.subtitle,n=t.isAccent;return o.a.createElement("div",{className:c()("dialog-status",{"dialog-status-accent":n})},e?e+", ":null,a)}}var _e=Le;a(473);class Ne extends o.a.Component{constructor(e){super(e),this.handleClick=()=>{var e=this.props,t=e.chatId,a=e.onSelect;a&&a(t)};var t=this.props.chatId;this.state={chat:Z.a.get(t)}}shouldComponentUpdate(e,t){return e.chatId!==this.props.chatId}render(){var e=this.props,t=e.chatId,a=e.subtitle,n=e.onTileSelect,s=e.showStatus,i=e.showSavedMessages,r=e.big,l=e.showTitle,h=Object(V.cb)(t);return o.a.createElement("div",{className:c()("chat",{"chat-big":r}),onClick:this.handleClick},o.a.createElement("div",{className:"chat-wrapper"},o.a.createElement(K,{big:r,chatId:t,onSelect:n,showSavedMessages:i}),l&&o.a.createElement("div",{className:"chat-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},o.a.createElement(xe,{chatId:t,showSavedMessages:i})),s&&(!h||!i)&&o.a.createElement("div",{className:"tile-second-row"},o.a.createElement(_e,{chatId:t,subtitle:a})))))}}Ne.defaultProps={showSavedMessages:!0,showStatus:!0,showTitle:!0};var Pe=Ne,je=Object(T.a)(o.a.createElement("path",{d:"M4.29289322,11.2928932 L11.2928932,4.29289322 C11.6834175,3.90236893 12.3165825,3.90236893 12.7071068,4.29289322 C13.0675907,4.65337718 13.0953203,5.22060824 12.7902954,5.61289944 L12.7071068,5.70710678 L7.414,11 L19,11 C19.5128358,11 19.9355072,11.3860402 19.9932723,11.8833789 L20,12 C20,12.5128358 19.6139598,12.9355072 19.1166211,12.9932723 L19,13 L7.414,13 L12.7071068,18.2928932 C13.0675907,18.6533772 13.0953203,19.2206082 12.7902954,19.6128994 L12.7071068,19.7071068 C12.3466228,20.0675907 11.7793918,20.0953203 11.3871006,19.7902954 L11.2928932,19.7071068 L4.29289322,12.7071068 C3.93240926,12.3466228 3.90467972,11.7793918 4.20970461,11.3871006 L4.29289322,11.2928932 L11.2928932,4.29289322 L4.29289322,11.2928932 Z"}),"Back");a(474);class De extends o.a.Component{constructor(e){super(e)}render(){var e=this.props,t=e.chatId,a=e.t,n=e.backButton,s=e.onClick,i=e.onClose,r=a("ChatInfo");return Object(V.db)(t)?r=a("Info"):Object(V.R)(t)&&(r=a("ChannelInfo")),o.a.createElement("div",{className:"header-master"},n&&o.a.createElement(P.a,{className:"header-left-button",onClick:i},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:s},o.a.createElement("span",{className:"header-status-content"},r)),!n&&o.a.createElement(P.a,{className:"header-right-button",onClick:i},o.a.createElement(g.a,null)))}}var Re=Object(_.a)()(De),Te=a(426),Fe=a(176),Ae=a(102);class Be extends o.a.Component{constructor(e){super(e),this.onUpdateChatNotificationSettings=e=>{var t=e.chat_id,a=this.props.chatId;t&&t===a&&this.setState({isMuted:Object(V.U)(a)})},this.onUpdateScopeNotificationSettings=e=>{var t=this.props.chatId,a=Z.a.get(t);switch(e.scope["@type"]){case"notificationSettingsScopeGroupChats":"chatTypeBasicGroup"!==a.type["@type"]&&"chatTypeSupergroup"!==a.type["@type"]||this.setState({isMuted:Object(V.U)(t)});break;case"notificationSettingsScopePrivateChats":"chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||this.setState({isMuted:Object(V.U)(t)})}},this.handleSetChatNotifications=()=>{this.setState({isMuted:!this.state.isMuted}),this.debouncedSetChatNotificationSettings()},this.setChatNotificationSettings=()=>{var e=this.props.chatId,t=this.state.isMuted;Object(Fe.i)(e,t)};var t=e.chatId;this.state={prevChatId:t,isMuted:Object(V.U)(t)},this.debouncedSetChatNotificationSettings=Object(M.f)(this.setChatNotificationSettings,u.D)}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){var a=e.chatId;return{prevChatId:a,isMuted:Object(V.U)(a)}}return null}componentDidMount(){Z.a.on("updateChatNotificationSettings",this.onUpdateChatNotificationSettings),Ae.a.on("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}componentWillUnmount(){Z.a.off("updateChatNotificationSettings",this.onUpdateChatNotificationSettings),Ae.a.off("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}}var Ve=Be;a(475);var He=Object(_.a)()(class extends Ve{render(){var e=this.props.t,t=this.state.isMuted;return o.a.createElement(be.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleSetChatNotifications},o.a.createElement(Ee.a,null,o.a.createElement(Te.a,{className:"notifications-checkbox",edge:"start",checked:!t,color:"primary",tabIndex:-1,disableRipple:!0,onChange:this.handleSetChatNotifications})),o.a.createElement(Se.a,{primary:o.a.createElement(Me.a,{variant:"inherit",noWrap:!0},e("Notifications")),secondary:e(t?"PopupDisabled":"PopupEnabled")}))}}),ze=a(444);a(476);class We extends o.a.Component{constructor(e){super(e),this.onUpdateMessageContent=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.onUpdateDeleteMessages=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.onUpdateNewMessage=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.message.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.hasObserver=()=>"ResizeObserver"in window,this.onWindowResize=()=>{this.setSelection(!0)},this.setMediaState=(e,t)=>{var a=this.props.chatId,n=e?e.photoAndVideo:[],s=e?e.document:[],i=e?e.audio:[],r=e?e.url:[],o=e?e.voiceNote:[],l=e?e.groupsInCommon:[],c=n.length>0,h=s.length>0,d=i.length>0,p=r.length>0,u=o.length>0,m=l.length>0;(-1===t||1===t&&!c||2===t&&!h||3===t&&!d||4===t&&!p||5===t&&!u||6===t&&!m)&&(c?t=1:h?t=2:d?t=3:p?t=4:u?t=5:m&&(t=6),x.a.clientUpdate({"@type":"clientUpdateMediaTab",chatId:a,index:t})),this.setState({selectedIndex:t,photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l},()=>{this.hasObserver()||this.setSelection()})},this.onClientUpdateChatMedia=e=>{var t=this.props.chatId,a=this.state.selectedIndex,n=e.chatId,s=e.media;n===t&&this.setMediaState(s,a)},this.onClientUpdateMediaTab=e=>{var t=e.chatId,a=e.index;t===this.props.chatId&&this.setState({selectedIndex:a},()=>{this.hasObserver()||this.setSelection()})},this.setSelection=(e=!0)=>{var t=this.state,a=t.selectedIndex;t.isSmallWidth;if(-1!==a){var n=this.filtersRef.current,s=null,i=0,r=this.filterRef.get("photoAndVideo");1===a&&r&&(i=(s=r.firstChild).offsetLeft);var o=this.filterRef.get("document");2===a&&o&&(i=(s=o.firstChild).offsetLeft);var l=this.filterRef.get("audio");3===a&&l&&(i=(s=l.firstChild).offsetLeft);var c=this.filterRef.get("url");4===a&&c&&(i=(s=c.firstChild).offsetLeft);var h=this.filterRef.get("voiceNote");5===a&&h&&(i=(s=h.firstChild).offsetLeft);var d=this.filterRef.get("groupsInCommon");if(6===a&&d&&(i=(s=d.firstChild).offsetLeft),s){var p=this.filterSelectionRef.current;if(p){var u=e?"transition: left 0.25s ease, width 0.25s ease":null;p.style.cssText="left: ".concat(i-3,"px; width: ").concat(s.scrollWidth+6,"px; ").concat(u)}if(s&&e){var m=this.animator;m&&m.stop(),this.animator=new ze.a(250,[{from:n.scrollLeft,to:Object(M.d)(i-n.offsetWidth/2+s.offsetWidth/2,0,n.scrollWidth-n.offsetWidth),func:e=>n.scrollLeft=e}]),setTimeout(()=>{this.animator&&this.animator.start()},0)}}}},this.handleFilterClick=(e,t)=>{if(!e||0===e.button){var a=this.props,n=a.chatId,s=a.onClick;s&&s(e),x.a.clientUpdate({"@type":"clientUpdateMediaTab",chatId:n,index:t})}},this.filterRef=new Map,this.filtersRef=o.a.createRef(),this.filterSelectionRef=o.a.createRef(),this.state={},this.onWindowResize=Object(M.D)(this.onWindowResize,250)}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){var a=le.a.getMedia(e.chatId),n=a?a.photoAndVideo:[],s=a?a.document:[],i=a?a.audio:[],r=a?a.url:[],o=a?a.voiceNote:[],l=a?a.groupsInCommon:[],c=-1;return n.length>0?c=1:s.length>0?c=2:i.length>0?c=3:r.length>0?c=4:o.length>0?c=5:l.length>0&&(c=6),{prevChatId:e.chatId,selectedIndex:c,photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l,isSmallWidth:!1}}return null}componentDidMount(){this.observeResize(),this.setSelection(),le.a.on("clientUpdateMediaTab",this.onClientUpdateMediaTab),le.a.on("clientUpdateChatMedia",this.onClientUpdateChatMedia),le.a.on("updateNewMessage",this.onUpdateNewMessage),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentDidUpdate(e,t,a){this.unobserveResize(),this.observeResize()}componentWillUnmount(){this.unobserveResize(),le.a.off("clientUpdateMediaTab",this.onClientUpdateMediaTab),le.a.off("clientUpdateChatMedia",this.onClientUpdateChatMedia),le.a.off("updateNewMessage",this.onUpdateNewMessage),le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.off("updateMessageContent",this.onUpdateMessageContent)}observeResize(){if(this.hasObserver()){var e=this.filtersRef.current;if(e){var t=new ResizeObserver(this.onWindowResize);t.observe(e),this.resizeObserver={observer:t,filters:e}}}}unobserveResize(){if(this.hasObserver()&&this.resizeObserver){var e=this.resizeObserver,t=e.observer,a=e.filters;t&&a&&t.unobserve(a)}}render(){var e=this.props.t,t=this.state,a=t.selectedIndex,n=t.photoAndVideo,s=t.document,i=t.audio,r=t.url,l=t.voiceNote,h=t.groupsInCommon,d=(n.length>0?1:0)+(s.length>0?1:0)+(i.length>0?1:0)+(r.length>0?1:0)+(l.length>0?1:0)+(h.length>0?1:0);return n.length>0||s.length>0||i.length>0||r.length>0||l.length>0||h.length>0?(this.filterRef=new Map,o.a.createElement("div",{className:c()("tabs","shared-media-tabs")},o.a.createElement("div",{className:"tabs-bottom-border"}),o.a.createElement("div",{ref:this.filtersRef,className:c()("filters",{"shared-media-tabs-container":d>1})},n.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("photoAndVideo",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":1===a}),onMouseDown:e=>this.handleFilterClick(e,1)},o.a.createElement("span",null,e("SharedMediaTab2"))),s.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("document",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":2===a}),onMouseDown:e=>this.handleFilterClick(e,2)},o.a.createElement("span",null,e("SharedFilesTab2"))),i.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("audio",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":3===a}),onMouseDown:e=>this.handleFilterClick(e,3)},o.a.createElement("span",null,e("SharedMusicTab2"))),r.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("url",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":4===a}),onMouseDown:e=>this.handleFilterClick(e,4)},o.a.createElement("span",null,e("SharedLinksTab2"))),l.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("voiceNote",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":5===a}),onMouseDown:e=>this.handleFilterClick(e,5)},o.a.createElement("span",null,e("SharedVoiceTab2"))),h.length>0&&o.a.createElement("div",{ref:e=>this.filterRef.set("groupsInCommon",e),className:c()("filter",{"shared-media-tab":d>1},{"item-selected":6===a}),onMouseDown:e=>this.handleFilterClick(e,6)},o.a.createElement("span",null,e("SharedGroupsTab2"))),o.a.createElement("div",{ref:this.filterSelectionRef,className:"filter-selection"})))):null}}var Ge=Object(_.a)()(We),Ze=a(23),qe=a(381),Ke=a(654),Je=a(379),Ye=a(478),Xe=a.n(Ye),Qe=Object(T.a)(o.a.createElement("path",{d:"M18,6.5 C18.5522847,6.5 19,6.94771525 19,7.5 L19,18 C19,19.6568542 17.6568542,21 16,21 L8,21 C6.34314575,21 5,19.6568542 5,18 L5,7.5 C5,6.94771525 5.44771525,6.5 6,6.5 L18,6.5 Z M17,8.5 L7,8.5 L7,18 C7,18.5522847 7.44771525,19 8,19 L16,19 C16.5522847,19 17,18.5522847 17,18 L17,8.5 Z M10,2 L14,2 C14.2210137,2 14.434484,2.07316447 14.6080295,2.20608063 L14.7071068,2.29289322 L15.415,3 L19,3 C19.5128358,3 19.9355072,3.38604019 19.9932723,3.88337887 L20,4 C20,4.51283584 19.6139598,4.93550716 19.1166211,4.99327227 L19,5 L5,5 C4.44771525,5 4,4.55228475 4,4 C4,3.48716416 4.38604019,3.06449284 4.88337887,3.00672773 L5,3 L8.584,3 L9.29289322,2.29289322 C9.44917353,2.1366129 9.65185492,2.03740171 9.86855602,2.00867243 L10,2 L14,2 L10,2 Z"}),"Delete"),$e=Object(T.a)(o.a.createElement("path",{d:"M11.8025478,4.79529691 C11.8025478,3.93005081 12.5039683,3.22863025 13.3692144,3.22863025 C13.7633775,3.22863025 14.1430567,3.37720768 14.4325315,3.64473128 L22.2284036,10.8494344 C22.8638434,11.4366882 22.9029059,12.4278772 22.2883553,13.0917108 L22.2284036,13.1505656 L14.4325315,20.3552687 C13.7970916,20.9425225 12.8059026,20.90346 12.2186488,20.2680201 C11.9511252,19.9785454 11.8025478,19.5988662 11.8025478,19.2047031 L11.8025478,16.4249931 C8.21922017,16.6092505 5.79479016,17.8111183 4.43312712,19.9909578 L4.29164834,20.2262356 C3.95336498,20.8131459 3.20334729,21.0146979 2.61643694,20.6764146 C2.24185558,20.4605134 2.00860424,20.0633528 2.00249611,19.6310483 C1.8981509,12.2459874 5.13388305,8.13673748 11.4825227,7.6491321 L11.8025478,7.62777147 L11.8025478,4.79529691 Z M13.8025478,5.78581808 L13.8025478,8.6 C13.8025478,9.15228475 13.3548325,9.6 12.8025478,9.6 C7.49232524,9.6 4.65375859,12.0566924 4.1006582,17.2535243 C6.09650127,15.345115 9.01935671,14.4 12.8025478,14.4 C13.3548325,14.4 13.8025478,14.8477153 13.8025478,15.4 L13.8025478,18.2142808 L20.5271714,12.0005066 L13.8025478,5.78581808 Z"}),"Share");a(477);class et extends o.a.Component{constructor(...e){super(...e),this.handleOpenMessage=e=>{var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(re.i)(a,n)},this.handleForward=e=>{var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(re.f)(a,[n])},this.handleDelete=e=>{var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(re.c)(a,[n])}}render(){var e=this.props,t=e.t,a=e.chatId,n=e.messageId,s=e.open,i=e.onClose,r=e.anchorPosition,l=e.showOpenMessage,c=le.a.get(a,n);if(!c)return null;var h=c.can_be_forwarded,d=c.can_be_deleted_only_for_self,p=c.can_be_deleted_for_all_users;return o.a.createElement(Je.a,{open:s,onClose:i,anchorReference:"anchorPosition",anchorPosition:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation()},o.a.createElement(qe.a,null,l&&o.a.createElement(Ke.a,{onClick:this.handleOpenMessage},o.a.createElement(Ee.a,null,o.a.createElement(Xe.a,null)),o.a.createElement(Se.a,{primary:t("GoToMessage")})),h&&o.a.createElement(Ke.a,{onClick:this.handleForward},o.a.createElement(Ee.a,null,o.a.createElement($e,null)),o.a.createElement(Se.a,{primary:t("Forward")})),(d||p)&&o.a.createElement(Ke.a,{color:"secondary",onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:t("Delete")}))))}}var tt=Object(_.a)()(et),at=a(36);a(479);class nt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={},this.onClientUpdatePhotoBlob=e=>{var t=this.state,a=t.photoSize,n=t.thumbSize,s=e.fileId;(a&&a.photo&&a.photo.id===s||n&&n.photo&&n.photo.id===s)&&this.forceUpdate()},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}static getDerivedStateFromProps(e,t){var a=e.photo,n=e.size,s=e.thumbnailSize;return a!==t.prevPhoto?{prevPhoto:a,contextMenu:!1,left:0,top:0,photoSize:Object(M.q)(a.sizes,n),thumbSize:Object(M.q)(a.sizes,s),minithumbnail:a.minithumbnail}:null}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId,r=n.photo,o=n.showOpenMessage,l=this.state,c=l.contextMenu,h=l.left,d=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.photo||(o!==e.showOpenMessage||(c!==t.contextMenu||(h!==t.left||d!==t.top)))))}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.openMedia,s=e.showOpenMessage,i=e.style,r=this.state,l=r.minithumbnail,c=r.thumbSize,h=r.photoSize,d=r.contextMenu,p=r.left,u=r.top;if(!h)return null;var m=l?"data:image/jpeg;base64, "+l.data:null,f=Object(G.m)(c?c.photo:null),g=Object(G.m)(h.photo);m||Object(at.m)(c);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-photo",style:i,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"shared-photo-content",style:{backgroundImage:"url(".concat(f||m,")"),backgroundSize:"cover"}},g!==f&&o.a.createElement("div",{className:"shared-photo-main-content",style:{backgroundImage:"url(".concat(g,")")}}))),o.a.createElement(tt,{chatId:t,messageId:a,anchorPosition:{top:u,left:p},open:d,showOpenMessage:s,onClose:this.handleCloseContextMenu}))}}nt.defaultProps={size:u.K,thumbnailSize:u.L};var st=nt,it=a(35);a(480);class rt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId,r=n.showOpenMessage,o=this.state,l=o.contextMenu,c=o.left,h=o.top;return s!==e.chatId||(i!==e.messageId||(r!==e.showOpenMessage||(l!==t.contextMenu||(c!==t.left||h!==t.top))))}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.showOpenMessage,s=e.i18n,i=this.state,r=i.contextMenu,l=i.left,c=i.top,h=le.a.get(t,a);if(!h)return null;var d=h.date,p=new Date(1e3*d).toLocaleDateString([s.language],{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",hour12:!1});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-document",onContextMenu:this.handleOpenContextMenu},Object(at.f)(h,()=>Object(it.T)(t,a,!0),{date:p})),o.a.createElement(tt,{chatId:t,messageId:a,anchorPosition:{top:c,left:l},open:r,showOpenMessage:n,onClose:this.handleCloseContextMenu}))}}var ot=Object(_.a)()(rt),lt=a(84);a(481);class ct extends o.a.Component{constructor(...e){super(...e),this.onClientUpdatePhotoBlob=e=>{var t=this.props.thumbnail;if(t){var a=t.file||t.photo;a&&e.fileId===a.id&&this.forceUpdate()}}}componentDidMount(){U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}componentWillUnmount(){U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.thumbnail,s=e.minithumbnail,i=e.title,r=s?"data:image/jpeg;base64, "+s.data:null,l=Object(G.m)(n?n.file||n.photo:null),h=!l&&r||Object(at.m)(n,u.Fb),d=Object(it.F)(t,a),p=Boolean(l||r),m="tile_color_".concat(Math.abs(i.charCodeAt(0))%7+1);return o.a.createElement("div",{className:c()("shared-link-tile",{[m]:!p})},p?o.a.createElement("img",{className:c()("shared-link-tile-photo",{"shared-link-tile-photo-round":d},{"media-blurred":l&&h},{"media-mini-blurred":!l&&r&&h}),draggable:!1,src:l||r,alt:""}):o.a.createElement("span",null,i))}}var ht=ct,dt=a(211);a(482);class pt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId,r=n.webPage,o=n.caption,l=n.showOpenMessage,c=this.state,h=c.contextMenu,d=c.left,p=c.top;return s!==e.chatId||(i!==e.messageId||(r!==e.webPage||(o!==e.caption||(l!==e.showOpenMessage||(h!==t.contextMenu||(d!==t.left||p!==t.top))))))}static isValidEntity(e){if(!e)return!1;var t=e.type;return!!t&&("textEntityTypeUrl"===t["@type"]||"textEntityTypeTextUrl"===t["@type"]||"textEntityTypeEmailAddress"===t["@type"])}getTitleFromUrl(e){try{e=e.startsWith("http")?e:"http://"+e;var t=decodeURI(e),a=new URL(t).hostname.split("."),n=a.length>=2?a[a.length-2]:new URL(t).hostname;return dt.a.ToUnicode(n)}catch(s){console.error("url: "+e+"\n"+s)}return null}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.webPage,s=e.showOpenMessage,i=this.state,r=i.contextMenu,l=i.left,c=i.top,h=le.a.get(t,a);if(!h)return null;var d=null,p=null,m=null,f=n||{title:"",description:{"@type":"formattedText",text:"",entities:[]},photo:null,animation:null,audio:null,document:null,sticker:null,video:null,video_note:null,url:""},g=(f.display_url,f.description),C=f.photo,v=f.title,b=f.url,E=f.animation,S=f.audio,y=f.document,I=f.sticker,U=f.video,k=f.video_note;E?(p=E.minithumbnail,d=E.thumbnail):S?(p=S.album_cover_minithumbnail,d=S.album_cover_thumbnail):y?(p=y.minithumbnail,d=y.thumbnail):I?(p=I.minithumbnail,d=I.thumbnail):U?(p=U.minithumbnail,d=U.thumbnail):k&&(p=k.minithumbnail,d=k.thumbnail),d||p||!C||(p=C.minithumbnail,d=Object(M.m)(C.sizes,u.K));var x=h.content,w=x.text,O=x.caption;if(w=w||O){var L=w.entities;if(L&&L.length>0){var _=L.filter(pt.isValidEntity),N=_.length>1||w.text.length>40,P=1===L.length&&0===L[0].offset&&L[0].length===w.text.length,j=_.map((e,t)=>{var a=Object(it.V)(w.text,e.offset,e.offset+e.length);b=a;var n=!1;switch(e.type["@type"]){case"textEntityTypeTextUrl":var s=e.type.url;s&&(b=s);break;case"textEntityTypeUrl":break;case"textEntityTypeEmailAddress":n=!0}return v=v||this.getTitleFromUrl(b)||" ",o.a.createElement(lt.a,{key:t,className:"shared-link-url",url:b,mail:n},a)});if(N){var D=(_.length>0&&_[0].offset>0?w.text.substring(0,_[0].offset):w.text)||g.text||"";D=D.trim(),m=o.a.createElement(o.a.Fragment,null,D&&!P&&o.a.createElement("div",{className:"web-page-description"},D),o.a.createElement("div",null,j))}else{var R=g.text||"";R=R.trim(),m=o.a.createElement(o.a.Fragment,null,R&&o.a.createElement("div",{className:"web-page-description"},R),o.a.createElement("div",{className:"shared-link-text"},Object(it.n)(w,e=>e,{isValidEntity:pt.isValidEntity})))}n&&(v=v||this.getTitleFromUrl(b))}}return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-link",onContextMenu:this.handleOpenContextMenu},o.a.createElement(ht,{minithumbnail:p,thumbnail:d,title:Object(M.i)(this.getTitleFromUrl(b))}),o.a.createElement("div",{className:"shared-link-content"},v&&o.a.createElement("div",{className:"web-page-title"},v),m)),o.a.createElement(tt,{chatId:t,messageId:a,anchorPosition:{top:c,left:l},open:r,showOpenMessage:s,onClose:this.handleCloseContextMenu}))}}var ut=pt,mt=a(136),ft=a(119),gt=a(33),Ct=a(212);a(483);class vt extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId,r=n.voiceNote,o=n.showOpenMessage,l=this.state,c=l.contextMenu,h=l.left,d=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.voiceNote||(o!==e.showOpenMessage||(c!==t.contextMenu||(h!==t.left||d!==t.top)))))}render(){var e=this.props,t=e.chatId,a=e.i18n,n=e.messageId,s=e.voiceNote,i=e.openMedia,r=e.showOpenMessage,l=this.state,c=l.contextMenu,h=l.left,d=l.top,p=le.a.get(t,n);if(!p)return null;if(!s)return null;var u=p.date,m=p.sender_user_id,f=new Date(1e3*u).toLocaleDateString([a.language],{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",hour12:!1}),g=s.duration,C=s.voice;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-voice-note",onContextMenu:this.handleOpenContextMenu},o.a.createElement(Ct.a,{chatId:t,messageId:n,file:C,openMedia:i}),o.a.createElement("div",{className:"voice-note-content"},o.a.createElement("div",{className:"document-title"},o.a.createElement(gt.a,{chatId:t,messageId:n,userId:m})),o.a.createElement("div",{className:"voice-note-meta"},o.a.createElement(mt.a,{chatId:t,messageId:n,duration:g,file:C,date:f}),o.a.createElement(ft.a,{chatId:t,messageId:n,icon:"\xa0\u2022"})))),o.a.createElement(tt,{chatId:t,messageId:n,anchorPosition:{top:d,left:h},open:c,showOpenMessage:r,onClose:this.handleCloseContextMenu}))}}var bt=Object(_.a)()(vt);a(484);class Et extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,left:0,top:0},this.onClientUpdateVideoThumbnailBlob=e=>{var t=this.props.video.thumbnail,a=e.fileId;if(t){var n=t.file;n&&n.id===a&&this.forceUpdate()}},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})}}componentDidMount(){U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateVideoThumbnailBlob)}componentWillUnmount(){U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateVideoThumbnailBlob)}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId,r=n.video,o=n.showOpenMessage,l=this.state,c=l.contextMenu,h=l.left,d=l.top;return s!==e.chatId||(i!==e.messageId||(r!==e.video||(o!==e.showOpenMessage||(c!==t.contextMenu||(h!==t.left||d!==t.top)))))}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.openMedia,s=e.style,i=e.showOpenMessage,r=this.props.video,l=r.minithumbnail,h=r.thumbnail,d=r.duration,p=this.state,u=p.contextMenu,m=p.left,f=p.top,g=l?"data:image/jpeg;base64, "+l.data:null,C=Object(G.m)(h?h.file:null),v=C?Object(at.m)(h):Boolean(g);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"shared-photo",style:s,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"shared-video-wrapper"},o.a.createElement("div",{className:c()("shared-video-content",{"media-blurred":v,"media-mini-blurred":!C&&v}),style:{backgroundImage:"url(".concat(C||g,")")}}),o.a.createElement("div",{className:"shared-video-meta"},Object(M.h)(d)))),o.a.createElement(tt,{chatId:t,messageId:a,anchorPosition:{top:f,left:m},open:u,showOpenMessage:i,onClose:this.handleCloseContextMenu}))}}Et.defaultProps={size:u.K,thumbnailSize:u.L};var St=Et;a(485);class yt extends o.a.Component{constructor(e){var t;super(e),t=this,this.onUpdateMessageContent=e=>{var t=e.chat_id,a=e.message_id,n=this.props.chatId;if(n===t){var s=this.state,i=s.items,r=s.selectedIndex;if(i.some(e=>e.id===a)){var o=le.a.getMedia(n);this.setMediaState(o,r)}}},this.onWindowResize=e=>{var t=this.state,a=t.items,n=t.scrollTop,s=this.listRef.current;if(s){var i=s.offsetTop,r=s.offsetParent.offsetHeight,o=this.getRenderIds(a,r,n-i);this.setState(Object(Ze.a)({},o))}},this.onUpdateMessageSend=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.message.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.onUpdateNewMessage=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.message.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.onUpdateDeleteMessages=e=>{var t=this.props.chatId,a=this.state.selectedIndex;if(t===e.chat_id){var n=le.a.getMedia(t);this.setMediaState(n,a)}},this.setMediaState=(e,t)=>{var a=this.state.scrollTop,n=e?e.photoAndVideo:[],s=e?e.document:[],i=e?e.audio:[],r=e?e.url:[],o=e?e.voiceNote:[],l=e?e.groupsInCommon:[],c=n.length>0,h=s.length>0,d=i.length>0,p=r.length>0,m=o.length>0,f=l.length>0;(-1===t||1===t&&!c||2===t&&!h||3===t&&!d||4===t&&!p||5===t&&!m||6===t&&!f)&&(c?t=1:h?t=2:d?t=3:p?t=4:m?t=5:f&&(t=6));var g=yt.getSource(t,e).filter(e=>yt.isValidContent(t,e.content)).slice(0,u.Ab),C=this.listRef.current;if(C){var v=C.offsetTop,b=C.offsetParent.offsetHeight;this.setState({selectedIndex:t,renderIds:this.getRenderIds(g,b,a-v),rowHeight:yt.getRowHeight(t),items:g,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:yt.getFilter(t)},photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l})}},this.onClientUpdateMediaTab=e=>{var t=this.props.chatId,a=e.chatId,n=e.index;if(a===t){var s=le.a.getMedia(t),i=s?s.photoAndVideo:[],r=s?s.document:[],o=s?s.audio:[],l=s?s.url:[],c=s?s.voiceNote:[],h=s?s.groupsInCommon:[],d=[];1===n?d=i:2===n?d=r:3===n?d=o:4===n?d=l:5===n?d=c:6===n&&(d=h),d=d.filter(e=>yt.isValidContent(n,e.content)),this.setState({selectedIndex:n,renderIds:new Map,rowHeight:yt.getRowHeight(n),items:d.slice(0,u.Ab),photoAndVideo:i,document:r,audio:o,url:l,voiceNote:c,groupsInCommon:h,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:yt.getFilter(n)}})}},this.onClientUpdateChatMedia=e=>{var t=this.props.chatId,a=this.state.selectedIndex,n=e.chatId;if(n===t){var s=le.a.getMedia(n);this.setMediaState(s,a)}},this.handleScroll=(e,t)=>{var a=this.state.params;a&&!a.completed&&this.onLoadNext(a)},this.handleVirtScroll=(e,t)=>{this.listRef.current&&this.setScrollPosition(t.scrollTop)},this.isVisibleItem=(e,t,a)=>{var n=this.state.rowHeight;return e*n>a-5*n&&(e+1)*n<a+t+5*n},this.setScrollPosition=e=>{var t=this.state,a=t.items,n=t.scrollTop,s=t.rowHeight,i=this.listRef.current;if(i){var r=i.offsetTop,o=i.offsetParent.offsetHeight;if(Math.abs(e-n)>=s){var l=this.getRenderIds(a,o,e-r);this.setState(Object(Ze.a)({scrollTop:e},l))}}},this.onLoadNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,h,d,p,m,f,g,C,v,b;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=t.state,o=r.items,l=r.selectedIndex,c=a.completed,h=a.filter,d=a.loading,p=a.messages,6!==l){e.next=5;break}return e.abrupt("return");case 5:if(h){e.next=7;break}return e.abrupt("return");case 7:if(!d){e.next=9;break}return e.abrupt("return");case 9:if(!c){e.next=11;break}return e.abrupt("return");case 11:return m=o.length>0?o[o.length-1].id:0,p&&(m=p.length>0?p[p.length-1].id:0),a.loading=!0,a.requestId=new Date,e.next=17,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:m,offset:0,limit:u.Ab,filter:h}).finally(()=>{a.loading=!1});case 17:if(f=e.sent,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:m,offset:0,limit:2*u.Ab,filter:h}),(g=t.state.params)&&g.requestId===a.requestId){e.next=22;break}return e.abrupt("return");case 22:C=f.messages,a.messages=C,a.completed=0===C.length||0===C.total_count,a.items=o.concat(C.filter(e=>yt.isValidMessage(l,e))),v=n&&C.length>0&&C.length<u.Ab,le.a.setItems(f.messages),b=U.a.getStore(),Object(G.B)(b,f.messages),t.setState({items:a.items}),a.completed?t.onLoadMigratedNext(a,!0):v&&t.onLoadNext(a,!1);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleOpen=e=>{var t=this.props.popup;switch(e["@type"]){case"message":var a=e.chat_id,n=e.id;Object(it.T)(a,n,!1);break;case"chat":var s=e.id;Object(re.i)(s),t&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})}},this.listRef=o.a.createRef(),this.state={scrollTop:0}}static getItemHeight(e){if(e)switch(e["@type"]){case"message":switch(e.content["@type"]){case"messagePhoto":case"messageVideo":return;case"messageDocument":return 78;case"messageAudio":return 94;case"messageVoiceNote":return 74;default:return}case"chat":return 74;default:return}}static getRowHeight(e){switch(e){case 1:return;case 2:return 78;case 3:return 94;case 4:return;case 5:case 6:return 74}}static isValidMessage(e,t){return!!t&&yt.isValidContent(e,t.content)}static isValidContent(e,t){switch(e){case 1:return yt.isValidPhotoAndVideoContent(t);case 2:return yt.isValidDocumentContent(t);case 3:return yt.isValidAudioContent(t);case 4:return yt.isValidUrlContent(t);case 5:return yt.isValidVoiceNoteContent(t);case 6:return!0}return!1}static isValidPhotoAndVideoContent(e){return e&&("messagePhoto"===e["@type"]||"messageVideo"===e["@type"])}static isValidAudioContent(e){return e&&"messageAudio"===e["@type"]}static isValidDocumentContent(e){return e&&("messageDocument"===e["@type"]||"messageAudio"===e["@type"])}static isValidUrlContent(e){if(!e)return!1;var t=e.web_page,a=e.text,n=e.caption;if(t)return!0;if(!a&&!n)return!1;var s=(a||n).entities;return!!s&&s.find(e=>"textEntityTypeUrl"===e.type["@type"]||"textEntityTypeTextUrl"===e.type["@type"]||"textEntityTypeEmailAddress"===e.type["@type"])}static isValidVoiceNoteContent(e){return e&&"messageVoiceNote"===e["@type"]}static getFilter(e){switch(e){case 1:return{"@type":"searchMessagesFilterPhotoAndVideo"};case 2:return{"@type":"searchMessagesFilterDocument"};case 3:return{"@type":"searchMessagesFilterAudio"};case 4:return{"@type":"searchMessagesFilterUrl"};case 5:return{"@type":"searchMessagesFilterVoiceNote"};case 6:return null}return null}static getSource(e,t){if(!t)return[];switch(e){case 1:return t.photoAndVideo||[];case 2:return t.document||[];case 3:return t.audio||[];case 4:return t.url||[];case 5:return t.voiceNote||[];case 6:return t.groupsInCommon||[]}return[]}static getDerivedStateFromProps(e,t){if(e.chatId!==t.prevChatId){var a=le.a.getMedia(e.chatId),n=a?a.photoAndVideo:[],s=a?a.document:[],i=a?a.audio:[],r=a?a.url:[],o=a?a.voiceNote:[],l=a?a.groupsInCommon:[],c=-1;n.length>0?c=1:s.length>0?c=2:i.length>0?c=3:r.length>0?c=4:o.length>0?c=5:l.length>0&&(c=6);var h=yt.getSource(c,a).filter(e=>yt.isValidContent(c,e.content));return{prevChatId:e.chatId,selectedIndex:c,renderIds:new Map,rowHeight:yt.getRowHeight(c),items:h.slice(0,u.Ab),photoAndVideo:n,document:s,audio:i,url:r,voiceNote:o,groupsInCommon:l,isSmallWidth:!1,params:{loading:!1,completed:!1,migrateCompleted:!1,filter:yt.getFilter(c)}}}return null}componentDidMount(){window.addEventListener("resize",this.onWindowResize),le.a.on("clientUpdateMediaTab",this.onClientUpdateMediaTab),le.a.on("clientUpdateChatMedia",this.onClientUpdateChatMedia),le.a.on("updateNewMessage",this.onUpdateNewMessage),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.on("updateMessageContent",this.onUpdateMessageContent),le.a.on("updateMessageSendSucceeded",this.onUpdateMessageSend),le.a.on("updateMessageSendFailed",this.onUpdateMessageSend)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),le.a.off("clientUpdateMediaTab",this.onClientUpdateMediaTab),le.a.off("clientUpdateChatMedia",this.onClientUpdateChatMedia),le.a.off("updateNewMessage",this.onUpdateNewMessage),le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.off("updateMessageContent",this.onUpdateMessageContent),le.a.off("updateMessageSendSucceeded",this.onUpdateMessageSend),le.a.off("updateMessageSendFailed",this.onUpdateMessageSend)}componentDidUpdate(e,t,a){if(e.items!==this.props.chatId||t.selectedIndex!==this.state.selectedIndex){var n=this.state.items,s=U.a.getStore();switch(this.state.selectedIndex){case 1:case 2:case 3:case 4:case 5:Object(G.B)(s,n);break;case 6:Object(G.x)(s,n)}}}getRenderIds(e,t,a){var n=new Map,s=[];return e.forEach((e,i)=>{this.isVisibleItem(i,t,a)&&(n.set(i,i),s.push(i))}),{renderIds:n,renderIdsList:s}}onLoadMigratedNext(e,t){}render(){var e=this.state,t=e.selectedIndex,a=e.items,n=void 0===a?[]:a,s=e.renderIds,i=e.photoAndVideo,r=e.document,l=e.audio,h=e.url,d=e.voiceNote,p=e.groupsInCommon;if(!(i&&i.length>0||r&&r.length>0||l&&l.length>0||h&&h.length>0||d&&d.length>0||p&&p.length>0))return o.a.createElement("div",{ref:this.listRef});if(2===t||3===t||5===t){var u=0,m=n.map((e,a)=>{var n=e.chat_id,i=e.id,r=yt.getItemHeight(e);return r?(u+=r,(!s.size||s.has(a))&&o.a.createElement("div",{key:"chat_id=".concat(n,"_message_id=").concat(i),className:"shared-media-virt-item",style:{top:u-r}},yt.getItemTemplate(t,e,()=>this.handleOpen(e)))):null});return o.a.createElement("div",{ref:this.listRef,className:"shared-media-virt-content",style:{height:u}},m)}return o.a.createElement("div",{ref:this.listRef,className:c()("shared-media-content",{"shared-photos-list":1===t})},n.map(e=>yt.getItemTemplate(t,e,()=>this.handleOpen(e))))}}yt.getItemTemplate=(e,t,a)=>{switch(e){case 1:var n=t.chat_id,s=t.id,i=t.content;return"messageVideo"===i["@type"]?o.a.createElement(St,{key:"chat_id=".concat(n,"_message_id=").concat(s),chatId:n,messageId:s,video:i.video,openMedia:a,showOpenMessage:-1!==n}):o.a.createElement(st,{key:"chat_id=".concat(n,"_message_id=").concat(s),chatId:n,messageId:s,photo:i.photo,openMedia:a,showOpenMessage:-1!==n});case 2:var r=t.chat_id,l=t.id;return o.a.createElement(ot,{key:"chat_id=".concat(r,"_message_id=").concat(l),chatId:r,messageId:l,showOpenMessage:-1!==r});case 3:var c=t.chat_id,h=t.id;t.content;return o.a.createElement(ot,{key:"chat_id=".concat(c,"_message_id=").concat(h),chatId:c,messageId:h,showOpenMessage:-1!==c});case 4:var d=t.chat_id,p=t.id,u=t.content;return o.a.createElement(ut,{key:"chat_id=".concat(d,"_message_id=").concat(p),chatId:d,messageId:p,webPage:u.web_page,caption:u.caption,openMedia:a,showOpenMessage:-1!==d});case 5:var m=t.chat_id,f=t.id,g=t.content;return o.a.createElement(bt,{key:"chat_id=".concat(m,"_message_id=").concat(f),chatId:m,messageId:f,voiceNote:g.voice_note,openMedia:a,showOpenMessage:-1!==m});case 6:var C=t.id;return o.a.createElement(be.a,{button:!0,key:"chat_id=".concat(C),className:"groups-in-common-item"},o.a.createElement(Pe,{chatId:C,onSelect:a}))}return null};var Mt=yt,It=a(75);a(486),a(487);class Ut extends o.a.Component{constructor(e){super(e),this.onUpdateBasicGroupFullInfo=e=>{var t=Z.a.get(this.props.chatId);t&&t.type&&"chatTypeBasicGroup"===t.type["@type"]&&t.type.basic_group_id===e.basic_group_id&&this.forceUpdate()},this.onUpdateSupergroupFullInfo=e=>{var t=Z.a.get(this.props.chatId);t&&t.type&&"chatTypeSupergroup"===t.type["@type"]&&t.type.supergroup_id===e.supergroup_id&&this.forceUpdate()},this.onUpdateUserFullInfo=e=>{var t=Z.a.get(this.props.chatId);t&&(!t.type||"chatTypePrivate"!==t.type["@type"]&&"chatTypeSecret"!==t.type["@type"]||t.type.user_id!==e.user_id||this.forceUpdate())},this.onUpdateUserStatus=e=>{this.members.has(e.user_id)&&this.forceUpdate()},this.loadContent=()=>{this.loadChatContents()},this.loadChatContents=()=>{var e=this.props,t=e.chatId,a=e.popup,n=U.a.getStore();Object(G.x)(n,[t]);var s=Object(V.C)(t).map(e=>e.user_id);Object(G.J)(n,s),a&&Object(V.n)(t)},this.handleUsernameHint=()=>{var e=this.props,t=e.t,a=e.chatId,n=Object(V.A)(a);if(n){var s=ee.a.get("t_me_url");X((s?s.value:"https://telegram.org/")+n),this.handleScheduledAction(t("LinkCopied"))}},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>{n(s)}},o.a.createElement(g.a,null))]})},this.handlePhoneHint=()=>{var e=this.props,t=e.t,a=e.chatId,n=Object(V.r)(a);n&&(X(Object(It.a)(n)),this.handleScheduledAction(t("PhoneCopied")))},this.handleHeaderClick=()=>{this.listRef.current.scrollTop=0},this.handleOpenViewer=()=>{var e=this.props,t=e.chatId,a=e.popup,n=Z.a.get(t);n&&n.photo&&(Object(re.r)({chatId:t}),a&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0}))},this.handleOpenChat=()=>{var e=this.props,t=e.chatId,a=e.popup;Object(re.i)(t,null,!1),a&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})},this.handleOpenUser=e=>{Object(re.k)(e,!0)},this.getContentHeight=()=>this.listRef?this.listRef.current.clientHeight:0,this.handleTabClick=e=>{var t=this.listRef.current;if(t){var a=this.dividerRef.current;a&&a.offsetTop!==t.scrollTop&&(t.scrollTop<a.offsetTop?t.scrollTo({top:a.offsetTop,behavior:"smooth"}):(t.scrollTop=a.offsetTop+70,setTimeout(()=>{t.scrollTo({top:a.offsetTop,behavior:"smooth"})},0)))}},this.handleScroll=e=>{if(this.listRef&&this.mediaRef){var t=this.listRef.current;if(t){var a=this.mediaRef.current;a&&(t.scrollTop+t.offsetHeight>=t.scrollHeight-u.yb&&a.handleScroll(e),a.handleVirtScroll(e,t))}}},this.listRef=o.a.createRef(),this.dividerRef=o.a.createRef(),this.mediaRef=o.a.createRef();var t=this.props.chatId;this.members=new Map,this.state={prevChatId:t}}static getDerivedStateFromProps(e,t){return e.chatId!==t.prevChatId?{prevChatId:e.chatId}:null}getSnapshotBeforeUpdate(e,t){this.props.chatId;var a=this.listRef.current;return{scrollTop:a.scrollTop,scrollHeight:a.scrollHeight,offsetHeight:a.offsetHeight}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.theme,i=a.counters,r=a.migratedCounters;return e.chatId!==n||(e.counters!==i||(e.migratedCounters!==r||e.theme!==s))}componentDidUpdate(e,t,a){var n=this.props.chatId;e.chatId!==n&&this.loadContent();var s=this.listRef.current,i=a.scrollTop;a.scrollHeight,a.offsetHeight;e.chatId===n?s.scrollTop=i:s.scrollTop=0}componentDidMount(){this.loadContent(),H.a.on("updateUserStatus",this.onUpdateUserStatus),H.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}componentWillUnmount(){H.a.off("updateUserStatus",this.onUpdateUserStatus),H.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo)}render(){var e=this.props,t=e.backButton,a=e.className,n=e.chatId,s=e.onClose,i=e.popup,r=e.t,l=this.props,h=l.counters,d=l.migratedCounters;d=d||[0,0,0,0,0,0];var p=(h=h||[0,0,0,0,0,0]).map((e,t)=>e+d[t]),u=Object(L.a)(p,6),m=(u[0],u[1],u[2],u[3],u[4],u[5],Z.a.get(n));if(!m)return o.a.createElement("div",{className:"chat-details"},o.a.createElement(Re,{onClose:s}),o.a.createElement("div",{ref:this.listRef,className:c()("chat-details-list","scrollbars-hidden")}));var f=0;if(Object(V.db)(n)){var g=H.a.getFullInfo(m.type.user_id);f=g?g.group_in_common_count:f}var C=Object(V.A)(n),v=Object(V.r)(n),b=Object(V.k)(n),E=Object(V.bb)(n),S=Object(V.cb)(n),y=Object(V.C)(n),M=[];this.members=new Map,y.forEach(e=>{var t=H.a.get(e.user_id);t&&(this.members.set(t.id,t.id),M.push(t))});M.sort((e,t)=>Object(B.g)(t)-Object(B.g)(e)).map(e=>o.a.createElement(be.a,{button:!0,className:"list-item",key:e.id},o.a.createElement(Ie.a,{userId:e.id,onSelect:this.handleOpenUser})));var I=m.photo;if(Object(V.bb)(n)||Object(V.R)(n)){var U=Object(it.B)(b,[]),k=U.text,x=U.entities;x.length>0&&(b=Object(it.n)({"@type":"formattedText",text:k,entities:x}))}var w=o.a.createElement(o.a.Fragment,null,o.a.createElement(Re,{chatId:n,backButton:t,onClose:s,onClick:this.handleHeaderClick}),o.a.createElement("div",{ref:this.listRef,className:c()("chat-details-list","scrollbars-hidden"),onScroll:this.handleScroll},o.a.createElement("div",{className:"chat-details-info"},o.a.createElement(Pe,{chatId:n,big:!0,showStatus:!0,showSavedMessages:!i,onTileSelect:I?this.handleOpenViewer:null}),!S&&o.a.createElement(ve.a,{className:"chat-details-items"},b&&o.a.createElement(be.a,{className:"list-item-rounded",alignItems:"flex-start"},o.a.createElement(Ee.a,null,o.a.createElement(ge.a,{className:"chat-details-info-icon"})),o.a.createElement(Se.a,{primary:b,secondary:r("Bio"),style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}})),C&&o.a.createElement(be.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleUsernameHint},o.a.createElement(Ee.a,null,o.a.createElement(pe.a,null)),o.a.createElement(Se.a,{primary:o.a.createElement(Me.a,{variant:"inherit",noWrap:!0},C),secondary:r("Username")})),v&&o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handlePhoneHint},o.a.createElement(Ee.a,null,o.a.createElement(me.a,null)),o.a.createElement(Se.a,{primary:o.a.createElement(Me.a,{variant:"inherit",noWrap:!0},Object(It.a)(v)),secondary:r("Phone")}))),o.a.createElement(He,{chatId:n}),i&&!E&&o.a.createElement(be.a,{button:!0,className:"list-item-rounded",alignItems:"flex-start",onClick:this.handleOpenChat},o.a.createElement(Se.a,{primary:o.a.createElement(Me.a,{color:"primary",variant:"inherit",noWrap:!0},r("SendMessage").toUpperCase()),style:{paddingLeft:40}})))),o.a.createElement("div",{ref:this.dividerRef}),o.a.createElement(Ge,{chatId:n,onClick:this.handleTabClick}),o.a.createElement(Mt,{ref:this.mediaRef,chatId:n,popup:i})));return i?o.a.createElement(o.a.Fragment,null,w):o.a.createElement("div",{className:c()("chat-details",a)},w)}}var kt=Object(h.a)(Object(h.d)(),Object(_.a)(),p.b,Object(h.c)())(Ut);a(490);class xt extends o.a.Component{render(){var e=this.props.onClose;return o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:e},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},"Groups in common")))}}var wt=xt;a(491);class Ot extends o.a.Component{constructor(e){super(e),this.handleSelect=e=>{var t=this.props.popup;Object(re.i)(e),t&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})},this.state={chatIds:[]}}componentDidMount(){var e=this.props.chatId,t=Object(V.z)(e);t&&x.a.send({"@type":"getGroupsInCommon",user_id:t,offset_chat_id:0,limit:100}).then(e=>{var t=U.a.getStore();Object(G.x)(t,e.chat_ids),this.setState({chatIds:e.chat_ids})})}render(){var e=this.props,t=e.minHeight,a=e.onClose,n=e.popup,s=this.state.chatIds.map(e=>o.a.createElement(be.a,{button:!0,key:e},o.a.createElement(Pe,{chatId:e,onSelect:this.handleSelect}))),i=o.a.createElement(o.a.Fragment,null,o.a.createElement(wt,{onClose:a}),o.a.createElement("div",{className:"groups-in-common-list",style:{minHeight:t}},s));return n?o.a.createElement(o.a.Fragment,null,i):o.a.createElement("div",{className:"groups-in-common"},i)}}Ot.defaultProps={popup:!1,minHeight:0};var Lt=Ot,_t=a(12),Nt=a.n(_t),Pt=Object(T.a)(o.a.createElement("path",{d:"M9.5,3 C13.0898509,3 16,5.91014913 16,9.5 C16,10.9337106 15.5358211,12.2590065 14.7495478,13.3338028 L19.7071068,18.2928932 C20.0976311,18.6834175 20.0976311,19.3165825 19.7071068,19.7071068 C19.3466228,20.0675907 18.7793918,20.0953203 18.3871006,19.7902954 L18.2928932,19.7071068 L13.3338028,14.7495478 C12.2590065,15.5358211 10.9337106,16 9.5,16 C5.91014913,16 3,13.0898509 3,9.5 C3,5.91014913 5.91014913,3 9.5,3 Z M9.5,5 C7.01471863,5 5,7.01471863 5,9.5 C5,11.9852814 7.01471863,14 9.5,14 C11.9852814,14 14,11.9852814 14,9.5 C14,7.01471863 11.9852814,5 9.5,5 Z"}),"Search"),jt=a(663);a(492);class Dt extends o.a.Component{constructor(e){super(e),this.handleSearch=()=>{if(this.searchInputRef.current&&this.searchInputRef.current.innerText){this.searchInputRef.current.innerText="";var e=this.props.onSearch;if(!e)return;return void e("")}var t=this.props.onCloseSearch,a=this.state.openSearch;this.setState({openSearch:!a}),t&&t()},this.handleKeyDown=e=>{13===e.keyCode&&e.preventDefault()},this.handleKeyUp=()=>{var e=this.searchInputRef.current;if(e){var t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null);var a=e.innerText,n=this.props.onSearch;n&&n(a)}},this.handlePaste=e=>{var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.searchInputRef=o.a.createRef(),this.state={openSearch:!1}}componentDidUpdate(e,t,a){var n=this.state.openSearch;n&&n!==e.openSearch&&setTimeout(()=>{this.searchInputRef.current&&this.searchInputRef.current.focus()},u.b)}render(){var e=this.props,t=e.t,a=e.title,n=e.onClick,s=e.onClose,i=e.onSearch,r=this.state.openSearch;return o.a.createElement("div",{className:"header-master"},r?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-search-input grow"},o.a.createElement("div",{id:"header-search-inputbox",ref:this.searchInputRef,placeholder:t("Search"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste}))):o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{className:"header-left-button",onClick:s},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer",onClick:n},o.a.createElement("span",{className:"header-status-content"},a))),Boolean(i)&&o.a.createElement(P.a,{className:"header-right-button",onMouseDown:this.handleSearch},o.a.createElement(jt.a,{open:r,icon:o.a.createElement(Pt,null),openIcon:o.a.createElement(g.a,null)})))}}var Rt=Object(_.a)()(Dt);a(493);class Tt extends o.a.Component{getListClassName(){return null}getSearchListClassName(){return null}constructor(e){var t;if(new.target===Tt)throw new TypeError("Cannot construct SharedMediaBase instances directly");super(e),t=this,this.onUpdateMessageContent=e=>{var t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.chat_id,l=e.message_id,c=(e.old_content,e.new_content),h=le.a.get(o,l);if(o===a){if(!i.length)return;if(!Object(M.c)(l,i[0].id,i[i.length-1].id,!0))return;var d=i.findIndex(e=>e.id===l);this.isValidContent(c)?-1===d?this.setState({items:Object(M.s)(i,h,it.S)}):this.setState({items:[...i.slice(0,d),h,...i.slice(d+1)]}):-1===d||this.setState({items:i.filter(e=>e.id!==l)})}else if(o===n){if(!r.length)return;if(!Object(M.c)(l,r[0].id,r[r.length-1].id,!0))return;var p=r.findIndex(e=>e.id===l);this.isValidContent(c)?-1===p?this.setState({migratedItems:Object(M.s)(r,h,it.S)}):this.setState({migratedItems:[...r.slice(0,p),h,...r.slice(p+1)]}):-1===p||this.setState({migratedItems:r.filter(e=>e.id!==l)})}},this.onUpdateNewMessage=e=>{var t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.message,l=o.chat_id;if(l===a&&this.isValidMessage(o)){var c=U.a.getStore();Object(G.B)(c,[o]),l===a?this.setState({items:[o].concat(i)}):l===n&&this.setState({migratedItems:[o].concat(r)})}},this.onUpdateDeleteMessages=e=>{var t=this.props,a=t.chatId,n=t.migratedChatId,s=this.state,i=s.items,r=s.migratedItems,o=e.chat_id,l=e.message_ids,c=new Map(l.map(e=>[e,e])),h=()=>{this.state.items.length+this.state.migratedItems.length<u.Ab&&this.onLoadNext(this.params)};o===a?this.setState({items:i.filter(e=>!c.has(e.id))},h):o===n&&this.setState({migratedItems:r.filter(e=>!c.has(e.id))},h)},this.loadContent=()=>{this.params={loading:!1,completed:!1,migrateCompleted:!1,items:[],migratedItems:[],filter:this.getSearchFilter()},this.onLoadNext(this.params)},this.onLoadNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,h,d,p,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=a.completed,o=a.filter,l=a.items,!a.loading){e.next=4;break}return e.abrupt("return");case 4:if(!r){e.next=6;break}return e.abrupt("return");case 6:return c=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=10,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:c,offset:0,limit:u.Ab,filter:o}).finally(()=>{a.loading=!1});case 10:h=e.sent,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:c,offset:0,limit:2*u.Ab,filter:o}),d=h.messages,a.completed=0===d.length||0===d.total_count,a.items=l.concat(d.filter(t.isValidMessage)),p=n&&d.length>0&&d.length<u.Ab,le.a.setItems(h.messages),m=U.a.getStore(),Object(G.B)(m,h.messages),t.setState({items:a.items}),a.completed?t.onLoadMigratedNext(a,!0):p&&t.onLoadNext(a,!1);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onLoadMigratedNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,h,d,p,m,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.migratedChatId,r=a.filter,o=a.loading,l=a.migrateCompleted,c=a.migratedItems,i){e.next=4;break}return e.abrupt("return");case 4:if(!o){e.next=6;break}return e.abrupt("return");case 6:if(!l){e.next=8;break}return e.abrupt("return");case 8:return h=c.length>0?c[c.length-1].id:0,a.loading=!0,e.next=12,x.a.send({"@type":"searchChatMessages",chat_id:i,query:"",sender_user_id:0,from_message_id:h,offset:0,limit:u.Ab,filter:r}).finally(()=>{a.loading=!1});case 12:if(d=e.sent,p=d.messages,a.migratedItems=c.concat(p.filter(t.isValidMessage)),a.migrateCompleted=0===p.length||0===p.total_count,m=n&&p.length>0&&p.length<u.Ab,!a.migrateCompleted){e.next=19;break}return e.abrupt("return");case 19:le.a.setItems(p),f=U.a.getStore(),Object(G.B)(f,p),t.setState({migratedItems:a.migratedItems}),m&&t.onLoadMigratedNext(a,!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleScroll=()=>{if(this.listRef){var e=this.listRef.current;if(e){var t=this.params;e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&(t&&!t.completed?this.onLoadNext(t):this.onLoadMigratedNext(t))}}},this.handleHeaderClick=()=>{var e=this.listRef.current;e&&(e.scrollTop=0)},this.handleSearchScroll=()=>{if(this.searchListRef){var e=this.searchListRef.current;if(e){var t=this.searchParams;t&&e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&(t.completed?this.onSearchMigratedNext(t):this.onSearchNext(t))}}},this.onSearchNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,h,d,p,m,f,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.chatId,r=a.completed,o=a.filter,l=a.items,c=a.loading,h=a.query,!r){e.next=4;break}return e.abrupt("return");case 4:if(!c){e.next=6;break}return e.abrupt("return");case 6:return d=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=10,x.a.send({"@type":"searchChatMessages",chat_id:i,query:h,sender_user_id:0,from_message_id:d,offset:0,limit:u.Ab,filter:o}).finally(()=>{a.loading=!1});case 10:if(p=e.sent,m=p.messages,a.items=l.concat(m.filter(t.isValidMessage)),a.completed=0===m.length||0===m.total_count,f=n&&m.length>0&&m.length<u.Ab,t.searchParams===a){e.next=17;break}return e.abrupt("return");case 17:le.a.setItems(m),g=U.a.getStore(),Object(G.B)(g,m),t.setState({searchItems:a.items,searchMigratedItems:a.migratedItems}),a.completed?t.onSearchMigratedNext(a,!0):f&&t.onSearchNext(a,!1);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onSearchMigratedNext=function(){var e=Object(i.a)(s.a.mark((function e(a,n=!0){var i,r,o,l,c,h,d,p,m,f,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.props.migratedChatId,r=a.filter,o=a.loading,l=a.migratedItems,c=a.migrateCompleted,h=a.query,i){e.next=4;break}return e.abrupt("return");case 4:if(!o){e.next=6;break}return e.abrupt("return");case 6:if(!c){e.next=8;break}return e.abrupt("return");case 8:return d=l.length>0?l[l.length-1].id:0,a.loading=!0,e.next=12,x.a.send({"@type":"searchChatMessages",chat_id:i,query:h,sender_user_id:0,from_message_id:d,offset:0,limit:u.Ab,filter:r}).finally(()=>{a.loading=!1});case 12:if(p=e.sent,m=p.messages,a.migratedItems=l.concat(m.filter(t.isValidMessage)),a.migrateCompleted=0===m.length||0===m.total_count,f=n&&m.length>0&&m.length<u.Ab,t.searchParams===a){e.next=19;break}return e.abrupt("return");case 19:le.a.setItems(m),g=U.a.getStore(),Object(G.B)(g,m),t.setState({searchItems:a.items,searchMigratedItems:a.migratedItems}),f&&t.onSearchMigratedNext(a,!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a?a.trim():""){e.next=4;break}return t.handleCloseSearch(),e.abrupt("return");case 4:t.searchParams={query:n,completed:!1,migrateCompleted:!1,items:[],migratedItems:[],filter:t.getSearchFilter()},t.onSearchNext(t.searchParams,!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseSearch=()=>{this.searchParams=null,this.setState({searchItems:[],searchMigratedItems:[]})},this.isValidMessage=e=>!!e&&this.isValidContent(e.content),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.state={items:[],migratedItems:[],searchItems:[],searchMigratedItems:[]}}hasSearch(){return!0}isValidContent(e){throw new Error("Virtual method isValidContent is not implemented")}getItemTemplate(e){var t=this.props.migratedChatId,a=e.chat_id,n=e.id;return o.a.createElement(ot,{key:"chat_id=".concat(a,"_message_id=").concat(n),chatId:a,messageId:n,showOpenMessage:a!==t})}getSearchFilter(){throw new Error("Virtual method getSearchFilter is not implemented")}getHeader(){throw new Error("Virtual method getHeader is not implemented")}componentDidMount(){this.loadContent(),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.on("updateMessageContent",this.onUpdateMessageContent),le.a.on("updateNewMessage",this.onUpdateNewMessage)}componentWillUnmount(){le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.off("updateMessageContent",this.onUpdateMessageContent),le.a.off("updateNewMessage",this.onUpdateNewMessage)}render(){var e=this.props,t=e.minHeight,a=e.onClose,n=e.popup,s=this.state,i=s.items,r=s.migratedItems,l=s.searchItems,h=s.searchMigratedItems,d=this.searchParams,p=i.concat(r).map(e=>this.getItemTemplate(e)),u=l.concat(h).map(e=>this.getItemTemplate(e));return o.a.createElement(o.a.Fragment,null,o.a.createElement(Rt,{title:this.getHeader(),onClick:this.handleHeaderClick,onClose:a,onSearch:this.hasSearch()?this.handleSearch:null,onCloseSearch:this.handleCloseSearch}),o.a.createElement("div",{ref:this.listRef,className:c()("shared-media-list",this.getListClassName()),onScroll:this.handleScroll,style:{minHeight:n?t:null}},p),Boolean(d)&&o.a.createElement("div",{ref:this.searchListRef,className:c()("shared-media-search-list",this.getSearchListClassName()),onScroll:this.handleSearchScroll},u))}}var Ft=Tt;a(494);class At extends Ft{isValidContent(e){return e&&"messageAudio"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterAudio"}}getHeader(){return(0,this.props.t)("AudioTitle")}}At.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},At.defaultProps={popup:!1,minHeight:0};var Bt=Object(_.a)()(At);a(495);class Vt extends Ft{isValidContent(e){return e&&"messageDocument"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterDocument"}}getHeader(){return(0,this.props.t)("DocumentsTitle")}}Vt.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},Vt.defaultProps={popup:!1,minHeight:0};var Ht=Object(_.a)()(Vt);a(496);class zt extends Ft{isValidContent(e){if(!e)return!1;var t=e.web_page,a=e.text;if(t)return!0;if(!a)return!1;var n=a.entities;return!!n&&n.find(e=>"textEntityTypeUrl"===e.type["@type"]||"textEntityTypeTextUrl"===e.type["@type"]||"textEntityTypeEmailAddress"===e.type["@type"])}getSearchFilter(){return{"@type":"searchMessagesFilterUrl"}}getHeader(){return(0,this.props.t)("LinksTitle")}getItemTemplate(e){var t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(ut,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,webPage:n.web_page,openMedia:()=>Object(it.T)(a,s,!1),showOpenMessage:a!==t})}}zt.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},zt.defaultProps={popup:!1,minHeight:0};var Wt=Object(_.a)()(zt),Gt=a(661),Zt=a(655);a(497);class qt extends o.a.Component{constructor(e){super(e)}render(){var e=this.props.close;return o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:e},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},"Shared Media")))}}var Kt=qt;a(498);class Jt extends o.a.Component{constructor(...e){super(...e),this.state={value:0},this.handleChange=(e,t)=>{this.setState({value:t})}}render(){var e=this.props,t=e.onClose,a=e.popup,n=this.state.value,s=o.a.createElement(o.a.Fragment,null,o.a.createElement(Kt,{close:t}),o.a.createElement(Gt.a,{value:n,onChange:this.handleChange,indicatorColor:"primary",textColor:"primary",scrollable:!0,scrollButtons:"off",fullWidth:!0},o.a.createElement(Zt.a,{label:"Media",style:{minWidth:"40px"}}),o.a.createElement(Zt.a,{label:"Docs",style:{minWidth:"40px"}}),o.a.createElement(Zt.a,{label:"Links",style:{minWidth:"40px"}}),o.a.createElement(Zt.a,{label:"Audio",style:{minWidth:"40px"}})));return a?o.a.createElement(o.a.Fragment,null,s):o.a.createElement("div",{className:"shared-media"},s)}}Jt.defaultProps={popup:!1,minHeight:0};var Yt=Jt;a(499);class Xt extends Ft{getListClassName(){return"shared-photos-list"}getSearchListClassName(){return"shared-photos-search-list"}isValidContent(e){return e&&"messagePhoto"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterPhoto"}}getHeader(){return(0,this.props.t)("PhotosTitle")}getItemTemplate(e){var t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(st,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,photo:n.photo,openMedia:()=>Object(it.T)(a,s,!1),showOpenMessage:a!==t})}}Xt.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},Xt.defaultProps={popup:!1,minHeight:0};var Qt=Object(_.a)()(Xt);a(500);class $t extends Ft{getListClassName(){return"shared-photos-list"}getSearchListClassName(){return"shared-photos-search-list"}isValidContent(e){return e&&"messageVideo"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterVideo"}}getHeader(){return(0,this.props.t)("VideosTitle")}getItemTemplate(e){var t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(St,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,video:n.video,openMedia:()=>Object(it.T)(a,s,!1),showOpenMessage:a!==t})}}$t.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},$t.defaultProps={popup:!1,minHeight:0};var ea=Object(_.a)()($t);a(501);class ta extends Ft{isValidContent(e){return e&&"messageVoiceNote"===e["@type"]}getSearchFilter(){return{"@type":"searchMessagesFilterVoiceNote"}}getHeader(){return(0,this.props.t)("VoiceTitle")}hasSearch(){return!1}getItemTemplate(e){var t=this.props.migratedChatId,a=e.chat_id,n=e.content,s=e.id;return o.a.createElement(bt,{key:"chat_id=".concat(a,"_message_id=").concat(s),chatId:a,messageId:s,voiceNote:n.voice_note,openMedia:()=>Object(it.T)(a,s,!1),showOpenMessage:a!==t})}}ta.propTypes={chatId:Nt.a.number.isRequired,migratedChatId:Nt.a.number,onClose:Nt.a.func.isRequired,popup:Nt.a.bool,minHeight:Nt.a.number},ta.defaultProps={popup:!1,minHeight:0};var aa=Object(_.a)()(ta),na=a(14);a(502);class sa extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePageWidth=e=>{e.isSmallWidth&&(this.props.popup||this.handleCloseChatDetails())},this.onClientUpdateChatId=e=>{var t=this.props.popup,a=this.state.chatId;t||a!==e.nextChatId&&(this.sharedAudios=null,this.sharedDocuments=null,this.sharedLinks=null,this.sharedPhotos=null,this.sharedVideos=null,this.sharedVoiceNotes=null,this.setState({chatId:e.nextChatId,migratedChatId:0,userChatId:null,openGroupInCommon:!1,openSharedAudios:!1,openSharedDocuments:!1,openSharedLinks:!1,openSharedMedia:!1,openSharedPhotos:!1,openSharedVideos:!1,openSharedVoiceNotes:!1,counters:Z.a.getCounters(e.nextChatId),migratedCounters:null}),e.nextChatId||this.handleCloseChatDetails())},this.loadContent=e=>{this.loadChatCounters(e),this.loadMigratedCounters(e);var t=Object(V.J)(e);t&&Object(G.C)(e,[t])},this.loadChatCounters=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Fe.d)(a);case 2:if(n=e.sent,Z.a.setCounters(a,n),a===t.state.chatId){e.next=6;break}return e.abrupt("return");case 6:t.setState({counters:n});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadMigratedCounters=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(V.eb)(a)){e.next=2;break}return e.abrupt("return");case 2:if(n=Oe.a.getFullInfo(Object(V.K)(a))){e.next=5;break}return e.abrupt("return");case 5:if(i=n.upgraded_from_basic_group_id){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,x.a.send({"@type":"createBasicGroupChat",basic_group_id:i,force:!0});case 10:if(r=e.sent){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,Object(Fe.d)(r.id);case 15:if(o=e.sent,Z.a.setCounters(r.id,o),t.state.chatId===a){e.next=19;break}return e.abrupt("return");case 19:t.setState({migratedChatId:r.id,migratedCounters:Z.a.getCounters(r.id)});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleOpenSharedMedia=()=>{this.setState({openSharedMedia:!0})},this.handleCloseSharedMedia=()=>{this.setState({openSharedMedia:!1})},this.handleOpenGroupInCommon=()=>{this.setState({openGroupInCommon:!0})},this.handleCloseGroupsInCommon=()=>{this.setState({openGroupInCommon:!1})},this.handleCloseChatDetails=()=>{var e=this.props.popup;this.state.userChatId?this.setState({userChatId:null}):e?x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0}):Object(Fe.b)(!1)},this.handleOpenSharedDocuments=()=>{this.setState({openSharedDocuments:!0})},this.handleCloseSharedDocuments=()=>{this.setState({openSharedDocuments:!1})},this.handleOpenSharedAudios=()=>{this.setState({openSharedAudios:!0})},this.handleCloseSharedAudios=()=>{this.setState({openSharedAudios:!1})},this.handleOpenSharedVoiceNotes=()=>{this.setState({openSharedVoiceNotes:!0})},this.handleCloseSharedVoiceNotes=()=>{this.setState({openSharedVoiceNotes:!1})},this.handleOpenSharedLinks=()=>{this.setState({openSharedLinks:!0})},this.handleCloseSharedLinks=()=>{this.setState({openSharedLinks:!1})},this.handleOpenSharedPhotos=()=>{this.setState({openSharedPhotos:!0})},this.handleCloseSharedPhotos=()=>{this.setState({openSharedPhotos:!1})},this.handleOpenSharedVideos=()=>{this.setState({openSharedVideos:!0})},this.handleCloseSharedVideos=()=>{this.setState({openSharedVideos:!1})},this.detailsRef=o.a.createRef();var a=e.popup,n=na.a.chatId,r=na.a.dialogChatId;this.state={chatId:a?r:n,migratedChatId:0,userChatId:null,openGroupInCommon:!1,openSharedAudios:!1,openSharedDocuments:!1,openSharedLinks:!1,openSharedMedia:!1,openSharedPhotos:!1,openSharedVideos:!1,openSharedVoiceNotes:!1,counters:null,migratedCounters:null}}componentDidMount(){this.loadContent(this.state.chatId),na.a.on("clientUpdateChatId",this.onClientUpdateChatId),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentDidUpdate(e,t,a){var n=this.state.chatId;n!==t.chatId&&this.loadContent(n)}render(){var e=this.props,t=e.className,a=e.popup,n=this.state,s=n.chatId,i=n.counters,r=n.migratedChatId,l=n.migratedCounters,h=n.userChatId,d=n.openSharedAudios,p=n.openSharedDocuments,u=n.openSharedLinks,m=n.openSharedMedia,f=n.openSharedPhotos,g=n.openSharedVideos,C=n.openSharedVoiceNotes,v=n.openGroupInCommon,b=s||h,E=this.detailsRef&&this.detailsRef.current?this.detailsRef.current.getContentHeight():0,S=null;return m?S=o.a.createElement(Yt,{chatId:b,popup:a,minHeight:E,onClose:this.handleCloseSharedMedia}):d?(this.sharedAudios=this.sharedAudios||o.a.createElement(Bt,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedAudios}),S=this.sharedAudios):p?(this.sharedDocuments=this.sharedDocuments||o.a.createElement(Ht,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedDocuments}),S=this.sharedDocuments):u?(this.sharedLinks=this.sharedLinks||o.a.createElement(Wt,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedLinks}),S=this.sharedLinks):f?(this.sharedPhotos=this.sharedPhotos||o.a.createElement(Qt,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedPhotos}),S=this.sharedPhotos):g?(this.sharedVideos=this.sharedVideos||o.a.createElement(ea,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedVideos}),S=this.sharedVideos):C?(this.sharedVoiceNotes=this.sharedVoiceNotes||o.a.createElement(aa,{chatId:b,migratedChatId:r,popup:a,minHeight:E,onClose:this.handleCloseSharedVoiceNotes}),S=this.sharedVoiceNotes):S=v?o.a.createElement(Lt,{chatId:b,popup:a,minHeight:E,onClose:this.handleCloseGroupsInCommon}):o.a.createElement(kt,{ref:this.detailsRef,chatId:b,popup:a,backButton:h===s,counters:i,migratedCounters:l,onOpenGroupInCommon:this.handleOpenGroupInCommon,onOpenSharedAudios:this.handleOpenSharedAudios,onOpenSharedDocuments:this.handleOpenSharedDocuments,onOpenSharedMedia:this.handleOpenSharedMedia,onOpenSharedLinks:this.handleOpenSharedLinks,onOpenSharedPhotos:this.handleOpenSharedPhotos,onOpenSharedVideos:this.handleOpenSharedVideos,onOpenSharedVoiceNotes:this.handleOpenSharedVoiceNotes,onClose:this.handleCloseChatDetails}),a?o.a.createElement(o.a.Fragment,null,S):o.a.createElement("div",{className:c()("chat-info",{"right-column":!a},t)},S)}}sa.defaultProps={className:null,classes:null,popup:!1};var ia=sa,ra=a(636);a(503);class oa extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdateUser=e=>{var t=this.props.chatId,a=e.user,n=Z.a.get(t);if(n&&!Object(V.db)(t)){var s=n.last_message;if(s)s.sender_user_id===a.id&&this.forceUpdate()}},this.onUpdate=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.t;return e.chatId!==n||e.t!==s}componentDidMount(){Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.on("updateChatDraftMessage",this.onUpdate),Z.a.on("updateChatLastMessage",this.onUpdate),Z.a.on("updateChatReadInbox",this.onUpdate),Z.a.on("updateUserChatAction",this.onUpdate),H.a.on("updateUser",this.onUpdateUser)}componentWillUnmount(){Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.off("updateChatDraftMessage",this.onUpdate),Z.a.off("updateChatLastMessage",this.onUpdate),Z.a.off("updateChatReadInbox",this.onUpdate),Z.a.off("updateUserChatAction",this.onUpdate)}render(){var e=this.props,t=e.chatId,a=e.t;if(this.clearHistory)return o.a.createElement("div",{className:"dialog-content"},"\xa0");var n=Z.a.get(t);if(!n)return o.a.createElement("div",{className:"dialog-content"},"\xa0");var s=null,i=Object(V.y)(t);if(i&&(s=o.a.createElement("span",{className:"dialog-content-accent"},i)),!s){var r=Object(V.l)(t);if(Object(V.gb)(t)){var l=r.text||"\xa0";s=o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"dialog-content-draft"},a("Draft")+": "),l)}}if(!s){var c=Object(V.D)(n,a)||"\xa0",h=Object(V.F)(n,a);s=o.a.createElement(o.a.Fragment,null,h&&o.a.createElement("span",{className:"dialog-content-accent"},h,": "),c)}return o.a.createElement("div",{className:"dialog-content"},s)}}var la=Object(_.a)()(oa),ca=Object(T.a)(o.a.createElement("g",{strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.a.createElement("line",{x1:"10.5",y1:"13.5",x2:"7",y2:"17",id:"Path-51",strokeWidth:"1.66",strokeLinecap:"round"}),o.a.createElement("path",{d:"M15.2734195,6.29329584 L17.7068554,8.72673178 C18.0977149,9.11759123 18.0977149,9.7512996 17.7068554,10.142159 C17.6489915,10.200023 17.5842494,10.2505721 17.5140791,10.2926743 L15.0747102,11.7562956 C15.5465193,13.1717229 15.0755189,14.5863414 13.661709,16.0001513 L8,10.3384422 C9.41380985,8.92463237 10.8284284,8.45363199 12.2438557,8.92544107 L13.707477,6.48607217 C13.991869,6.01208547 14.6066564,5.85838861 15.0806431,6.14278063 C15.1508135,6.18488284 15.2155555,6.2354319 15.2734195,6.29329584 Z",strokeWidth:"1.66",strokeLinecap:"round",strokeLinejoin:"round"})),"Pin"),ha=a(25),da=a(185);class pa extends ha.a{constructor(){super(),this.reset=()=>{this.chatList={"@type":"chatListMain"},this.filters=null},this.onUpdate=e=>{switch(e["@type"]){case"updateAuthorizationState":var t=e.authorization_state;if(!t)break;switch(t["@type"]){case"authorizationStateClosed":this.reset()}break;case"updateChatFilters":var a=e.chat_filters;this.filters=a,this.emit("updateChatFilters",e)}},this.onClientUpdate=e=>{switch(e["@type"]){case"clientUpdateChatList":var t=e.chatList;this.chatList=t,this.emit("clientUpdateChatList",e)}},this.addTdLibListener=()=>{x.a.on("update",this.onUpdate),x.a.on("clientUpdate",this.onClientUpdate)},this.removeTdLibListener=()=>{x.a.off("update",this.onUpdate),x.a.off("clientUpdate",this.onClientUpdate)},this.reset(),this.addTdLibListener()}}var ua=new pa;window.filter=ua;var ma=ua;a(504);class fa extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdate=e=>{var t=this.props.chatId;e.chat_id===t&&this.forceUpdate()},this.onUpdateScopeNotificationSettings=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a)switch(e.scope["@type"]){case"notificationSettingsScopeGroupChats":"chatTypeBasicGroup"!==a.type["@type"]&&"chatTypeSupergroup"!==a.type["@type"]||this.forceUpdate();break;case"notificationSettingsScopePrivateChats":"chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||this.forceUpdate()}}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.chatList;return e.chatId!==n||e.chatList!==s}componentDidMount(){Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.on("updateChatDraftMessage",this.onUpdate),Z.a.on("updateChatIsMarkedAsUnread",this.onUpdate),Z.a.on("updateChatPosition",this.onUpdate),Z.a.on("updateChatNotificationSettings",this.onUpdate),Z.a.on("updateChatReadInbox",this.onUpdate),Z.a.on("updateChatLastMessage",this.onUpdate),Z.a.on("updateChatReadOutbox",this.onUpdate),Z.a.on("updateChatUnreadMentionCount",this.onUpdate),Z.a.on("updateMessageMentionRead",this.onUpdate),Ae.a.on("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}componentWillUnmount(){Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.off("updateChatDraftMessage",this.onUpdate),Z.a.off("updateChatIsMarkedAsUnread",this.onUpdate),Z.a.off("updateChatPosition",this.onUpdate),Z.a.off("updateChatNotificationSettings",this.onUpdate),Z.a.off("updateChatReadInbox",this.onUpdate),Z.a.off("updateChatLastMessage",this.onUpdate),Z.a.off("updateChatReadOutbox",this.onUpdate),Z.a.off("updateChatUnreadMentionCount",this.onUpdate),Z.a.off("updateMessageMentionRead",this.onUpdate),Ae.a.off("updateScopeNotificationSettings",this.onUpdateScopeNotificationSettings)}render(){if(this.clearHistory)return null;var e=this.props,t=e.chatId,a=e.chatList,n=Z.a.get(t);if(!n)return null;var s=n.unread_count,i=Object(V.V)(t,a),r=Object(V.ib)(t),l=Object(V.hb)(t),h=Object(V.U)(t);return o.a.createElement(o.a.Fragment,null,r&&o.a.createElement("div",{className:"dialog-badge"},o.a.createElement("div",{className:"dialog-badge-mention"},"@")),l&&o.a.createElement("div",{className:c()({"dialog-badge-muted":h},"dialog-badge")},o.a.createElement("span",{className:"dialog-badge-text"},s>0?s:"")),i&&!l&&!r&&o.a.createElement("div",{className:"dialog-badge-pinned"},o.a.createElement(ca,{className:"dialog-badge-pinned-icon"})))}}var ga=fa,Ca=Object(T.a)(o.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.a.createElement("g",{transform:"translate(-3.000000, 0.000000)",fill:"#E53935",fillRule:"nonzero"},o.a.createElement("path",{d:"M10,0.4 C13.6450793,0.4 16.6,3.35492065 16.6,7 C16.6,10.6450793 13.6450793,13.6 10,13.6 C6.35492065,13.6 3.4,10.6450793 3.4,7 C3.4,3.35492065 6.35492065,0.4 10,0.4 Z M10,9.25 C9.58578644,9.25 9.25,9.58578644 9.25,10 C9.25,10.4142136 9.58578644,10.75 10,10.75 C10.4142136,10.75 10.75,10.4142136 10.75,10 C10.75,9.58578644 10.4142136,9.25 10,9.25 Z M10,2.85 C9.64101491,2.85 9.35,3.14101491 9.35,3.5 L9.35,7.5 C9.35,7.85898509 9.64101491,8.15 10,8.15 C10.3589851,8.15 10.65,7.85898509 10.65,7.5 L10.65,3.5 C10.65,3.14101491 10.3589851,2.85 10,2.85 Z"}))),"Error"),va=Object(T.a)(o.a.createElement("g",{strokeWidth:"1",fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"},o.a.createElement("g",{transform:"translate(-3.000000, 0.000000)"},o.a.createElement("circle",{strokeWidth:"1.2",cx:"10",cy:"7",r:"6"}),o.a.createElement("line",{x1:"10",y1:"3.5",x2:"10",y2:"7",strokeWidth:"1.3"}),o.a.createElement("line",{x1:"12",y1:"9",x2:"10",y2:"7",strokeWidth:"1.3"}))),"Pending"),ba=Object(T.a)(o.a.createElement("path",{transform:"translate(-4.000000, -2.000000)",d:"M7.96833846,10.0490996 L14.5108251,2.571972 C14.7472185,2.30180819 15.1578642,2.27443181 15.428028,2.51082515 C15.6711754,2.72357915 15.717665,3.07747757 15.5522007,3.34307913 L15.4891749,3.428028 L8.48917485,11.428028 C8.2663359,11.6827011 7.89144111,11.7199091 7.62486888,11.5309823 L7.54038059,11.4596194 L4.54038059,8.45961941 C4.2865398,8.20577862 4.2865398,7.79422138 4.54038059,7.54038059 C4.7688373,7.31192388 5.12504434,7.28907821 5.37905111,7.47184358 L5.45961941,7.54038059 L7.96833846,10.0490996 L14.5108251,2.571972 L7.96833846,10.0490996 Z"}),"Sent"),Ea=Object(T.a)(o.a.createElement("path",{transform:"translate(-1.000000, -2.000000)",d:"M4.96833846,10.0490996 L11.5108251,2.571972 C11.7472185,2.30180819 12.1578642,2.27443181 12.428028,2.51082515 C12.6711754,2.72357915 12.717665,3.07747757 12.5522007,3.34307913 L12.4891749,3.428028 L5.48917485,11.428028 C5.2663359,11.6827011 4.89144111,11.7199091 4.62486888,11.5309823 L4.54038059,11.4596194 L1.54038059,8.45961941 C1.2865398,8.20577862 1.2865398,7.79422138 1.54038059,7.54038059 C1.7688373,7.31192388 2.12504434,7.28907821 2.37905111,7.47184358 L2.45961941,7.54038059 L4.96833846,10.0490996 L11.5108251,2.571972 L4.96833846,10.0490996 Z M9.96833846,10.0490996 L16.5108251,2.571972 C16.7472185,2.30180819 17.1578642,2.27443181 17.428028,2.51082515 C17.6711754,2.72357915 17.717665,3.07747757 17.5522007,3.34307913 L17.4891749,3.428028 L10.4891749,11.428028 C10.2663359,11.6827011 9.89144111,11.7199091 9.62486888,11.5309823 L9.54038059,11.4596194 L8.54038059,10.4596194 C8.2865398,10.2057786 8.2865398,9.79422138 8.54038059,9.54038059 C8.7688373,9.31192388 9.12504434,9.28907821 9.37905111,9.47184358 L9.45961941,9.54038059 L9.96833846,10.0490996 L16.5108251,2.571972 L9.96833846,10.0490996 Z"}),"Succeeded");a(505);class Sa extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateMessageSend=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=e.old_message_id,i=e.message;if(n===s&&i){var r=i.chat_id,o=i.id,l=i.sending_state;a===r&&(this.newMessageId=o,this.setState({sendingState:l}))}},this.onUpdateChatReadOutbox=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=e.chat_id,i=e.last_read_outbox_message_id,r=this.newMessageId;a===s&&(r&&r<=i||n<=i)&&this.setState({sendingState:null,unread:!1})}}static getDerivedStateFromProps(e,t){var a=e.chatId,n=e.messageId,s=le.a.get(a,n),i=s?s.sending_state:null;return a!==t.prevChatId||n!==t.prevMessageId?{prevChatId:a,prevMessageId:n,sendingState:i,unread:Object(it.O)(a,n)}:null}componentDidMount(){Z.a.on("updateChatReadOutbox",this.onUpdateChatReadOutbox),le.a.on("updateMessageSendFailed",this.onUpdateMessageSend),le.a.on("updateMessageSendSucceeded",this.onUpdateMessageSend)}componentWillUnmount(){Z.a.off("updateChatReadOutbox",this.onUpdateChatReadOutbox),le.a.off("updateMessageSendFailed",this.onUpdateMessageSend),le.a.off("updateMessageSendSucceeded",this.onUpdateMessageSend)}render(){var e=this.state,t=e.sendingState;return e.unread?t?"messageSendingStateFailed"===t["@type"]?o.a.createElement(Ca,{className:"status",viewBox:"0 0 14 14",style:{width:16,height:12,transform:"translate(0, 1px)"}}):o.a.createElement(va,{className:"status",viewBox:"0 0 14 14",style:{width:16,height:12,transform:"translate(0, 1px)",stroke:"currentColor"}}):o.a.createElement(ba,{className:"status",viewBox:"0 0 12 10",style:{width:16,height:9}}):o.a.createElement(Ea,{className:"status",viewBox:"0 0 17 10",style:{width:16,height:9}})}}var ya=Sa;a(506);class Ma extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&(this.clearHistory=e.inProgress,this.forceUpdate())},this.onFastUpdatingComplete=e=>{this.forceUpdate()},this.onUpdate=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()}}shouldComponentUpdate(e,t){var a=this.props.chatId;return e.chatId!==a}componentDidMount(){Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.on("updateChatDraftMessage",this.onUpdate),Z.a.on("updateChatLastMessage",this.onUpdate),Z.a.on("updateChatReadInbox",this.onUpdate),Z.a.on("updateChatUnreadMentionCount",this.onUpdate),Z.a.on("updateMessageMentionRead",this.onUpdate)}componentWillUnmount(){Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),Z.a.off("updateChatDraftMessage",this.onUpdate),Z.a.off("updateChatLastMessage",this.onUpdate),Z.a.off("updateChatReadInbox",this.onUpdate),Z.a.off("updateChatUnreadMentionCount",this.onUpdate),Z.a.off("updateMessageMentionRead",this.onUpdate)}render(){if(this.clearHistory)return null;var e=this.props.chatId,t=Z.a.get(e);if(!t)return null;var a=Object(V.cb)(e),n=t.last_message;if(!n)return null;var s=Object(V.E)(t);if(!s)return null;var i=n.id,r=n.is_outgoing;return o.a.createElement("div",{className:"dialog-meta"},r&&!a&&o.a.createElement(o.a.Fragment,null,o.a.createElement(ya,{chatId:e,messageId:i}),o.a.createElement("span",null," ")),s)}}var Ia=Ma,Ua=Object(T.a)(o.a.createElement("path",{d:"M16.5,1 C17.7590292,1 18.9445825,1.59277663 19.7,2.6 L19.7,2.6 L21.2,4.6 C21.7192885,5.29238468 22,6.13451915 22,7 L22,7 L22,8 C22,8.11615513 21.980196,8.22768478 21.9437804,8.33139667 C21.9809544,8.54881122 22,8.77218145 22,9 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,9 C2,8.77218145 2.01904557,8.54881122 2.05563136,8.33139468 C2.01980398,8.22768478 2,8.11615513 2,8 L2,8 L2,7 C2,6.13451915 2.28071149,5.29238468 2.8,4.6 L2.8,4.6 L4.3,2.6 C5.05541753,1.59277663 6.24097079,1 7.5,1 L7.5,1 Z M18,7 L6,7 C4.8954305,7 4,7.8954305 4,9 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,9 C20,7.8954305 19.1045695,7 18,7 Z M8.29289322,11.2928932 C8.68341751,10.9023689 9.31658249,10.9023689 9.70710678,11.2928932 L9.70710678,11.2928932 L12,13.5857864 L14.2928932,11.2928932 C14.6834175,10.9023689 15.3165825,10.9023689 15.7071068,11.2928932 C16.0976311,11.6834175 16.0976311,12.3165825 15.7071068,12.7071068 L15.7071068,12.7071068 L12.7071068,15.7071068 C12.3165825,16.0976311 11.6834175,16.0976311 11.2928932,15.7071068 L11.2928932,15.7071068 L8.29289322,12.7071068 C7.90236893,12.3165825 7.90236893,11.6834175 8.29289322,11.2928932 Z M16.5,3 L7.5,3 C6.87048539,3 6.27770876,3.29638831 5.9,3.8 L5.9,3.8 L4.88040369,5.15879948 C5.23567546,5.05542416 5.61136523,5 6,5 L18,5 C18.3882729,5 18.7636249,5.055321 19.1186039,5.15851085 L18.1,3.8 C17.7222912,3.29638831 17.1295146,3 16.5,3 L16.5,3 Z"}),"Archive"),ka=Object(T.a)(o.a.createElement("path",{d:"M19.36,2.72L20.78,4.14L15.06,9.85C16.13,11.39 16.28,13.24 15.38,14.44L9.06,8.12C10.26,7.22 12.11,7.37 13.65,8.44L19.36,2.72M5.93,17.57C3.92,15.56 2.69,13.16 2.35,10.92L7.23,8.83L14.67,16.27L12.58,21.15C10.34,20.81 7.94,19.58 5.93,17.57Z"}),"Broom"),xa=Object(T.a)(o.a.createElement("path",{d:"M16.5,1 C17.7590292,1 18.9445825,1.59277663 19.7,2.6 L19.7,2.6 L21.2,4.6 C21.7192885,5.29238468 22,6.13451915 22,7 L22,7 L22,8 C22,8.11615513 21.980196,8.22768478 21.9437804,8.33139667 C21.9809544,8.54881122 22,8.77218145 22,9 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,9 C2,8.77218145 2.01904557,8.54881122 2.05563136,8.33139468 C2.01980398,8.22768478 2,8.11615513 2,8 L2,8 L2,7 C2,6.13451915 2.28071149,5.29238468 2.8,4.6 L2.8,4.6 L4.3,2.6 C5.05541753,1.59277663 6.24097079,1 7.5,1 L7.5,1 Z M18,7 L6,7 C4.8954305,7 4,7.8954305 4,9 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,9 C20,7.8954305 19.1045695,7 18,7 Z M12.7071068,10.7928932 L15.7071068,13.7928932 C16.0976311,14.1834175 16.0976311,14.8165825 15.7071068,15.2071068 C15.3165825,15.5976311 14.6834175,15.5976311 14.2928932,15.2071068 L12,12.9142136 L9.70710678,15.2071068 C9.31658249,15.5976311 8.68341751,15.5976311 8.29289322,15.2071068 C7.90236893,14.8165825 7.90236893,14.1834175 8.29289322,13.7928932 L11.2928932,10.7928932 C11.6834175,10.4023689 12.3165825,10.4023689 12.7071068,10.7928932 Z M16.5,3 L7.5,3 C6.87048539,3 6.27770876,3.29638831 5.9,3.8 L5.9,3.8 L4.88040369,5.15879948 C5.23567546,5.05542416 5.61136523,5 6,5 L18,5 C18.3882729,5 18.7636249,5.055321 19.1186039,5.15851085 L18.1,3.8 C17.7222912,3.29638831 17.1295146,3 16.5,3 L16.5,3 Z"}),"Unarchive"),wa=Object(T.a)(o.a.createElement("path",{d:"M18.1483713,2 L18.2928313,2.00686658 C19.0534832,2.07955132 19.6483713,2.72030388 19.6483713,3.5 C19.6483713,3.93788733 19.4570272,4.35391161 19.1245584,4.6388849 L16.9591265,6.49496934 L16.5350978,11.1592857 L19.5076921,14.5034542 C20.0580691,15.1226284 20.002298,16.070737 19.3831238,16.621114 C19.1085471,16.8651821 18.7539493,17 18.3865781,17 L12.9994219,17 L13,22 C13,22.5128358 12.6139598,22.9355072 12.1166211,22.9932723 L12,23 C11.4477153,23 11,22.5522847 11,22 L11,22 L10.9994219,17 L5.61342192,17 C4.7849948,17 4.11342192,16.3284271 4.11342192,15.5 C4.11342192,15.1326288 4.24823977,14.7780309 4.49230794,14.5034542 L7.46490224,11.1592857 L7.04087348,6.49496934 L4.87544164,4.6388849 C4.24645288,4.09975168 4.17361057,3.1528017 4.7127438,2.52381294 C4.9977171,2.19134409 5.41374137,2 5.8516287,2 L18.1483713,2 Z M16.7967426,4 L7.20325741,4 L8.34245623,4.97645613 C8.73788815,5.31539777 8.98550756,5.79522213 9.0326599,6.31389784 L9.45668865,10.9782142 C9.50671685,11.5285243 9.32683472,12.0750103 8.95972088,12.4880133 L6.72684384,15 L17.2731562,15 L15.0402791,12.4880133 C14.6731653,12.0750103 14.4932831,11.5285243 14.5433113,10.9782142 L14.9673401,6.31389784 C15.0144924,5.79522213 15.2621119,5.31539777 15.6575438,4.97645613 L16.7967426,4 Z"}),"Pin2"),Oa=Object(T.a)(o.a.createElement("path",{d:"M13,20 C13.5522847,20 14,20.4477153 14,21 C14,21.5522847 13.5522847,22 13,22 L13,22 L11,22 C10.4477153,22 10,21.5522847 10,21 C10,20.4477153 10.4477153,20 11,20 L11,20 Z M3.30352462,2.28241931 C3.6998335,1.89776658 4.33292796,1.90721575 4.71758069,2.30352462 L4.71758069,2.30352462 L21.2175807,19.3035246 C21.6022334,19.6998335 21.5927842,20.332928 21.1964754,20.7175807 C20.8001665,21.1022334 20.167072,21.0927842 19.7824193,20.6964754 L19.7824193,20.6964754 L18.127874,18.9919007 C18.1241295,18.9923786 18.1203785,18.9928359 18.1166211,18.9932723 L18,19 L4,19 C3.23933773,19 2.77101468,18.1926118 3.11084891,17.5416503 L3.16794971,17.4452998 L5,14.6972244 L5,9 C5,7.98873702 5.21529462,7.00715088 5.62359521,6.10821117 L3.28241931,3.69647538 C2.89776658,3.3001665 2.90721575,2.66707204 3.30352462,2.28241931 Z M7.00817933,8.71121787 L7,9 L7,14.6972244 C7,15.0356672 6.91413188,15.3676193 6.75167088,15.6624466 L6.66410059,15.8066248 L5.86851709,17 L16.1953186,16.9999993 L7.16961011,7.7028948 C7.08210009,8.02986218 7.02771758,8.36725335 7.00817933,8.71121787 Z M12,2 C15.7854517,2 18.8690987,5.00478338 18.995941,8.75935025 L19,9 L19,12 C19,12.5522847 18.5522847,13 18,13 C17.4871642,13 17.0644928,12.6139598 17.0067277,12.1166211 L17,12 L17,9 C17,6.23857625 14.7614237,4 12,4 C11.3902636,4 10.7970241,4.10872043 10.239851,4.31831953 C9.72293204,4.51277572 9.14624852,4.25136798 8.95179232,3.734449 C8.75733613,3.21753002 9.01874387,2.6408465 9.53566285,2.4463903 C10.3171048,2.15242503 11.1488212,2 12,2 Z"}),"Mute"),La=Object(T.a)(o.a.createElement("path",{d:"M13,20 C13.5522847,20 14,20.4477153 14,21 C14,21.5522847 13.5522847,22 13,22 L13,22 L11,22 C10.4477153,22 10,21.5522847 10,21 C10,20.4477153 10.4477153,20 11,20 L11,20 Z M12,2 C15.8659932,2 19,5.13400675 19,9 L19,14.6972244 L20.8320503,17.4452998 C21.2750868,18.1098545 20.7986954,19 20,19 L4,19 C3.20130462,19 2.72491322,18.1098545 3.16794971,17.4452998 L5,14.6972244 L5,9 C5,5.13400675 8.13400675,2 12,2 Z M12,4 C9.23857625,4 7,6.23857625 7,9 L7,14.6972244 C7,15.0920743 6.88312395,15.4780897 6.66410059,15.8066248 L5.86851709,17 L18.1314829,17 L17.3358994,15.8066248 C17.1168761,15.4780897 17,15.0920743 17,14.6972244 L17,9 C17,6.23857625 14.7614237,4 12,4 Z"}),"Unmute"),_a=Object(T.a)(o.a.createElement("path",{d:"M12,12 C15.9072418,12 18.715318,13.0364023 20.3351717,15.1788288 C20.7665758,15.7493929 21,16.4451545 21,17.1604559 L21,18.2857143 C21,19.7847729 19.7847729,21 18.2857143,21 L5.71428571,21 C4.21522711,21 3,19.7847729 3,18.2857143 L3,17.160494 C3,16.445199 3.23340019,15.7494497 3.66478123,15.178891 C5.28463457,13.0364199 8.09272555,12 12,12 Z M12,14 C8.66170181,14 6.44476079,14.8182362 5.26012276,16.3850773 C5.09133017,16.6083279 5,16.8805766 5,17.160494 L5,18.2857143 C5,18.6802034 5.31979661,19 5.71428571,19 L18.2857143,19 C18.6802034,19 19,18.6802034 19,18.2857143 L19,17.1604559 C19,16.8805572 18.9086617,16.6083073 18.7398491,16.38504 C17.5552048,14.8182236 15.3382718,14 12,14 Z M12,2 C14.209139,2 16,3.790861 16,6 C16,8.209139 14.209139,10 12,10 C9.790861,10 8,8.209139 8,6 C8,3.790861 9.790861,2 12,2 Z M12,4 C10.8954305,4 10,4.8954305 10,6 C10,7.1045695 10.8954305,8 12,8 C13.1045695,8 14,7.1045695 14,6 C14,4.8954305 13.1045695,4 12,4 Z"}),"User"),Na=Object(T.a)(o.a.createElement("path",{d:"M8,13 C11.3229116,13 13.7530244,13.8337117 15.2223821,15.5699359 C15.724477,16.1632234 16,16.915291 16,17.6925226 L16,18.5 C16,19.8807119 14.8807119,21 13.5,21 L2.5,21 C1.11928813,21 0,19.8807119 0,18.5 L0,17.6925204 C0,16.9152876 0.275524605,16.1632192 0.777621166,15.569932 C2.24697824,13.8337108 4.67709024,13 8,13 Z M17.9515112,14.0335753 L18.0683205,14.0347288 C20.2213596,14.1802785 21.8813904,14.7876525 23.0130897,15.8958397 C23.5916808,16.4623828 23.9388003,17.2206225 23.9926356,18.0235027 L24,18.2434663 L24,18.75 C24,19.940864 23.0748384,20.9156449 21.9040488,20.9948092 L21.75,21 L19,21 C18.4477153,21 18,20.5522847 18,20 C18,19.4871642 18.3860402,19.0644928 18.8833789,19.0067277 L19,19 L21.75,19 C21.8683467,19 21.9674868,18.9177666 21.9933973,18.8073227 L22,18.75 L22,18.2434663 C22,17.8977921 21.8608093,17.5666871 21.6138154,17.3248364 C20.8641159,16.5907126 19.6490875,16.1461566 17.9334244,16.0301743 C17.3823973,15.9929238 16.9658991,15.5160306 17.0031496,14.9650035 C17.0377394,14.4533355 17.4514089,14.0576643 17.9515112,14.0335753 L17.9515112,14.0335753 Z M8,15 C5.21130036,15 3.33538166,15.6435809 2.30428673,16.861943 C2.10781409,17.0940989 2,17.3883868 2,17.6925212 L2,18.5 C2,18.7761424 2.22385763,19 2.5,19 L13.5,19 C13.7761424,19 14,18.7761424 14,18.5 L14,17.6925226 C14,17.3883883 13.8921864,17.0941004 13.6957148,16.8619448 C12.6646202,15.6435815 10.788701,15 8,15 Z M17,5 C18.9329966,5 20.5,6.56700338 20.5,8.5 C20.5,10.4329966 18.9329966,12 17,12 C15.0670034,12 13.5,10.4329966 13.5,8.5 C13.5,6.56700338 15.0670034,5 17,5 Z M8,3 C10.209139,3 12,4.790861 12,7 C12,9.209139 10.209139,11 8,11 C5.790861,11 4,9.209139 4,7 C4,4.790861 5.790861,3 8,3 Z M17,7 C16.1715729,7 15.5,7.67157288 15.5,8.5 C15.5,9.32842712 16.1715729,10 17,10 C17.8284271,10 18.5,9.32842712 18.5,8.5 C18.5,7.67157288 17.8284271,7 17,7 Z M8,5 C6.8954305,5 6,5.8954305 6,7 C6,8.1045695 6.8954305,9 8,9 C9.1045695,9 10,8.1045695 10,7 C10,5.8954305 9.1045695,5 8,5 Z"}),"Group"),Pa=Object(T.a)(o.a.createElement("path",{d:"M7.41421356,19 L3.87781746,22.5363961 C3.44824074,22.9659728 2.75175926,22.9659728 2.32218254,22.5363961 C2.11589252,22.3301061 2,22.0503168 2,21.7585786 L2,6 C2,3.790861 3.790861,2 6,2 L18,2 C20.209139,2 22,3.790861 22,6 L22,15 C22,17.209139 20.209139,19 18,19 L7.41421356,19 Z M4,19.5857864 L6.20502525,17.3807612 C6.44882255,17.1369639 6.77948263,17 7.12426407,17 L18,17 C19.1045695,17 20,16.1045695 20,15 L20,6 C20,4.8954305 19.1045695,4 18,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,19.5857864 Z"}),"Message"),ja=Object(T.a)(o.a.createElement("path",{d:"M6,2 L18,2 C20.1421954,2 21.8910789,3.68396847 21.9951047,5.80035966 L22,6 L22,10 C22,10.5522847 21.5522847,11 21,11 C20.4871642,11 20.0644928,10.6139598 20.0067277,10.1166211 L20,10 L20,6 C20,4.9456382 19.1841222,4.08183488 18.1492623,4.00548574 L18,4 L6,4 C4.9456382,4 4.08183488,4.81587779 4.00548574,5.85073766 L4,6 L4,19.5857864 L6.20502525,17.3807612 C6.41399436,17.1717921 6.68678103,17.0413128 6.97757724,17.0082977 L7.12426407,17 L13,17 C13.5522847,17 14,17.4477153 14,18 C14,18.5128358 13.6139598,18.9355072 13.1166211,18.9932723 L13,19 L7.41421356,19 L3.87781746,22.5363961 C3.44824074,22.9659728 2.75175926,22.9659728 2.32218254,22.5363961 C2.14536253,22.3595761 2.034957,22.1287566 2.00702113,21.8826983 L2,21.7585786 L2,6 C2,3.85780461 3.68396847,2.10892112 5.80035966,2.00489531 L6,2 L18,2 L6,2 Z M19,12 C21.209139,12 23,13.790861 23,16 C23,18.209139 21.209139,20 19,20 C16.790861,20 15,18.209139 15,16 C15,13.790861 16.790861,12 19,12 Z M19,14 C17.8954305,14 17,14.8954305 17,16 C17,17.1045695 17.8954305,18 19,18 C20.1045695,18 21,17.1045695 21,16 C21,14.8954305 20.1045695,14 19,14 Z"}),"Unread");a(507);class Da extends r.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateChatId=e=>{var t=this.props.chatId;t!==e.previousChatId&&t!==e.nextChatId||this.forceUpdate()},this.handleSelect=e=>{0===e.button&&Object(re.i)(this.props.chatId)},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,h,d,p,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),n=t.props,i=n.chatId,r=n.chatList,!t.state.contextMenu){e.next=7;break}t.setState({contextMenu:!1}),e.next=23;break;case 7:return o=new Date,Da.contextMenuId=o,l=a.clientX,c=a.clientY,h=Object(V.V)(i,r),e.next=14,t.canPinChats(i);case 14:if(e.t0=e.sent,e.t0){e.next=17;break}e.t0=h;case 17:if(d=e.t0,p=Object(V.a)(i),u=!Object(V.cb)(i),Da.contextMenuId===o){e.next=22;break}return e.abrupt("return");case 22:t.setState({contextMenu:!0,canTogglePin:d,canToggleArchive:p,canMute:u,left:l,top:c});case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleMute=e=>{this.handleCloseContextMenu(e);var t=this.props.chatId;Object(Fe.i)(t,!Object(V.U)(t))},this.canPinChats=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.props.chatList,i=Object(V.S)(a)?ee.a.get("pinned_archived_chat_count_max"):ee.a.get("pinned_chat_count_max")){e.next=4;break}return e.abrupt("return",!1);case 4:return r=Object(V.W)(a),e.next=7,x.a.send({"@type":"getChats",chat_list:n,offset_order:"9223372036854775807",offset_chat_id:0,limit:i.value+10});case 7:return o=e.sent,l=o.chat_ids.reduce((e,t)=>{if(Object(V.W)(t)!==r)return e;var a=Z.a.get(t);return e+(a&&Object(V.V)(a.id,n)?1:0)},0),e.abrupt("return",l<i.value);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handlePin=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleCloseContextMenu(a),n=t.props,i=n.chatId,r=n.chatList,(o=Object(V.V)(i,r))||t.canPinChats(i)){e.next=5;break}return e.abrupt("return");case 5:Object(Fe.h)(i,r,!o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleArchive=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleCloseContextMenu(a),n=t.props.chatId,Object(V.a)(n)){e.next=4;break}return e.abrupt("return");case 4:Object(Fe.a)(n,{"@type":Object(V.S)(n)?"chatListMain":"chatListArchive"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleViewInfo=e=>{this.handleCloseContextMenu(e);var t=this.props.chatId;Object(re.i)(t,null,!0)},this.handleRead=e=>{this.handleCloseContextMenu(e);var t=this.props.chatId;if(Object(V.X)(t)){var a=Z.a.get(t);if(!a)return;var n=a.is_marked_as_unread,s=a.last_message;a.unread_count>0&&s?function(e,t,a){x.a.send({"@type":"viewMessages",chat_id:e,message_ids:t,force_read:a})}(t,[s.id],!0):n&&Object(Fe.g)(t,!1)}else Object(Fe.g)(t,!0)},this.handleDeleteChat=e=>{this.handleCloseContextMenu(e);var t=this.props.chatId;Object(Fe.e)(t)},this.dialog=o.a.createRef();var a=Z.a.get(this.props.chatId);this.state={chat:a,contextMenu:!1,left:0,top:0}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.t,i=a.hidden,r=a.isLastPinned,o=a.chatList,l=a.style,c=this.state.contextMenu;return e.chatId!==n||(e.t!==s||(e.hidden!==i||(e.isLastPinned!==r||(t.contextMenu!==c||(t.chatList!==o||!(!e.style||!l||l.top===e.style.top))))))}componentDidMount(){na.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){var e=this.props,t=e.chatId,a=e.chatList,n=e.showSavedMessages,s=e.hidden,i=e.t,r=(e.isLastPinned,e.style),l=this.state,h=l.contextMenu,d=l.left,p=l.top,u=l.canToggleArchive,m=l.canTogglePin,f=l.canMute,g=Object(V.c)(t),C=Object(V.B)(t,i),v=Object(V.V)(t,a),b=na.a.getChatId()===t,E=Object(V.U)(t),S=Object(V.X)(t),y=Object(V.S)(t);return o.a.createElement("div",{ref:this.dialog,className:c()("dialog",{"item-selected":b},{"dialog-hidden":s}),onMouseDown:this.handleSelect,onContextMenu:this.handleContextMenu,style:r},o.a.createElement("div",{className:"dialog-wrapper"},o.a.createElement(K,{chatId:t,dialog:!0,showSavedMessages:n,showOnline:!0}),o.a.createElement("div",{className:"dialog-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},o.a.createElement(xe,{chatId:t}),o.a.createElement(Ia,{chatId:t})),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement(la,{chatId:t}),o.a.createElement(ga,{chatId:t,chatList:a})))),o.a.createElement(Je.a,{open:h,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:p,left:d},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},u&&o.a.createElement(Ke.a,{onClick:this.handleArchive},y?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(xa,null)),o.a.createElement(Se.a,{primary:i("Unarchive")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(Ua,null)),o.a.createElement(Se.a,{primary:i("Archive")}))),m&&o.a.createElement(Ke.a,{onClick:this.handlePin},v?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(wa,null)),o.a.createElement(Se.a,{primary:i("UnpinFromTop")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(wa,null)),o.a.createElement(Se.a,{primary:i("PinToTop")}))),o.a.createElement(Ke.a,{onClick:this.handleViewInfo},o.a.createElement(Ee.a,null,Object(V.db)(t)?o.a.createElement(_a,null):o.a.createElement(Na,null)),o.a.createElement(Se.a,{primary:Object(V.L)(t,i)})),f&&o.a.createElement(Ke.a,{onClick:this.handleMute},E?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(La,null)),o.a.createElement(Se.a,{primary:i("ChatsUnmute")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(Oa,null)),o.a.createElement(Se.a,{primary:i("ChatsMute")}))),o.a.createElement(Ke.a,{onClick:this.handleRead},S?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(Pa,null)),o.a.createElement(Se.a,{primary:i("MarkAsRead")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(ja,null)),o.a.createElement(Se.a,{primary:i("MarkAsUnread")}))),g&&C&&o.a.createElement(Ke.a,{onClick:this.handleDeleteChat},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:C})))))}}Da.defaultProps={hidden:!1,showSavedMessages:!0};var Ra=Object(_.a)()(Da);a(508);class Ta extends o.a.Component{render(){var e=this.props,t=e.chatId,a=e.index,n=e.showTitle,s=null;n&&(s=Object(V.v)(t,!0));var i="".concat(50+10*Math.sin(a),"%"),r="".concat(70+10*Math.cos(a),"%");return o.a.createElement("div",{className:"dialog-placeholder"},o.a.createElement("div",{className:"dialog-placeholder-wrapper"},o.a.createElement("div",{className:"dialog-placeholder-tile"}),o.a.createElement("div",{className:"dialog-placeholder-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},n?s:o.a.createElement("div",{className:"dialog-placeholder-title",style:{width:i}})),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement("div",{className:"dialog-placeholder-content",style:{width:r}})))))}}var Fa=Ta,Aa=(a(509),e=>({height:e,position:"relative"})),Ba=(e,t)=>({height:t,left:0,right:0,top:t*e,position:"absolute"});class Va extends o.a.Component{constructor(e){super(e),this.setViewportHeight=()=>{var e=this.props.source,t=this.state.scrollTop,a=this.listRef.current;if(a){var n=parseFloat(window.getComputedStyle(a,null).getPropertyValue("height")),s=this.getRenderIds(e,n,t);this.setState(Object(Ze.a)({viewportHeight:n},s))}},this.setScrollPosition=e=>{var t=this.props,a=t.source,n=t.rowHeight,s=t.onScroll,i=this.state,r=i.viewportHeight,o=i.scrollTop;if(Math.abs(e.target.scrollTop-o)>=n){var l=this.getRenderIds(a,r,e.target.scrollTop);this.setState(Object(Ze.a)({scrollTop:e.target.scrollTop},l))}s&&s(e)},this.isVisibleItem=(e,t,a)=>{var n=this.props,s=n.overScanCount,i=n.rowHeight;return e*i>a-s*i&&(e+1)*i<a+t+s*i},this.listRef=o.a.createRef(),this.state={scrollTop:0,renderIds:new Map,renderIdsList:[],viewportHeight:0}}componentDidUpdate(e,t,a){e.source!==this.props.source&&this.setViewportHeight()}shouldComponentUpdate(e,t,a){return!0}componentDidMount(){window.addEventListener("resize",this.setViewportHeight,!0);var e=this.listRef.current;e&&(e.addEventListener("scroll",this.setScrollPosition,!0),this.setViewportHeight())}getRenderIds(e,t,a){var n=new Map,s=[];return e.forEach((e,i)=>{this.isVisibleItem(i,t,a)&&(n.set(i,i),s.push(i))}),{renderIds:n,renderIdsList:s}}componentWillUnmount(){window.removeEventListener("resize",this.setViewportHeight);var e=this.listRef.current;e&&e.removeEventListener("scroll",this.setScrollPosition)}getListRenderIds(){return this.state.renderIds}getListRef(){return this.listRef}render(){var e=this.props,t=e.className,a=e.source,n=e.renderItem,s=e.rowHeight,i=this.state.renderIds,r=(a||[]).map((e,t)=>i.has(t)&&n({index:t,style:Ba(t,s)}));return o.a.createElement("div",{ref:this.listRef,className:c()("vlist",t)},o.a.createElement("div",{style:Aa((a||[]).length*s)},r))}}Va.defaultProps={source:[],rowHeight:72,overScanCount:5};var Ha=Va;function za(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=e.childNodes.length-1;t>=0;t--){var a=za(e.childNodes[t]);if(a)return a}return null}function Wa(e){if(e){var t=za(e);if(t){var a=document.createRange();a.setStart(t,t.length),a.collapse(!0);var n=window.getSelection();n.removeAllRanges(),n.addRange(a)}e.focus()}}function Ga(e,t="smooth"){e&&(e.scrollTop=Math.min(e.scrollTop,100),setTimeout(()=>{e.scrollTo({top:0,behavior:t})},50))}a(510);var Za=a(242),qa=Object(T.a)(o.a.createElement("path",{d:"M18.5,1.6784749 C19.8807119,1.6784749 21,2.79776303 21,4.1784749 L21,19.8215251 C21,20.4013736 20.7984395,20.9631907 20.4298256,21.4107932 C19.552097,22.4766065 17.9765451,22.6290792 16.9107319,21.7513507 L12,17.7064749 L12,19.5 C12,21.0976809 10.75108,22.4036609 9.17627279,22.4949073 L9,22.5 C7.34314575,22.5 6,21.1568542 6,19.5 L6,19.5 L5.99981203,16.8999437 C3.71766536,16.4366008 2,14.4188915 2,12 C2,9.23857625 4.23857625,7 7,7 L11.1412346,7 L16.9107319,2.24864931 C17.3583344,1.88003543 17.9201515,1.6784749 18.5,1.6784749 Z M8,19.5 C8,20.0522847 8.44771525,20.5 9,20.5 C9.55228475,20.5 10,20.0522847 10,19.5 L10,19.5 L10,16.9994749 L8,16.9994749 Z M18.5,3.6784749 C18.3840303,3.6784749 18.2716669,3.71878701 18.1821464,3.79250978 L12.4126491,8.54386047 C12.054567,8.83875158 11.6051134,9 11.1412346,9 L7,9 C5.34314575,9 4,10.3431458 4,12 C4,13.6568542 5.34314575,15 7,15 L11.1412346,15 C11.6051134,15 12.054567,15.1612484 12.4126491,15.4561395 L18.1821464,20.2074902 C18.395309,20.3830359 18.7104194,20.3525414 18.8859651,20.1393787 C18.9596879,20.0498582 19,19.9374948 19,19.8215251 L19,4.1784749 C19,3.90233253 18.7761424,3.6784749 18.5,3.6784749 Z"}),"Channel"),Ka=Object(T.a)(o.a.createElement("path",{d:"M4,16 L20,16 C20.5522847,16 21,16.4477153 21,17 C21,17.5128358 20.6139598,17.9355072 20.1166211,17.9932723 L20,18 L4,18 C3.44771525,18 3,17.5522847 3,17 C3,16.4871642 3.38604019,16.0644928 3.88337887,16.0067277 L4,16 L20,16 L4,16 Z M4,11 L20,11 C20.5522847,11 21,11.4477153 21,12 C21,12.5128358 20.6139598,12.9355072 20.1166211,12.9932723 L20,13 L4,13 C3.44771525,13 3,12.5522847 3,12 C3,11.4871642 3.38604019,11.0644928 3.88337887,11.0067277 L4,11 Z M4,6 L20,6 C20.5522847,6 21,6.44771525 21,7 C21,7.51283584 20.6139598,7.93550716 20.1166211,7.99327227 L20,8 L4,8 C3.44771525,8 3,7.55228475 3,7 C3,6.48716416 3.38604019,6.06449284 3.88337887,6.00672773 L4,6 Z"}),"Menu"),Ja=Object(T.a)(o.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M11.9779053,15.294165 C12.6523978,15.294165 13.1985107,15.8124506 13.1985107,16.4732666 C13.1985107,17.1238794 12.6418359,17.6523682 11.9779053,17.6523682 C11.3175981,17.6523682 10.7572998,17.1168932 10.7572998,16.4732666 C10.7572998,15.8194152 11.3070616,15.294165 11.9779053,15.294165 Z M12.3306885,6.9 C14.2795758,6.9 15.719873,7.96860761 15.719873,9.65625 C15.719873,10.6709643 15.2884676,11.3128276 14.2962576,12.0165438 L13.7962596,12.3573922 C13.1714716,12.7953495 12.9391113,13.1198405 12.9391113,13.5887451 L12.9391113,13.7132568 C12.9391113,14.2033083 12.5618823,14.5499512 11.9986572,14.5499512 C11.4068652,14.5499512 11.0789551,14.2281702 11.0789551,13.630249 L11.0789551,13.4953613 C11.0789551,12.5573197 11.487326,11.9745882 12.4189711,11.3276124 L12.7619755,11.0871498 C13.5110635,10.5470305 13.7248291,10.2540011 13.7248291,9.73925781 C13.7248291,8.99900037 13.149745,8.51113281 12.2580566,8.51113281 C11.6278214,8.51113281 11.1498312,8.8062186 10.7980484,9.38963394 L10.5277106,9.73161327 L10.5277106,9.73161327 L10.4428973,9.8298462 C10.2452762,10.0412654 10.0433297,10.1297852 9.70556641,10.1297852 C9.27040611,10.1297852 8.9,9.79174463 8.9,9.31384277 C8.9,9.13743147 8.92867764,8.96536563 8.98734042,8.76592778 C9.31829759,7.6784971 10.623966,6.9 12.3306885,6.9 Z"}),"Help"),Ya=Object(T.a)(o.a.createElement("path",{d:"M13.4542714,1 C14.5034049,1 15.447759,1.80035641 15.6254934,2.83409123 L15.8863908,4.35151652 C16.4016786,4.58533298 16.8892685,4.86975342 17.3418997,5.20083722 L18.729489,4.68523838 C19.7215225,4.31661974 20.8874905,4.74674629 21.4093705,5.66596818 L22.3631385,7.34590292 C22.8807104,8.25753682 22.6641696,9.47960173 21.8668015,10.158283 L20.7203437,11.1340925 C20.7523279,11.4263818 20.768775,11.713662 20.768775,12 C20.768775,12.2863013 20.7523321,12.5735444 20.7203561,12.8657949 L21.8666717,13.8411466 C22.6665193,14.5217032 22.8803536,15.7423983 22.3631806,16.6535107 L21.4094127,18.3337799 C20.8871999,19.2537711 19.7186485,19.6823124 18.729489,19.3147616 L17.3418997,18.7991628 C16.8892685,19.1302466 16.4016786,19.414667 15.8863908,19.6484835 L15.6254934,21.1659088 C15.4482371,22.1968626 14.500959,23 13.4542714,23 L11.5464067,23 C10.4973482,23 9.55294448,22.1997516 9.37499917,21.1661206 L9.11371177,19.6483803 C8.59870239,19.4145642 8.11116816,19.1301583 7.65836517,18.7991106 L6.27103566,19.3147347 C5.27906015,19.683419 4.11313098,19.25315 3.59116388,18.3339086 L2.63706709,16.6536394 C2.11936149,15.741903 2.33579039,14.5197379 3.13332831,13.8411466 L4.27990265,12.8655748 C4.24777315,12.5724368 4.23122501,12.2856623 4.23122501,12 C4.23122501,11.7143012 4.24777739,11.4274899 4.27991498,11.1343127 L3.1331985,10.158283 C2.33341387,9.47754488 2.11971252,8.25678535 2.6371093,7.34577419 L3.59120609,5.66583945 C4.11357343,4.74607633 5.28204594,4.31769072 6.27103566,4.68526527 L7.65836517,5.20088944 C8.02060756,4.93605128 8.40507795,4.70106385 8.80806121,4.49794854 L9.11371177,4.35161967 L9.37499917,2.83387942 C9.55246572,1.80302941 10.4997942,1 11.5464067,1 L13.4542714,1 Z M13.4542714,3 L11.5464067,3 C11.4759721,3 11.3587093,3.09940116 11.3460046,3.17319893 L10.9911423,5.23448734 C10.9307198,5.5854636 10.6881938,5.87781899 10.3544182,6.00203275 C9.66471384,6.25870451 9.03276419,6.62813555 8.48454956,7.09507573 C8.20871593,7.3300162 7.82737524,7.39737412 7.48774669,7.2711455 L5.57427032,6.55997006 C5.50662795,6.53482964 5.36908018,6.58525743 5.33030218,6.65353615 L4.37620539,8.3334709 C4.33235155,8.41068695 4.36153792,8.57741281 4.42951339,8.63527025 L5.99467372,9.96745916 C6.26327177,10.1960769 6.39156502,10.5492878 6.3322987,10.8969923 C6.26535074,11.2897637 6.23122501,11.6509097 6.23122501,12 C6.23122501,12.3490903 6.26535074,12.7102363 6.3322987,13.1030077 C6.39157523,13.4507721 6.26322722,13.80404 5.99454391,14.0326513 L4.42938358,15.3643802 C4.36263141,15.4211768 4.33280785,15.5895892 4.3762476,15.6660914 L5.33034439,17.3463606 C5.36962791,17.4155432 5.5053715,17.4656373 5.57427032,17.4400299 L7.48774669,16.7288545 C7.82737524,16.6026259 8.20871593,16.6699838 8.48454956,16.9049243 C9.03276419,17.3718644 9.66471384,17.7412955 10.3544182,17.9979673 C10.6881938,18.122181 10.9307198,18.4145364 10.9911423,18.7655127 L11.3460046,20.8268011 C11.3591616,20.9032262 11.473368,21 11.5464067,21 L13.4542714,21 C13.5246311,21 13.6417446,20.9007069 13.6544151,20.8270129 L14.0088212,18.7657245 C14.0691981,18.4145617 14.3118672,18.1220527 14.6458423,17.9978703 C15.3359969,17.7412494 15.9677081,17.3719578 16.5150513,16.9052644 C16.7908836,16.6700754 17.1723926,16.6025695 17.512181,16.7288276 L19.4261097,17.4400031 C19.4938321,17.4651673 19.631347,17.4147366 19.6700861,17.3464893 L20.623854,15.6662201 C20.6677382,15.5889085 20.6385289,15.422164 20.5706164,15.3643802 L19.0054561,14.0326513 C18.7363402,13.803672 18.6080436,13.4496677 18.6679701,13.1014383 C18.7347206,12.7135552 18.768775,12.3516302 18.768775,12 C18.768775,11.6483698 18.7347206,11.2864448 18.6679701,10.8985617 C18.6080539,10.5503923 18.7362957,10.196445 19.0053263,9.96745916 L20.5704866,8.63527025 C20.6374086,8.57830946 20.6672761,8.40975011 20.6238962,8.33334216 L19.6701283,6.65340742 C19.6309511,6.58440211 19.4952014,6.53432393 19.4261097,6.55999695 L17.512181,7.27117239 C17.1723926,7.39743055 16.7908836,7.32992456 16.5150513,7.09473562 C15.9677081,6.62804223 15.3359969,6.25875055 14.6458423,6.00212967 C14.3118672,5.87794735 14.0691981,5.58543825 14.0088212,5.23427554 L13.6544151,3.17298713 C13.6412929,3.0966658 13.5272352,3 13.4542714,3 Z M12.5,10 C13.6045695,10 14.5,10.8954305 14.5,12 C14.5,13.1045695 13.6045695,14 12.5,14 C11.3954305,14 10.5,13.1045695 10.5,12 C10.5,10.8954305 11.3954305,10 12.5,10 Z"}),"Settings");var Xa=new class{load(e){return Object(i.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=localStorage.getItem(e)){t.next=3;break}return t.abrupt("return",null);case 3:return t.prev=3,t.abrupt("return",JSON.parse(a));case 7:return t.prev=7,t.t0=t.catch(3),t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[3,7]])})))()}save(e,t){return Object(i.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:localStorage.setItem(e,JSON.stringify(t));case 1:case"end":return a.stop()}}),a)})))()}remove(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:localStorage.removeItem(e);case 1:case"end":return t.stop()}}),t)})))()}clear(){return Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.clear();case 1:case"end":return e.stop()}}),e)})))()}};class Qa extends ha.a{constructor(){super(),this.reset=()=>{this.filters=null,this.chatIds=[],this.archiveChatIds=[],this.meChat=null,this.cacheContacts&&(this.contacts=null),this.cache=null},this.onUpdate=e=>{switch(e["@type"]){case"updateAuthorizationState":var t=e.authorization_state;if(!t)break;switch(t["@type"]){case"authorizationStateClosed":this.reset(),this.clear();break;case"authorizationStateLoggingOut":case"authorizationStateWaitCode":case"authorizationStateWaitPhoneNumber":case"authorizationStateWaitPassword":case"authorizationStateWaitRegistration":Xa.remove("cache"),Xa.remove("files"),this.cacheContacts&&Xa.remove("contacts")}}},this.onClientUpdate=e=>{switch(e["@type"]){case"clientUpdateDialogsReady":this.clearDataUrls()}},this.addTdLibListener=()=>{x.a.on("update",this.onUpdate),x.a.on("clientUpdate",this.onClientUpdate)},this.removeTdLibListener=()=>{x.a.off("update",this.onUpdate),x.a.off("clientUpdate",this.onClientUpdate)},this.cacheContacts=!1,this.reset(),this.addTdLibListener(),this.saveInternal=Object(M.f)(this.saveInternal,2e3)}load(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o,l,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=[]).push(Xa.load("cache").catch(e=>null)),a.push(Xa.load("files").catch(e=>null)),a.push(Xa.load("filters").catch(e=>null)),e.cacheContacts&&a.push(Xa.load("contacts").catch(e=>null)),t.next=7,Promise.all(a);case 7:return n=t.sent,i=Object(L.a)(n,4),r=i[0],o=i[1],l=i[2],c=i[3],e.cache=r,e.cache&&(e.cache.files=o||[]),e.cacheContacts&&c&&((c||[]).forEach(e=>{H.a.set(e)}),e.contacts={"@type":"users",user_ids:c.map(e=>e.id),total_count:c.length}),e.filters=l,e.cache&&e.parseCache(e.cache),t.abrupt("return",e.cache);case 19:case"end":return t.stop()}}),t)})))()}parseCache(e){if(e){var t=e.meChat,a=e.chats,n=e.archiveChats,s=e.users,i=e.basicGroups,r=e.supergroups,o=e.files,l=e.options;(o||[]).filter(e=>Boolean(e)).forEach(({id:e,url:t})=>{U.a.setDataUrl(e,t)}),(s||[]).forEach(e=>{H.a.set(e)}),(i||[]).forEach(e=>{we.a.set(e)}),(r||[]).forEach(e=>{Oe.a.set(e)}),(a||[]).concat(n||[]).concat([t]).forEach(e=>{e&&(delete e.OutputTypingManager,Z.a.set(e),e.photo&&(e.photo.small&&U.a.set(e.photo.small),e.photo.big&&U.a.set(e.photo.big)),e.position&&Z.a.updateChatChatLists(e.id),e.last_message&&le.a.set(e.last_message))}),(l||[]).forEach(([e,t])=>{ee.a.set(e,t)})}}getCache(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l,c,h,d;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new Map,r=new Map,o=new Map,l=new Map,c=a.meChat,h=e.map(e=>Z.a.get(e)),d=t.map(e=>Z.a.get(e)),h.concat(d).concat([c]).forEach(e=>{var t=e.photo,a=e.type,n=e.last_message;if(t&&t.small){var s=t.small.id;if(s){var c=U.a.getBlob(s);c&&i.set(s,c)}}switch(a["@type"]){case"chatTypeBasicGroup":var h=we.a.get(a.basic_group_id);h&&o.set(h.id,h);case"chatTypePrivate":case"chatTypeSecret":var d=H.a.get(a.user_id);d&&r.set(d.id,d);case"chatTypeSupergroup":var p=Oe.a.get(a.supergroup_id);p&&l.set(p.id,p)}if(n){var u=n.sender_user_id;if(u){var m=H.a.get(u);m&&r.set(m.id,m)}}}),n.abrupt("return",{date:new Date,meChat:c,chats:h,archiveChats:d,users:[...r.values()],basicGroups:[...o.values()],supergroups:[...l.values()],files:[...i.entries()],options:[...ee.a.items.entries()]});case 9:case"end":return n.stop()}}),n)})))()}save(e,t,a){var n=this;return Object(i.a)(s.a.mark((function i(){return s.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(n.chatIds=t,n.archiveChatIds=a,s.t0=n.meChat,s.t0){s.next=7;break}return s.next=6,x.a.send({"@type":"createPrivateChat",user_id:H.a.getMyId(),force:!1});case 6:s.t0=s.sent;case 7:if(n.meChat=s.t0,!n.cacheContacts){s.next=15;break}if(s.t1=n.contacts,s.t1){s.next=14;break}return s.next=13,x.a.send({"@type":"getContacts"});case 13:s.t1=s.sent;case 14:n.contacts=s.t1;case 15:n.filters=e,n.saveInternal();case 17:case"end":return s.stop()}}),i)})))()}saveInternal(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCache(e.chatIds,e.archiveChatIds);case 2:return a=t.sent,n=a.files,a.files=[],t.next=7,Xa.save("cache",a);case 7:return i=[],n.forEach(e=>{var t=Object(L.a)(e,2),a=t[0],n=t[1];i.push(new Promise((e,t)=>{var s=new FileReader;s.readAsDataURL(n),s.onload=t=>{e({id:a,url:t.target.result})},s.onerror=t=>{e(null)}}))}),t.next=11,Promise.all(i);case 11:return r=t.sent,t.next=14,Xa.save("files",r);case 14:if(!e.cacheContacts){t.next=18;break}return o=e.contacts.user_ids.map(e=>H.a.get(e)),t.next=18,Xa.save("contacts",o);case 18:if(!e.filters){t.next=21;break}return t.next=21,Xa.save("filters",e.filters);case 21:case"end":return t.stop()}}),t)})))()}clear(){var e=[];e.push(Xa.remove("cache").catch(e=>null)),e.push(Xa.remove("files").catch(e=>null)),e.push(Xa.remove("filters").catch(e=>null)),e.push(Xa.remove("contacts").catch(e=>null)),e.push(Xa.remove("register").catch(e=>null)),Promise.all(e)}clearDataUrls(){this.cache&&this.cache.files.forEach(({id:e,url:t})=>{U.a.deleteDataUrl(e)})}}var $a=new Qa;window.cache=$a;var en=$a;a(511);class tn extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePageWidth=e=>{var t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.handleMenuOpen=e=>{var t=this.state.authorizationState;Object(M.u)(t)&&this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleCheckUpdates=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.handleMenuClose();case 1:case"end":return e.stop()}}),e)}))),this.handleNewChannel=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateNewChannel",open:!0})},this.handleNewGroup=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!0})},this.handleContacts=e=>{this.handleMenuClose(),x.a.clientUpdate({"@type":"clientUpdateContacts",open:!0})},this.handleArchived=e=>{this.handleMenuClose(),Object(re.h)()},this.handleSaved=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleMenuClose(),n=en.cache?en.cache.meChat:null){e.next=6;break}return e.next=5,x.a.send({"@type":"createPrivateChat",user_id:H.a.getMyId(),force:!1});case 5:n=e.sent;case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:Object(re.i)(n.id);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSettings=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.handleMenuClose(),n=en.cache?en.cache.meChat:null){e.next=6;break}return e.next=5,x.a.send({"@type":"createPrivateChat",user_id:H.a.getMyId(),force:!1});case 5:n=e.sent;case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:x.a.clientUpdate({"@type":"clientUpdateSettings",open:!0,chatId:n.id});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleHelp=function(){var e=Object(i.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.handleMenuClose();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleSearch=()=>{this.handleMenuClose(),Object(re.m)(0)},this.state={authorizationState:na.a.getAuthorizationState(),anchorEl:null,isSmallWidth:na.a.isSmallWidth}}componentDidMount(){na.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){na.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}render(){var e=this.props,t=e.t,a=e.timeout,n=e.popup,s=e.showClose,i=e.onClose,r=this.state,l=r.anchorEl,c=r.authorizationState,h=r.isSmallWidth,d=!s&&Object(M.u)(c)?o.a.createElement(Za.a,{id:"main-menu",anchorEl:l,open:Boolean(l),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"left"}},o.a.createElement(Ke.a,{onClick:this.handleNewChannel},o.a.createElement(Ee.a,null,o.a.createElement(qa,null)),o.a.createElement(Se.a,{primary:t("NewChannel")})),o.a.createElement(Ke.a,{onClick:this.handleNewGroup},o.a.createElement(Ee.a,null,o.a.createElement(Na,null)),o.a.createElement(Se.a,{primary:t("NewGroup")})),h&&o.a.createElement(Ke.a,{onClick:this.handleSearch},o.a.createElement(Ee.a,null,o.a.createElement(Pt,null)),o.a.createElement(Se.a,{primary:t("Search")})),o.a.createElement(Ke.a,{onClick:this.handleContacts},o.a.createElement(Ee.a,null,o.a.createElement(_a,null)),o.a.createElement(Se.a,{primary:t("Contacts")})),o.a.createElement(Ke.a,{onClick:this.handleArchived},o.a.createElement(Ee.a,null,o.a.createElement(Ua,null)),o.a.createElement(Se.a,{primary:t("Archived")})),o.a.createElement(Ke.a,{onClick:this.handleSaved},o.a.createElement(Ee.a,null,o.a.createElement(F,null)),o.a.createElement(Se.a,{primary:t("Saved")})),o.a.createElement(Ke.a,{onClick:this.handleSettings},o.a.createElement(Ee.a,null,o.a.createElement(Ya,null)),o.a.createElement(Se.a,{primary:t("Settings")})),o.a.createElement(Ke.a,{onClick:this.handleHelp},o.a.createElement(Ee.a,null,o.a.createElement(Ja,null)),o.a.createElement(Se.a,{primary:t("SettingsHelp")}))):null,p=n?o.a.createElement(g.a,null):o.a.createElement(je,null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{"aria-owns":l?"simple-menu":null,"aria-haspopup":"true",className:"header-left-button main-menu-button","aria-label":"Menu",onClick:s?i:this.handleMenuOpen},a?o.a.createElement(jt.a,{open:s,openIcon:o.a.createElement(je,null),icon:o.a.createElement(Ka,null)}):o.a.createElement(o.a.Fragment,null,s?p:o.a.createElement(Ka,null))),d)}}var an=Object(_.a)()(tn);a(512);class nn extends o.a.Component{constructor(...e){super(...e),this.handleKeyDown=e=>{if(13===e.keyCode)e.preventDefault();else if(27===e.keyCode){var t=this.props,a=t.onChange,n=t.onClose,s=e.target;if(!s)return;if(s.innerText)return e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),s.innerText=null,void(a&&a(s.innerText));n&&n(e)}else if(8===e.keyCode){var i=this.props.onBackspace,r=e.target;if(!r)return;if(r.innerText)return;i&&(e.stopPropagation(),i())}},this.handleKeyUp=e=>{var t=e.target;if(t){var a=t.innerHTML;"<br>"!==a&&"<div><br></div>"!==a||(t.innerHTML=null)}},this.handlePaste=e=>{var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleInput=e=>{var t=this.props.onChange,a=e.target;a&&t&&t(a.innerText)}}render(){var e=this.props,t=e.inputRef,a=e.t,n=e.onFocus,s=e.hint,i=e.showIcon;return o.a.createElement("div",{className:"search-input"},o.a.createElement("div",{id:"search-inputbox",ref:t,placeholder:s||a("Search"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,onInput:this.handleInput,onFocus:n}),i&&o.a.createElement(Pt,{className:"search-input-icon"}))}}nn.defaultProps={showIcon:!0};var sn=Object(_.a)()(nn);a(450);class rn extends o.a.Component{constructor(e){super(e),this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.handleSearch=()=>{var e=this.props,t=e.onSearch,a=e.openSearch,n=this.state.authorizationState;Object(M.u)(n)&&t(!a)},this.handleSearchTextChange=()=>{var e=this.props.onSearchTextChange,t=this.searchInputRef.current;if(t){var a=t.innerHTML;"<br>"!==a&&"<div><br></div>"!==a||(t.innerHTML=null),e(t.innerText)}},this.handleCloseSearch=()=>{this.handleSearch()},this.handleFocus=()=>{this.handleSearch()},this.searchInputRef=o.a.createRef(),this.state={authorizationState:na.a.getAuthorizationState(),open:!1}}setInitQuery(e){var t=this.props.onSearchTextChange,a=this.searchInputRef.current;if(a){if(a.innerText=e,a.childNodes.length>0){var n=document.createRange();n.setStart(a.childNodes[0],a.childNodes[0].length),n.collapse(!0);var s=window.getSelection();s.removeAllRanges(),s.addRange(n)}a.focus(),t(e)}}componentDidUpdate(e,t,a){var n=this.props.openSearch;if(n!==e.openSearch)if(n)this.focusInput();else{var s=this.searchInputRef.current;s&&(s.innerText=null)}}focusInput(){var e=this.searchInputRef.current;e&&e.focus()}componentDidMount(){this.props.popup&&this.focusInput(),na.a.on("updateAuthorizationState",this.onUpdateAuthorizationState)}componentWillUnmount(){na.a.off("updateAuthorizationState",this.onUpdateAuthorizationState)}render(){var e=this.props,t=e.openSearch,a=e.timeout,n=e.popup,s=null,i=!1;return t?(i=!0,s=o.a.createElement(sn,{inputRef:this.searchInputRef,onChange:this.handleSearchTextChange,onClose:this.handleCloseSearch})):s=o.a.createElement(sn,{inputRef:this.searchInputRef,onFocus:this.handleFocus}),o.a.createElement("div",{className:"header-master"},o.a.createElement(an,{timeout:a,showClose:i,popup:n,onClose:this.handleCloseSearch}),s)}}var on=rn,ln=a(83);a(513);class cn extends o.a.Component{constructor(e){super(e),this.hasObserver=()=>"ResizeObserver"in window,this.onClientUpdateLanguageChange=e=>{this.hasObserver()||this.setSelection(!1)},this.onClientUpdateCacheLoaded=e=>{if(!this.state.filters){var t=en.filters;t&&this.setState({filters:t},()=>{this.hasObserver()||this.setSelection(!1)})}},this.onWindowResize=()=>{this.setSelection(!0)},this.onClientUpdatePageWidth=e=>{var t=na.a.isSmallWidth;this.setState({isSmallWidth:t},()=>{this.hasObserver()||this.setSelection(!1)})},this.setSelection=(e=!0)=>{var t=this.state,a=t.chatList,n=t.filters,s=(t.isSmallWidth,this.filtersRef.current),i=null,r=9;if("chatListMain"===a["@type"]){var o=this.filterRef.get("chatListMain");o&&(r=(i=o.firstChild).offsetLeft)}else if("chatListFilter"===a["@type"])for(var l=0;l<n.length;l++){var c=this.filterRef.get("chatListFilter_id="+n[l].id);if(n[l].id===a.chat_filter_id){r=(i=c.firstChild).offsetLeft;break}}if(i){var h=this.filterSelectionRef.current;if(h){var d=e?"transition: left 0.25s ease, width 0.25s ease":null;h.style.cssText="left: ".concat(r-3,"px; width: ").concat(i.scrollWidth+6,"px; ").concat(d)}if(i&&e){var p=this.animator;p&&p.stop(),this.animator=new ze.a(250,[{from:s.scrollLeft,to:Object(M.d)(r-s.offsetWidth/2+i.offsetWidth/2,0,s.scrollWidth-s.offsetWidth),func:e=>s.scrollLeft=e}]),setTimeout(()=>{this.animator&&this.animator.start()},0)}}},this.onUpdateChatFilters=e=>{var t=this.state.chatList,a=ma.filters;this.setState({filters:a},()=>{"chatListFilter"===t["@type"]&&-1===a.findIndex(e=>e.id===t.chat_filter_id)?this.handleMainClick():this.hasObserver()||this.setSelection()})},this.onClientUpdateChatList=e=>{var t=ma.chatList;this.setState({chatList:t},()=>{this.hasObserver()||this.setSelection()})},this.handleMainClick=e=>{e&&0!==e.button||x.a.clientUpdate({"@type":"clientUpdateChatList",chatList:{"@type":"chatListMain"}})},this.handleFilterClick=(e,t)=>{e&&0!==e.button||x.a.clientUpdate({"@type":"clientUpdateChatList",chatList:{"@type":"chatListFilter",chat_filter_id:t}})},this.handleWheel=e=>{e.deltaY&&(e.currentTarget.scrollLeft+=e.deltaY,e.stopPropagation())},this.filterRef=new Map,this.filtersRef=o.a.createRef(),this.filterSelectionRef=o.a.createRef();var t=na.a.isSmallWidth,a=ma.filters,n=ma.chatList;this.state={isSmallWidth:t,filters:a,chatList:n},this.onWindowResize=Object(M.D)(this.onWindowResize,250)}componentDidMount(){this.observeResize(),na.a.on("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),ma.on("clientUpdateChatList",this.onClientUpdateChatList),ma.on("updateChatFilters",this.onUpdateChatFilters),ln.a.on("clientUpdateLanguageChange",this.onClientUpdateLanguageChange),this.setSelection()}componentDidUpdate(e,t,a){this.unobserveResize(),this.observeResize()}componentWillUnmount(){this.unobserveResize(),na.a.off("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),ma.off("clientUpdateChatList",this.onClientUpdateChatList),ma.off("updateChatFilters",this.onUpdateChatFilters),ln.a.off("clientUpdateLanguageChange",this.onClientUpdateLanguageChange)}observeResize(){if(this.hasObserver()){var e=this.filtersRef.current;if(e){var t=new ResizeObserver(this.onWindowResize);t.observe(e),this.resizeObserver={observer:t,filters:e}}}}unobserveResize(){if(this.hasObserver()&&this.resizeObserver){var e=this.resizeObserver,t=e.observer,a=e.filters;t&&a&&t.unobserve(a)}}render(){var e=this.props.t,t=this.state,a=t.filters,n=t.chatList,s=t.isSmallWidth;return a&&a.length?(this.filterRef=new Map,o.a.createElement("div",{className:"tabs"},o.a.createElement("div",{className:"tabs-bottom-border"}),o.a.createElement("div",{ref:this.filtersRef,className:"filters",onWheel:this.handleWheel},o.a.createElement("div",{ref:e=>this.filterRef.set("chatListMain",e),className:c()("filter",{"item-selected":"chatListMain"===n["@type"]}),onMouseDown:this.handleMainClick,title:s?e("FilterAllChats"):null},o.a.createElement("span",null,s?Object(M.i)(e("FilterAllChats")):e("FilterAllChats"))),a.map(e=>o.a.createElement("div",{key:e.id,ref:t=>this.filterRef.set("chatListFilter_id="+e.id,t),className:c()("filter",{"item-selected":n.chat_filter_id===e.id}),onMouseDown:t=>this.handleFilterClick(t,e.id),title:s?e.title:null},o.a.createElement("span",null,s?Object(M.i)(e.title):e.title))),o.a.createElement("div",{ref:this.filterSelectionRef,className:"filter-selection"})))):null}}var hn=Object(_.a)()(cn);class dn extends o.a.Component{shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.chatList,r=n.style,o=n.hidden;return e.chatId!==s||(e.chatList!==i||(e.hidden!==o||e.style.top!==r.top))}render(){var e=this.props,t=e.chatId,a=e.chatList,n=e.hidden,s=e.style;return o.a.createElement("div",{className:"dialog-list-item",style:s},o.a.createElement(Ra,{chatId:t,chatList:a,hidden:n}))}}class pn extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateChatList=e=>{var t=e.chatList;this.setState({chatList:t,params:{loading:!1,completed:!1}},()=>{this.loadFirstSlice()})},this.onUpdateSupergroup=e=>{},this.onClientUpdateLeaveChat=e=>{var t=e.inProgress,a=e.chatId;t?this.hiddenChats.set(a,a):this.hiddenChats.delete(a),this.forceUpdate()},this.onUpdateAuthorizationState=e=>{var t=e.authorization_state;this.setState({authorizationState:t},()=>this.loadFirstSlice())},this.onFastUpdatingComplete=e=>{this.onLoadNext(!0)},this.loadFirstSlice=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.authorizationState,Object(M.u)(a)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,U.a.initDB(()=>t.onLoadNext(!0));case 5:case"end":return e.stop()}}),e)}))),this.saveCache=()=>{var e=this.props,t=e.onSaveCache,a=e.type,n=this.state.chatList;"chatListMain"===a&&"chatListMain"===n["@type"]&&t&&t()},this.onUpdateChatPosition=e=>{var t=this.state.chatList,a=e.position;Object(V.i)(t,a.list)&&this.onUpdateChatOrder(e)},this.onUpdateChatOrder=e=>{var t=this.state,a=t.chats,n=t.chatList,s=t.params;if(a){var i=s.loading;if(!i||a.length){var r=e.chat_id,o=Z.a.get(r);if(o&&Object(V.N)(r,n)){var l=Object(V.q)(r,n),c=a.findIndex(e=>e===r);if(-1!==c||"0"!==l){for(var h=[],d=0;d<a.length;d++){var p=Z.a.get(a[d]),u=Object(V.q)(a[d],n);p&&"0"!==u&&h.push(p.id)}var m=[];"0"===l?r!==na.a.getChatId()||o.last_message||(x.a.setChatId(0),Object(Fe.b)(!1)):-1===c&&(i?console.error("[vl] skip add while getChats",e):m.push(r)),this.reorderChats(h,m,()=>{this.loadChatContents(m),this.saveCache()})}}}}},this.handleScroll=()=>{var e=this.listRef.current.getListRef().current;e&&(e.scrollTop<=u.xb?this.onLoadPrev():e.scrollTop+e.offsetHeight>=e.scrollHeight-e.offsetHeight&&this.onLoadNext())},this.renderItem=({index:e,style:t},a)=>{var n=this.state.chatList,s=a[e];return o.a.createElement(dn,{key:s,chatId:s,chatList:n,hidden:this.hiddenChats.has(s),style:t})},this.hiddenChats=new Map,this.listRef=o.a.createRef();var a=na.a.authorizationState;this.state={authorizationState:a,chats:null,fistSliceLoaded:!1,chatList:"chatListMain"===e.type?{"@type":"chatListMain"}:{"@type":"chatListArchive"},params:{loading:!1,completed:!1}}}shouldComponentUpdate(e,t){var a=this.props,n=a.theme,s=a.open,i=a.showArchive,r=a.archiveTitle,o=a.items,l=a.cacheItems,c=this.state,h=c.chats;c.chatList;return e.theme!==n||(e.open!==s||(e.items!==o||(e.cacheItems!==l||(e.showArchive!==i||(e.archiveTitle!==r||t.chats!==h)))))}getSnapshotBeforeUpdate(e,t){var a=this.listRef.current;return a?{scrollTop:a.scrollTop}:{scrollTop:0}}componentDidUpdate(e,t,a){}componentDidMount(){this.loadFirstSlice(),na.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),Z.a.on("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.on("clientUpdateLeaveChat",this.onClientUpdateLeaveChat),Z.a.on("updateChatDraftMessage",this.onUpdateChatOrder),Z.a.on("updateChatLastMessage",this.onUpdateChatOrder),Z.a.on("updateChatPosition",this.onUpdateChatPosition),ma.on("clientUpdateChatList",this.onClientUpdateChatList),Oe.a.on("updateSupegroup",this.onUpdateSupergroup)}componentWillUnmount(){na.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),Z.a.off("clientUpdateFastUpdatingComplete",this.onFastUpdatingComplete),Z.a.off("clientUpdateLeaveChat",this.onClientUpdateLeaveChat),Z.a.off("updateChatDraftMessage",this.onUpdateChatOrder),Z.a.off("updateChatLastMessage",this.onUpdateChatOrder),Z.a.off("updateChatPosition",this.onUpdateChatPosition),ma.off("clientUpdateChatList",this.onClientUpdateChatList),Oe.a.off("updateSupegroup",this.onUpdateSupergroup)}reorderChats(e,t=[],a){var n=this.state.chatList,s=e.concat(t).sort((e,t)=>Object(M.A)(Object(V.q)(t,n),Object(V.q)(e,n)));pn.isDifferentOrder(this.state.chats,s)?this.setState({chats:s},a):a&&a()}static isDifferentOrder(e,t){if(e.length===t.length){for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!0;return!1}return!0}onLoadPrev(){}onLoadNext(e=!1,t=u.f){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l,c,h,d,p;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.props.type,i=a.state,r=i.chats,o=i.chatList,!(l=i.params).loading){n.next=4;break}return n.abrupt("return");case 4:if(!l.completed){n.next=6;break}return n.abrupt("return");case 6:return c="9223372036854775807",h=0,!e&&r&&r.length>0&&(d=Z.a.get(r[r.length-1]))&&(c=Object(V.q)(d.id,o),h=d.id),l.loading=!0,n.next=12,x.a.send({"@type":"getChats",chat_list:o,offset_chat_id:h,offset_order:c,limit:u.f}).finally(()=>{l.loading=!1,e&&x.a.clientUpdate({"@type":"clientUpdateDialogsReady",list:o})});case 12:if(p=n.sent,l===a.state.params){n.next=15;break}return n.abrupt("return");case 15:p.chat_ids.length>0&&p.chat_ids[0]===h&&p.chat_ids.shift(),l.completed=!p.chat_ids.length,e?a.replaceChats(p.chat_ids,()=>{a.loadChatContents(p.chat_ids),a.saveCache(),p.chat_ids.length<u.f&&a.onLoadNext(!1,u.f-p.chat_ids.length);var e=a.listRef.current.getListRef().current;e&&(e.scrollTop=0)}):a.appendChats(p.chat_ids,()=>{a.loadChatContents(p.chat_ids),p.chat_ids.length&&p.chat_ids.length<t&&a.onLoadNext(!1,t-p.chat_ids.length)});case 18:case"end":return n.stop()}}),n)})))()}loadChatContents(e){var t=U.a.getStore();Object(G.x)(t,e)}appendChats(e,t){if(0!==e.length){var a=(this.state.chats||[]).concat(e);this.setState({chats:a},t)}else t&&t()}replaceChats(e,t){this.setState({chats:e},t)}scrollToTop(){Ga(this.listRef.current.getListRef().current)}render(){var e=this.props,t=e.open,a=e.cacheItems,n=(e.showArchive,e.archiveTitle,this.state),s=n.chats,i=n.chatList;if(!t)return null;this.source=[];if(s){s.forEach(e=>{Object(V.V)(e,i)&&e}),this.source=s}else if(a){a.forEach(e=>{Object(V.V)(e,i)&&e}),this.source=a.map(e=>e.id)}else"chatListMain"===i["@type"]&&Array.from(Array(10)).map((e,t)=>o.a.createElement(Fa,{key:t,index:t}));return o.a.createElement(Ha,{ref:this.listRef,className:"dialogs-list",source:this.source,rowHeight:76,overScanCount:20,renderItem:e=>this.renderItem(e,this.source),onScroll:this.handleScroll})}}var un=pn;class mn extends o.a.Component{render(){var e=this.props,t=e.t,a=e.innerListRef,n=e.items,s=e.cacheItems,i=e.onClose;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button main-menu-button",onClick:i},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("ArchivedChats")))),o.a.createElement("div",{className:"dialogs-content"},o.a.createElement(un,{type:"chatListArchive",ref:a,cacheItems:s,open:!0,items:n})))}}var fn=Object(_.a)()(mn);a(514);class gn extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,top:0,left:0},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleDelete=e=>{this.handleCloseContextMenu(),(0,this.props.onDelete)()}}render(){var e=this.props,t=e.chatId,a=e.onSelect,n=e.showSavedMessages,s=e.t,i=this.state,r=i.contextMenu,l=i.top,c=i.left,h=Object(V.s)(t,n,s);return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{button:!0,className:"top-chat",onClick:a,onContextMenu:this.handleContextMenu},o.a.createElement(K,{dialog:!0,chatId:t,showSavedMessages:n,showOnline:!0}),o.a.createElement("div",{className:"top-chat-title"},h)),o.a.createElement(Je.a,{open:r,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:l,left:c},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:s("Delete")})))))}}gn.defaultProps={showSavedMessages:!0};var Cn=Object(_.a)()(gn);a(515);class vn extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1,top:0,left:0},this.handleContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(n=a.clientX,i=a.clientY,t.setState({contextMenu:!0,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.handleDelete=e=>{this.handleCloseContextMenu(),(0,this.props.onDelete)()}}render(){var e=this.props,t=e.t,a=e.chatId,n=e.onClick,s=this.state,i=s.contextMenu,r=s.top,l=s.left;return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{button:!0,className:"recently-found-chat",onClick:n,onContextMenu:this.handleContextMenu},o.a.createElement(Pe,{chatId:a})),o.a.createElement(Je.a,{open:i,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:r,left:l},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:t("Delete")})))))}}var bn=Object(_.a)()(vn);a(516);class En extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatId=e=>{var t=e.nextChatId,a=e.previousChatId;this.setState({nextChatId:t,previousChatId:a})},this.state={nextChatId:na.a.getChatId(),previousChatId:null}}shouldComponentUpdate(e,t){var a=this.props.chatId;return t.nextChatId===a||t.previousChatId===a}componentDidMount(){na.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){var e=this.props,t=e.chatId,a=e.onClick,n=this.state.nextChatId,s=Object(V.A)(t);return o.a.createElement(be.a,{button:!0,className:c()("found-public-chat",{"item-selected":t===n}),onClick:a},o.a.createElement("div",{className:"found-public-chat-wrapper"},o.a.createElement(Pe,{chatId:t,subtitle:s?"@"+s:null})))}}var Sn=En,yn=a(95);a(517);class Mn extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatId=e=>{this.setState(Object(Ze.a)({},e))},this.state={nextChatId:na.a.getChatId(),nextMessageId:na.a.getMessageId()}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId;return t.nextChatId===n&&t.nextMessageId===s||t.previousChatId===n&&t.previousMessageId===s}componentDidMount(){na.a.on("clientUpdateChatId",this.onClientUpdateChatId)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.chatSearch,s=e.onClick,i=e.t,r=this.state.nextChatId,l=this.state.nextMessageId,h=le.a.get(t,a),d=h.sender_user_id,p=Object(V.G)(h),u=Object(V.I)(h,i),m=Object(V.H)(h,i),f=Object(it.i)(h,i)||"\xa0",g=t===r&&a===l,C=d&&n?o.a.createElement(yn.a,{userId:d,dialog:!0}):o.a.createElement(K,{chatId:t,dialog:!0});return o.a.createElement(be.a,{button:!0,className:c()("found-message",{"item-selected":g}),onClick:s},o.a.createElement("div",{className:"dialog-wrapper"},C,o.a.createElement("div",{className:"dialog-inner-wrapper"},o.a.createElement("div",{className:"tile-first-row"},n&&m?o.a.createElement("div",{className:"dialog-title"},m):o.a.createElement(xe,{chatId:t}),o.a.createElement("div",{className:"dialog-meta"},p)),o.a.createElement("div",{className:"tile-second-row"},o.a.createElement("div",{className:"dialog-content"},o.a.createElement(o.a.Fragment,null,!n&&u&&o.a.createElement("span",{className:"dialog-content-accent"},u,": "),f))))))}}var In=Object(_.a)()(Mn);a(518);var Un=function({command:e,multiline:t,onClick:a,children:n}){return o.a.createElement("div",{className:"section-header"},o.a.createElement("div",{className:c()("section-header-title",{"section-header-title-multiline":t})},n),Boolean(e)&&o.a.createElement("a",{onClick:a},e))};a(519);class kn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleKeyDown=e=>{if(!(oe.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation(),e.target.blur(),this.handleClose()}},this.concatSearchResults=e=>{for(var t=[],a=new Map,n=0;n<e.length;n++){var s=e[n]&&e[n].chat_ids;if(s)for(var i=0;i<s.length;i++)a.has(s[i])||(a.set(s[i],s[i]),t.push(s[i]))}return t.sort((e,t)=>Object(M.A)(Object(V.q)(t),Object(V.q)(e))),t},this.searchText=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,h,d,p,m,f,g,C,v,b,E,S,y,M,I,k,w,O,L,_,N,P,j,D,R,T;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.sessionId=new Date,t.text=a,n=t.sessionId,i=null,r=t.props.chatId,o=t.state.savedMessages,r){e.next=43;break}return l=[],c=x.a.send({"@type":"searchChats",query:a,limit:100}),l.push(c),(h=ie(a))&&h!==a&&(d=x.a.send({"@type":"searchChats",query:h,limit:100}),l.push(d)),(p=ne(a))&&p!==a&&(m=x.a.send({"@type":"searchChats",query:p,limit:100}),l.push(m)),e.next=16,Promise.all(l.map(e=>e.catch(e=>null)));case 16:if(f=e.sent,g=t.concatSearchResults(f),n===t.sessionId){e.next=20;break}return e.abrupt("return");case 20:if(o&&(C=t.props.t,v=a.toUpperCase(),((b=["SAVED MESSAGES",C("SavedMessages").toUpperCase()]).some(e=>e.includes(v))||h&&b.some(e=>e.includes(h.toUpperCase())))&&g.splice(0,0,o.id)),t.setState({top:null,recentlyFound:null,local:g}),i=U.a.getStore(),Object(G.x)(i,g),!((E=(E=a.trim()).startsWith("@")?E.substr(1):E).length>=u.Jb)){e.next=42;break}return S=[],y=x.a.send({"@type":"searchPublicChats",query:E}),S.push(y),h&&(M=(M=h.trim()).startsWith("@")?M.substr(1):M).length>=u.Jb&&M!==E&&(I=x.a.send({"@type":"searchPublicChats",query:M}),S.push(I)),e.next=33,Promise.all(S.map(e=>e.catch(e=>null)));case 33:if(k=e.sent,w=t.concatSearchResults(k),n===t.sessionId){e.next=37;break}return e.abrupt("return");case 37:t.setState({global:w}),i=U.a.getStore(),Object(G.x)(i,w),e.next=43;break;case 42:t.setState({global:null});case 43:if(O=[],!r){e.next=50;break}return e.next=47,x.a.send({"@type":"searchChatMessages",chat_id:r,query:a,sender_user_id:0,from_message_id:0,offset:0,limit:50,filter:null});case 47:O=e.sent,e.next=53;break;case 50:return e.next=52,x.a.send({"@type":"searchMessages",chat_list:{"@type":"chatListMain"},query:a,offset_date:0,offset_chat_id:0,offset_message_id:0,limit:50});case 52:O=e.sent;case 53:if(le.a.setItems(O.messages),L=null,r){e.next=67;break}return e.prev=56,e.next=59,x.a.send({"@type":"getMessageLinkInfo",url:a});case 59:_=e.sent,le.a.setItems([_.message]),L=_,e.next=67;break;case 64:e.prev=64,e.t0=e.catch(56),console.log("[se] searchText="+a+" messageLinkInfo error",e.t0);case 67:if(n===t.sessionId){e.next=69;break}return e.abrupt("return");case 69:for(t.setState({messages:O,linkMessage:L}),N=new Map,P=new Map,j=0;j<O.messages.length;j++)N.set(O.messages[j].chat_id,O.messages[j].chat_id),O.messages[j].sender_user_id&&P.set(O.messages[j].sender_user_id,O.messages[j].sender_user_id);L&&(R=(D=L).chat_id,T=D.sender_user_id,N.set(R,R),T&&P.set(T,T)),i=U.a.getStore(),Object(G.x)(i,[...N.keys()]),Object(G.J)(i,[...P.keys()]);case 77:case"end":return e.stop()}}),e,null,[[56,64]])})));return function(t){return e.apply(this,arguments)}}(),this.loadContent=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.props.chatId){e.next=4;break}return t.setState({top:null,recentlyFound:null,local:null,global:null,messages:null,linkMessage:null}),e.abrupt("return");case 4:return a=x.a.send({"@type":"getTopChats",category:{"@type":"topChatCategoryUsers"},limit:30}).catch(()=>({"@type":"chats",chat_ids:[]})),n=x.a.send({"@type":"searchChats",query:"",limit:100}).catch(()=>({"@type":"chats",chat_ids:[]})),i=x.a.send({"@type":"createPrivateChat",user_id:H.a.getMyId(),force:!0}).catch(e=>{}),e.next=9,Promise.all([a,n,i]);case 9:r=e.sent,o=Object(L.a)(r,3),l=o[0],c=o[1],h=o[2],t.setState({top:l,recentlyFound:c,savedMessages:h,local:null,global:null,messages:null,linkMessage:null}),d=U.a.getStore(),Object(G.x)(d,l.chat_ids),Object(G.x)(d,c.chat_ids);case 18:case"end":return e.stop()}}),e)}))),this.handleClearRecentlyFound=e=>{e.stopPropagation(),x.a.send({"@type":"clearRecentlyFoundChats"}),this.setState({recentlyFound:null})},this.handleSelectMessage=(e,t,a,n)=>{var s=this.props.onSelectMessage;a&&x.a.send({"@type":"addRecentlyFoundChat",chat_id:e}),s(e,t,n)},this.handleScroll=()=>{var e=this.listRef.current;e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&this.onLoadPrevious()},this.getOffset=e=>{var t=e?e.messages.length:0;return{offset_date:t>0?e.messages[t-1].date:0,offset_chat_id:t>0?e.messages[t-1].chat_id:0,offset_message_id:t>0?e.messages[t-1].id:0}},this.concatMessages=(e,t)=>t&&t.messages.length?e&&e.messages.length?{total_count:t.total_count,messages:e.messages.concat(t.messages)}:t:e,this.onLoadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading){e.next=2;break}return e.abrupt("return");case 2:if(a=t.props.chatId,n=t.sessionId,i=t.state.messages,r=t.getOffset(i),t.loading=!0,o=[],!a){e.next=14;break}return e.next=11,x.a.send({"@type":"searchChatMessages",chat_id:a,query:t.text,sender_user_id:0,from_message_id:r.offset_message_id,limit:50,filter:null});case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,x.a.send(Object(Ze.a)(Object(Ze.a)({"@type":"searchMessages",chat_list:{"@type":"chatListMain"},query:t.text},r),{},{limit:50}));case 16:o=e.sent;case 17:if(t.loading=!1,Object(it.f)(o,i?i.messages:[]),le.a.setItems(o.messages),n===t.sessionId){e.next=22;break}return e.abrupt("return");case 22:for(t.setState({messages:t.concatMessages(i,o)}),l=new Map,c=new Map,h=0;h<o.messages.length;h++)l.set(o.messages[h].chat_id,o.messages[h].chat_id),o.messages[h].sender_user_id&&c.set(o.messages[h].sender_user_id,o.messages[h].sender_user_id);d=U.a.getStore(),Object(G.x)(d,[...l.keys()]),Object(G.J)(d,[...c.keys()]);case 29:case"end":return e.stop()}}),e)}))),this.handleTopChatsScroll=e=>{e.stopPropagation()},this.handleClose=()=>{(0,this.props.onClose)()},this.handleDeleteRecentlyFoundChat=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"removeRecentlyFoundChat",chat_id:a});case 4:if(n=t.state.recentlyFound){e.next=7;break}return e.abrupt("return");case 7:t.setState({recentlyFound:Object(Ze.a)(Object(Ze.a)({},n),{},{chat_ids:n.chat_ids.filter(e=>e!==a)})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleDeleteTopChat=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"removeTopChat",chat_id:a,category:{"@type":"topChatCategoryUsers"}});case 4:if(n=t.state.top){e.next=7;break}return e.abrupt("return");case 7:t.setState({top:Object(Ze.a)(Object(Ze.a)({},n),{},{chat_ids:n.chat_ids.filter(e=>e!==a)})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.keyboardHandler=new I.a(this.handleKeyDown),this.listRef=o.a.createRef(),this.state={}}componentDidMount(){var e=this.props.text;this.searchOrLoadContent(e),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}componentDidUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.text;(e.text!==i||e.chatId!==s)&&this.searchOrLoadContent(i)}searchOrLoadContent(e){var t=e?e.trim():"";t?this.searchText(t):this.loadContent()}render(){var e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.top,i=n.recentlyFound,r=n.local,l=n.global,c=n.messages,h=n.linkMessage,d=Z.a.get(t),p=s&&s.chat_ids?s.chat_ids.map(e=>o.a.createElement(Cn,{key:e,chatId:e,onSelect:()=>this.handleSelectMessage(e,null,!1,!1),onDelete:()=>this.handleDeleteTopChat(e)})):[],u=i&&i.chat_ids?i.chat_ids.map(e=>o.a.createElement(bn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!1),onDelete:()=>this.handleDeleteRecentlyFoundChat(e)})):[],m=r?r.map(e=>o.a.createElement(bn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!1)})):[],f=new Map,C=l?l.map(e=>(f.set(e,e),o.a.createElement(Sn,{key:e,chatId:e,onClick:()=>this.handleSelectMessage(e,null,!0,!0)}))):[],v=h&&h.chat_id&&!h.message&&!f.has(h.chat_id)?o.a.createElement(Sn,{key:h.chat_id,chatId:h.chat_id,onClick:()=>this.handleSelectMessage(h.chat_id,null,!0,!0)}):null,b=new Map,E=c&&c.messages?c.messages.map(e=>{var a="".concat(e.chat_id,"_").concat(e.id);return b.set(a,a),o.a.createElement(In,{key:a,chatId:e.chat_id,messageId:e.id,chatSearch:Boolean(t),onClick:()=>this.handleSelectMessage(e.chat_id,e.id,!1,!0)})}):[],S=h&&h.message&&!b.has("".concat(h.message.chat_id,"_").concat(h.message.id))?o.a.createElement(In,{key:"".concat(h.message.chat_id,"_").concat(h.message.id),chatId:h.message.chat_id,messageId:h.message.id,chatSearch:!1,onClick:()=>this.handleSelectMessage(h.message.chat_id,h.message.id,!1,!0)}):null,y=c?c.total_count:0;h&&h.message&&!b.has("".concat(h.message.chat_id,"_").concat(h.message.id))&&y++;var M=a("NoMessages");return y&&(M=1===y?"Found 1 message":"Found ".concat(y," messages")),o.a.createElement("div",{ref:this.listRef,className:"search",onScroll:this.handleScroll},d&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,a("SearchMessagesIn")),o.a.createElement("div",{className:"search-chat-wrapper"},o.a.createElement("div",{className:"search-chat-control"},o.a.createElement(Pe,{chatId:t,showStatus:!1})),o.a.createElement(P.a,{className:"header-right-button","aria-label":"Search",onMouseDown:this.handleClose},o.a.createElement(g.a,null)))),o.a.createElement("div",{className:"sidebar-page-section-divider"})),p.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,a("ChatHints")),o.a.createElement("div",{className:"search-top-chats-list",onScroll:this.handleTopChatsScroll},o.a.createElement("div",{className:"search-top-chats-placeholder"}),p,o.a.createElement("div",{className:"search-top-chats-placeholder"}))),o.a.createElement("div",{className:"sidebar-page-section-divider"})),u.length>0&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,{command:a("ClearButton"),onClick:this.handleClearRecentlyFound},a("Recent")),u),m.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,a("ChatsAndContacts")),m),o.a.createElement("div",{className:"sidebar-page-section-divider"})),C.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,a("GlobalSearch")),v,C),o.a.createElement("div",{className:"sidebar-page-section-divider"})),(c||h&&h.message)&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,M),S,E))}}var xn=Object(_.a)()(kn),wn=a(651);a(520);class On extends o.a.Component{constructor(e){super(e),this.handleKeyDown=e=>{if(!(oe.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":var t=this.props.onClose;t&&(e.preventDefault(),e.stopPropagation(),e.target.blur(),t())}},this.keyboardHandler=new I.a(this.handleKeyDown)}componentDidUpdate(e,t,a){var n=this.props.open;e.open!==n&&(n?I.b.add(this.keyboardHandler):I.b.remove(this.keyboardHandler))}render(){var e=this.props,t=e.children,a=e.open,n=e.timeout,s=e.onClose;return o.a.createElement(wn.a,{direction:"right",in:a,timeout:n,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement("div",{className:"sidebar-page"},s?o.a.cloneElement(t,{onClose:s}):t))}}var Ln=On,_n=Object(T.a)(o.a.createElement("path",{d:"M9.37867966,2 C9.97541676,2 10.5501571,2.2133476 11.0009229,2.59780217 L11.1464466,2.73223305 L13.267767,4.85355339 C13.3427815,4.92856794 13.4391777,4.97728504 13.542631,4.9937713 L13.6213203,5 L19,5 C21.1421954,5 22.8910789,6.68396847 22.9951047,8.80035966 L23,9 L23,18 C23,20.1421954 21.3160315,21.8910789 19.1996403,21.9951047 L19,22 L5,22 C2.85780461,22 1.10892112,20.3160315 1.00489531,18.1996403 L1,18 L1,6 C1,3.85780461 2.68396847,2.10892112 4.80035966,2.00489531 L5,2 L9.37867966,2 Z M9.37867966,4 L5,4 C3.9456382,4 3.08183488,4.81587779 3.00548574,5.85073766 L3,6 L3,18 C3,19.0543618 3.81587779,19.9181651 4.85073766,19.9945143 L5,20 L19,20 C20.0543618,20 20.9181651,19.1841222 20.9945143,18.1492623 L21,18 L21,9 C21,7.9456382 20.1841222,7.08183488 19.1492623,7.00548574 L19,7 L13.6213203,7 C13.0245832,7 12.4498429,6.7866524 11.9990771,6.40219783 L11.8535534,6.26776695 L9.73223305,4.14644661 C9.6572185,4.07143206 9.56082233,4.02271496 9.45736903,4.0062287 L9.37867966,4 Z M19,10 C19.5522847,10 20,10.4477153 20,11 C20,11.5128358 19.6139598,11.9355072 19.1166211,11.9932723 L19,12 L5,12 C4.44771525,12 4,11.5522847 4,11 C4,10.4871642 4.38604019,10.0644928 4.88337887,10.0067277 L5,10 L19,10 Z"}),"Folder"),Nn=Object(T.a)(o.a.createElement("path",{d:"M7.70710678,20.7071068 C7.5195704,20.8946432 7.26521649,21 7,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,17 C3,16.7347835 3.10535684,16.4804296 3.29289322,16.2928932 L16.5857864,3 C17.3257272,2.26005924 18.5012114,2.22111499 19.2869988,2.88316725 L19.4142136,3 L21,4.58578644 C21.7399408,5.3257272 21.778885,6.50121136 21.1168328,7.28699879 L21,7.41421356 L7.70710678,20.7071068 Z M5,17.4142136 L5,19 L6.58578644,19 L16.5857864,9 L15,7.41421356 L5,17.4142136 Z M18,4.41421356 L16.414,5.99921356 L18,7.58521356 L19.5857864,6 L18,4.41421356 Z"}),"Edit"),Pn=Object(T.a)(o.a.createElement("path",{d:"M11,2 C13.209139,2 15,3.790861 15,6 C15,6.55228475 14.5522847,7 14,7 C13.4477153,7 13,6.55228475 13,6 L13,6 L12.9945143,5.85073766 C12.9181651,4.81587779 12.0543618,4 11,4 L11,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L6,20 L11,20 C12.1045695,20 13,19.1045695 13,18 L13,18 L13.0067277,17.8833789 C13.0644928,17.3860402 13.4871642,17 14,17 C14.5522847,17 15,17.4477153 15,18 C15,20.209139 13.209139,22 11,22 L11,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,18 L2,6 C2,3.790861 3.790861,2 6,2 L6,2 Z M18.7071068,7.29289322 L22.7071068,11.2928932 C22.7355731,11.3213595 22.7623312,11.3515341 22.787214,11.3832499 L22.7071068,11.2928932 C22.7425008,11.3282873 22.774687,11.3656744 22.8036654,11.4046934 C22.8215099,11.4288693 22.8382813,11.453725 22.8539326,11.4793398 C22.8613931,11.4913869 22.8685012,11.5036056 22.8753288,11.5159379 C22.8862061,11.5357061 22.8966234,11.5561086 22.9063462,11.5769009 C22.914321,11.5939015 22.9218036,11.6112044 22.9287745,11.628664 C22.9366843,11.6484208 22.9438775,11.6682023 22.9504533,11.6882636 C22.9552713,11.7031487 22.9599023,11.7185367 22.9641549,11.734007 C22.9701664,11.7555635 22.9753602,11.7772539 22.9798348,11.7992059 C22.9832978,11.8166247 22.9863719,11.834051 22.9889822,11.8515331 C22.9962388,11.8996379 23,11.9493797 23,12 L22.9962979,11.9137692 C22.9978436,11.9317345 22.9989053,11.9497336 22.9994829,11.9677454 L23,12 C23,12.0112225 22.9998151,12.0224019 22.9994483,12.0335352 C22.9988772,12.050591 22.997855,12.0679231 22.996384,12.0852242 C22.994564,12.1070574 22.9920941,12.1281144 22.9889807,12.1489612 C22.9863719,12.165949 22.9832978,12.1833753 22.9797599,12.2007258 C22.9753602,12.2227461 22.9701664,12.2444365 22.964279,12.2658396 C22.9599023,12.2814633 22.9552713,12.2968513 22.9502619,12.3121425 C22.9438775,12.3317977 22.9366843,12.3515792 22.928896,12.3710585 C22.9218036,12.3887956 22.914321,12.4060985 22.9063266,12.4232215 C22.8966234,12.4438914 22.8862061,12.4642939 22.8751242,12.484277 C22.8685012,12.4963944 22.8613931,12.5086131 22.8540045,12.5207088 C22.8382813,12.546275 22.8215099,12.5711307 22.8036865,12.5951593 C22.7982466,12.602603 22.7927155,12.6098424 22.7870723,12.6170223 C22.7849289,12.6196628 22.7826279,12.6225624 22.7803112,12.625449 L22.7071068,12.7071068 L22.7071068,12.7071068 L18.7071068,16.7071068 C18.3165825,17.0976311 17.6834175,17.0976311 17.2928932,16.7071068 C16.9023689,16.3165825 16.9023689,15.6834175 17.2928932,15.2928932 L19.585,13 L13,13 C12.4871642,13 12.0644928,12.6139598 12.0067277,12.1166211 L12,12 C12,11.4477153 12.4477153,11 13,11 L13,11 L19.585,11 L17.2928932,8.70710678 C16.9023689,8.31658249 16.9023689,7.68341751 17.2928932,7.29289322 C17.6834175,6.90236893 18.3165825,6.90236893 18.7071068,7.29289322 Z"}),"LogOut"),jn=Object(T.a)(o.a.createElement("path",{d:"M12,16 C13.1045695,16 14,16.8954305 14,18 C14,19.1045695 13.1045695,20 12,20 C10.8954305,20 10,19.1045695 10,18 C10,16.8954305 10.8954305,16 12,16 Z M12,10 C13.1045695,10 14,10.8954305 14,12 C14,13.1045695 13.1045695,14 12,14 C10.8954305,14 10,13.1045695 10,12 C10,10.8954305 10.8954305,10 12,10 Z M12,4 C13.1045695,4 14,4.8954305 14,6 C14,7.1045695 13.1045695,8 12,8 C10.8954305,8 10,7.1045695 10,6 C10,4.8954305 10.8954305,4 12,4 Z"}),"More"),Dn=a(374),Rn=a(375);class Tn extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null,open:!1},this.handleMenuOpen=e=>{this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleLogOut=()=>{this.handleMenuClose(),this.setState({open:!0})},this.handleDone=()=>{this.handleClose(),x.a.logOut()},this.handleClose=()=>{this.setState({open:!1})}}render(){var e=this.props.t,t=this.state,a=t.anchorEl,n=t.open;return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{"aria-owns":a?"simple-menu":null,"aria-haspopup":"true",className:"header-right-button","aria-label":"Menu",onClick:this.handleMenuOpen},o.a.createElement(jn,null)),o.a.createElement(Za.a,{id:"main-menu",anchorEl:a,open:Boolean(a),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(Ke.a,{onClick:this.handleLogOut},o.a.createElement(Ee.a,null,o.a.createElement(Pn,null)),o.a.createElement(Se.a,{primary:e("LogOut")}))),o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:n,onClose:this.handleClose,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},e("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,{style:{whiteSpace:"pre-wrap"}},e("AreYouSureLogout"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleClose,color:"primary"},e("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},e("Ok")))))}}var Fn=Object(_.a)()(Tn),An=Object(T.a)(o.a.createElement("path",{d:"M12,1 C14.6887547,1 16.8818181,3.12230671 16.9953805,5.78311038 L17,6 L17,8 C18.6568542,8 20,9.34314575 20,11 L20,19 C20,20.6568542 18.6568542,22 17,22 L7,22 C5.34314575,22 4,20.6568542 4,19 L4,11 C4,9.34314575 5.34314575,8 7,8 L7,6 C7,3.23857625 9.23857625,1 12,1 Z M17,10 L7,10 C6.44771525,10 6,10.4477153 6,11 L6,19 C6,19.5522847 6.44771525,20 7,20 L17,20 C17.5522847,20 18,19.5522847 18,19 L18,11 C18,10.4477153 17.5522847,10 17,10 Z M12,13.5 C12.8284271,13.5 13.5,14.1715729 13.5,15 C13.5,15.8284271 12.8284271,16.5 12,16.5 C11.1715729,16.5 10.5,15.8284271 10.5,15 C10.5,14.1715729 11.1715729,13.5 12,13.5 Z M12.1762728,3.00509269 L12,3 C10.4023191,3 9.09633912,4.24891996 9.00509269,5.82372721 L9,6 L9,8 L15,8 L15,6 C15,4.40231912 13.75108,3.09633912 12.1762728,3.00509269 L12,3 L12.1762728,3.00509269 Z"}),"Data"),Bn=Object(T.a)(o.a.createElement("path",{d:"M12.4100787,14.6155108 L10.33,12.56 L10.33,12.56 L10.36,12.53 C12.1,10.59 13.34,8.36 14.07,6 L16,6 C16.5522847,6 17,5.55228475 17,5 C17,4.44771525 16.5522847,4 16,4 L10,4 L10,4 L10,3 C10,2.44771525 9.55228475,2 9,2 C8.44771525,2 8,2.44771525 8,3 L8,4 L8,4 L1.995,4 C1.44547667,4 1,4.44547667 1,4.995 C1,5.54452333 1.44547667,5.99 1.995,5.99 L12.17,5.99 L12.17,5.99 C11.5,7.92 10.44,9.75 9,11.35 C8.29025814,10.5639418 7.67370319,9.7196418 7.15033516,8.83487918 C7.09974701,8.74935905 7.03930045,8.64304956 6.96899548,8.51595071 C6.79288115,8.1975972 6.45776707,8 6.09394677,8 L5.69,8 C5.34408921,8 5.06367311,8.2804161 5.06367311,8.62632689 C5.06367311,8.72554854 5.08724633,8.82335055 5.13246346,8.91167013 C5.1653189,8.97586688 5.19575217,9.03408878 5.22376326,9.08633583 C5.88285067,10.3156835 6.70136504,11.4828779 7.67,12.56 L3.29489879,16.8749328 C2.90279535,17.2616439 2.89842396,17.8929978 3.28513501,18.2851012 C3.28675102,18.2867397 3.28837269,18.2883727 3.29,18.29 L3.29289322,18.2928932 C3.68341751,18.6834175 4.31658249,18.6834175 4.70710678,18.2928932 L9,14 L9,14 L11.3403247,16.3403247 C11.6133932,16.6133932 12.0561246,16.6133932 12.3291931,16.3403247 C12.4001325,16.2693853 12.4549762,16.1840114 12.49,16.09 L12.6442671,15.6759147 C12.7816472,15.3071575 12.6899849,14.8921111 12.4100787,14.6155108 Z M17.8069995,10 L17.1930005,10 C16.7761559,10 16.4030352,10.2585728 16.2566713,10.6488766 L12.3511234,21.0636708 C12.2167367,21.4220355 12.3983067,21.8214894 12.7566713,21.9558761 C12.8344793,21.9850541 12.916901,22 13,22 L13.3059169,22 C13.7232965,22 14.0967782,21.7407727 14.2427584,21.3497542 L15.12,19 L15.12,19 L19.87,19 L20.7561047,21.3524905 C20.9028501,21.74208 21.2756099,22 21.6919201,22 L22,22 C22.3827336,22 22.6930005,21.6897331 22.6930005,21.3069995 C22.6930005,21.2239005 22.6780546,21.1414789 22.6488766,21.0636708 L18.7433287,10.6488766 C18.5969648,10.2585728 18.2238441,10 17.8069995,10 Z M17.5,12.67 L19.12,17 L15.88,17 L17.5,12.67 Z"}),"Language"),Vn=a(103);a(521);class Hn extends o.a.Component{constructor(...e){super(...e),this.handleOpenViewer=()=>{var e=this.props.chatId,t=Z.a.get(e);t&&t.photo&&Object(re.r)({chatId:e})}}render(){var e=this.props,t=e.chatId,a=e.popup,n=e.t,s=e.onClose,i=e.onEditProfile,r=e.onGeneral,l=e.onNotifications,c=e.onPrivacySecurity,h=e.onLanguage,d=e.onFilters,p=Z.a.get(t);if(!p)return null;var u=p.photo;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:s},a?o.a.createElement(g.a,null):o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},n("Settings"))),o.a.createElement(Fn,null)),o.a.createElement("div",{className:"sidebar-page-content settings-main-content"},o.a.createElement("div",{className:"chat-details-info"},o.a.createElement(Pe,{chatId:t,big:!0,showStatus:!0,showSavedMessages:!1,onTileSelect:u?this.handleOpenViewer:null})),o.a.createElement(be.a,{className:"settings-list-item",button:!0,onClick:i},o.a.createElement(Ee.a,null,o.a.createElement(Nn,null)),o.a.createElement(Se.a,{primary:n("EditProfile")})),o.a.createElement(be.a,{className:"settings-list-item",button:!0,onClick:r},o.a.createElement(Ee.a,null,o.a.createElement(Ya,null)),o.a.createElement(Se.a,{primary:n("GeneralSettings")})),o.a.createElement(be.a,{className:"settings-list-item",button:!0,onClick:l},o.a.createElement(Ee.a,null,o.a.createElement(La,null)),o.a.createElement(Se.a,{primary:n("Notifications")})),o.a.createElement(be.a,{className:"settings-list-item",button:!0,onClick:c},o.a.createElement(Ee.a,null,o.a.createElement(An,null)),o.a.createElement(Se.a,{primary:n("PrivacySettings")})),o.a.createElement(be.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:d},o.a.createElement(Ee.a,null,o.a.createElement(_n,null)),o.a.createElement(Se.a,{primary:n("Filters")})),o.a.createElement(be.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:h},o.a.createElement(Ee.a,null,o.a.createElement(Bn,null)),o.a.createElement(Se.a,{primary:n("Language")})),o.a.createElement("div",{className:"settings-main-footer"},Vn.version)))}}var zn=Object(_.a)()(Hn),Wn=a(424),Gn=a(448),Zn=a(522),qn=a.n(Zn),Kn=Object(T.a)(o.a.createElement("path",{d:"M19.8833789,16.0067277 L20,16 C20.5128358,16 20.9355072,16.3860402 20.9932723,16.8833789 L21,17 L21,19 L23,19 C23.5128358,19 23.9355072,19.3860402 23.9932723,19.8833789 L24,20 C24,20.5128358 23.6139598,20.9355072 23.1166211,20.9932723 L23,21 L21,21 L21,23 C21,23.5128358 20.6139598,23.9355072 20.1166211,23.9932723 L20,24 C19.4871642,24 19.0644928,23.6139598 19.0067277,23.1166211 L19,23 L19,21 L17,21 C16.4871642,21 16.0644928,20.6139598 16.0067277,20.1166211 L16,20 C16,19.4871642 16.3860402,19.0644928 16.8833789,19.0067277 L17,19 L19,19 L19,17 C19,16.4871642 19.3860402,16.0644928 19.8833789,16.0067277 L20,16 L19.8833789,16.0067277 Z M8.41421356,2 L13.5857864,2 C14.0572824,2 14.5116128,2.16648982 14.8701798,2.46691315 L15,2.58578644 L16.4142136,4 L18,4 C19.5976809,4 20.9036609,5.24891996 20.9949073,6.82372721 L21,7 L21,12 C21,12.5522847 20.5522847,13 20,13 C19.4871642,13 19.0644928,12.6139598 19.0067277,12.1166211 L19,12 L19,7 C19,6.48716416 18.6139598,6.06449284 18.1166211,6.00672773 L18,6 L16.4142136,6 C15.9427176,6 15.4883872,5.83351018 15.1298202,5.53308685 L15,5.41421356 L13.5857864,4 L8.41421356,4 L7,5.41421356 C6.66660199,5.74761157 6.22761579,5.95114561 5.76163928,5.99225938 L5.58578644,6 L4,6 C3.48716416,6 3.06449284,6.38604019 3.00672773,6.88337887 L3,7 L3,18 C3,18.5128358 3.38604019,18.9355072 3.88337887,18.9932723 L4,19 L13,19 C13.5522847,19 14,19.4477153 14,20 C14,20.5128358 13.6139598,20.9355072 13.1166211,20.9932723 L13,21 L4,21 C2.40231912,21 1.09633912,19.75108 1.00509269,18.1762728 L1,18 L1,7 C1,5.40231912 2.24891996,4.09633912 3.82372721,4.00509269 L4,4 L5.58578644,4 L7,2.58578644 C7.33339801,2.25238843 7.77238421,2.04885439 8.23836072,2.00774062 L8.41421356,2 L13.5857864,2 L8.41421356,2 Z M11,7 C13.7614237,7 16,9.23857625 16,12 C16,14.7614237 13.7614237,17 11,17 C8.23857625,17 6,14.7614237 6,12 C6,9.23857625 8.23857625,7 11,7 Z M11,9 C9.34314575,9 8,10.3431458 8,12 C8,13.6568542 9.34314575,15 11,15 C12.6568542,15 14,13.6568542 14,12 C14,10.3431458 12.6568542,9 11,9 Z"}),"AddImage"),Jn=a(208);a(524),a(525);class Yn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleCancel=()=>{this.setState({open:!1})},this.handleDone=()=>{var e=this.cropperRef.current;e&&(e.getCroppedCanvas().toBlob(e=>{var t=URL.createObjectURL(e);this.setState({blob:e,blobURL:t});var a=this.props.onChoose;a&&a(e,t)},"image/jpeg"),this.handleCancel())},this.handleAttach=()=>{this.attachPhotoRef.current.click()},this.handleAttachComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachPhotoRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=14;break}if(n=Array.from(a),i=Object(Gn.a)(n),r=i[0],i.slice(1),r){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,Object(M.B)(r);case 9:o=e.sent,l=Object(L.a)(o,2),c=l[0],h=l[1],t.setState({open:!0,file:r,fileURL:URL.createObjectURL(r),width:c,height:h});case 14:t.attachPhotoRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.attachPhotoRef=o.a.createRef(),this.cropperRef=o.a.createRef();var a=this.props.defaultURL;this.state={blobURL:a,open:!1}}render(){var e=this.props.t,t=this.state,a=t.open,n=t.width,s=t.height,i=t.fileURL,r=t.blobURL,l=Object(M.j)({width:n,height:s},400,!0),c=l.width,h=l.height;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"new-chat-photo"},r?o.a.createElement("img",{className:"new-chat-photo-image-button",alt:"",src:r,onClick:this.handleAttach}):o.a.createElement("div",{className:"new-chat-photo-image-button new-chat-photo-button",onClick:this.handleAttach},o.a.createElement(Kn,{className:"new-chat-photo-icon"}))),o.a.createElement("input",{ref:this.attachPhotoRef,className:"inputbox-attach-button",type:"file",multiple:!1,accept:"image/*",onChange:this.handleAttachComplete}),a&&o.a.createElement(j.a,{transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"dialog-title"},o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:this.handleCancel},o.a.createElement(g.a,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},e("DragToReposition")))),o.a.createElement(Dn.a,null,o.a.createElement(qn.a,{ref:this.cropperRef,src:i,style:{height:h,width:c,margin:"0 46px 62px"},aspectRatio:1,viewMode:3,guides:!1})),o.a.createElement("div",{className:"new-chat-photo-done-button ",onClick:this.handleDone},o.a.createElement(Jn.a,null))))}}var Xn=Object(_.a)()(Yn);a(526);class Qn extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleUsernameChange=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.username,(i=t.usernameRef.current.value).startsWith("@")&&i.length>1&&(i=i.substr(1)),n!==i&&""!==i){e.next=8;break}t.setState({usernameCheck:null}),e.next=14;break;case 8:return e.next=10,x.a.send({"@type":"checkChatUsername",chat_id:a,username:i});case 10:r=e.sent,(o=t.usernameRef.current.value).startsWith("@")&&o.length>1&&(o=o.substr(1)),o===i&&t.setState({usernameCheck:r});case 14:case"end":return e.stop()}}),e)}))),this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props.chatId,e.next=3,x.a.send({"@type":"setProfilePhoto",photo:{"@type":"inputFileBlob",name:"profile_photo.jpg",data:a}});case 3:i=U.a.getStore(),Object(G.w)(i,n,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.firstNameRef=o.a.createRef(),this.lastNameRef=o.a.createRef(),this.bioRef=o.a.createRef(),this.usernameRef=o.a.createRef();var a=H.a.get(H.a.getMyId()),n=H.a.getFullInfo(H.a.getMyId());this.state={firstName:a?a.first_name:"",lastName:a?a.last_name:"",bio:n?n.bio:"",username:a?a.username:"",usernameCheck:null}}componentWillUnmount(){this.setName(),this.setBio(),this.setUsername()}setUsername(){var e=this.state,t=e.username,a=e.usernameCheck,n=this.usernameRef.current.value;n.startsWith("@")&&n.length>1&&(n=n.substr(1)),t!==n&&a&&"checkChatUsernameResultOk"===a["@type"]&&x.a.send({"@type":"setUsername",username:n})}setName(){var e=this.state,t=e.firstName,a=e.lastName,n=this.firstNameRef.current.value,s=this.lastNameRef.current.value;n===t&&s===a||x.a.send({"@type":"setName",first_name:n,last_name:s})}setBio(){var e=this.state.bio,t=this.bioRef.current.value;t!==e&&x.a.send({"@type":"setBio",bio:t})}render(){var e=this.props,t=e.chatId,a=e.t,n=e.onClose,s=this.state,i=s.firstName,r=s.lastName,l=s.bio,c=s.username,h=s.usernameCheck,d=!1,p=a("Username");if(h)switch(h["@type"]){case"checkChatUsernameResultOk":d=!1,p="Username is available";break;case"checkChatUsernameResultPublicChatsTooMuch":case"checkChatUsernameResultPublicGroupsUnavailable":case"checkChatUsernameResultUsernameInvalid":d=!0,p="Invalid username";break;case"checkChatUsernameResultUsernameOccupied":d=!0,p="Username is already taken"}var u=Z.a.get(t);if(!u)return null;var m=u.photo,f=Object(G.m)(m?m.small:null),g=[],C=Object(it.x)(a("UsernameHelp"),g),v=Object(it.n)({"@type":"formattedText",text:C,entities:g});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:n},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("EditProfile")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement(Xn,{defaultURL:f,onChoose:this.handleChoosePhoto}),o.a.createElement("div",{className:"edit-profile-name"},o.a.createElement(Wn.a,{inputRef:this.firstNameRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("FirstName"),defaultValue:i}),o.a.createElement(Wn.a,{inputRef:this.lastNameRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("LastName"),defaultValue:r}),o.a.createElement(Wn.a,{inputRef:this.bioRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:a("Bio"),defaultValue:l}),o.a.createElement("div",{className:"edit-profile-hint"},a("BioAbout"))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"edit-profile-username"},o.a.createElement(Wn.a,{inputRef:this.usernameRef,error:d,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:p,defaultValue:c,onChange:this.handleUsernameChange}),o.a.createElement("div",{className:"edit-profile-hint"},v))))}}var $n=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(Qn),es=Object(T.a)(o.a.createElement("path",{fill:"currentColor",fillRule:"nonzero",d:"M11.8833789,4.00672773 L12,4 C12.5128358,4 12.9355072,4.38604019 12.9932723,4.88337887 L13,5 L13,11 L19,11 C19.5128358,11 19.9355072,11.3860402 19.9932723,11.8833789 L20,12 C20,12.5128358 19.6139598,12.9355072 19.1166211,12.9932723 L19,13 L13,13 L13,19 C13,19.5128358 12.6139598,19.9355072 12.1166211,19.9932723 L12,20 C11.4871642,20 11.0644928,19.6139598 11.0067277,19.1166211 L11,19 L11,13 L5,13 C4.48716416,13 4.06449284,12.6139598 4.00672773,12.1166211 L4,12 C4,11.4871642 4.38604019,11.0644928 4.88337887,11.0067277 L5,11 L11,11 L11,5 C11,4.48716416 11.3860402,4.06449284 11.8833789,4.00672773 L12,4 L11.8833789,4.00672773 Z"}),"Add"),ts=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M18,18 C23.8608627,18 28.072977,19.5546034 30.5027576,22.7682432 C31.1498637,23.6240893 31.5,24.6677318 31.5,25.7406839 L31.5,27.4285714 C31.5,29.6771593 29.6771593,31.5 27.4285714,31.5 L8.57142857,31.5 C6.32284066,31.5 4.5,29.6771593 4.5,27.4285714 L4.5,25.740741 C4.5,24.6677985 4.85010028,23.6241745 5.49717185,22.7683365 C7.92695186,19.5546298 12.1390883,18 18,18 Z M18,21 C12.9925527,21 9.66714119,22.2273543 7.89018414,24.5776159 C7.63699525,24.9124919 7.5,25.3208649 7.5,25.740741 L7.5,27.4285714 C7.5,28.0203051 7.97969491,28.5 8.57142857,28.5 L27.4285714,28.5 C28.0203051,28.5 28.5,28.0203051 28.5,27.4285714 L28.5,25.7406839 C28.5,25.3208358 28.3629925,24.9124609 28.1097736,24.5775601 C26.3328071,22.2273354 23.0074077,21 18,21 Z M18,3 C21.3137085,3 24,5.6862915 24,9 C24,12.3137085 21.3137085,15 18,15 C14.6862915,15 12,12.3137085 12,9 C12,5.6862915 14.6862915,3 18,3 Z M18,6 C16.3431458,6 15,7.34314575 15,9 C15,10.6568542 16.3431458,12 18,12 C19.6568542,12 21,10.6568542 21,9 C21,7.34314575 19.6568542,6 18,6 Z"}),"NewPrivate"),as=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M9,13 C12.3229116,13 14.7530244,13.8337117 16.2223821,15.5699359 C16.6742675,16.1038947 16.9426297,16.7664653 16.9917833,17.4602417 L17,17.6925226 L17,18.5 C17,19.8254834 15.9684641,20.9100387 14.6643757,20.9946823 L14.5,21 L3.5,21 C2.1745166,21 1.08996133,19.9684641 1.00531768,18.6643757 L1,18.5 L1,17.6925204 C1,16.9152876 1.2755246,16.1632192 1.77762117,15.569932 C3.24697824,13.8337108 5.67709024,13 9,13 Z M9,15 C6.21130036,15 4.33538166,15.6435809 3.30428673,16.861943 C3.14055953,17.0554062 3.03840077,17.2920167 3.00889582,17.5415166 L3,17.6925212 L3,18.5 C3,18.7454599 3.17687516,18.9496084 3.41012437,18.9919443 L3.5,19 L14.5,19 C14.7454599,19 14.9496084,18.8231248 14.9919443,18.5898756 L15,18.5 L15,17.6925226 C15,17.3883883 14.8921864,17.0941004 14.6957148,16.8619448 C13.6646202,15.6435815 11.788701,15 9,15 Z M19,14 C19.5522847,14 20,14.4477153 20,15 C20,15.5522847 19.5522847,16 19,16 C18.4477153,16 18,15.5522847 18,15 C18,14.4477153 18.4477153,14 19,14 Z M19,3 C21.209139,3 23,4.790861 23,7 C23,8.80747736 21.8011592,10.3349504 20.1552529,10.8306439 L20,10.873 L20,11.5 C20,12.0128358 19.6139598,12.4355072 19.1166211,12.4932723 L19,12.5 C18.4871642,12.5 18.0644928,12.1139598 18.0067277,11.6166211 L18,11.5 L18,10 C18,9.48716416 18.3860402,9.06449284 18.8833789,9.00672773 L19,9 C20.1045695,9 21,8.1045695 21,7 C21,5.8954305 20.1045695,5 19,5 C17.8954305,5 17,5.8954305 17,7 C17,7.55228475 16.5522847,8 16,8 C15.4477153,8 15,7.55228475 15,7 C15,4.790861 16.790861,3 19,3 Z M9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 Z M9,5 C7.8954305,5 7,5.8954305 7,7 C7,8.1045695 7.8954305,9 9,9 C10.1045695,9 11,8.1045695 11,7 C11,5.8954305 10.1045695,5 9,5 Z"}),"NonContacts"),ns=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M12,19.5 C16.9843673,19.5 20.6295366,20.7505675 22.8335731,23.3549038 C23.5867154,24.2448351 24,25.3729365 24,26.538784 L24,27.75 C24,29.8210678 22.3210678,31.5 20.25,31.5 L3.75,31.5 C1.67893219,31.5 0,29.8210678 0,27.75 L0,26.5387806 C0,25.3729314 0.413286907,24.2448288 1.16643175,23.354898 C3.37046736,20.7505662 7.01563535,19.5 12,19.5 Z M26.9272668,21.0503629 L27.1024807,21.0520931 C30.3320395,21.2704178 32.8220855,22.1814787 34.5196345,23.8437596 C35.3875212,24.6935741 35.9082005,25.8309338 35.9889534,27.0352541 L36,27.3651995 L36,28.125 C36,29.911296 34.6122576,31.3734674 32.8560732,31.4922138 L32.625,31.5 L28.5,31.5 C27.6715729,31.5 27,30.8284271 27,30 C27,29.2307462 27.5790603,28.5967393 28.3250683,28.5100916 L28.5,28.5 L32.625,28.5 C32.8025201,28.5 32.9512302,28.3766499 32.990096,28.2109841 L33,28.125 L33,27.3651995 C33,26.8466882 32.7912139,26.3500306 32.4207231,25.9872546 C31.2961739,24.8860689 29.4736312,24.2192349 26.9001365,24.0452615 C26.0735959,23.9893857 25.4488487,23.2740458 25.5047245,22.4475052 C25.5566091,21.6800032 26.1771133,21.0864965 26.9272668,21.0503629 L26.9272668,21.0503629 Z M12,22.5 C7.81695054,22.5 5.00307249,23.4653713 3.4564301,25.2929144 C3.16172113,25.6411484 3,26.0825803 3,26.5387817 L3,27.75 C3,28.1642136 3.33578644,28.5 3.75,28.5 L20.25,28.5 C20.6642136,28.5 21,28.1642136 21,27.75 L21,26.538784 C21,26.0825825 20.8382796,25.6411507 20.5435722,25.2929172 C18.9969303,23.4653723 16.1830516,22.5 12,22.5 Z M25.5,7.5 C28.3994949,7.5 30.75,9.85050506 30.75,12.75 C30.75,15.6494949 28.3994949,18 25.5,18 C22.6005051,18 20.25,15.6494949 20.25,12.75 C20.25,9.85050506 22.6005051,7.5 25.5,7.5 Z M12,4.5 C15.3137085,4.5 18,7.1862915 18,10.5 C18,13.8137085 15.3137085,16.5 12,16.5 C8.6862915,16.5 6,13.8137085 6,10.5 C6,7.1862915 8.6862915,4.5 12,4.5 Z M25.5,10.5 C24.2573593,10.5 23.25,11.5073593 23.25,12.75 C23.25,13.9926407 24.2573593,15 25.5,15 C26.7426407,15 27.75,13.9926407 27.75,12.75 C27.75,11.5073593 26.7426407,10.5 25.5,10.5 Z M12,7.5 C10.3431458,7.5 9,8.84314575 9,10.5 C9,12.1568542 10.3431458,13.5 12,13.5 C13.6568542,13.5 15,12.1568542 15,10.5 C15,8.84314575 13.6568542,7.5 12,7.5 Z"}),"NewGroup"),ss=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M27.75,2.51771235 C29.8210678,2.51771235 31.5,4.19664454 31.5,6.26771235 L31.5,29.7322876 C31.5,30.6020604 31.1976592,31.444786 30.6447384,32.1161898 C29.3281456,33.7149097 26.9648177,33.9436189 25.3660978,32.627026 L18,26.5597124 L18,29.25 C18,31.6465213 16.1266201,33.6054913 13.7644092,33.742361 L13.5,33.75 C11.1034787,33.75 9.14450868,31.8766201 9.00763904,29.5144092 L9,29.25 L8.99971804,25.3499156 C5.57649804,24.6549011 3,21.6283372 3,18 C3,13.8578644 6.35786438,10.5 10.5,10.5 L16.7118519,10.5 L25.3660978,3.37297397 C26.0375017,2.82005314 26.8802273,2.51771235 27.75,2.51771235 Z M12,25.4992124 L12,29.25 C12,30.0784271 12.6715729,30.75 13.5,30.75 C14.2692538,30.75 14.9032607,30.1709397 14.9899084,29.4249317 L15,29.25 L15,25.4992124 L12,25.4992124 L12,29.25 L12,25.4992124 Z M27.75,5.51771235 C27.5760455,5.51771235 27.4075003,5.57818051 27.2732196,5.68876467 L18.6189737,12.8157907 C18.0818506,13.2581274 17.4076701,13.5 16.7118519,13.5 L10.5,13.5 C8.01471863,13.5 6,15.5147186 6,18 C6,20.4852814 8.01471863,22.5 10.5,22.5 L16.7118519,22.5 C17.4076701,22.5 18.0818506,22.7418726 18.6189737,23.1842093 L27.2732196,30.3112353 C27.5929635,30.5745539 28.0656291,30.5288121 28.3289477,30.2090681 C28.4395318,30.0747873 28.5,29.9062422 28.5,29.7322876 L28.5,6.26771235 C28.5,5.85349879 28.1642136,5.51771235 27.75,5.51771235 Z"}),"NewChannel"),is=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M17,3 C19.1421954,3 20.8910789,4.68396847 20.9951047,6.80035966 L21,7 L21,10.5 C21,11.0522847 20.5522847,11.5 20,11.5 C19.4871642,11.5 19.0644928,11.1139598 19.0067277,10.6166211 L19,10.5 L19,7 C19,5.9456382 18.1841222,5.08183488 17.1492623,5.00548574 L17,5 L7,5 C5.9456382,5 5.08183488,5.81587779 5.00548574,6.85073766 L5,7 L5,19.585 L7.20502525,17.3807612 C7.41399436,17.1717921 7.68678103,17.0413128 7.97757724,17.0082977 L8.12426407,17 L12.5,17 C13.0522847,17 13.5,17.4477153 13.5,18 C13.5,18.5128358 13.1139598,18.9355072 12.6166211,18.9932723 L12.5,19 L8.413,19 L4.87781746,22.5363961 C4.47892479,22.9352888 3.84989486,22.9637811 3.41812544,22.6218731 L3.32218254,22.5363961 C3.14536253,22.3595761 3.034957,22.1287566 3.00702113,21.8826983 L3,21.7585786 L3,7 C3,4.85780461 4.68396847,3.10892112 6.80035966,3.00489531 L7,3 L17,3 Z M22.7071068,12.2928932 C23.0675907,12.6533772 23.0953203,13.2206082 22.7902954,13.6128994 L22.7071068,13.7071068 L17.7071068,18.7071068 C17.3466228,19.0675907 16.7793918,19.0953203 16.3871006,18.7902954 L16.2928932,18.7071068 L13.7928932,16.2071068 C13.4023689,15.8165825 13.4023689,15.1834175 13.7928932,14.7928932 C14.1533772,14.4324093 14.7206082,14.4046797 15.1128994,14.7097046 L15.2071068,14.7928932 L17,16.585 L21.2928932,12.2928932 C21.6834175,11.9023689 22.3165825,11.9023689 22.7071068,12.2928932 Z"}),"ReadChats"),rs=Object(T.a)(o.a.createElement("path",{fillRule:"nonzero",d:"M12,1 C12.5128358,1 12.9355072,1.38604019 12.9932723,1.88337887 L13,2 L13,3 L13.5,3 C16.7383969,3 19.3775718,5.56557489 19.4958615,8.77506174 L19.5,9 L19.5,11 L20,11 L20.1762728,11.0050927 C21.6927538,11.0929596 22.9070404,12.3072462 22.9949073,13.8237272 L23,14 L23,17 L22.9932723,17.1166211 C22.9355072,17.6139598 22.5128358,18 22,18 C21.4871642,18 21.0644928,17.6139598 21.0067277,17.1166211 L21,17 L21,14 L20.9932723,13.8833789 C20.9399506,13.424297 20.575703,13.0600494 20.1166211,13.0067277 L20,13 L19.5,13 L19.5,18 C19.5,20.1421954 17.8160315,21.8910789 15.6996403,21.9951047 L15.5,22 L8.5,22 C6.35780461,22 4.60892112,20.3160315 4.50489531,18.1996403 L4.5,18 L4.5,13 L4,13 C3.48716416,13 3.06449284,13.3860402 3.00672773,13.8833789 L3,14 L3,17 C3,17.5522847 2.55228475,18 2,18 C1.48716416,18 1.06449284,17.6139598 1.00672773,17.1166211 L1,17 L1,14 C1,12.4023191 2.24891996,11.0963391 3.82372721,11.0050927 L4,11 L4.5,11 L4.5,9 C4.5,5.76160306 7.06557489,3.12242824 10.2750617,3.00413847 L10.5,3 L11,3 L11,2 C11,1.44771525 11.4477153,1 12,1 Z M16.6762728,12.9949073 L16.5,13 L7.5,13 C7.14939781,13 6.81284272,12.9398572 6.5,12.8293257 L6.5,18 C6.5,19.0543618 7.31587779,19.9181651 8.35073766,19.9945143 L8.5,20 L15.5,20 C16.5543618,20 17.4181651,19.1841222 17.4945143,18.1492623 L17.5,18 L17.5009007,12.8289758 C17.2406443,12.9210572 16.9638938,12.9782422 16.6762728,12.9949073 Z M13.5,5 L10.5,5 C8.35780461,5 6.60892112,6.68396847 6.50489531,8.80035966 L6.5,9 L6.5,10 C6.5,10.5128358 6.88604019,10.9355072 7.38337887,10.9932723 L7.5,11 L16.5,11 C17.0128358,11 17.4355072,10.6139598 17.4932723,10.1166211 L17.5,10 L17.5,9 C17.5,6.85780461 15.8160315,5.10892112 13.6996403,5.00489531 L13.5,5 Z M9.5,7.5 C10.0522847,7.5 10.5,7.94771525 10.5,8.5 C10.5,9.05228475 10.0522847,9.5 9.5,9.5 C8.94771525,9.5 8.5,9.05228475 8.5,8.5 C8.5,7.94771525 8.94771525,7.5 9.5,7.5 Z M14.5,7.5 C15.0522847,7.5 15.5,7.94771525 15.5,8.5 C15.5,9.05228475 15.0522847,9.5 14.5,9.5 C13.9477153,9.5 13.5,9.05228475 13.5,8.5 C13.5,7.94771525 13.9477153,7.5 14.5,7.5 Z"}),"Bots"),os=a(533),ls=a.n(os),cs=Object(T.a)(o.a.createElement("path",{d:"M4.70710678,12.2928932 C4.31658249,11.9023689 3.68341751,11.9023689 3.29289322,12.2928932 C2.90236893,12.6834175 2.90236893,13.3165825 3.29289322,13.7071068 L8.29289322,18.7071068 C8.68341751,19.0976311 9.31658249,19.0976311 9.70710678,18.7071068 L20.7071068,7.70710678 C21.0976311,7.31658249 21.0976311,6.68341751 20.7071068,6.29289322 C20.3165825,5.90236893 19.6834175,5.90236893 19.2928932,6.29289322 L9,16.5857864 L4.70710678,12.2928932 Z"}),"Done"),hs=a(47),ds=a(425);a(527);class ps extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0,checked:!1},this.handleOpenContextMenu=e=>{this.props.onDelete&&(e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY}))},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleDelete=()=>{this.handleCloseContextMenu();var e=this.props,t=e.chatId,a=e.onDelete;a&&a(t)}}render(){var e=this.props,t=e.chatId,a=e.t,n=e.type,s=e.checked,i=e.onClick,r=this.state,l=r.contextMenu,c=r.left,h=r.top,d=Object(V.v)(t,!0,a);return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:i,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"filter-chat-tile"},o.a.createElement(K,{chatId:t,small:!0,showSavedMessages:!0})),o.a.createElement("div",{className:"filter-chat-content"},o.a.createElement("div",{className:"filter-chat-title"},d),n&&o.a.createElement("div",{className:"filter-chat-subtitle"},Object(V.w)(t,a))),void 0!==s&&o.a.createElement(ds.a,{className:"filter-chat-checkbox",color:"primary",checked:s})),o.a.createElement(Je.a,{open:l,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:h,left:c},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:a("Delete")})))))}}var us=Object(_.a)()(ps);a(528);class ms extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0},this.handleOpenContextMenu=e=>{this.props.onDelete&&(e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY}))},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleDelete=()=>{this.handleCloseContextMenu();var e=this.props.onDelete;e&&e()}}render(){var e=this.props,t=e.t,a=e.className,n=e.icon,s=e.text,i=e.checked,r=e.onClick,l=this.state,h=l.contextMenu,d=l.left,p=l.top;return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{className:c()(a,"settings-list-item2","filter-chat-text"),role:void 0,button:!0,onMouseDown:r,onContextMenu:this.handleOpenContextMenu},o.a.createElement("div",{className:"filter-chat-tile"},n),o.a.createElement("div",{className:"filter-chat-content"},s),void 0!==i&&o.a.createElement(ds.a,{className:"filter-chat-checkbox",color:"primary",checked:i})),o.a.createElement(Je.a,{open:h,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:p,left:d},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:t("Delete")})))))}}var fs=Object(_.a)()(ms);a(529);class gs extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){var e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){var t=this.divRef.current;t&&(t.style.cssText=e)}render(){var e=this.props,t=e.icon,a=e.text,n=e.selected,s=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":n}),onClick:s},o.a.createElement("div",{className:"chip-icon"},t),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(g.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},a))}}var Cs=gs;a(530);class vs extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){var e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){var t=this.divRef.current;t&&(t.style.cssText=e)}render(){var e=this.props,t=e.chatId,a=e.selected,n=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":a}),onClick:n},o.a.createElement(K,{chatId:t,small:!0}),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(g.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},Object(V.s)(t)))}}var bs=vs;a(531);class Es extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleChatChange=(e,t)=>{var a=this.props.mode;if(t){var n=this.searchInputRef.current;n.focus(),n.innerText="",this.handleSearch("")}this.handleChange("include"===a?"included_chat_ids":"excluded_chat_ids",e)},this.handleBackspace=()=>{var e=this.props,t=e.filter,a=e.mode,n=this.state.focusedItem;if(t)if(n)switch(n){case"include_contacts":case"include_non_contacts":case"include_bots":case"include_groups":case"include_channels":case"exclude_muted":case"exclude_read":case"exclude_archived":this.handleChange(n),this.setState({focusedItem:null});break;default:this.handleChatChange(n),this.setState({focusedItem:null})}else if("include"===a){var s=t.include_contacts,i=t.include_non_contacts,r=t.include_bots,o=t.include_groups,l=t.include_channels,c=t.included_chat_ids;if(c.length>0){var h=c[c.length-1];if(!h)return;this.setState({focusedItem:h})}else r?this.setState({focusedItem:"include_bots"}):l?this.setState({focusedItem:"include_channels"}):o?this.setState({focusedItem:"include_groups"}):i?this.setState({focusedItem:"include_non_contacts"}):s&&this.setState({focusedItem:"include_contacts"})}else{var d=t.exclude_muted,p=t.exclude_read,u=t.exclude_archived,m=t.excluded_chat_ids;if(m.length>0){var f=m[m.length-1];if(!f)return;this.setState({focusedItem:f})}else u?this.setState({focusedItem:"exclude_archived"}):p?this.setState({focusedItem:"exclude_read"}):d&&this.setState({focusedItem:"exclude_muted"})}},this.handleChange=(e,t)=>{(0,this.props.onChange)(e,t),this.setState({focusedItem:null})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null,focusedItem:null}),e.abrupt("return");case 4:return(i=[]).push(x.a.send({"@type":"searchChats",query:n,limit:100})),e.next=8,Promise.all(i);case 8:r=e.sent,o=Object(L.a)(r,1),l=o[0],c=U.a.getStore(),Object(G.x)(c,l.chat_ids),t.setState({searchItems:l,focusedItem:null});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.searchInputRef=o.a.createRef(),this.wrapPanelRef=o.a.createRef(),this.itemsRef=new Map,this.state={focusedItem:null,searchItems:null,error:!1}}getSnapshotBeforeUpdate(e,t){var a=this.props,n=a.filter,s=a.mode,i=e.filter;if(e.filter===n)return null;var r="include"===s,o=r?e.filter.included_chat_ids:e.filter.excluded_chat_ids,l=r?n.included_chat_ids:n.excluded_chat_ids,c=o.length>l.length||i.include_contacts&&!n.include_contacts||i.include_non_contacts&&!n.include_non_contacts||i.include_groups&&!n.include_groups||i.include_channels&&!n.include_channels||i.include_bots&&!n.include_bots||i.exclude_read&&!n.exclude_read||i.exclude_muted&&!n.exclude_muted||i.exclude_archived&&!n.exclude_archived,h=this.wrapPanelRef.current,d=h.scrollHeight,p=h.offsetHeight,u=h.style.cssText,m=h.scrollTop;c&&(h.style.cssText=null);var f,g=new Map,C=Object(hs.a)(this.itemsRef.keys());try{for(C.s();!(f=C.n()).done;){var v=f.value,b=this.itemsRef.get(v);if(b){var E=b.getOffset();g.set(v,E)}}}catch(S){C.e(S)}finally{C.f()}return{items:g,panel:{isDeleting:c,prevHeight:d,prevOffsetHeight:p,prevScrollTop:m,prevCSSText:u}}}componentDidUpdate(e,t,a){e.filter!==this.props.filter&&this.animatePanel(a.panel)}animatePanel(e){if(e){var t=e.isDeleting,a=e.prevHeight,n=e.prevOffsetHeight,s=e.prevScrollTop,i=e.prevCSSText,r=this.wrapPanelRef.current,o=r.scrollHeight,l=(r.offsetHeight,o<a);o>a?a<123?(r.style.cssText="max-height: ".concat(Math.min(a,123),"px;"),requestAnimationFrame(()=>{r.style.cssText="max-height: ".concat(Math.min(o,123),"px;"),setTimeout(()=>{this.searchInputRef.current.scrollIntoView({behavior:"auto"})},250)})):(r.style.cssText="max-height: ".concat(123,"px;"),this.searchInputRef.current.scrollIntoView({behavior:"smooth"})):l?o<123?(r.style.cssText="min-height: ".concat(Math.min(n,123),"px;"),requestAnimationFrame(()=>{r.style.cssText="min-height: ".concat(Math.min(o,123),"px;")})):(r.style.cssText="max-height: ".concat(123,"px;"),r.scrollTop=s):t?(r.style.cssText=i,r.scrollTop=s):this.searchInputRef.current.scrollIntoView({behavior:"smooth"})}}animateItems(e){if(e){var t,a=new Map,n=Object(hs.a)(this.itemsRef.keys());try{for(n.s();!(t=n.n()).done;){var s=t.value,i=this.itemsRef.get(s);if(i){var r=i.getOffset(),o=e.has(s)?e.get(s):null;if(o){o.left<r.left&&a.set(i,{prevOffset:o,currentOffset:r});var l="transform: translate(".concat(o.left-r.left,"px, ").concat(o.top-r.top,"px)");i.setStyleCSSText(l)}}}}catch(c){n.e(c)}finally{n.f()}requestAnimationFrame(()=>{var e,t=Object(hs.a)(this.itemsRef.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value,s=this.itemsRef.get(n);if(s){var i="transition: transform 0.25s ease";if(a.has(s)){var r=a.get(s),o=r.prevOffset,l=r.currentOffset;i="transform: translate(".concat(o.left-l.left-o.width,"px, ").concat(o.top-l.top,"px);")+"transition: transform 0.1s ease;"}s.setStyleCSSText(i)}}}catch(c){t.e(c)}finally{t.f()}a.size&&setTimeout(()=>{var e,t=Object(hs.a)(a.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value,s=a.get(n).currentOffset,i="transform: translate(".concat(s.width,"px, 0);")+"transition: transform 0s ease;";n.setStyleCSSText(i)}}catch(c){t.e(c)}finally{t.f()}requestAnimationFrame(()=>{var e,t=Object(hs.a)(a.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.setStyleCSSText("transition: transform 0.15s ease")}}catch(c){t.e(c)}finally{t.f()}})},100)})}}render(){var e=this.props,t=e.t,a=e.filter,n=e.chats,s=e.limit,i=e.mode,r=e.onClose,l=(e.onChange,e.onScroll),c=this.state,h=c.focusedItem,d=c.searchItems,p=a.include_contacts,u=a.include_non_contacts,m=a.include_bots,f=a.include_groups,g=a.include_channels,C=a.included_chat_ids,v=a.exclude_muted,b=a.exclude_read,E=a.exclude_archived,S=a.excluded_chat_ids,y="include"===i,M=y?C:S;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:r},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("include"===i?"FilterInclude":"FilterExclude")))),o.a.createElement("div",{ref:this.wrapPanelRef,className:"animated-wrap-panel"},y&&o.a.createElement(o.a.Fragment,null,p&&o.a.createElement(Cs,{onClick:()=>this.handleChange("include_contacts"),ref:e=>{this.itemsRef.set("include_contacts",e)},selected:"include_contacts"===h,icon:o.a.createElement(ts,{viewBox:"0 0 36 36"}),text:t("FilterContacts")}),u&&o.a.createElement(Cs,{onClick:()=>this.handleChange("include_non_contacts"),ref:e=>{this.itemsRef.set("include_non_contacts",e)},selected:"include_non_contacts"===h,icon:o.a.createElement(as,null),text:t("FilterNonContacts")}),f&&o.a.createElement(Cs,{onClick:()=>this.handleChange("include_groups"),ref:e=>{this.itemsRef.set("include_groups",e)},selected:"include_groups"===h,icon:o.a.createElement(ns,{viewBox:"0 0 36 36"}),text:t("FilterGroups")}),g&&o.a.createElement(Cs,{onClick:()=>this.handleChange("include_channels"),ref:e=>{this.itemsRef.set("include_channels",e)},selected:"include_channels"===h,icon:o.a.createElement(ss,{viewBox:"0 0 36 36"}),text:t("FilterChannels")}),m&&o.a.createElement(Cs,{onClick:()=>this.handleChange("include_bots"),ref:e=>{this.itemsRef.set("include_bots",e)},selected:"include_bots"===h,icon:o.a.createElement(rs,null),text:t("FilterBots")})),!y&&o.a.createElement(o.a.Fragment,null,v&&o.a.createElement(Cs,{onClick:()=>this.handleChange("exclude_muted"),ref:e=>{this.itemsRef.set("exclude_muted",e)},selected:"exclude_muted"===h,icon:o.a.createElement(ns,{viewBox:"0 0 36 36"}),text:t("FilterMuted")}),b&&o.a.createElement(Cs,{onClick:()=>this.handleChange("exclude_read"),ref:e=>{this.itemsRef.set("exclude_read",e)},selected:"exclude_read"===h,icon:o.a.createElement(ss,{viewBox:"0 0 36 36"}),text:t("FilterRead")}),E&&o.a.createElement(Cs,{onClick:()=>this.handleChange("exclude_archived"),ref:e=>{this.itemsRef.set("exclude_archived",e)},selected:"exclude_archived"===h,icon:o.a.createElement(rs,null),text:t("FilterArchived")})),M.map(e=>o.a.createElement(bs,{selected:h===e,ref:t=>{this.itemsRef.set(e,t)},key:e,chatId:e,onClick:()=>this.handleChatChange(e)})),o.a.createElement(sn,{inputRef:this.searchInputRef,hint:t("Search"),onClose:this.handleSearchClose,onChange:this.handleSearch,onBackspace:this.handleBackspace})),o.a.createElement("div",{className:"sidebar-page-top-divider",style:{zIndex:1}}),o.a.createElement("div",{ref:this.scrollRef,className:"sidebar-page-content",style:{marginTop:-3,position:"relative",height:"100%"},onScroll:l},o.a.createElement(Un,null,t("FilterChatTypes")),y&&o.a.createElement(o.a.Fragment,null,o.a.createElement(fs,{onClick:()=>this.handleChange("include_contacts"),checked:p,icon:o.a.createElement(ts,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterContacts")}),o.a.createElement(fs,{onClick:()=>this.handleChange("include_non_contacts"),checked:u,icon:o.a.createElement(as,{className:"filter-text-subtle-icon"}),text:t("FilterNonContacts")}),o.a.createElement(fs,{onClick:()=>this.handleChange("include_groups"),checked:f,icon:o.a.createElement(ns,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterGroups")}),o.a.createElement(fs,{onClick:()=>this.handleChange("include_channels"),checked:g,icon:o.a.createElement(ss,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterChannels")}),o.a.createElement(fs,{onClick:()=>this.handleChange("include_bots"),checked:m,icon:o.a.createElement(rs,{className:"filter-text-subtle-icon"}),text:t("FilterBots")})),!y&&o.a.createElement(o.a.Fragment,null,o.a.createElement(fs,{onClick:()=>this.handleChange("exclude_muted"),checked:v,icon:o.a.createElement(Oa,{className:"filter-text-subtle-icon"}),text:t("FilterMuted")}),o.a.createElement(fs,{onClick:()=>this.handleChange("exclude_read"),checked:b,icon:o.a.createElement(is,{className:"filter-text-subtle-icon"}),text:t("FilterRead")}),o.a.createElement(fs,{onClick:()=>this.handleChange("exclude_archived"),checked:E,icon:o.a.createElement(Ua,{className:"filter-text-subtle-icon"}),text:t("FilterArchived")})),n&&n.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider",style:{margin:"8px -8px"}}),o.a.createElement(Un,null,t("FilterChats")),(n||[]).slice(0,s).map(e=>o.a.createElement(us,{type:!0,onClick:()=>this.handleChatChange(e),key:e,chatId:e,checked:"include"===i?C.includes(e):S.includes(e)}))),d&&o.a.createElement("div",{className:"edit-filter-chats-search"},d.chat_ids.map(e=>o.a.createElement(us,{type:!0,onClick:()=>this.handleChatChange(e,!0),key:e,chatId:e,checked:"include"===i?C.includes(e):S.includes(e)})))))}}var Ss=Object(_.a)()(Es);a(532);var ys=o.a.lazy(()=>a.e(0).then(a.bind(null,397)));class Ms extends o.a.Component{constructor(e){var t;super(e),t=this,this.loadAnimationData=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.closeData){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,a=[fetch("data/Folders_2.json")],e.next=7,Promise.all(a);case 7:return n=e.sent,e.next=10,Promise.all(n.map(e=>e.text()));case 10:i=e.sent,r=Object(L.a)(i,1),o=r[0],t.setState({data:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[3,16]])}))),this.handleDone=()=>{var e=this.props.onDone,t=this.state.editFilter,a=this.titleRef.current.value.trim();if(!a)return this.titleRef.current.focus(),void this.setState({error:!0});this.setState({error:!1}),t.title=a,function(e){if(!e)return!1;var t=e.include_contacts,a=e.include_non_contacts,n=e.include_bots,s=e.include_groups,i=e.include_channels,r=e.included_chat_ids;return!!e.title&&(t||a||n||s||i||r.length>0)}(t)?e&&e(t):this.handleScheduledAction("Please choose at least one chat for this folder.")},this.handleAnimationClick=()=>{var e=this.lottieRef.current;e&&e.isPaused&&e.play()},this.handleDeleteIncludeContacts=()=>{var e=this.props.t,t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{include_contacts:!1});this.setState({editFilter:a}),this.titleRef.current.value===e("FilterContacts")&&this.setState({title:""})}},this.handleDeleteIncludeNonContacts=()=>{var e=this.props.t,t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{include_non_contacts:!1});this.setState({editFilter:a}),this.titleRef.current.value===e("FilterNonContacts")&&this.setState({title:""})}},this.handleDeleteIncludeGroups=()=>{var e=this.props.t,t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{include_groups:!1});this.setState({editFilter:a}),this.titleRef.current.value===e("FilterGroups")&&this.setState({title:""})}},this.handleDeleteIncludeChannels=()=>{var e=this.props.t,t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{include_channels:!1});this.setState({editFilter:a}),this.titleRef.current.value===e("FilterChannels")&&this.setState({title:""})}},this.handleDeleteIncludeBots=()=>{var e=this.props.t,t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{include_bots:!1});this.setState({editFilter:a}),this.titleRef.current.value===e("FilterBots")&&this.setState({title:""})}},this.handleDeleteIncludedChat=e=>{var t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{included_chat_ids:t.included_chat_ids.filter(t=>t!==e)});this.setState({editFilter:a})}},this.handleDeleteExcludeMuted=()=>{var e=this.state.editFilter;if(e){var t=Object(Ze.a)(Object(Ze.a)({},e),{},{exclude_muted:!1});this.setState({editFilter:t})}},this.handleDeleteExcludeRead=()=>{var e=this.state.editFilter;if(e){var t=Object(Ze.a)(Object(Ze.a)({},e),{},{exclude_read:!1});this.setState({editFilter:t})}},this.handleDeleteExcludeArchived=()=>{var e=this.state.editFilter;if(e){var t=Object(Ze.a)(Object(Ze.a)({},e),{},{exclude_archived:!1});this.setState({editFilter:t})}},this.handleDeleteExcludedChat=e=>{var t=this.state.editFilter;if(t){var a=Object(Ze.a)(Object(Ze.a)({},t),{},{excluded_chat_ids:t.excluded_chat_ids.filter(t=>t!==e)});this.setState({editFilter:a})}},this.handleOpenFilterChats=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:0,limit:1e3});case 2:n=e.sent,t.setState({openFilterChats:!0,mode:a,chats:n.chat_ids,limit:u.f});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseFilterChats=()=>{this.setDefaultFilterTitle(),this.setState({openFilterChats:!1,mode:null})},this.handleChange=(e,t)=>{var a=this.state.editFilter;if(a){var n=null;switch(e){case"include_contacts":n=Object(Ze.a)(Object(Ze.a)({},a),{},{include_contacts:!a.include_contacts});break;case"include_non_contacts":n=Object(Ze.a)(Object(Ze.a)({},a),{},{include_non_contacts:!a.include_non_contacts});break;case"include_bots":n=Object(Ze.a)(Object(Ze.a)({},a),{},{include_bots:!a.include_bots});break;case"include_groups":n=Object(Ze.a)(Object(Ze.a)({},a),{},{include_groups:!a.include_groups});break;case"include_channels":n=Object(Ze.a)(Object(Ze.a)({},a),{},{include_channels:!a.include_channels});break;case"included_chat_ids":var s,i;a.included_chat_ids.includes(t)?(s=a.included_chat_ids.filter(e=>e!==t),i=a.excluded_chat_ids):(s=[...a.included_chat_ids,t],i=a.excluded_chat_ids.filter(e=>e!==t)),n=Object(Ze.a)(Object(Ze.a)({},a),{},{included_chat_ids:s,excluded_chat_ids:i});break;case"exclude_muted":n=Object(Ze.a)(Object(Ze.a)({},a),{},{exclude_muted:!a.exclude_muted});break;case"exclude_read":n=Object(Ze.a)(Object(Ze.a)({},a),{},{exclude_read:!a.exclude_read});break;case"exclude_archived":n=Object(Ze.a)(Object(Ze.a)({},a),{},{exclude_archived:!a.exclude_archived});break;case"excluded_chat_ids":var r,o;a.excluded_chat_ids.includes(t)?(o=a.excluded_chat_ids.filter(e=>e!==t),r=a.included_chat_ids):(o=[...a.excluded_chat_ids,t],r=a.included_chat_ids.filter(e=>e!==t)),n=Object(Ze.a)(Object(Ze.a)({},a),{},{included_chat_ids:r,excluded_chat_ids:o})}n&&this.setState({editFilter:n})}},this.handleTitleChange=()=>{var e=this.titleRef.current.value.substr(0,u.j);this.setState({title:e})},this.handleScroll=e=>{var t=e.target;t.scrollTop+t.offsetHeight>=t.scrollHeight&&this.setState({limit:this.state.limit+u.f})},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(g.a,null))]})},this.titleRef=o.a.createRef(),this.lottieRef=o.a.createRef(),this.state={prevFilterId:-1,data:null,openFilterChats:!1,mode:null,title:"",error:!1,shook:!1,chats:[],limit:0}}static getDerivedStateFromProps(e,t){var a=e.filter,n=e.filterId,s=t.prevFilterId;return a&&s!==n?{prevFilterId:n,editFilter:Object(Ze.a)({},a),title:a.title}:null}componentDidMount(){this.loadAnimationData()}setDefaultFilterTitle(){var e=this.props.t,t=this.state.editFilter;if(!this.titleRef.current.value){var a=t.include_contacts,n=t.include_non_contacts,s=t.include_bots,i=t.include_groups,r=t.include_channels,o=t.included_chat_ids;t.exclude_muted,t.exclude_read,t.exclude_archived,t.excluded_chat_ids;o.length||(!a||n||s||i||r?a||!n||s||i||r?!a||!n||s||i||r?a||n||!s||i||r?a||n||s||!i||r?a||n||s||i||!r||this.setState({title:e("FilterChannels")}):this.setState({title:e("FilterGroups")}):this.setState({title:e("FilterBots")}):this.setState({title:e("ChatHints")}):this.setState({title:e("FilterNonContacts")}):this.setState({title:e("FilterContacts")}))}}render(){var e=this.props,t=e.t,a=e.filter,n=e.id,s=e.onClose;if(!a)return null;var i=this.state,r=i.editFilter,l=i.data,c=i.openFilterChats,h=i.mode,d=i.chats,p=i.limit,u=i.title,m=i.error,f=(i.shook,r.include_contacts),g=r.include_non_contacts,C=r.include_bots,v=r.include_groups,b=r.include_channels,E=r.included_chat_ids,S=r.exclude_muted,y=r.exclude_read,M=r.exclude_archived,I=r.excluded_chat_ids;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:s},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t(n>=0?"FilterEdit":"CreateNewFilter"))),o.a.createElement(P.a,{className:"header-right-button",color:"primary",onClick:this.handleDone},o.a.createElement(cs,null))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"filters-create-animation"},l&&o.a.createElement(o.a.Suspense,{fallback:null},o.a.createElement(ys,{ref:this.lottieRef,options:{width:80,height:80,autoplay:!0,loop:!1,fileId:"createFilter",stringData:l},onClick:this.handleAnimationClick}))),o.a.createElement("div",{className:"create-filter-title"},o.a.createElement(Wn.a,{inputRef:this.titleRef,className:"edit-profile-input",variant:"outlined",fullWidth:!0,label:t("FilterNameHint"),value:u,error:m,onChange:this.handleTitleChange})),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("FilterInclude")),o.a.createElement(fs,{className:"create-filter-add-chats",icon:o.a.createElement(es,null),text:t("FilterAddChats"),onClick:()=>this.handleOpenFilterChats("include")}),f&&o.a.createElement(fs,{onDelete:this.handleDeleteIncludeContacts,icon:o.a.createElement(ts,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterContacts")}),g&&o.a.createElement(fs,{onDelete:this.handleDeleteIncludeNonContacts,icon:o.a.createElement(as,{className:"filter-text-subtle-icon"}),text:t("FilterNonContacts")}),v&&o.a.createElement(fs,{onDelete:this.handleDeleteIncludeGroups,icon:o.a.createElement(ns,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterGroups")}),b&&o.a.createElement(fs,{onDelete:this.handleDeleteIncludeChannels,icon:o.a.createElement(ss,{className:"filter-text-subtle-icon",viewBox:"0 0 36 36"}),text:t("FilterChannels")}),C&&o.a.createElement(fs,{onDelete:this.handleDeleteIncludeBots,icon:o.a.createElement(rs,{className:"filter-text-subtle-icon"}),text:t("FilterBots")}),E.map(e=>o.a.createElement(us,{key:e,chatId:e,onDelete:this.handleDeleteIncludedChat}))),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("FilterExclude")),o.a.createElement(fs,{className:"create-filter-remove-chats",icon:o.a.createElement(ls.a,null),text:t("FilterRemoveChats"),onClick:()=>this.handleOpenFilterChats("exclude")}),S&&o.a.createElement(fs,{onDelete:this.handleDeleteExcludeMuted,icon:o.a.createElement(Oa,{className:"filter-text-subtle-icon"}),text:t("FilterMuted")}),y&&o.a.createElement(fs,{onDelete:this.handleDeleteExcludeRead,icon:o.a.createElement(is,{className:"filter-text-subtle-icon"}),text:t("FilterRead")}),M&&o.a.createElement(fs,{onDelete:this.handleDeleteExcludeArchived,icon:o.a.createElement(Ua,{className:"filter-text-subtle-icon"}),text:t("FilterArchived")}),I.map(e=>o.a.createElement(us,{key:e,chatId:e,onDelete:this.handleDeleteExcludedChat})))),o.a.createElement(Ln,{open:c,onClose:this.handleCloseFilterChats},o.a.createElement(Ss,{filter:r,mode:h,chats:d,limit:p,onChange:this.handleChange,onScroll:this.handleScroll})))}}var Is=Object(h.a)(Object(_.a)(),p.b)(Ms);a(534);class Us extends o.a.Component{constructor(...e){super(...e),this.state={dialog:!1,contextMenu:!1,left:0,top:0},this.handleDelete=()=>{this.handleCloseContextMenu(),this.handleOpenDialog()},this.handleOpenDialog=()=>{this.setState({dialog:!0})},this.handleCloseDialog=()=>{this.setState({dialog:!1})},this.handleDeleteCancel=()=>{this.handleCloseDialog()},this.handleDeleteConfirm=()=>{var e=this.props.info;e&&(this.handleCloseDialog(),x.a.send({"@type":"deleteChatFilter",chat_filter_id:e.id}))},this.handleOpenContextMenu=e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setState({contextMenu:!0,left:e.clientX,top:e.clientY})},this.handleCloseContextMenu=()=>{this.setState({contextMenu:!1,left:0,top:0})}}render(){var e=this.props,t=e.t,a=e.info,n=e.onEdit,s=e.chats;if(!a)return null;var i=this.state,r=i.dialog,l=i.contextMenu,c=i.top,h=i.left,d=a.title,p=function(e,t,a){if(!a)return" ";for(var n=0,s=0;s<a.chat_ids.length;s++)"0"!==Object(V.q)(a.chat_ids[s],{"@type":"chatListFilter",chat_filter_id:t})&&n++;return n?1===n?"1 chat":"".concat(n," chats"):e("FilterNoChats")}(t,a.id,s);return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:n,onContextMenu:this.handleOpenContextMenu},o.a.createElement(Se.a,{className:"settings-list-item-text2",primary:d,secondary:p})),o.a.createElement(Je.a,{open:l,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:c,left:h},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:t("Delete")})))),o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:r,onClose:this.handleCancel,"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},t("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,t("FilterDeleteAlert"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleDeleteCancel,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDeleteConfirm,color:"primary"},t("Ok")))))}}var ks=Object(_.a)()(Us);a(535);class xs extends o.a.Component{constructor(...e){super(...e),this.handleAdd=()=>{var e=this.props.filter;if(e){var t=e.filter;x.a.send({"@type":"createChatFilter",filter:t})}}}render(){var e=this.props,t=e.t,a=e.filter;if(!a)return null;var n=a.filter,s=a.description;return o.a.createElement(be.a,{className:"settings-list-item2",role:void 0,button:!0},o.a.createElement(Se.a,{className:"settings-list-item-text",primary:n.title,secondary:s}),o.a.createElement(N.a,{className:"recommended-filter-add",variant:"contained",disableElevation:!0,color:"primary",onClick:this.handleAdd},t("Add")))}}var ws=Object(_.a)()(xs),Os=(a(536),o.a.lazy(()=>a.e(0).then(a.bind(null,397))));class Ls extends o.a.Component{constructor(e){var t;super(e),t=this,this.onUpdateChatFilters=e=>{setTimeout(()=>{this.loadData()},100)},this.loadAnimationData=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.closeData){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,a=[fetch("data/Folders_1.json"),fetch("data/Folders_2.json")],e.next=7,Promise.all(a);case 7:return n=e.sent,e.next=10,Promise.all(n.map(e=>e.text()));case 10:i=e.sent,r=Object(L.a)(i,1),o=r[0],t.setState({data:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[3,16]])}))),this.handleCreateFilter=()=>{var e=this.props.t;if(ma.filters.length>=u.i)this.handleScheduledAction(e("FilterCreateError"));else{this.setState({openFilter:!0,filterId:-1,filter:{"@type":"chatFiler",title:"",icon_name:"",pinned_chat_ids:[],included_chat_ids:[],excluded_chat_ids:[],exclude_muted:!1,exclude_read:!1,exclude_archived:!1,include_contacts:!1,include_non_contacts:!1,include_bots:!1,include_groups:!1,include_channels:!1}})}},this.handleCloseFilter=()=>{this.setState({openFilter:!1,filterId:-1,filter:null})},this.handleEditFilter=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"getChatFilter",chat_filter_id:a.id});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.setState({openFilter:!0,filterId:a.id,filter:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleDone=e=>{var t=this.state.filterId;this.handleCloseFilter(),e&&(-1!==t?x.a.send({"@type":"editChatFilter",chat_filter_id:t,filter:e}):x.a.send({"@type":"createChatFilter",filter:e}))},this.handleAnimationClick=()=>{var e=this.lottieRef.current;e&&e.isPaused&&e.play()},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(g.a,null))]})},this.lottieRef=o.a.createRef(),this.state={openFilter:!1,filterId:-1,filter:null,editFilter:null,recommendedFilters:null,chats:null,filtersMap:new Map}}componentDidMount(){this.loadAnimationData(),this.loadData(),ma.on("updateChatFilters",this.onUpdateChatFilters)}componentWillUnmount(){ma.off("updateChatFilters",this.onUpdateChatFilters)}loadData(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i,r,o,l,c,h;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_chat_id:0,offset_order:"9223372036854775807",limit:1e3});case 2:for(a=t.sent,n=ma.filters,i=[],r=0;n&&r<n.length;r++)i.push(x.a.send({"@type":"getChatFilter",chat_filter_id:n[r].id}).catch(e=>null));return t.next=8,Promise.all(i);case 8:for(o=t.sent,l=new Map,c=0;n&&c<n.length;c++)l.set(n[c].id,o[c]);return t.next=13,x.a.send({"@type":"getRecommendedChatFilters"});case 13:h=t.sent,e.setState({chats:a,filtersMap:l,recommendedFilters:h});case 15:case"end":return t.stop()}}),t)})))()}render(){var e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.recommendedFilters,i=n.openFilter,r=n.filter,l=n.filterId,c=n.data,h=n.chats,d=n.filtersMap,p=ma.filters,m=p&&p.length>0,f=s&&s.chat_filters.length>0&&(!p||p.length<u.i);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:a},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("FilterAvailableTitle")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section filters-create"},o.a.createElement("div",{className:"filters-create-animation"},c&&o.a.createElement(o.a.Suspense,{fallback:null},o.a.createElement(Os,{ref:this.lottieRef,options:{width:80,height:80,autoplay:!0,loop:!1,fileId:"filters",stringData:c},onClick:this.handleAnimationClick}))),o.a.createElement("div",{className:"filters-create-hint"},t("CreateNewFilterInfo")),o.a.createElement(N.a,{className:"filters-create-button",color:"primary",variant:"contained",disableElevation:!0,startIcon:o.a.createElement(es,null),onClick:this.handleCreateFilter},t("CreateNewFilter"))),m&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("Filters")),(p||[]).map(e=>o.a.createElement(ks,{key:e.id,info:e,filter:d.get(e.id),chats:h,onEdit:()=>this.handleEditFilter(e)})))),f&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("FilterRecommended")),s.chat_filters.map(e=>o.a.createElement(ws,{key:e.filter.title,filter:e}))))),o.a.createElement(Ln,{open:i,onClose:this.handleCloseFilter},o.a.createElement(Is,{filter:r,id:l,onDone:this.handleDone})))}}var _s=Object(h.a)(Object(_.a)(),p.b)(Ls),Ns=Object(T.a)(o.a.createElement("path",{d:"M19.2869988,2.88316725 L19.4142136,3 L21,4.58578644 C21.7399408,5.3257272 21.778885,6.50121136 21.1168328,7.28699879 L21,7.41421356 L17.414,10.9992136 L18.2071068,11.7928932 C18.5976311,12.1834175 18.5976311,12.8165825 18.2071068,13.2071068 C17.8466228,13.5675907 17.2793918,13.5953203 16.8871006,13.2902954 L16.7928932,13.2071068 L16,12.4142136 L7.70710678,20.7071068 C7.55082647,20.8633871 7.34814508,20.9625983 7.13144398,20.9913276 L7,21 L4,21 C3.48716416,21 3.06449284,20.6139598 3.00672773,20.1166211 L3,20 L3,17 C3,16.7789863 3.07316447,16.565516 3.20608063,16.3919705 L3.29289322,16.2928932 L11.585,7.99921356 L10.7928932,7.20710678 C10.4023689,6.81658249 10.4023689,6.18341751 10.7928932,5.79289322 C11.1533772,5.43240926 11.7206082,5.40467972 12.1128994,5.70970461 L12.2071068,5.79289322 L13,6.58521356 L16.5857864,3 C17.3257272,2.26005924 18.5012114,2.22111499 19.2869988,2.88316725 Z M13,9.415 L5,17.414 L5,18.999 L6.585,18.999 L14.585,11 L13,9.415 Z M18,4.41421356 L14.414,7.99921356 L16,9.58521356 L19.5857864,6 L18,4.41421356 Z"}),"Colorize"),Ps=(a(537),a(70));class js extends o.a.Component{constructor(...e){super(...e),this.state={loaded:!1},this.onClientUpdateDocumentThumbnailBlob=e=>{var t=this.props.wallpaper;if(t){var a=t.document;if(a){var n=a.thumbnail;if(n){var s=n.file;if(s){var i=e.fileId;s.id===i&&this.forceUpdate()}}}}},this.handleLoad=()=>{this.setState({loaded:!0})},this.handleClick=()=>{var e=this.props,t=e.wallpaper,a=e.onClick;a&&a(t)}}componentDidMount(){U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}componentWillUnmount(){U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}render(){var e=this.props,t=e.wallpaper,a=e.isSelected,n=(this.state.loaded,t.document),s=n.minithumbnail,i=n.thumbnail,r=s?"data:image/jpeg;base64, "+s.data:null,l=Object(G.m)(i?i.file:null),c=l||r;return o.a.createElement("div",{className:"shared-photo",onClick:this.handleClick},o.a.createElement("div",{className:"shared-photo-content",style:{backgroundImage:"url(".concat(l||r,")"),backgroundSize:"cover",backgroundPosition:"50%"}},c!==l&&o.a.createElement("div",{className:"shared-photo-main-content",style:{backgroundImage:"url(".concat(c,")")}})),a&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"wallpaper-selected"}),o.a.createElement("div",{className:"wallpaper-selected-inner"})),n&&n.document&&o.a.createElement(Ps.a,{file:n.document,cancelButton:!1}))}}var Ds=js;a(538);class Rs extends o.a.Component{constructor(...e){super(...e),this.state={selectedId:Z.a.wallpaper?Z.a.wallpaper.id:-1},this.handleClick=e=>{this.setState({selectedId:e.id});var t=e.document;if(t){t.thumbnail;var a=t.document;if(a){if(!Object(G.m)(a)){var n=U.a.getStore();Object(G.u)(n,e,!0)}x.a.clientUpdate({"@type":"clientUpdateChatBackground",wallpaper:e})}}}}componentDidMount(){this.loadContent()}loadContent(){var e=this.props.backgrounds;if(e){var t=U.a.getStore();Object(G.v)(t,e.backgrounds)}}render(){var e=this.props,t=e.t,a=e.backgrounds,n=e.onClose,s=this.state.selectedId,i=a.backgrounds.filter(e=>"backgroundTypeWallpaper"===e.type["@type"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:n},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("ChatBackground")))),o.a.createElement("div",{className:"sidebar-page-content shared-media-list shared-photos-list"},i.map(e=>o.a.createElement(Ds,{key:e.id,wallpaper:e,isSelected:e.id===s,onClick:this.handleClick}))))}}var Ts=Object(_.a)()(Rs),Fs=a(188),As=a.n(Fs),Bs=a(656),Vs=a(658),Hs=a(417),zs=a(378),Ws=a(256),Gs=a.n(Ws),Zs=a(257),qs=a.n(Zs),Ks=a(540),Js=a.n(Ks),Ys=a(258),Xs=a.n(Ys),Qs=a(255),$s=a.n(Qs),ei=a(541),ti=a.n(ei);a(539);class ai extends o.a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({type:e.target.value}),na.a.emit("clientUpdateThemeChanging",{type:e.target.value,primary:this.getColor(this.state.color)})},this.handleAccentChange=e=>{this.setState({color:e.target.value}),na.a.emit("clientUpdateThemeChanging",{type:this.state.type,primary:this.getColor(e.target.value)})},this.getColorString=e=>{switch(e){case Gs.a[500]:return"red";case qs.a[500]:return"orange";case Js.a[500]:return"amber";case Xs.a[500]:return"green";case"#50A2E9":return"blue";case $s.a[500]:return"indigo";case ti.a[500]:return"deepPurple"}return null},this.getColor=e=>{switch(e){case"red":return Gs.a;case"orange":return qs.a;case"amber":return Js.a;case"green":return Xs.a;case"blue":return{main:"#50A2E9"};case"indigo":return $s.a;case"deepPurple":return ti.a}return null},this.handleClose=()=>{this.setState({open:!1})},this.open=()=>{this.setState({open:!0})},this.state={open:!1,type:this.props.theme.palette.type,color:this.getColorString(this.props.theme.palette.primary.main)}}render(){var e=this.props.t,t=this.state,a=t.type,n=t.color,s=t.open;return o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:s,onClose:this.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(R.a,{id:"alert-dialog-title"},e("Appearance")),o.a.createElement(Dn.a,null,o.a.createElement(Hs.a,{component:"fieldset",className:"theme-picker-form"},o.a.createElement(zs.a,{focused:!0,component:"legend"},e("Theme")),o.a.createElement(Bs.a,{"aria-label":"theme",name:"theme1",className:"theme-picker-group",value:a,onChange:this.handleChange},o.a.createElement(Vs.a,{value:"light",control:o.a.createElement(ds.a,{color:"primary"}),label:"Light"}),o.a.createElement(Vs.a,{value:"dark",control:o.a.createElement(ds.a,{color:"primary"}),label:"Dark"}))),o.a.createElement(Hs.a,{component:"fieldset",className:"theme-picker-form"},o.a.createElement(zs.a,{focused:!0,component:"legend"},e("Accent")),o.a.createElement(Bs.a,{"aria-label":"accent",name:"accent1",className:"theme-picker-group",value:n,onChange:this.handleAccentChange},o.a.createElement(Vs.a,{value:"red",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-red"}}),label:"Red"}),o.a.createElement(Vs.a,{value:"orange",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-orange"}}),label:"Orange"}),o.a.createElement(Vs.a,{value:"amber",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-amber"}}),label:"Amber"}),o.a.createElement(Vs.a,{value:"green",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-green"}}),label:"Green"}),o.a.createElement(Vs.a,{value:"blue",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-blue"}}),label:"Blue"}),o.a.createElement(Vs.a,{value:"indigo",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-indigo"}}),label:"Indigo"}),o.a.createElement(Vs.a,{value:"deepPurple",control:o.a.createElement(ds.a,{color:"primary",classes:{root:"theme-picker-deep-purple"}}),label:"Deep Purple"})))))}}var ni=Object(h.a)(Object(h.d)(),As.a,Object(_.a)(),Object(h.c)())(ai);a(542);class si extends o.a.Component{constructor(e){super(e),this.handleAppearance=()=>{this.themePickerRef.current.open()},this.loadContent=()=>{x.a.send({"@type":"getBackgrounds",for_dark_theme:!1}).then(e=>this.setState({backgrounds:e}))},this.openChatBackground=()=>{this.state.backgrounds&&this.setState({openChatBackground:!0})},this.closeChatBackground=()=>{this.setState({openChatBackground:!1})},this.state={backgrounds:null,openChatBackground:!1},this.themePickerRef=o.a.createRef()}componentDidMount(){this.loadContent()}render(){var e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.backgrounds,i=n.openChatBackground;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:a},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("GeneralSettings")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(be.a,{autoFocus:!1,className:"settings-list-item",button:!0,onClick:this.handleAppearance},o.a.createElement(Ee.a,null,o.a.createElement(Ns,null)),o.a.createElement(Se.a,{primary:t("Appearance")})))),o.a.createElement(Ln,{open:i,onClose:this.closeChatBackground},o.a.createElement(Ts,{backgrounds:s})),o.a.createElement(ni,{ref:this.themePickerRef}))}}var ii=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(si);a(543);class ri extends o.a.Component{constructor(e){super(e),this.handleChange=e=>{this.setState({language:e}),x.a.clientUpdate({"@type":"clientUpdateLanguageChange",language:e})};var t=e.i18n,a=t?t.language:null;this.state={language:a||"en"}}render(){var e=this.props,t=e.t,a=e.onClose,n=this.state.language,s=(ln.a.info||{language_packs:[]}).language_packs.map(e=>o.a.createElement("div",{key:e.id,className:"settings-item",onClick:()=>this.handleChange(e.id)},o.a.createElement(ds.a,{color:"primary",className:"settings-item-control",checked:n===e.id,tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(Se.a,{id:"label-2",primary:e.name,secondary:e.native_name})));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:a},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("Language")))),o.a.createElement("div",{className:"sidebar-page-content"},s))}}var oi=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(ri);a(544);class li extends o.a.Component{constructor(e){super(e),this.handleMuteFor=e=>{var t=this.state[e];if(t){var a=t.mute_for,n=Object(Ze.a)(Object(Ze.a)({},t),{},{mute_for:0===a?31536e3:0});this.setState({[e]:n})}},this.handleShowPreview=e=>{var t=this.state[e];if(t){var a=t.show_preview,n=Object(Ze.a)(Object(Ze.a)({},t),{},{show_preview:!a});this.setState({[e]:n})}},this.handleContactJoined=()=>{this.setState({contactJoined:!this.state.contactJoined})};var t=ee.a.get("disable_contact_registered_notifications");this.state={privateChatsSettings:Ae.a.settings.get("notificationSettingsScopePrivateChats"),groupChatsSettings:Ae.a.settings.get("notificationSettingsScopeGroupChats"),channelChatsSettings:Ae.a.settings.get("notificationSettingsScopeChannelChats"),contactJoined:!t||!t.value}}componentWillUnmount(){var e=this.state,t=e.privateChatsSettings,a=e.groupChatsSettings,n=e.channelChatsSettings,s=e.contactJoined;this.setScopeNotificationSettings("notificationSettingsScopePrivateChats",t),this.setScopeNotificationSettings("notificationSettingsScopeGroupChats",a),this.setScopeNotificationSettings("notificationSettingsScopeChannelChats",n),this.setContactJoinedOption(s)}setContactJoinedOption(){var e=this.state.contactJoined,t=ee.a.get("disable_contact_registered_notifications");(!t||!t.value)!==e&&x.a.send({"@type":"setOption",name:"disable_contact_registered_notifications",value:{"@type":"optionValueBoolean",value:!e}})}setScopeNotificationSettings(e,t){if(e&&t){var a=Ae.a.settings.get(e);if(a){var n=t.mute_for,s=t.show_preview,i=a.mute_for,r=a.show_preview;n===i&&s===r||x.a.send({"@type":"setScopeNotificationSettings",scope:{"@type":e},notification_settings:t})}}}isEnabled(e){return!!e&&0===e.mute_for}showPreview(e){return!!e&&e.show_preview}render(){var e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.privateChatsSettings,i=n.groupChatsSettings,r=n.channelChatsSettings,l=n.contactJoined;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:a},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("Notifications")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("NotificationsPrivateChats")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("privateChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(s),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(Se.a,{id:"label-1",primary:t("NotificationsForPrivateChats"),secondary:this.isEnabled(s)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("privateChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(s),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(Se.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(s)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("NotificationsGroups")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("groupChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(i),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(Se.a,{id:"label-1",primary:t("NotificationsForGroups"),secondary:this.isEnabled(i)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("groupChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(i),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(Se.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(i)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("NotificationsChannels")),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleMuteFor("channelChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.isEnabled(r),tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(Se.a,{id:"label-1",primary:t("NotificationsForChannels"),secondary:this.isEnabled(r)?t("NotificationsEnabled"):t("NotificationsDisabled")})),o.a.createElement("div",{className:"settings-item",onClick:()=>this.handleShowPreview("channelChatsSettings")},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:this.showPreview(r),tabIndex:-1,inputProps:{"aria-labelledby":"label-2"}}),o.a.createElement(Se.a,{id:"label-2",primary:t("MessagePreview"),secondary:this.showPreview(r)?t("PreviewEnabled"):t("PreviewDisabled")}))),o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("NotificationsOther")),o.a.createElement("div",{className:"settings-item",onClick:this.handleContactJoined},o.a.createElement(Te.a,{color:"primary",className:"settings-item-control",checked:l,tabIndex:-1,inputProps:{"aria-labelledby":"label-1"}}),o.a.createElement(Se.a,{id:"label-1",primary:t("ContactJoined"),secondary:t(l?"ContactJoinedEnabled":"ContactJoinedDisabled")})))))}}var ci=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(li),hi=Object(T.a)(o.a.createElement("g",{transform:"translate(-1.000000, -1.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 Z M12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 Z M8,11 L16,11 C16.5522847,11 17,11.4477153 17,12 C17,12.5128358 16.6139598,12.9355072 16.1166211,12.9932723 L16,13 L8,13 C7.44771525,13 7,12.5522847 7,12 C7,11.4871642 7.38604019,11.0644928 7.88337887,11.0067277 L8,11 L16,11 L8,11 Z"})),"Stop");a(545);class di extends o.a.Component{constructor(...e){super(...e),this.state={contextMenu:!1,left:0,top:0},this.handleContextMenu=e=>{e&&(e.preventDefault(),e.stopPropagation());var t=this.props.session;if(t&&!t.is_current)if(this.state.contextMenu)this.setState({contextMenu:!1});else{var a=e.clientX,n=e.clientY;this.setState({contextMenu:!0,left:a,top:n})}},this.handleCloseContextMenu=e=>{this.setState({contextMenu:!1,left:0,top:0})},this.handleTerminate=e=>{this.handleCloseContextMenu(e);var t=this.props;(0,t.onTerminate)(t.session)}}render(){var e=this.props,t=e.session,a=e.t;if(!t)return null;var n=this.state,s=n.left,i=n.top,r=n.contextMenu,l=t.is_current,c=t.application_name,h=t.application_version,d=t.device_model,p=t.platform,u=t.system_version,m=t.ip,f=t.region,g=t.country,C=t.last_active_date,v=!l;return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{className:"settings-list-item",button:!0,onContextMenu:this.handleContextMenu},o.a.createElement("div",{className:"session"},o.a.createElement("div",{className:"session-title"},o.a.createElement("div",{className:"session-app"},"".concat(c," ").concat(h)),v&&o.a.createElement("div",{className:"session-date"},Object(V.G)({date:C}))),o.a.createElement("div",{className:"session-subtitle1"},"".concat(d,", ").concat(p," ").concat(u)),o.a.createElement("div",{className:"session-subtitle2"},"".concat(m," - "),f&&"".concat(f,", "),g&&"".concat(g)))),o.a.createElement(Je.a,{open:r,onClose:this.handleCloseContextMenu,anchorReference:"anchorPosition",anchorPosition:{top:i,left:s},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:this.handleTerminate},o.a.createElement(Ee.a,null,o.a.createElement(hi,null)),o.a.createElement(Se.a,{primary:a("Terminate")})))))}}var pi=Object(_.a)()(di);a(546);class ui extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={open:!1,openAll:!1,session:null},this.handleTerminate=e=>{this.setState({open:!0,session:e})},this.handleTerminateAllOther=()=>{this.setState({openAll:!0})},this.handleCloseConfirmation=()=>{this.setState({open:!1,session:null})},this.handleDoneConfirmation=Object(i.a)(s.a.mark((function e(){var a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.sessions,n=t.state.session){e.next=4;break}return e.abrupt("return");case 4:return t.setState({open:!1,session:null}),e.next=7,x.a.send({"@type":"terminateSession",session_id:n.id});case 7:a.sessions=a.sessions.filter(e=>e.id!==n.id),t.forceUpdate();case 9:case"end":return e.stop()}}),e)}))),this.handleCloseAllConfirmation=()=>{this.setState({openAll:!1})},this.handleDoneAllConfirmation=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.props.sessions,t.setState({openAll:!1}),e.next=4,x.a.send({"@type":"terminateAllOtherSessions"});case 4:a.sessions=a.sessions.filter(e=>!e.is_current),t.forceUpdate();case 6:case"end":return e.stop()}}),e)})))}render(){var e=this.props,t=e.t,a=e.sessions,n=e.onClose,s=this.state,i=s.open,r=s.openAll,l=a.sessions.find(e=>e.is_current),c=a.sessions.filter(e=>!e.is_current);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:n},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("SessionsTitle")))),o.a.createElement("div",{className:"sidebar-page-content"},Boolean(l)&&o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("CurrentSession")),o.a.createElement(pi,{session:l,onTerminate:this.handleTerminate}),c.length>0&&o.a.createElement(be.a,{className:"settings-list-item",button:!0,disableRipple:!0,onClick:this.handleTerminateAllOther},o.a.createElement(Ee.a,null,o.a.createElement(hi,{color:"secondary"})),o.a.createElement(Se.a,{primaryTypographyProps:{color:"secondary"},primary:t("TerminateAllSessions")}))),c.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"sidebar-page-section-divider"}),o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(Un,null,t("OtherSessions")),c.map(e=>o.a.createElement(pi,{key:e.id,session:e,onTerminate:this.handleTerminate}))))),o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:i,onClose:this.handleCloseConfirmation,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,{style:{whiteSpace:"pre-wrap"}},t("TerminateSessionText"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCloseConfirmation,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDoneConfirmation,color:"primary"},t("Ok")))),o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:r,onClose:this.handleCloseAllConfirmation,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,{style:{whiteSpace:"pre-wrap"}},t("AreYouSureSessions"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCloseAllConfirmation,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleDoneAllConfirmation,color:"primary"},t("Ok")))))}}var mi=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(ui),fi=a(230),gi=Object(T.a)(o.a.createElement("path",{d:"M18,1 C20.6887547,1 22.8818181,3.12230671 22.9953805,5.78311038 L23,6 L23,9 C23,9.55228475 22.5522847,10 22,10 C21.4871642,10 21.0644928,9.61395981 21.0067277,9.11662113 L21,9 L21,6 C21,4.34314575 19.6568542,3 18,3 C16.4023191,3 15.0963391,4.24891996 15.0050927,5.82372721 L15,6 L15,8 C16.6568542,8 18,9.34314575 18,11 L18,19 C18,20.6568542 16.6568542,22 15,22 L5,22 C3.34314575,22 2,20.6568542 2,19 L2,11 C2,9.34314575 3.34314575,8 5,8 L13,8 L13,6 C13,3.3112453 15.1223067,1.11818189 17.7831104,1.00461951 L18,1 Z M15,10 L5,10 C4.44771525,10 4,10.4477153 4,11 L4,19 C4,19.5522847 4.44771525,20 5,20 L15,20 C15.5522847,20 16,19.5522847 16,19 L16,11 C16,10.4477153 15.5522847,10 15,10 Z M10,13.5 C10.8284271,13.5 11.5,14.1715729 11.5,15 C11.5,15.8284271 10.8284271,16.5 10,16.5 C9.17157288,16.5 8.5,15.8284271 8.5,15 C8.5,14.1715729 9.17157288,13.5 10,13.5 Z"}),"Unblock"),Ci=(a(547),o.a.memo(({userId:e,onClick:t,onUnblock:a})=>{var n=o.a.useState(!1),s=Object(L.a)(n,2),i=s[0],r=s[1],l=o.a.useState(0),c=Object(L.a)(l,2),h=c[0],d=c[1],p=o.a.useState(0),u=Object(L.a)(p,2),m=u[0],f=u[1],g=Object(fi.a)().t,C=()=>{r(!1),f(0),d(0)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{className:"settings-list-item",button:!0,onClick:()=>{t(e)},onContextMenu:e=>{if(e&&(e.preventDefault(),e.stopPropagation()),i)r(!1);else{var t=e.clientX,a=e.clientY;r(!0),f(t),d(a)}}},o.a.createElement(Ie.a,{userId:e})),o.a.createElement(Je.a,{open:i,onClose:C,anchorReference:"anchorPosition",anchorPosition:{top:h,left:m},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},o.a.createElement(Ke.a,{onClick:()=>{C(),a(e)}},o.a.createElement(Ee.a,null,o.a.createElement(gi,null)),o.a.createElement(Se.a,{primary:g("Unblock")})))))}));class vi extends o.a.Component{constructor(...e){super(...e),this.handleUnblock=function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"unblockUser",user_id:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}componentDidMount(){this.loadContent()}loadContent(){var e=this.props.users,t=U.a.getStore();Object(G.J)(t,e.user_ids)}render(){var e=this.props,t=e.onClose,a=e.users,n=e.t;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:t},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},n("BlockedUsers")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},a.user_ids.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement(Un,{multiline:!0},n("BlockedUsersInfo")),a.user_ids.map(e=>o.a.createElement(Ci,{key:e,userId:e,onClick:re.k,onUnblock:this.handleUnblock}))):o.a.createElement(Un,null,n("NoBlocked")))))}}var bi=Object(_.a)()(vi),Ei=Object(T.a)(o.a.createElement("g",{transform:"translate(0.000000, -2.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M18,2 C20.209139,2 22,3.790861 22,6 L22,6 L22,8 C22,8.55228475 21.5522847,9 21,9 C20.4477153,9 20,8.55228475 20,8 L20,8 L20,6 C20,4.8954305 19.1045695,4 18,4 L18,4 L4,4 C2.8954305,4 2,4.8954305 2,6 L2,6 L2,14 C2,15.1045695 2.8954305,16 4,16 L4,16 L14,16 C14.5522847,16 15,16.4477153 15,17 C15,17.5522847 14.5522847,18 14,18 L14,18 L12,18 L12,20 L14,20 C14.5128358,20 14.9355072,20.3860402 14.9932723,20.8833789 L15,21 C15,21.5522847 14.5522847,22 14,22 L14,22 L8,22 C7.44771525,22 7,21.5522847 7,21 C7,20.4477153 7.44771525,20 8,20 L8,20 L10,20 L10,18 L4,18 C1.85780461,18 0.108921124,16.3160315 0.00489530723,14.1996403 L0,14 L0,6 C0,3.790861 1.790861,2 4,2 L4,2 Z M22,11 C23.1045695,11 24,11.8954305 24,13 L24,20 C24,21.1045695 23.1045695,22 22,22 L19,22 C17.8954305,22 17,21.1045695 17,20 L17,13 C17,11.8954305 17.8954305,11 19,11 L22,11 Z M22,13 L19,13 L19,20 L22,20 L22,13 Z"})),"Device"),Si=Object(T.a)(o.a.createElement("g",{transform:"translate(-1.000000, -3.000000)",fillRule:"nonzero"},o.a.createElement("path",{d:"M9,13 C12.3229116,13 14.7530244,13.8337117 16.2223821,15.5699359 C16.724477,16.1632234 17,16.915291 17,17.6925226 L17,18.5 C17,19.8807119 15.8807119,21 14.5,21 L3.5,21 C2.11928813,21 1,19.8807119 1,18.5 L1,17.6925204 C1,16.9152876 1.2755246,16.1632192 1.77762117,15.569932 C3.24697824,13.8337108 5.67709024,13 9,13 Z M9,15 C6.21130036,15 4.33538166,15.6435809 3.30428673,16.861943 C3.10781409,17.0940989 3,17.3883868 3,17.6925212 L3,18.5 C3,18.7761424 3.22385763,19 3.5,19 L14.5,19 C14.7761424,19 15,18.7761424 15,18.5 L15,17.6925226 C15,17.3883883 14.8921864,17.0941004 14.6957148,16.8619448 C13.6646202,15.6435815 11.788701,15 9,15 Z M16,10 L22,10 C22.5522847,10 23,10.4477153 23,11 C23,11.5128358 22.6139598,11.9355072 22.1166211,11.9932723 L22,12 L16,12 C15.4477153,12 15,11.5522847 15,11 C15,10.4871642 15.3860402,10.0644928 15.8833789,10.0067277 L16,10 L22,10 L16,10 Z M9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 Z M9,5 C7.8954305,5 7,5.8954305 7,7 C7,8.1045695 7.8954305,9 9,9 C10.1045695,9 11,8.1045695 11,7 C11,5.8954305 10.1045695,5 9,5 Z"})),"RemoveMember");a(548);class yi extends o.a.Component{constructor(...e){super(...e),this.state={sessions:null,users:null,openBlockedUsers:!1,openActiveSessions:!1},this.onUpdateUserFullInfo=e=>{var t=e.user_id,a=e.user_full_info,n=this.state.users;if(n){var s=n.total_count,i=n.user_ids,r=a.is_blocked;r!==(-1!==i.indexOf(t))&&(r?this.setState({users:Object(Ze.a)(Object(Ze.a)({},n),{},{total_count:s+1,user_ids:[t,...i]})}):this.setState({users:Object(Ze.a)(Object(Ze.a)({},n),{},{total_count:s-1,user_ids:i.filter(e=>e!==t)})}))}},this.openActiveSessions=()=>{this.state.sessions&&this.setState({openActiveSessions:!0})},this.closeActiveSessions=()=>{this.setState({openActiveSessions:!1})},this.openBlockedUsers=()=>{this.state.users&&this.setState({openBlockedUsers:!0})},this.closeBlockedUsers=()=>{this.setState({openBlockedUsers:!1})}}componentDidMount(){this.loadContent(),H.a.on("updateUserFullInfo",this.onUpdateUserFullInfo)}componentWillUnmount(){H.a.off("updateUserFullInfo",this.onUpdateUserFullInfo)}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:x.a.send({"@type":"getActiveSessions"}).then(t=>e.setState({sessions:t})),x.a.send({"@type":"getBlockedUsers",offset:0,limit:100}).then(t=>e.setState({users:t}));case 2:case"end":return t.stop()}}),t)})))()}render(){var e=this.props,t=e.t,a=e.onClose,n=this.state,s=n.openBlockedUsers,i=n.users,r=n.openActiveSessions,l=n.sessions,c=l&&l.sessions.length>0?1===l.sessions.length?"1 session":"".concat(l.sessions.length," sessions"):"1 session",h=i&&i.total_count>0?1===i.total_count?"1 user":"".concat(i.total_count," users"):"no users";return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:a},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("PrivacySettings")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"sidebar-page-section"},o.a.createElement(be.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:this.openBlockedUsers},o.a.createElement(Ee.a,{className:"settings-list-item-icon"},o.a.createElement(Si,null)),o.a.createElement(Se.a,{id:"label-2",className:"settings-list-item-text",primary:t("BlockedUsers"),secondary:h})),o.a.createElement(be.a,{className:"settings-list-item2",role:void 0,button:!0,onClick:this.openActiveSessions},o.a.createElement(Ee.a,{className:"settings-list-item-icon"},o.a.createElement(Ei,null)),o.a.createElement(Se.a,{id:"label-2",className:"settings-list-item-text",primary:t("SessionsTitle"),secondary:c})))),o.a.createElement(Ln,{open:s,onClose:this.closeBlockedUsers},o.a.createElement(bi,{users:i})),o.a.createElement(Ln,{open:r,onClose:this.closeActiveSessions},o.a.createElement(mi,{sessions:l})))}}var Mi=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(yi);a(549);class Ii extends o.a.Component{constructor(e){super(e),this.onUpdateChatPhoto=e=>{var t=this.props.chatId,a=e.chat_id,n=e.photo;if(a===t&&n){var s=U.a.get();Object(G.w)(s,t,!0)}},this.openEditProfile=()=>{this.setState({openEditProfile:!0})},this.closeEditProfile=()=>{this.setState({openEditProfile:!1})},this.openGeneral=()=>{this.setState({openGeneral:!0})},this.closeGeneral=()=>{this.setState({openGeneral:!1})},this.openNotifications=()=>{this.setState({openNotifications:!0})},this.closeNotifications=()=>{this.setState({openNotifications:!1})},this.openPrivacySecurity=()=>{this.setState({openPrivacySecurity:!0})},this.closePrivacySecurity=()=>{this.setState({openPrivacySecurity:!1})},this.openLanguage=()=>{this.setState({openLanguage:!0})},this.closeLanguage=()=>{this.setState({openLanguage:!1})},this.openFilters=()=>{this.setState({openFilters:!0})},this.closeFilters=()=>{this.setState({openFilters:!1})},this.handleCloseSettings=()=>{x.a.clientUpdate({"@type":"clientUpdateSettings",open:!1})},this.state={openEditProfile:!1,openGeneral:!1,openNotifications:!1,openPrivacySecurity:!1,openLanguage:!1,openFilters:!1}}componentDidMount(){this.loadContent(),Z.a.on("updateChatPhoto",this.onUpdateChatPhoto)}componentWillUnmount(){Z.a.off("updateChatPhoto",this.onUpdateChatPhoto)}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.props.chatId,n=U.a.getStore(),Object(G.w)(n,a,!0),t.next=5,x.a.send({"@type":"getUserFullInfo",user_id:H.a.getMyId()});case 5:i=t.sent,H.a.setFullInfo(H.a.getMyId(),i);case 7:case"end":return t.stop()}}),t)})))()}render(){var e=this.props,t=e.chatId,a=e.popup,n=this.state,s=n.openEditProfile,i=n.openGeneral,r=n.openNotifications,l=n.openPrivacySecurity,c=n.openLanguage,h=n.openFilters;return o.a.createElement(o.a.Fragment,null,o.a.createElement(zn,{chatId:t,popup:a,onClose:this.handleCloseSettings,onEditProfile:this.openEditProfile,onGeneral:this.openGeneral,onNotifications:this.openNotifications,onPrivacySecurity:this.openPrivacySecurity,onLanguage:this.openLanguage,onFilters:this.openFilters}),o.a.createElement(Ln,{open:s,onClose:this.closeEditProfile},o.a.createElement($n,{chatId:t})),o.a.createElement(Ln,{open:i,onClose:this.closeGeneral},o.a.createElement(ii,{chatId:t})),o.a.createElement(Ln,{open:r,onClose:this.closeNotifications},o.a.createElement(ci,{chatId:t})),o.a.createElement(Ln,{open:l,onClose:this.closePrivacySecurity},o.a.createElement(Mi,null)),o.a.createElement(Ln,{open:h,onClose:this.closeFilters},o.a.createElement(_s,null)),o.a.createElement(Ln,{open:c,onClose:this.closeLanguage},o.a.createElement(oi,null)))}}var Ui=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(Ii);a(451);class ki extends o.a.Component{shouldComponentUpdate(e,t,a){var n=this.props,s=n.userId,i=n.style;return e.userId!==s||e.style.top!==i.top}render(){var e=this.props,t=e.userId,a=e.onClick,n=e.style;return o.a.createElement(be.a,{className:"user-list-item",onClick:()=>a(t),button:!0,style:n},o.a.createElement(Ie.a,{userId:t}))}}class xi extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleScroll=e=>{this.handleDebounceScroll(),this.handleThrottleScroll()},this.loadRenderIdsContent=()=>{var e=this.state,t=e.items,a=e.searchItems,n=a||t,s=(n===a?this.searchListRef:this.listRef).current;if(s){var i=s.getListRenderIds();if(i.size>0){var r=[];[...i.keys()].forEach(e=>{r.push(n.user_ids[e])});var o=U.a.getStore();Object(G.J)(o,r)}}},this.handleOpenUser=e=>{Object(re.k)(e,!1),this.handleClose()},this.renderItem=({index:e,style:t},a)=>{var n=a.user_ids[e];return o.a.createElement(ki,{key:n,userId:n,onClick:()=>this.handleOpenUser(n),style:t})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null}),e.abrupt("return");case 4:return e.next=6,x.a.send({"@type":"searchContacts",query:n,limit:1e3});case 6:(i=e.sent).user_ids=i.user_ids.sort((e,t)=>Object(B.c)(e).localeCompare(Object(B.c)(t))),r=U.a.getStore(),Object(G.J)(r,i.user_ids.slice(0,20)),t.setState({searchItems:i});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateContacts",open:!1})},this.searchInputRef=o.a.createRef(),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.state={items:null,searchItems:null},this.handleDebounceScroll=Object(M.f)(this.handleDebounceScroll,100,!1),this.handleThrottleScroll=Object(M.D)(this.handleThrottleScroll,200,!1)}componentDidMount(){var e=this.searchInputRef.current;e&&setTimeout(()=>e.focus(),50),this.loadContent()}handleDebounceScroll(){this.loadRenderIdsContent()}handleThrottleScroll(){this.loadRenderIdsContent()}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=en.contacts){t.next=7;break}return t.next=4,x.a.send({"@type":"getContacts"});case 4:(a=t.sent).user_ids=a.user_ids.sort((e,t)=>Object(B.c)(e).localeCompare(Object(B.c)(t))),en.contacts=a;case 7:n=U.a.getStore(),Object(G.J)(n,a.user_ids.slice(0,20)),e.setState({items:a});case 10:case"end":return t.stop()}}),t)})))()}render(){var e=this.props.popup,t=this.state,a=t.items,n=t.searchItems,s=e?{minHeight:800}:null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:this.handleClose},e?o.a.createElement(g.a,null):o.a.createElement(je,null)),o.a.createElement(sn,{inputRef:this.searchInputRef,onChange:this.handleSearch})),o.a.createElement("div",{className:"contacts-content",style:s},a&&o.a.createElement(Ha,{ref:this.listRef,className:"contacts-list",source:a.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,a),onScroll:this.handleScroll}),n&&o.a.createElement(Ha,{ref:this.searchListRef,className:"contacts-list contacts-search-list",source:n.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,n),onScroll:this.handleScroll})))}}var wi=xi,Oi=a(73);a(550);class Li extends o.a.Component{constructor(e){super(e),this.onClientUpdatePageWidth=e=>{var t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onClientUpdateNewContentAvailable=()=>{this.setState({newContentAvailable:!0})},this.handleUpdate=()=>{this.handled||(this.handled=!0,setTimeout(()=>{window.location.reload()},250))};var t=na.a.isSmallWidth;this.state={newContentAvailable:!1,isSmallWidth:t}}componentDidMount(){na.a.on("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth)}componentWillUnmount(){na.a.off("clientUpdateNewContentAvailable",this.onClientUpdateNewContentAvailable),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth)}render(){var e=this.state,t=e.newContentAvailable,a=e.isSmallWidth,n=this.props.t;return t?o.a.createElement(N.a,{className:"update-button",variant:"contained",color:"primary",onClick:this.handleUpdate},a?o.a.createElement(Oi.a,null):n("Update")):null}}var _i=Object(_.a)()(Li);a(452),a(453);class Ni extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewChannel",open:!1})},this.handleDone=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.error,n=t.state,i=n.defaultPhoto,r=n.defaultPhotoFile,o=t.titleRef.current.value.trim()){e.next=6;break}return t.setState({error:!0}),e.abrupt("return");case 6:return a&&t.setState({error:!1}),t.handleClose(),l=t.descriptionRef.current.value,e.next=11,x.a.send({"@type":"createNewSupergroupChat",title:o,description:l,is_channel:!0,location:null});case 11:c=e.sent,r?x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileId",id:r.id}}):i&&x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileBlob",name:"photo.jpg",data:i}}),Object(re.i)(c.id);case 14:case"end":return e.stop()}}),e)}))),this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({defaultPhoto:a,defaultPhotoURL:n}),e.next=3,x.a.send({"@type":"uploadFile",file:{"@type":"inputFileBlob",name:"photo.jpg",data:a},file_type:{"@type":"fileTypePhoto"},priority:u.Gb});case 3:i=e.sent,t.setState({defaultPhotoFile:i});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.titleRef=o.a.createRef(),this.descriptionRef=o.a.createRef(),this.state={error:!1,defaultPhoto:null,defaultPhotoURL:null,defaultPhotoFile:null}}render(){var e=this.props,t=e.popup,a=e.t,n=this.state.error;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:this.handleClose},t?o.a.createElement(g.a,null):o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("NewChannel")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"new-chat-content"},o.a.createElement(Xn,{onChoose:this.handleChoosePhoto}),o.a.createElement("div",{className:"new-chat-title"},o.a.createElement(Wn.a,{inputRef:this.titleRef,error:n,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:a("EnterChannelName"),defaultValue:""}),o.a.createElement(Wn.a,{inputRef:this.descriptionRef,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:a("DescriptionOptionalPlaceholder"),defaultValue:""}),o.a.createElement("div",{className:"edit-profile-hint"},a("DescriptionInfo"))))),o.a.createElement("div",{className:"new-chat-bottom-button",onClick:this.handleDone},o.a.createElement(je,null)))}}var Pi=Object(_.a)()(Ni);a(551);class ji extends o.a.Component{constructor(e){super(e),this.divRef=o.a.createRef()}getOffset(){var e=this.divRef.current;return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}setStyleCSSText(e){var t=this.divRef.current;t&&(t.style.cssText=e)}render(){var e=this.props,t=e.userId,a=e.selected,n=e.onClick;return o.a.createElement("div",{ref:this.divRef,className:c()("chip",{"item-selected":a}),onClick:n},o.a.createElement(yn.a,{userId:t,small:!0}),o.a.createElement("div",{className:"chip-delete"},o.a.createElement(g.a,{className:"chip-delete-icon"})),o.a.createElement("div",{className:"chip-text"},Object(B.e)(t)))}}var Di=ji;class Ri extends o.a.Component{shouldComponentUpdate(e,t,a){var n=this.props,s=n.userId,i=n.selected,r=n.style;return e.userId!==s||(e.selected!==i||e.style.top!==r.top)}render(){var e=this.props,t=e.userId,a=e.selected,n=e.onClick,s=e.style;return o.a.createElement(be.a,{className:"user-list-item",onClick:()=>n(t),button:!0,style:s},o.a.createElement(Te.a,{className:"user-list-item-checkbox",checked:a,color:"primary"}),o.a.createElement(Ie.a,{userId:t}))}}class Ti extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleScroll=e=>{this.handleDebounceScroll(),this.handleThrottleScroll()},this.loadRenderIdsContent=()=>{var e=this.state,t=e.items,a=e.searchItems,n=a||t,s=(n===a?this.searchListRef:this.listRef).current;if(s){var i=s.getListRenderIds();if(i.size>0){var r=[];[...i.keys()].forEach(e=>{r.push(n.user_ids[e])});var o=U.a.getStore();Object(G.J)(o,r)}}},this.handleOpenUser=e=>{var t,a=this.state,n=a.selectedItems,s=a.focusedItem,i=n.map,r=n.array,o=new Map(i),l=null,c=!1;i.has(e)?(o.delete(e),t=r.filter(t=>t!==e),l=s===e?null:s,c=!0):(o.set(e,e),t=r.concat([e]),l=null);var h=this.searchInputRef.current;h.focus(),c||(h.innerText="",this.handleSearch(""));var d,p=this.wrapPanelRef.current,u=p.scrollHeight,m=p.offsetHeight,f=new Map,g=Object(hs.a)(this.itemsRef.keys());try{for(g.s();!(d=g.n()).done;){var C=d.value,v=this.itemsRef.get(C);if(v){var b=v.getOffset();f.set(C,b)}}}catch(y){g.e(y)}finally{g.f()}var E=p.style.cssText,S=p.scrollTop;c&&(p.style.cssText=null),this.setState({focusedItem:l,selectedItems:{array:t,map:o}},()=>{this.animatePanel(c,u,m,S,E),this.animateItems(f)})},this.renderItem=({index:e,style:t},a,n)=>{var s=a[e],i=n.has(s);return o.a.createElement(Ri,{key:s,userId:s,selected:i,onClick:()=>this.handleOpenUser(s),style:t})},this.handleSearch=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.trim()){e.next=4;break}return t.setState({searchItems:null,publicItems:null,focusedItem:null}),e.abrupt("return");case 4:return(i=[]).push(x.a.send({"@type":"searchContacts",query:n,limit:20})),i.push(x.a.send({"@type":"searchPublicChats",query:n})),e.next=9,Promise.all(i);case 9:r=e.sent,o=Object(L.a)(r,2),l=o[0],c=o[1],l.user_ids=l.user_ids.sort((e,t)=>Object(B.c)(e).localeCompare(Object(B.c)(t))),h={"@type":"users",user_ids:[]},c.chat_ids.reduce((e,t)=>{var a=Z.a.get(t);return a&&"chatTypePrivate"===a.type["@type"]&&e.push(a.type.user_id),e},h.user_ids),d=U.a.getStore(),Object(G.J)(d,l.user_ids),Object(G.J)(d,h.user_ids),t.setState({searchItems:l,publicItems:h,focusedItem:null});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!1})},this.handleSearchClose=e=>{var t=this.state,a=t.selectedItems,n=t.focusedItem;a&&(a.map.has(n)&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({focusedItem:null})))},this.handleBackspace=()=>{var e=this.state,t=e.selectedItems,a=e.focusedItem;if(t){var n=t.array,s=t.map;if(n&&n.length)if(s.has(a))this.handleOpenUser(a);else{var i=n[n.length-1];i&&this.setState({focusedItem:i})}}},this.titleRef=o.a.createRef(),this.searchInputRef=o.a.createRef(),this.listRef=o.a.createRef(),this.searchListRef=o.a.createRef(),this.wrapPanelRef=o.a.createRef(),this.itemsRef=new Map,this.state={items:null,searchItems:null,selectedItems:{array:[],map:new Map},focusedItem:null},this.handleDebounceScroll=Object(M.f)(this.handleDebounceScroll,100,!1),this.handleThrottleScroll=Object(M.D)(this.handleThrottleScroll,200,!1)}getUserIds(){return this.state.selectedItems.array}componentDidMount(){var e=this.searchInputRef.current;e&&setTimeout(()=>e.focus(),50),this.loadContent()}handleDebounceScroll(){this.loadRenderIdsContent()}handleThrottleScroll(){this.loadRenderIdsContent()}loadContent(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=en.contacts){t.next=7;break}return t.next=4,x.a.send({"@type":"getContacts"});case 4:(a=t.sent).user_ids=a.user_ids.sort((e,t)=>Object(B.c)(e).localeCompare(Object(B.c)(t))),en.contacts=a;case 7:n=U.a.getStore(),Object(G.J)(n,a.user_ids.slice(0,20)),e.setState({items:a});case 10:case"end":return t.stop()}}),t)})))()}animatePanel(e,t,a,n,s){var i=this.wrapPanelRef.current,r=i.scrollHeight,o=(i.offsetHeight,r<t);r>t?t<123?(i.style.cssText="max-height: ".concat(Math.min(t,123),"px;"),requestAnimationFrame(()=>{i.style.cssText="max-height: ".concat(Math.min(r,123),"px;"),setTimeout(()=>{this.searchInputRef.current.scrollIntoView({behavior:"auto"})},250)})):(i.style.cssText="max-height: ".concat(123,"px;"),this.searchInputRef.current.scrollIntoView({behavior:"smooth"})):o?r<123?(i.style.cssText="min-height: ".concat(Math.min(a,123),"px;"),requestAnimationFrame(()=>{i.style.cssText="min-height: ".concat(Math.min(r,123),"px;")})):(i.style.cssText="max-height: ".concat(123,"px;"),i.scrollTop=n):e?(i.style.cssText=s,i.scrollTop=n):this.searchInputRef.current.scrollIntoView({behavior:"smooth"})}animateItems(e){var t,a=new Map,n=Object(hs.a)(this.itemsRef.keys());try{for(n.s();!(t=n.n()).done;){var s=t.value,i=this.itemsRef.get(s);if(i){var r=i.getOffset(),o=e.has(s)?e.get(s):null;if(o){o.left<r.left&&a.set(i,{prevOffset:o,currentOffset:r});var l="transform: translate(".concat(o.left-r.left,"px, ").concat(o.top-r.top,"px)");i.setStyleCSSText(l)}}}}catch(c){n.e(c)}finally{n.f()}requestAnimationFrame(()=>{var e,t=Object(hs.a)(this.itemsRef.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value,s=this.itemsRef.get(n);if(s){var i="transition: transform 0.25s ease";if(a.has(s)){var r=a.get(s),o=r.prevOffset,l=r.currentOffset;i="transform: translate(".concat(o.left-l.left-o.width,"px, ").concat(o.top-l.top,"px);")+"transition: transform 0.1s ease;"}s.setStyleCSSText(i)}}}catch(c){t.e(c)}finally{t.f()}a.size&&setTimeout(()=>{var e,t=Object(hs.a)(a.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value,s=a.get(n).currentOffset,i="transform: translate(".concat(s.width,"px, 0);")+"transition: transform 0s ease;";n.setStyleCSSText(i)}}catch(c){t.e(c)}finally{t.f()}requestAnimationFrame(()=>{var e,t=Object(hs.a)(a.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.setStyleCSSText("transition: transform 0.15s ease")}}catch(c){t.e(c)}finally{t.f()}})},101)})}render(){var e=this.props,t=e.popup,a=e.t,n=this.state,s=n.items,i=n.searchItems,r=n.publicItems,l=n.selectedItems,c=n.focusedItem,h=t?{minHeight:800}:null;return this.itemsRef.clear(),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:this.handleClose},t?o.a.createElement(g.a,null):o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},a("GroupAddMembers")))),o.a.createElement("div",{ref:this.wrapPanelRef,className:"animated-wrap-panel"},l.array.map(e=>o.a.createElement(Di,{selected:c===e,ref:t=>{this.itemsRef.set(e,t)},key:e,userId:e,onClick:()=>this.handleOpenUser(e)})),o.a.createElement(sn,{inputRef:this.searchInputRef,hint:a("SendMessageTo"),onClose:this.handleSearchClose,onChange:this.handleSearch,onBackspace:this.handleBackspace})),o.a.createElement("div",{className:"contacts-border"}),o.a.createElement("div",{className:"contacts-content",style:h},s&&o.a.createElement(Ha,{ref:this.listRef,className:"contacts-list",source:s.user_ids,rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,s.user_ids,l.map),onScroll:this.handleScroll}),i&&r&&o.a.createElement(Ha,{ref:this.searchListRef,className:"contacts-list contacts-search-list",source:i.user_ids.concat(r.user_ids),rowHeight:72,overScanCount:20,renderItem:e=>this.renderItem(e,i.user_ids.concat(r.user_ids),l.map),onScroll:this.handleScroll})))}}var Fi=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(Ti);a(552);class Ai extends o.a.Component{shouldComponentUpdate(e,t,a){var n=this.props.userId;return e.userId!==n}render(){var e=this.props,t=e.userId,a=e.style;return o.a.createElement(be.a,{className:"user-list-item",button:!0,style:a},o.a.createElement(Ie.a,{userId:t}))}}class Bi extends o.a.Component{constructor(e){super(e),this.handleClose=()=>{var e=this.props.onClose;e&&e()},this.titleRef=o.a.createRef(),this.state={error:!1}}componentDidMount(){var e=this.props.userIds,t=U.a.getStore();Object(G.J)(t,e)}getTitle(){var e=this.state.error,t=this.titleRef.current.value.trim();return t?(e&&this.setState({error:!1}),t):(this.setState({error:!0}),t)}render(){var e=this.props,t=e.t,a=e.userIds,n=e.defaultPhotoURL,s=e.onChoosePhoto,i=this.state.error,r=a.map(e=>o.a.createElement(Ai,{key:e,userId:e})),l=1!==a.length?"".concat(a.length," members"):"".concat(a.length," member");return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header-master"},o.a.createElement(P.a,{className:"header-left-button",onClick:this.handleClose},o.a.createElement(je,null)),o.a.createElement("div",{className:"header-status grow cursor-pointer"},o.a.createElement("span",{className:"header-status-content"},t("NewGroup")))),o.a.createElement("div",{className:"sidebar-page-content"},o.a.createElement("div",{className:"new-chat-content"},o.a.createElement(Xn,{defaultURL:n,onChoose:s}),o.a.createElement("div",{className:"new-chat-title"},o.a.createElement(Wn.a,{inputRef:this.titleRef,error:i,className:"new-chat-input",variant:"outlined",fullWidth:!0,label:t("GroupName"),defaultValue:""})),o.a.createElement(Un,null,l),r)))}}var Vi=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(Bi);class Hi extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleDone=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.openParams){e.next=8;break}if((a=t.addParticipantsRef.current.getUserIds()).length){e.next=5;break}return e.abrupt("return");case 5:t.setState({openParams:!0,userIds:a}),e.next=19;break;case 8:if(n=t.state,i=n.userIds,r=n.defaultPhoto,o=n.defaultPhotoFile,l=t.newGroupParamsRef.current.getTitle()){e.next=12;break}return e.abrupt("return");case 12:return t.handleClose(),e.next=15,x.a.send({"@type":"createNewSupergroupChat",title:l,is_channel:!1,description:"",location:null});case 15:c=e.sent,o?x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileId",id:o.id}}):r&&x.a.send({"@type":"setChatPhoto",chat_id:c.id,photo:{"@type":"inputFileBlob",name:"photo.jpg",data:r}}),i.length>0&&x.a.send({"@type":"addChatMembers",chat_id:c.id,user_ids:i}),Object(re.i)(c.id);case 19:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateNewGroup",open:!1})},this.handleCloseParams=()=>{this.setState({openParams:!1,userIds:[]})},this.handleChoosePhoto=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({defaultPhoto:a,defaultPhotoURL:n}),e.next=3,x.a.send({"@type":"uploadFile",file:{"@type":"inputFileBlob",name:"photo.jpg",data:a},file_type:{"@type":"fileTypePhoto"},priority:u.Gb});case 3:i=e.sent,t.setState({defaultPhotoFile:i});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.addParticipantsRef=o.a.createRef(),this.newGroupParamsRef=o.a.createRef(),this.state={openParams:!1,userIds:[],defaultPhoto:null,defaultPhotoURL:null,defaultPhotoFile:null}}render(){var e=this.props.popup,t=this.state,a=t.openParams,n=t.userIds,s=t.defaultPhotoURL;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Fi,{ref:this.addParticipantsRef,popup:e,onClose:this.handleClose}),o.a.createElement(Ln,{open:a},o.a.createElement(Vi,{ref:this.newGroupParamsRef,defaultPhotoURL:s,userIds:n,onChoosePhoto:this.handleChoosePhoto,onClose:this.handleCloseParams})),o.a.createElement("div",{className:"new-chat-bottom-button",onClick:this.handleDone},o.a.createElement(je,null)))}}var zi=Object(_.a)()(Hi);class Wi extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateSearchChat=e=>{if(na.a.isSmallWidth){var t=e.chatId,a=e.query,n=this.state,s=n.openSearch,i=n.searchChatId,r=n.searchText;s&&t===i&&a===r||(this.query=a,this.setState({openSearch:!0,searchChatId:t,searchText:null}))}},this.handleDialogEnter=()=>{if(this.query){var e=this.headerRef.current;e&&e.setInitQuery(this.query),this.query=null}},this.onClientUpdateSettings=e=>{if(na.a.isSmallWidth){var t=e.open,a=e.chatId;this.setState({openSettings:t,meChatId:a})}},this.onClientUpdateContacts=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openContacts:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewGroup=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewGroup:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewChannel=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewChannel:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleClose=()=>{this.setState({openSettings:!1,openContacts:!1,openNewGroup:!1,openNewChannel:!1,openSearch:!1})},this.handleSearch=e=>{this.setState({openSearch:e,searchChatId:0,searchText:null})},this.handleSearchTextChange=e=>{this.setState({searchText:e,query:null})},this.handleSelectMessage=(e,t,a)=>{Object(re.i)(e,t),this.handleCloseSearch()},this.handleCloseSearch=()=>{this.setState({openSearch:!1,searchChatId:0,searchText:null})},this.headerRef=o.a.createRef(),this.state={openSearch:!1,openSettings:!1,openContacts:!1,openNewGroup:!1,openNewChannel:!1}}shouldComponentUpdate(e,t,a){var n=this.state,s=n.openSearch,i=n.searchText,r=n.openSettings,o=n.openContacts,l=n.openNewGroup,c=n.openNewChannel;return t.openSearch!==s||(t.searchText!==i||(t.openSettings!==r||(t.openContacts!==o||(t.openNewGroup!==l||t.openNewChannel!==c))))}componentDidMount(){na.a.on("clientUpdateSearchChat",this.onClientUpdateSearchChat),Z.a.on("clientUpdateSettings",this.onClientUpdateSettings),Z.a.on("clientUpdateContacts",this.onClientUpdateContacts),Z.a.on("clientUpdateNewGroup",this.onClientUpdateNewGroup),Z.a.on("clientUpdateNewChannel",this.onClientUpdateNewChannel)}componentWillUnmount(){na.a.off("clientUpdateSearchChat",this.onClientUpdateSearchChat),Z.a.off("clientUpdateSettings",this.onClientUpdateSettings),Z.a.off("clientUpdateContacts",this.onClientUpdateContacts),Z.a.off("clientUpdateNewGroup",this.onClientUpdateNewGroup),Z.a.off("clientUpdateNewChannel",this.onClientUpdateNewChannel)}render(){var e=this.state,t=e.meChatId,a=e.searchChatId,n=e.searchText,s=e.openSearch,i=e.openContacts,r=e.openSettings,l=e.openNewGroup,c=e.openNewChannel;return s||i||r||l||c?o.a.createElement(j.a,{open:!0,transitionDuration:0,onClose:this.handleClose,classes:{root:"chat-info-dialog-root",container:"chat-info-dialog-container",paper:"chat-info-dialog-paper"},onEnter:this.handleDialogEnter},r&&o.a.createElement(Ui,{chatId:t,popup:!0}),i&&o.a.createElement(wi,{popup:!0}),l&&o.a.createElement(zi,{popup:!0}),c&&o.a.createElement(Pi,{popup:!0}),s&&o.a.createElement(o.a.Fragment,null,o.a.createElement(on,{ref:this.headerRef,openSearch:!0,timeout:!1,onClick:this.handleHeaderClick,onSearch:this.handleSearch,onSearchTextChange:this.handleSearchTextChange,popup:!0}),o.a.createElement("div",{className:"search-content"},o.a.createElement(xn,{chatId:a,text:n,onSelectMessage:this.handleSelectMessage,onClose:this.handleCloseSearch})))):null}}var Gi=Wi;function Zi(){var e=Z.a.chatList.get("chatListArchive"),t=[],a=[];if(e){var n,s=Object(hs.a)(e.keys());try{for(s.s();!(n=s.n()).done;){var i=n.value,r=Z.a.get(i);if(r){var o=Object(V.q)(i,{"@type":"chatListArchive"});"0"!==o&&t.push(r),a.push({order:o,id:i,title:r.title})}}}catch(l){s.e(l)}finally{s.f()}}return t.sort((e,t)=>Object(M.A)(Object(V.q)(t,{"@type":"chatListArchive"}),Object(V.q)(e,{"@type":"chatListArchive"}))).map(e=>e.title).join(", ")}var qi=a(259),Ki=(a(553),{enter:qi.duration.enteringScreen,exit:qi.duration.leavingScreen});class Ji extends r.Component{constructor(e){var t;super(e),t=this,this.onUpdateChatFilters=e=>{this.handleSaveCache()},this.onClientUpdatePageWidth=e=>{if(e.isSmallWidth){var t=this.state,a=t.openSettings,n=t.openContacts,s=t.openSearch,i=t.openNewGroup,r=t.openNewChannel;(a||n||s||i||r)&&this.setState({openContacts:!1,openSettings:!1,openSearch:!1,openNewGroup:!1,openNewChannel:!1,timeout:0},()=>{this.setState({timeout:Ki})})}},this.onUpdateChatOrder=e=>{var t=this.state.showArchive,a=this.dialogListRef.current;if(!a||!a.loading){var n=this.archiveListRef.current;if(!n||!n.loading){var s=Z.a.chatList.get("chatListArchive"),i=s&&s.size>0;this.setState({showArchive:i,archiveTitle:Zi()},()=>{if(!t&&i){var e=this.dialogListRef.current;if(e.listRef){var a=e.listRef.current;a&&a.scrollTop>0&&(e.scrollTop+=68)}}}),t&&!i&&x.a.clientUpdate({"@type":"clientUpdateCloseArchive"})}}},this.onClientUpdateContacts=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openContacts:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateSettings=e=>{if(!na.a.isSmallWidth){var t=e.open,a=e.chatId;this.setState({openSettings:t,meChatId:a})}},this.onClientUpdateNewGroup=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewGroup:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateNewChannel=function(){var e=Object(i.a)(s.a.mark((function e(a){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!na.a.isSmallWidth){e.next=3;break}return e.abrupt("return");case 3:n=a.open,t.setState({openNewChannel:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateArchive=e=>{var t=e.open;this.setState({openArchive:t})},this.onClientUpdateThemeChange=e=>{this.forceUpdate()},this.onClientUpdateSearchChat=e=>{if(!na.a.isSmallWidth){var t=e.chatId,a=e.query,n=this.state,s=n.openSearch,i=n.searchChatId,r=n.searchText;if(!s||t!==i||a!==r){var o=this.dialogsHeaderRef.current;this.setState({openSearch:!0,searchChatId:t,searchText:null,openArchive:!1,openContacts:!1,openSettings:!1,openNewGroup:!1,openNewChannel:!1},()=>{o&&o.setInitQuery(a)})}}},this.handleHeaderClick=()=>{this.state.openArchive?x.a.clientUpdate({"@type":"clientUpdateCloseArchive"}):this.dialogListRef.current.scrollToTop()},this.handleSearch=e=>{this.setState({openSearch:e,searchChatId:0,searchText:null})},this.handleSelectMessage=(e,t,a)=>{Object(re.i)(e,t);var n=a?this.state.searchChatId:0,s=a?this.state.searchText:null;this.setState({openSearch:a,searchChatId:n,searchText:s})},this.handleCloseSearch=()=>{this.setState({openSearch:!1,searchChatId:0,searchText:null})},this.handleSearchTextChange=e=>{this.setState({searchText:e,query:null})},this.handleSaveCache=()=>{this.saveCache()},this.handleCloseArchive=()=>{this.setState({openArchive:!1})},this.handleCloseContacts=()=>{this.setState({openContacts:!1})},this.handleCloseSettings=()=>{this.setState({openSettings:!1})},this.handleCloseNewGroup=()=>{this.setState({openNewGroup:!1})},this.handleCloseNewChannel=()=>{this.setState({openNewChannel:!1})},this.dialogListRef=o.a.createRef(),this.archiveListRef=o.a.createRef(),this.dialogsHeaderRef=o.a.createRef(),this.state={cache:null,showArchive:!1,archiveTitle:null,mainItems:[],archiveItems:[],timeout:Ki,openSearch:!1,openArchive:!1,openContacts:!1,openSettings:!1,openNewGroup:!1,openNewChannel:!1,searchChatId:0,searchText:null,query:null}}shouldComponentUpdate(e,t){var a=this.state,n=a.cache,s=a.showArchive,i=a.archiveTitle,r=a.mainItems,o=a.archiveItems,l=a.openSearch,c=a.openArchive,h=a.openSettings,d=a.openContacts,p=a.openNewGroup,u=a.openNewChannel,m=a.searchChatId,f=a.searchText;return t.cache!==n||(t.showArchive!==s||(t.archiveTitle!==i||(t.archiveItems!==o||(t.mainItems!==r||(t.openSearch!==l||(t.openArchive!==c||(t.openSettings!==h||(t.openContacts!==d||(t.openNewGroup!==p||(t.openNewChannel!==u||(t.searchChatId!==m||t.searchText!==f)))))))))))}componentDidMount(){this.loadCache(),na.a.on("clientUpdateSearchChat",this.onClientUpdateSearchChat),na.a.on("clientUpdateThemeChange",this.onClientUpdateThemeChange),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),Z.a.on("updateChatDraftMessage",this.onUpdateChatOrder),Z.a.on("updateChatLastMessage",this.onUpdateChatOrder),Z.a.on("updateChatPosition",this.onUpdateChatOrder),Z.a.on("clientUpdateSettings",this.onClientUpdateSettings),Z.a.on("clientUpdateArchive",this.onClientUpdateArchive),Z.a.on("clientUpdateContacts",this.onClientUpdateContacts),Z.a.on("clientUpdateNewGroup",this.onClientUpdateNewGroup),Z.a.on("clientUpdateNewChannel",this.onClientUpdateNewChannel),ma.on("updateChatFilters",this.onUpdateChatFilters)}componentWillUnmount(){na.a.off("clientUpdateSearchChat",this.onClientUpdateSearchChat),na.a.off("clientUpdateThemeChange",this.onClientUpdateThemeChange),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),Z.a.off("updateChatDraftMessage",this.onUpdateChatOrder),Z.a.off("updateChatLastMessage",this.onUpdateChatOrder),Z.a.off("updateChatPosition",this.onUpdateChatOrder),Z.a.off("clientUpdateSettings",this.onClientUpdateSettings),Z.a.off("clientUpdateArchive",this.onClientUpdateArchive),Z.a.off("clientUpdateContacts",this.onClientUpdateContacts),Z.a.off("clientUpdateNewGroup",this.onClientUpdateNewGroup),Z.a.off("clientUpdateNewChannel",this.onClientUpdateNewChannel),ma.off("updateChatFilters",this.onUpdateChatFilters)}loadCache(){var e=this;return Object(i.a)(s.a.mark((function t(){var a,n,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,en.load();case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0={};case 5:a=t.t0,n=a.chats,i=a.archiveChats,ma.filters=ma.filters||en.filters,e.setState({cache:a,showArchive:i&&i.length>0,archiveTitle:Zi()}),e.loadChatContents((n||[]).map(e=>e.id)),x.a.clientUpdate({"@type":"clientUpdateCacheLoaded"});case 11:case"end":return t.stop()}}),t)})))()}saveCache(){return Object(i.a)(s.a.mark((function e(){var t,a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=[]).push(x.a.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:0,limit:u.f})),t.push(x.a.send({"@type":"getChats",chat_list:{"@type":"chatListArchive"},offset_order:"9223372036854775807",offset_chat_id:0,limit:u.f})),e.next=5,Promise.all(t);case 5:a=e.sent,n=Object(L.a)(a,2),i=n[0],r=n[1],o=ma.filters,en.save(o,i.chat_ids,r.chat_ids);case 11:case"end":return e.stop()}}),e)})))()}loadChatContents(e){var t=U.a.getStore();Object(G.x)(t,e)}render(){var e=this.state,t=e.cache,a=e.showArchive,n=e.archiveTitle,s=e.mainItems,i=e.archiveItems,r=e.meChatId,l=e.openSettings,c=e.openContacts,h=e.openArchive,d=e.openSearch,p=e.openNewGroup,u=e.openNewChannel,m=e.timeout,f=e.searchChatId,g=e.searchText,C=t?t.chats||[]:null,v=t?t.archiveChats||[]:null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"dialogs"},o.a.createElement("div",{className:"sidebar-page"},o.a.createElement(on,{ref:this.dialogsHeaderRef,openSearch:d,timeout:0!==m,onClick:this.handleHeaderClick,onSearch:this.handleSearch,onSearchTextChange:this.handleSearchTextChange}),o.a.createElement("div",{className:"dialogs-content"},o.a.createElement("div",{className:"dialogs-content-internal"},o.a.createElement(hn,null),o.a.createElement(un,{type:"chatListMain",ref:this.dialogListRef,cacheItems:C,items:s,showArchive:a,archiveTitle:n,open:!0,onSaveCache:this.handleSaveCache})),o.a.createElement(ra.a,{classNames:"search",timeout:m,in:d,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement(xn,{chatId:f,text:g,onSelectMessage:this.handleSelectMessage,onClose:this.handleCloseSearch}))),o.a.createElement(_i,null)),o.a.createElement(Ln,{open:h,timeout:m,onClose:this.handleCloseArchive},o.a.createElement(fn,{innerListRef:this.archiveListRef,items:i,cacheItems:v})),o.a.createElement(Ln,{open:c,timeout:m,onClose:this.handleCloseContacts},o.a.createElement(wi,null)),o.a.createElement(Ln,{open:l,timeout:m,onClose:this.handleCloseSettings},o.a.createElement(Ui,{chatId:r})),o.a.createElement(Ln,{open:p,timeout:m,onClose:this.handleCloseNewGroup},o.a.createElement(zi,null)),o.a.createElement(Ln,{open:u,timeout:m,onClose:this.handleCloseNewChannel},o.a.createElement(Pi,null)),o.a.createElement(Gi,null)))}}var Yi=Ji;class Xi extends o.a.Component{constructor(...e){super(...e),this.state={chatId:na.a.dialogChatId},this.onClientUpdateMediaViewerContent=e=>{na.a.mediaViewerContent&&this.handleClose()},this.onClientUpdateDialogChatId=e=>{var t=e.chatId;this.setState({chatId:t})},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:0})}}shouldComponentUpdate(e,t,a){var n=this.state.chatId;return t.chatId!==n}componentDidMount(){na.a.on("clientUpdateDialogChatId",this.onClientUpdateDialogChatId),na.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent)}componentWillUnmount(){na.a.off("clientUpdateDialogChatId",this.onClientUpdateDialogChatId),na.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent)}render(){var e=this.state.chatId;return e?o.a.createElement(j.a,{open:!0,manager:oe.a,transitionDuration:0,onClose:this.handleClose,classes:{root:"chat-info-dialog-root",container:"chat-info-dialog-container",paper:"chat-info-dialog-paper"}},o.a.createElement(ia,{className:"chat-info-dialog-content",chatId:e,popup:!0})):null}}var Qi=Xi,$i=a(203),er=a.n($i),tr=a(554),ar=a.n(tr),nr=a(454),sr=Object(T.a)(o.a.createElement("path",{d:"M2.65383364,2.92607697 L4.145798,9.778632 C4.26700994,10.3353554 4.73555061,10.7489799 5.30300879,10.8002098 L16.196355,11.7836569 C16.3159306,11.7944521 16.4041145,11.9001385 16.3933192,12.0197141 C16.3838746,12.1243302 16.3009783,12.2072294 16.1963626,12.2166777 L5.30295988,13.2005138 C4.73552551,13.2517615 4.26701089,13.6653731 4.14579755,14.2220735 L2.65385781,21.074154 C2.55168485,21.543407 2.84926209,22.0066394 3.31851517,22.1088123 C3.50628037,22.1496954 3.70229947,22.1272304 3.87594675,22.0449272 L23.4110848,12.7858981 C23.8450551,12.5802101 24.0301144,12.0616646 23.8244264,11.6276943 C23.7384721,11.4463438 23.5924353,11.300307 23.4110848,11.2143527 L3.87592461,1.95531307 C3.44195432,1.74962507 2.92340882,1.93468443 2.71772082,2.36865471 C2.63541897,2.54229904 2.61295329,2.73831451 2.65383364,2.92607697 Z"}),"Send"),ir=Object(T.a)(o.a.createElement("path",{d:"M19,10 C19.5522847,10 20,10.4477153 20,11 C20,15.0792885 16.9468043,18.445465 13.0009551,18.9379871 L13,22 C13,22.5522847 12.5522847,23 12,23 C11.4871642,23 11.0644928,22.6139598 11.0067277,22.1166211 L11,22 L11.0000487,18.9381123 C7.05371356,18.4460359 4,15.0796344 4,11 C4,10.4477153 4.44771525,10 5,10 C5.55228475,10 6,10.4477153 6,11 C6,14.3137085 8.6862915,17 12,17 C15.3137085,17 18,14.3137085 18,11 C18,10.4477153 18.4477153,10 19,10 Z M12,2 C14.209139,2 16,3.790861 16,6 L16,11 C16,13.209139 14.209139,15 12,15 C9.790861,15 8,13.209139 8,11 L8,6 C8,3.790861 9.790861,2 12,2 Z M12,4 C10.8954305,4 10,4.8954305 10,6 L10,11 C10,12.1045695 10.8954305,13 12,13 C13.1045695,13 14,12.1045695 14,11 L14,6 C14,4.8954305 13.1045695,4 12,4 Z"}),"Microphone"),rr=Object(T.a)(o.a.createElement("path",{d:"M11.657825,8.68730116 L7.89384699,12.5266719 C6.53977525,13.9078658 6.53979565,16.118605 7.89389288,17.4997739 C9.18119565,18.812813 11.2598788,18.8798255 12.6276396,17.6859428 L12.8071445,17.5177786 L19.3928802,10.8005213 C21.4766204,8.67512215 21.4766204,5.27313659 19.3928802,3.14773741 C17.4051081,1.12022499 14.1862843,1.0310006 12.0906645,2.90336495 L11.834659,3.14773741 L5.26671543,9.84699003 C2.45333216,12.7166196 2.45333216,17.3098454 5.26671543,20.179475 C7.96150749,22.9281424 12.3352577,23.0332941 15.1578204,20.4629606 L15.452067,20.1794113 L19.2160679,16.340063 C19.6027032,15.945688 19.596429,15.3125541 19.202054,14.9259188 C18.8076791,14.5392835 18.1745452,14.5455577 17.7879099,14.9399327 L13.9520378,18.8511531 C11.9281881,20.8353343 8.67903707,20.8031766 6.6948559,18.7793268 C4.64395201,16.6874204 4.64395201,13.3390446 6.6948559,11.2471382 L13.3088798,4.50180526 C14.6072848,3.22884976 16.6917843,3.24948061 17.9647398,4.54788555 C19.2860006,5.89556155 19.2860006,8.05269718 17.9647398,9.40037319 L11.3764629,16.119959 C10.803533,16.6816592 9.88373353,16.6725557 9.32203335,16.0996258 C8.73040544,15.4961698 8.73039653,14.5302606 9.3220133,13.9267937 L13.0859914,10.0874229 C13.4726243,9.6930457 13.4663463,9.05991185 13.0719691,8.67327889 C12.6775919,8.28664594 12.044458,8.29292392 11.657825,8.68730116 Z"}),"Attach"),or=a(565),lr=a.n(or);a(564);class cr extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleMenuClick=e=>{this.setState({anchorEl:e.currentTarget})},this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleAttachPhoto=()=>{this.handleMenuClose();var e=this.props.onAttachPhoto;e&&setTimeout(()=>e(),u.c)},this.handleAttachDocument=()=>{this.handleMenuClose();var e=this.props.onAttachDocument;e&&setTimeout(()=>e(),u.c)},this.handleAttachPoll=()=>{this.handleMenuClose();var e=this.props.onAttachPoll;e&&e()}}render(){var e=this.props,t=(e.classes,e.t),a=e.chatId,n=this.state.anchorEl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{className:"inputbox-icon-button","aria-label":"Attach",open:Boolean(n),onClick:this.handleMenuClick},o.a.createElement(rr,null)),o.a.createElement(Za.a,{id:"attach-menu",anchorEl:n,open:Boolean(n),getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},classes:{paper:"attach-button-paper"},onClose:this.handleMenuClose},o.a.createElement(Ke.a,{onClick:this.handleAttachPhoto,disabled:!Object(V.e)(a)},o.a.createElement(Ee.a,null,o.a.createElement(ye,null)),o.a.createElement(Se.a,{primary:t("AttachPhoto")})),o.a.createElement(Ke.a,{onClick:this.handleAttachDocument,disabled:!Object(V.e)(a)},o.a.createElement(Ee.a,null,o.a.createElement(Ce,null)),o.a.createElement(Se.a,{primary:t("AttachDocument")})),!Object(V.db)(a)&&o.a.createElement(Ke.a,{onClick:this.handleAttachPoll,disabled:!Object(V.g)(a)},o.a.createElement(Ee.a,null,o.a.createElement(lr.a,null)),o.a.createElement(Se.a,{primary:t("Poll")}))))}}var hr=Object(_.a)()(cr),dr=a(659),pr=a(657),ur=a(460);function mr(e,t=!1){if(e){if(t&&e.childNodes&&e.childNodes.length>0){var a=e.childNodes[e.childNodes.length-1],n=document.createRange();n.setStart(a,a.length),n.collapse(!0);var s=window.getSelection();s.removeAllRanges(),s.addRange(n),e.scrollTop=e.scrollHeight}e.focus()}}var fr=8,gr=16,Cr=17,vr=18,br=46,Er=37,Sr=38,yr=39,Mr=40,Ir={special:{},navigational:{},isSpecial(e){return"undefined"!==typeof this.special[e.keyCode]},isNavigational(e){return"undefined"!==typeof this.navigational[e.keyCode]}};Ir.special[fr]=!0,Ir.special[gr]=!0,Ir.special[Cr]=!0,Ir.special[vr]=!0,Ir.special[br]=!0,Ir.navigational[Sr]=!0,Ir.navigational[Mr]=!0,Ir.navigational[Er]=!0,Ir.navigational[yr]=!0;a(566);class Ur extends o.a.Component{constructor(e){super(e),this.getText=()=>this.optionTextRef.current.innerText,this.focus=(e=!1)=>{mr(this.optionTextRef.current,e)},this.handleDelete=()=>{var e=this.props,t=e.option,a=e.onDelete;t&&a&&a(t.id)},this.handleInput=e=>{var t=this.props.option;e.preventDefault();var a=this.optionTextRef.current,n=a.dataset.length,s=(a.dataset.maxLength,this.getText());this.setState({remainLength:n-s.length}),x.a.clientUpdate({"@type":"clientUpdatePollOption",id:t.id,text:s})},this.handleKeyDown=e=>{var t=this.optionTextRef.current,a=t.dataset.maxLength,n=this.getText().length,s=!1,i=window.getSelection(),r=Ir.isSpecial(e),o=Ir.isNavigational(e);switch(i&&(s=!!i.toString()),e.key){case"Backspace":if(!this.getText()){var l=this.props,c=l.option,h=l.onDelete;return h&&h(c.id,!0),e.preventDefault(),!1}break;case"Enter":var d=this.props,p=d.option,u=d.onFocusNext;return p&&u&&u(p.id),e.preventDefault(),!1;case"ArrowUp":var m=window.getSelection();if(!m)break;if(!m.isCollapsed)break;var f=t.childNodes&&t.childNodes.length>0?t.childNodes[0]:null;if(!f||m.anchorNode===f&&!m.anchorOffset){var g=this.props,C=g.option,v=g.onFocusPrev;return v&&v(C.id),e.preventDefault(),!1}break;case"ArrowDown":var b=window.getSelection();if(!b)break;if(!b.isCollapsed)break;var E=t.childNodes&&t.childNodes.length>0?t.childNodes[t.childNodes.length-1]:null;if(!E||b.anchorNode===E&&b.anchorOffset===E.length){var S=this.props,y=S.option,M=S.onFocusNext;return M&&M(y.id),e.preventDefault(),!1}}return!(!r&&!o)||(!(n>=a&&!s)||(e.preventDefault(),!1))},this.handlePaste=e=>{e.preventDefault();var t=this.optionTextRef.current.dataset.maxLength,a=window.getSelection(),n=a?a.toString():"",s=this.getText();if(!(s.length-a.length>=t)){var i=e.clipboardData.getData("text/plain");i&&(i=i.replace("\r\n","\n").replace("\n"," "),s.length-n.length+i.length>t&&(i=i.substr(0,t-s.length+n.length)),document.execCommand("insertText",!1,i))}},this.handleChange=()=>{var e=this.props.option;e&&x.a.clientUpdate({"@type":"clientUpdatePollChooseOption",id:e.id})},this.optionTextRef=o.a.createRef(),this.state={remainLength:u.hb}}render(){var e=this.props,t=e.t,a=e.option,n=this.state.remainLength,s=a.is_chosen;return o.a.createElement("div",{className:"create-poll-option"},o.a.createElement("div",{className:"create-poll-option-wrapper"},o.a.createElement(ds.a,{key:Date.now(),classes:{root:"create-poll-radio-root"},color:"primary",checked:s,onChange:this.handleChange}),o.a.createElement("div",{ref:this.optionTextRef,className:"create-poll-option-text",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:t("Option"),"data-length":u.gb,"data-max-length":u.hb,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste})),o.a.createElement("div",{className:"create-poll-option-delete-button"},o.a.createElement(P.a,{className:"create-poll-option-button",onClick:this.handleDelete},o.a.createElement(g.a,{fontSize:"small"}))),o.a.createElement("div",{className:"create-poll-option-bottom-border"}),n<=u.gb-u.fb&&o.a.createElement(ur.a,{align:"center",className:"create-poll-option-subtitle",color:n>=0?"textSecondary":"error",variant:"subtitle1"},n))}}var kr=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())(Ur),xr=a(167);a(567);class wr extends o.a.Component{constructor(e){super(e),this.handleClientUpdateNewPoll=e=>{var t=xr.a.poll;this.setState({confirm:!1,remainLength:u.kb,poll:t})},this.handleClientUpdatePollQuestion=e=>{var t=xr.a.poll,a=this.questionRef.current,n=a.dataset.length,s=a.innerText;this.setState({remainLength:n-s.length,poll:t})},this.handleClientUpdatePoll=e=>{var t=xr.a.poll;this.setState({poll:t})},this.handleClientUpdateNewPollOption=e=>{var t=xr.a.poll;this.setState({poll:t},()=>{setTimeout(()=>{this.optionsRefMap.get(t.options.length-1).focus(!0)})})},this.handleKeyDown=e=>{var t=this.questionRef.current,a=t.dataset.maxLength,n=t.innerText.length,s=!1,i=window.getSelection(),r=Ir.isSpecial(e),o=Ir.isNavigational(e);switch(i&&(s=!!i.toString()),e.key){case"Enter":if(!e.shiftKey)return this.handleFocusNextOption(0),e.preventDefault(),!1;break;case"ArrowDown":var l=window.getSelection();if(!l)break;if(!l.isCollapsed)break;var c=t.childNodes&&t.childNodes.length>0?t.childNodes[t.childNodes.length-1]:null;if(!c||l.anchorNode===c&&l.anchorOffset===c.length)return this.handleFocusNextOption(0),e.preventDefault(),!1}return!(!r&&!o)||(!(n>=a&&!s)||(e.preventDefault(),!1))},this.handlePaste=e=>{e.preventDefault();var t=this.questionRef.current,a=t.dataset.maxLength,n=window.getSelection(),s=n?n.toString():"",i=t.innerText;if(!(i.length-n.length>=a)){var r=e.clipboardData.getData("text/plain");r&&(i.length-s.length+r.length>a&&(r=r.substr(0,a-i.length+s.length)),document.execCommand("insertText",!1,r))}},this.handleInput=e=>{e.preventDefault();var t=this.questionRef.current,a=t.innerText;"<br>"===t.innerHTML&&(t.innerText=""),x.a.clientUpdate({"@type":"clientUpdatePollQuestion",question:a})},this.handleAddOption=()=>{var e=this.state.poll;if(e&&!(e.options.length>=u.eb)){var t={id:Date.now(),text:""};x.a.clientUpdate({"@type":"clientUpdateNewPollOption",option:t})}},this.handleDeleteOption=(e,t=!1)=>{t?this.handleDeleteByBackspace(e):this.handleDelete(e)},this.handleDelete=e=>{x.a.clientUpdate({"@type":"clientUpdateDeletePollOption",id:e})},this.handleDeleteByBackspace=e=>{var t=this.state.poll;if(t){for(var a=t.options,n=a.findIndex(t=>t.id===e),s=n-1,i=!0,r=n;r<a.length;r++){if(a[r].text){i=!1;break}}i&&this.handleDeleteOption(e);var o=this.optionsRefMap.get(s);if(o)o.focus(!0);else mr(this.questionRef.current,!0)}},this.handleFocusPrevOption=e=>{var t=this.state.poll;if(t){var a=t.options.findIndex(t=>t.id===e)-1,n=this.optionsRefMap.get(a);if(n)n.focus(!1);else mr(this.questionRef.current,!1)}},this.handleFocusNextOption=e=>{var t=this.state.poll;if(t){var a=t.options,n=a.findIndex(t=>t.id===e),s=n+1,i=this.optionsRefMap.get(s);if(i)i.focus(i,!0);else{var r=n>=0&&n<a.length?a[n].text:"";if(a.length&&!r)return;this.handleAddOption()}}},this.getHint=()=>{var e=this.state.poll;if(e){var t=e.options,a=u.eb-t.length;return a<=0?"You have added the maximum number of options.":1===a?"You can add 1 more option.":"You can add ".concat(u.eb-t.length," more options.")}},this.handleClose=()=>{var e=this.state.poll;Object(da.a)(e)?this.setState({confirm:!0}):this.handleConfirmationDone()},this.handleSend=()=>{var e=this.props.onSend,t=xr.a.getInputMessagePoll();t&&(e(t),this.handleConfirmationDone())},this.handleConfirmationClose=()=>{this.setState({confirm:!1})},this.handleConfirmationDone=()=>{this.handleConfirmationClose(),x.a.clientUpdate({"@type":"clientUpdateDeletePoll"})},this.handleChangeAnonymous=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeAnonymous"})},this.handleChangeAllowMultipleAnswers=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeAllowMultipleAnswers"})},this.handleChangeType=()=>{x.a.clientUpdate({"@type":"clientUpdatePollChangeType"})},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(g.a,null))]})},this.handleAllowMultipleAnswersClick=e=>{var t=this.props.t,a=this.state.poll;a&&("pollTypeQuiz"===a.type["@type"]&&(e.stopPropagation(),this.handleScheduledAction(t("PollQuizOneRightAnswer"))))},this.questionRef=o.a.createRef(),this.optionsRefMap=new Map,this.state={poll:null,confirm:!1,remainLength:u.kb}}componentDidMount(){xr.a.on("clientUpdatePollChooseOption",this.handleClientUpdatePoll),xr.a.on("clientUpdatePollChangeAnonymous",this.handleClientUpdatePoll),xr.a.on("clientUpdatePollChangeAllowMultipleAnswers",this.handleClientUpdatePoll),xr.a.on("clientUpdatePollChangeType",this.handleClientUpdatePoll),xr.a.on("clientUpdateDeletePoll",this.handleClientUpdatePoll),xr.a.on("clientUpdateDeletePollOption",this.handleClientUpdatePoll),xr.a.on("clientUpdateNewPoll",this.handleClientUpdateNewPoll),xr.a.on("clientUpdateNewPollOption",this.handleClientUpdateNewPollOption),xr.a.on("clientUpdatePollOption",this.handleClientUpdatePoll),xr.a.on("clientUpdatePollQuestion",this.handleClientUpdatePollQuestion)}componentWillUnmount(){xr.a.off("clientUpdatePollChooseOption",this.handleClientUpdatePoll),xr.a.off("clientUpdatePollChangeAnonymous",this.handleClientUpdatePoll),xr.a.off("clientUpdatePollChangeAllowMultipleAnswers",this.handleClientUpdatePoll),xr.a.off("clientUpdatePollChangeType",this.handleClientUpdatePoll),xr.a.off("clientUpdateDeletePoll",this.handleClientUpdatePoll),xr.a.off("clientUpdateDeletePollOption",this.handleClientUpdatePoll),xr.a.off("clientUpdateNewPoll",this.handleClientUpdateNewPoll),xr.a.off("clientUpdateNewPollOption",this.handleClientUpdateNewPollOption),xr.a.off("clientUpdatePollOption",this.handleClientUpdatePoll),xr.a.off("clientUpdatePollQuestion",this.handleClientUpdatePollQuestion)}componentDidUpdate(e,t,a){this.state.poll&&!t.poll&&setTimeout(()=>{mr(this.questionRef.current,!0)},0)}render(){var e=this.props.t,t=this.state,a=t.remainLength,n=t.confirm,s=t.poll;if(!s)return null;var i=s.is_anonymous,r=s?s.options:[],l=s.type.allow_multiple_answers,h="pollTypeRegular"!==s.type["@type"],d="pollTypeQuiz"===s.type["@type"];this.optionsRefMap.clear();var p=r.map((e,t)=>o.a.createElement(kr,{ref:e=>this.optionsRefMap.set(t,e),key:e.id,option:e,onDelete:this.handleDeleteOption,onFocusPrev:this.handleFocusPrevOption,onFocusNext:this.handleFocusNextOption})),m=u.eb-r.length>0,f=this.getHint();return o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{className:c()("create-poll-dialog",{"create-quiz-dialog":d}),open:!0,manager:oe.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},e("NewPoll")),o.a.createElement(Dn.a,{classes:{root:"create-poll-dialog-root"}},o.a.createElement("div",{className:"create-poll-dialog-question-title"},o.a.createElement(Me.a,{color:"primary",variant:"subtitle1",style:{flexGrow:1}},e("Question")),a<=u.jb-u.ib&&o.a.createElement(Me.a,{color:a>=0?"textSecondary":"error",variant:"subtitle1"},a)),o.a.createElement("div",{ref:this.questionRef,id:"create-poll-dialog-question",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:e("QuestionHint"),"data-length":u.jb,"data-max-length":u.kb,onPaste:this.handlePaste,onKeyDown:this.handleKeyDown,onInput:this.handleInput}),o.a.createElement(dr.a,{className:"divider"}),o.a.createElement(Me.a,{color:"primary",variant:"subtitle1"},e("PollOptions")),o.a.createElement(ve.a,{classes:{root:"create-poll-dialog-list"}},p,m&&o.a.createElement(be.a,{selected:!1,className:"create-poll-add-option",button:!0,onClick:this.handleAddOption},o.a.createElement(Se.a,{disableTypography:!0,primary:e("AddAnOption")}))),o.a.createElement(Me.a,null,f),o.a.createElement(dr.a,{className:"divider"}),o.a.createElement(Me.a,{color:"primary",variant:"subtitle1"},e("Settings")),o.a.createElement(pr.a,null,o.a.createElement(Vs.a,{control:o.a.createElement(Te.a,{color:"primary",checked:i,onChange:this.handleChangeAnonymous}),label:e("PollAnonymous")}),o.a.createElement("div",{onClick:this.handleAllowMultipleAnswersClick,style:{background:"transparent"}},o.a.createElement(Vs.a,{control:o.a.createElement(Te.a,{color:"primary",disabled:h,checked:l,onChange:this.handleChangeAllowMultipleAnswers}),label:e("PollMultiple")})),o.a.createElement(Vs.a,{control:o.a.createElement(Te.a,{color:"primary",checked:d,onChange:this.handleChangeType}),label:e("PollQuiz")})),o.a.createElement(Me.a,null,e("QuizInfo"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{color:"primary",onClick:this.handleClose},e("Cancel")),Object(da.b)(s)&&o.a.createElement(N.a,{color:"primary",onClick:this.handleSend},e("Create")))),o.a.createElement(j.a,{className:"create-poll-dialog-root",open:n,manager:oe.a,transitionDuration:0,onClose:this.handleConfirmationClose,"aria-labelledby":"dialog-title"},o.a.createElement(R.a,{id:"dialog-title"},e("CancelPollAlertTitle")),o.a.createElement(Dn.a,{classes:{root:"create-poll-dialog-root"}},e("CancelPollAlertText")),o.a.createElement(D.a,null,o.a.createElement(N.a,{color:"primary",onClick:this.handleConfirmationClose},e("Cancel")),o.a.createElement(N.a,{color:"primary",onClick:this.handleConfirmationDone},e("Ok")))))}}var Or=Object(h.a)(Object(h.d)(),Object(_.a)(),p.b,Object(h.c)())(wr),Lr=a(87);a(568);class _r extends o.a.Component{constructor(e){super(e),this.handleTextKeyDown=e=>{"Enter"===e.key&&(this.urlInputRef.current.focus(),e.preventDefault(),e.stopPropagation())},this.handleUrlKeyDown=e=>{"Enter"===e.key&&(this.handleDone(),e.preventDefault(),e.stopPropagation())},this.handleTextChange=e=>{this.setState({text:e.target.value})},this.handleUrlChange=e=>{this.setState({url:e.target.value})},this.handleDone=()=>{var e=this.props,t=e.defaultText,a=e.defaultUrl,n=this.state,s=n.text,i=n.url;if(i=null!==i?i:a,(s=null!==s?s:t)||i){if(!s)return this.setState({textError:!0}),void this.textInputRef.current.focus();if(!(i=Object(Lr.d)(i)))return this.setState({urlError:!0}),void this.urlInputRef.current.focus();(0,this.props.onDone)(s,i)}else this.textInputRef.current.focus()},this.handleCancel=()=>{(0,this.props.onCancel)()},this.textRef=o.a.createRef(),this.textInputRef=o.a.createRef(),this.urlRef=o.a.createRef(),this.urlInputRef=o.a.createRef(),this.state={}}componentDidUpdate(e,t,a){var n=this.props,s=n.defaultText,i=n.defaultUrl,r=n.open;r&&e.open!==r&&setTimeout(()=>{var e=this.textInputRef.current,t=this.urlInputRef.current;e&&t&&(s?i?(e.focus(),e.select()):t.focus():e.focus())},0)}componentDidMount(){}shouldComponentUpdate(e,t,a){var n=this.props,s=n.defaultText,i=n.defaultUrl,r=n.onDone,o=n.onCancel,l=n.open,c=this.state,h=c.textError,d=c.urlError;return e.defaultText!==s||(e.defaultUrl!==i||(t.textError!==h||(t.urlError!==d||(e.onDone!==r||(e.onCancel!==o||e.open!==l)))))}static getDerivedStateFromProps(e,t){return t.prevOpen!==e.open?{prevOpen:!0,textError:!1,urlError:!1,text:null,url:null}:null}render(){var e=this.props,t=e.open,a=e.defaultUrl,n=e.defaultText,s=e.t,i=this.state,r=i.textError,l=i.urlError;return t?o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"edit-url-dialog-title"},o.a.createElement(R.a,{id:"edit-url-dialog-title"},s("CreateLink")),o.a.createElement(Dn.a,null,o.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:260}},o.a.createElement(Wn.a,{ref:this.textRef,inputRef:this.textInputRef,label:s("Text"),margin:"normal",autoComplete:"off",defaultValue:n,error:r,onChange:this.handleTextChange,onKeyDown:this.handleTextKeyDown}),o.a.createElement(Wn.a,{ref:this.urlRef,inputRef:this.urlInputRef,label:s("URL"),margin:"normal",autoComplete:"off",defaultValue:a,error:l,onChange:this.handleUrlChange,onKeyDown:this.handleUrlKeyDown}))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},s("Create")))):null}}var Nr=Object(_.a)()(_r);a(569);class Pr extends o.a.Component{constructor(...e){super(...e),this.onClientUpdatePhotoBlob=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.photoSize;if(s){var i=s.photo||s.file;i&&e.chatId===a&&e.messageId===n&&e.fileId===i.id&&this.forceUpdate()}}}componentDidMount(){U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.on("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}componentWillUnmount(){U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateAudioThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateStickerThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdatePhotoBlob),U.a.off("clientUpdateVideoNoteThumbnailBlob",this.onClientUpdatePhotoBlob)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.photoSize,s=e.minithumbnail;if(!n)return null;var i=n.photo||n.file;if(!i)return null;var r=s?"data:image/jpeg;base64, "+s.data:null,l=Object(G.m)(i),h=!l&&r||Object(at.m)(n,u.Fb),d=Object(it.F)(t,a),p=Boolean(l||r);return o.a.createElement("div",{className:"reply-tile"},p&&o.a.createElement("img",{className:c()("reply-tile-photo",{"reply-tile-photo-round":d},{"media-blurred":l&&h},{"media-mini-blurred":!l&&r&&h}),draggable:!1,src:l||r,alt:""}))}}var jr=Pr;a(570);class Dr extends o.a.Component{constructor(...e){super(...e),this.onGetMessageResult=e=>{var t=this.props,a=t.chatId,n=t.messageId;a===e.chat_id&&n===e.id&&this.forceUpdate()},this.handleClick=e=>{e.stopPropagation()},this.handleOpen=e=>{if(0===e.button){e.stopPropagation();var t=this.props,a=t.chatId,n=t.messageId,s=t.onClick,i=le.a.get(a,n);if(!i)return null;if(Object(it.J)(i))return null;Object(re.i)(a,n,!1),s&&s()}}}componentDidMount(){le.a.on("getMessageResult",this.onGetMessageResult)}componentWillUnmount(){le.a.off("getMessageResult",this.onGetMessageResult)}render(){var e=this.props,t=e.t,a=e.chatId,n=e.messageId,s=this.props.title,i=le.a.get(a,n);s=s||Object(it.z)(i,t);var r=i?Object(it.i)(i,t):t("Loading"),l=Object(it.u)(a,n),h=Object(it.t)(a,n);return Object(it.J)(i)&&(s=null,r=t("DeletedMessage")),o.a.createElement("div",{className:"reply",onMouseDown:this.handleOpen,onClick:this.handleClick},o.a.createElement("div",{className:"reply-wrapper"},o.a.createElement("div",{className:"border reply-border"}),l&&o.a.createElement(jr,{chatId:a,messageId:n,photoSize:l,minithumbnail:h}),o.a.createElement("div",{className:"reply-content"},s&&o.a.createElement("div",{className:"reply-content-title"},s),o.a.createElement("div",{className:c()("reply-content-subtitle")},r))))}}var Rr=Object(_.a)()(Dr);a(571);class Tr extends o.a.Component{constructor(...e){super(...e),this.onUpdateMessageContent=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.editMessageId,i=e.chat_id,r=e.message_id;a===i&&(n!==r&&s!==r||this.forceUpdate())},this.handleClose=()=>{var e=this.props,t=e.chatId;e.editMessageId?Object(re.d)(t,0):Object(re.l)(t,0)}}componentDidMount(){le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){le.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.editMessageId,s=e.t,i=e.onClick;return t&&(a||n)?o.a.createElement("div",{className:"inputbox-header"},o.a.createElement("div",{className:"inputbox-header-left-column"},o.a.createElement(P.a,{className:"inputbox-icon-button","aria-label":"Close",onClick:this.handleClose},o.a.createElement(g.a,null))),o.a.createElement("div",{className:"inputbox-header-middle-column"},o.a.createElement(Rr,{chatId:t,messageId:n||a,title:n?s("EditMessage"):null,onClick:i})),o.a.createElement("div",{className:"inputbox-header-right-column"})):null}}var Fr=Object(_.a)()(Tr);a(572);class Ar extends o.a.Component{constructor(...e){super(...e),this.handleDone=()=>{(0,this.props.onConfirm)()},this.handleCancel=()=>{(0,this.props.onCancel)()}}render(){var e=this.props,t=e.files,a=e.t;return t?o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},a("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,t.length>1?a("SendFilesConfirmation"):a("SendFileConfirmation"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},a("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},a("Ok")))):null}}var Br=Object(h.a)(Object(_.a)())(Ar);a(573);class Vr extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateRecordStart=()=>{this.timer=setInterval(()=>{var e=new Date-this.startTime;this.setState({time:e})},25),this.startTime=new Date},this.onClientUpdateRecordStop=()=>{this.timer&&clearTimeout(this.timer),this.setState({time:null})},this.onClientUpdateRecordError=()=>{this.timer&&clearTimeout(this.timer),this.setState({time:null})}}componentDidMount(){le.a.on("clientUpdateRecordStart",this.onClientUpdateRecordStart),le.a.on("clientUpdateRecordStop",this.onClientUpdateRecordStop),le.a.on("clientUpdateRecordError",this.onClientUpdateRecordError)}componentWillUnmount(){le.a.off("clientUpdateRecordStart",this.onClientUpdateRecordStart),le.a.off("clientUpdateRecordStop",this.onClientUpdateRecordStop),le.a.off("clientUpdateRecordError",this.onClientUpdateRecordError)}normalizeM(e){var t=e.toString();return 1===t.length?t+="0":t.length>2&&(t=t.substr(0,2)),t}normalizeS(e){var t=e.toString();return 1===t.length&&(t="0"+t),t}msToTime(e){var t=e%1e3,a=(e=(e-t)/1e3)%60,n=(e=(e-a)/60)%60,s=(e-n)/60,i=n+":"+this.normalizeS(a)+","+this.normalizeM(t);return s>0&&(i=s+":"+i),i}render(){var e=this.state.time;return e?o.a.createElement("div",{className:"record-timer"},this.msToTime(e),o.a.createElement("div",{className:"record-timer-icon"})):null}}var Hr=Vr,zr=a(575),Wr=a.n(zr);a(574);class Gr extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleSelectionChange=()=>{document.activeElement===this.captionRef.current&&this.saveSelection()},this.handleEnter=()=>{var e=this.props,t=e.chatId,a=e.messageId,n=e.open,s=e.newItem;if(n){var i=null,r=null,o=le.a.get(t,a);if(o){var l=o.content;l&&(i=l.text,r=l.caption)}var c=this.captionRef.current;c&&(i?this.setFormattedText(i):r?this.setFormattedText(r):s&&s.caption?c.innerHTML=s.caption:c.innerText=null,Wa(c))}},this.handleDone=()=>{var e=this.props,t=e.chatId,a=e.newItem,n=e.onSend,s=e.onEdit,i=this.state,r=i.editMessage,o=i.editFile,l=i.editMedia,c=i.sendAsPhoto,h=this.captionRef.current;if(h){var d=h.innerHTML;h.innerText=null;var p=Object(it.m)(d),u={"@type":"formattedText",text:p.text,entities:p.entities};if(Boolean(r)){if(l){var m=l.photo;if(!m)return;var f=m.sizes;if(!f)return;var g=f[f.length-1],C=g.width,v=g.height;s(null,{"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:o.name,data:o},width:C,height:v,caption:u})}else s(u,null);Object(re.d)(t,0)}else{var b=a.media,E=a.file,S=b.audio,y=b.photo,M=b.document,I=null;if(y){var U=y.sizes;if(!U)return;var k=U[U.length-1],x=k.width,w=k.height;I=c?{"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:E.name,data:E},width:x,height:w,caption:u}:{"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:E.name,data:E},thumbnail:null,caption:u}}else if(M)I={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:E.name,data:E},thumbnail:null,caption:u};else if(S){var O=S.duration,L=S.title,_=S.performer;I={"@type":"inputMessageAudio",audio:{"@type":"inputFileBlob",name:E.name,data:E},thumbnail:null,duration:O,title:L,performer:_,caption:u}}if(!I)return;n(I,E)}}},this.handleCancel=()=>{var e=this.props,t=e.chatId,a=e.messageId,n=e.onCancel,s=le.a.get(t,a);Boolean(s)&&Object(re.d)(t,0),n()},this.handleKeyDown=e=>{var t=e.altKey,a=e.ctrlKey,n=(e.key,e.keyCode,e.code,e.metaKey),s=e.shiftKey,i=e.repeat,r=e.nativeEvent;if(r.isComposing)e.stopPropagation();else switch(r.code){case"Enter":case"NumpadEnter":t||!(a||n||s)||i?t||a||n||s||i||(this.handleDone(),e.preventDefault(),e.stopPropagation()):(document.execCommand("insertLineBreak"),e.preventDefault(),e.stopPropagation());break;case"KeyB":t||!a&&!n||s||i||(this.handleBold(),e.preventDefault(),e.stopPropagation());break;case"KeyI":t||!a&&!n||s||i||(this.handleItalic(),e.preventDefault(),e.stopPropagation());break;case"KeyK":t||!a&&!n||s||i?!t||!a&&!n||s||i||(this.handleMono(),e.preventDefault(),e.stopPropagation()):(this.handleUrl(),e.preventDefault(),e.stopPropagation());break;case"KeyN":!t||!a&&!n||s||i||(this.handleClear(),e.preventDefault(),e.stopPropagation())}},this.handleClear=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null)},this.handleBold=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("bold",!1,null)},this.handleItalic=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("italic",!1,null)},this.handleMono=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null);var e="",t=this.selection;t&&!t.isCollapsed&&(e=t.toString()),e&&(e="<code>".concat(e,"</code>"),document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,e))},this.handleUnderline=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("underline",!1,null)},this.handleStrikeThrough=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("strikeThrough",!1,null)},this.handleUrl=()=>{this.openEditUrlDialog()},this.openEditUrlDialog=()=>{var e="",t="",a=this.selection,n=this.range;if(n){var s=n.startContainer;if(s===n.endContainer){var i=s.parentElement;i&&"A"===i.nodeName&&(e=i.innerText,t=i.href)}}e||!a||a.isCollapsed||(e=a.toString()),this.setState({openEditUrl:!0,defaultUrl:t,defaultText:e})},this.closeEditUrlDialog=()=>{this.setState({openEditUrl:!1},()=>{this.restoreSelection()})},this.handlePaste=e=>{var t=e.clipboardData.getData("text/plain");t&&(e.preventDefault(),document.execCommand("insertText",!1,t))},this.handleInput=()=>{this.clearInnerHtml()},this.handleCancelEditUrl=()=>{this.closeEditUrlDialog()},this.handleDoneEditUrl=(e,t)=>{this.closeEditUrlDialog(),setTimeout(()=>{var a=this.range;if(a){var n=a.startContainer,s=a.endContainer;if(n&&n===s){var i=n.parentNode;if(i&&"A"===i.nodeName){i.href=t,i.title=t,i.innerText=e;var r=i.lastChild;if(r){var o=document.createRange();o.setStart(r,r.textContent.length),o.setEnd(r,r.textContent.length);var l=document.getSelection();l.removeAllRanges(),l.addRange(o)}return}}}var c="<a href=".concat(t," title=").concat(t," rel='noopener noreferrer' target='_blank'>").concat(e,"</a>");document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,c)},0)},this.handleEditMedia=e=>{var t=this.editMediaRef.current;t&&t.click()},this.handleEditMediaComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.editMediaRef.current){e.next=3;break}return e.abrupt("return");case 3:if(0!==(n=a.files).length){e.next=6;break}return e.abrupt("return");case 6:if(i=Array.from(n),r=Object(Gn.a)(i),o=r[0],r.slice(1),o){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,Object(at.h)(o);case 11:l=e.sent,t.setState({editFile:o,editMedia:l}),a.value="";case 14:case"end":return e.stop()}}),e)}))),this.handleSendAsPhoto=()=>{var e=this.state.sendAsPhoto;this.setState({sendAsPhoto:!e})},this.captionRef=o.a.createRef(),this.editMediaRef=o.a.createRef(),this.state={}}static getDerivedStateFromProps(e,t){var a=t.prevOpen,n=e.open,s=e.chatId,i=e.messageId,r=e.newItem;if(a!==n){if(n){var o=le.a.get(s,i),l=!1;return(o&&"messagePhoto"===o.content["@type"]||r&&r.media&&"messagePhoto"===r.media["@type"])&&(l=!0),{prevOpen:!0,sendAsPhoto:l,editMessage:o,editMedia:null,editFile:null}}return{prevOpen:!1,sendAsPhoto:!1,editMessage:null,editMedia:null,editFile:null}}return null}componentDidMount(){document.addEventListener("selectionchange",this.handleSelectionChange,!0)}componentWillUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange,!0)}setFormattedText(e){var t=this.props.t,a=this.captionRef.current;if(e){var n=e.text,s=e.entities;try{var i=Object(it.s)(n,s,t);a.innerHTML=null,i.forEach(e=>{a.appendChild(e)})}catch(r){a.innerText=n}}else a.innerText=null}saveSelection(){this.selection=document.getSelection(),this.selection&&this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}restoreSelection(){var e=this.range;if(e){var t=document.getSelection();t.removeAllRanges(),t.addRange(e),this.captionRef.current.focus()}else Wa()}clearInnerHtml(){var e=this.captionRef.current;if(e){var t=e.innerHTML;"<br>"!==t&&"<div><br></div>"!==t||(e.innerHTML=null)}}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.newItem,s=e.open,i=e.t,r=this.state,l=r.defaultText,c=r.defaultUrl,h=r.openEditUrl,d=r.editMessage,p=r.editMedia,u=r.sendAsPhoto;if(!s)return null;var m=le.a.get(t,a),f=Boolean(m),g=!1;(n&&n.media&&"messagePhoto"===n.media["@type"]||p&&"messagePhoto"===p["@type"]||d&&"messagePhoto"===d.content["@type"])&&(g=!0);var C=null;f?C=p?Object(at.f)({content:p}):Object(at.f)(m,null):n&&(C=Object(at.f)({content:n.media}));var v=i(f?"Save":"Send");return o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:!0,onClose:this.handleCancel,"aria-labelledby":"edit-media-dialog-title",onEnter:this.handleEnter},o.a.createElement("div",{className:"edit-media-dialog-content"},o.a.createElement("div",{style:{margin:24}},C),f&&o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{disableRipple:!0,"aria-label":i("Edit"),className:"edit-media-dialog-edit-button",size:"small",onClick:this.handleEditMedia},o.a.createElement(Wr.a,{fontSize:"inherit"})),o.a.createElement("input",{ref:this.editMediaRef,className:"inputbox-attach-button",type:"file",accept:"image/*",onChange:this.handleEditMediaComplete})),!f&&g&&o.a.createElement(Bs.a,{value:u,onChange:this.handleSendAsPhoto,style:{margin:"0 24px 24px"}},o.a.createElement(Vs.a,{value:!0,control:o.a.createElement(ds.a,{color:"primary"}),label:i("SendAsPhoto")}),o.a.createElement(Vs.a,{value:!1,control:o.a.createElement(ds.a,{color:"primary"}),label:i("SendAsFile")}))),o.a.createElement("div",{ref:this.captionRef,id:"edit-media-dialog-caption",className:"scrollbars-hidden",contentEditable:!0,suppressContentEditableWarning:!0,placeholder:i("Caption"),onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onInput:this.handleInput}),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCancel,color:"primary"},i("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},v)),o.a.createElement(Nr,{open:h,defaultText:l,defaultUrl:c,onDone:this.handleDoneEditUrl,onCancel:this.handleCancelEditUrl}))}}var Zr=Object(_.a)()(Gr);var qr=class{constructor(e){this.chatId=e,this.lastAction=null}setTyping(e){if(this.chatId){if(this.lastAction&&this.lastAction["@type"]===e["@type"]){var t=new Date;if(t.setSeconds(t.getSeconds()-u.Ib),this.lastTypingDate&&this.lastTypingDate>t)return}this.lastAction=e,this.lastTypingDate=new Date,x.a.send({"@type":"sendChatAction",chat_id:this.chatId,action:e})}}},Kr=a(159),Jr=a(82),Yr=(a(576),o.a.lazy(()=>Promise.all([a.e(6),a.e(7)]).then(a.bind(null,662))));class Xr extends r.Component{constructor(e){var t;super(e),t=this,this.selectionChangeListener=()=>{document.activeElement===this.newMessageRef.current&&this.saveSelection()},this.onClientUpdateInputShake=e=>{var t=this.props;t.chatId,t.messageId;this.state.shook?this.setState({shook:!1},()=>{setTimeout(()=>{this.setState({shook:!0})},0)}):this.setState({shook:!0})},this.onClientUpdateSendFiles=e=>{var t=e.files;t&&this.handleSendFiles(Array.from(t))},this.onUpdateDeleteMessages=e=>{var t=this.state,a=t.chatId,n=t.editMessageId,s=e.chat_id,i=e.message_ids,r=e.is_permanent;n&&r&&a===s&&-1!==i.indexOf(n)&&this.handleCancel()},this.onClientUpdateEditMessage=e=>{var t=e.chatId,a=e.messageId;if(!this.state.recordingTime&&this.state.chatId===t){a?this.saveDraftAndSelection():this.restoreDraftAndSelection();var n=0!==a&&Object(at.n)(t,a);this.setState({editMessageId:a,openEditMedia:n},()=>{this.state.openEditMedia||(this.setEditMessage(),this.handleInput(),setTimeout(()=>{this.focusInput()},0))})}},this.onClientUpdateFocusWindow=e=>{e.focused||this.saveDraft()},this.onUpdateChatDraftMessage=e=>{var t=e.chat_id,a=this.state,n=a.chatId;a.recordingTime||n===t&&this.loadDraft()},this.onClientUpdateAnimationSend=e=>{var t=e.animation;if(t){var a=t.animation,n=t.thumbnail,s=t.width,i=t.height,r=t.duration;if(a){var o=this.newMessageRef.current;if(o){o.innerText=null,this.restoreSelection();var l={"@type":"inputMessageAnimation",animation:{"@type":"inputFileId",id:a.id},width:s,height:i,duration:r};if(n){var c=n.width,h=n.height,d=n.file;l.thumbnail={"@type":"inputThumbnail",thumbnail:{"@type":"inputFileId",id:d.id},width:c,height:h}}this.sendMessage(l,!1,e=>{})}}}},this.onClientUpdateStickerSend=e=>{var t=e.sticker;if(t){var a=t.sticker,n=t.thumbnail,s=t.width,i=t.height;if(a){var r=this.newMessageRef.current;if(r){r.innerText=null,this.restoreSelection();var o={"@type":"inputMessageSticker",sticker:{"@type":"inputFileId",id:a.id},width:s,height:i};if(n){var l=n.width,c=n.height,h=n.file;o.thumbnail={"@type":"inputThumbnail",thumbnail:{"@type":"inputFileId",id:h.id},width:l,height:c}}this.sendMessage(o,!1,e=>{}),x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null})}}}},this.onClientUpdateReply=e=>{var t=this.state,a=t.chatId,n=t.recordingTime,s=e.chatId,i=e.messageId;a===s&&(this.setState({replyToMessageId:i}),i&&!n&&this.setInputFocus())},this.onClientUpdateChatId=e=>{this.state.chatId!==e.nextChatId&&(this.saveDraft(),this.beforeEditText=null,this.setState({chatId:e.nextChatId,replyToMessageId:Object(V.m)(e.nextChatId),editMessageId:0,openEditUrl:!1},()=>{this.loadDraft()}),this.handleCancelRecord())},this.setDraft=()=>{var e=this.state.chatId,t=this.newMessageRef.current,a=Object(V.l)(e);a?(this.setFormattedText(a),this.setState({replyToMessageId:Object(V.m)(e)})):t.innerText=null},this.setInputFocus=()=>{this.state.recordingTime||setTimeout(()=>{Wa(this.newMessageRef.current)},100)},this.setChatDraftMessage=e=>{if(e){var t=e.chatId,a=e.draftMessage;t&&x.a.send({"@type":"setChatDraftMessage",chat_id:t,draft_message:a})}},this.getDraftMessage=(e,t,a)=>{var n=Z.a.get(e);if(n){var s=n.draft_message,i=Object(it.m)(a),r=i.text,o=i.entities,l=r&&r.length>0||o.length>0?{"@type":"draftMessage",reply_to_message_id:t,input_message_text:{"@type":"inputMessageText",text:{"@type":"formattedText",text:r,entities:o},disable_web_page_preview:!1,clear_draft:!1}}:null;return Object(V.j)(s,l)?null:{chatId:e,draftMessage:l}}},this.handleSubmit=(e=!0)=>{var t=this.state,a=t.chatId,n=t.editMessageId,s=(t.replyToMessageId,t.recordingReady),i=t.recordingTime;if(i){if(new Date-i<u.Ob)return;this.handleStopRecord()}else if(s)e&&this.handleRecord();else{var r=this.newMessageRef.current;if(r){var o=r.innerHTML;if(r.innerText=null,this.handleInput(),o&&o.trim()){var l=Object(it.m)(o),c={"@type":"formattedText",text:l.text,entities:l.entities},h={"@type":"inputMessageText",text:c,disable_web_page_preview:!1,clear_draft:!0};if(n){var d=le.a.get(a,n);if(!d)return;var p=d.content;if(!p)return;var m=p.text,f=p.caption;m?this.editMessageText(h,e=>{}):f&&this.editMessageCaption(c),Object(re.d)(a,0)}else this.sendMessage(h,!1,e=>{})}}}},this.handleAttachPoll=()=>{x.a.clientUpdate({"@type":"clientUpdateNewPoll"})},this.handleAttachPhoto=()=>{this.attachPhotoRef&&this.attachPhotoRef.current.click()},this.handleAttachPhotoComplete=Object(i.a)(s.a.mark((function e(){var a,n,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachPhotoRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=13;break}if(n=Array.from(a),r=Object(Gn.a)(n),o=r[0],r.slice(1),o){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.getNewItem(o,!0);case 9:l=e.sent,t.setState({openEditMedia:!0,newItem:l}),e.next=14;break;case 13:Array.from(a).forEach(function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.B)(a);case 2:n=e.sent,i=Object(L.a)(n,2),r=i[0],o=i[1],l={"@type":"inputMessagePhoto",photo:{"@type":"inputFileBlob",name:a.name,size:a.size,data:a},width:r,height:o},t.handleSendPhoto(l,a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:t.attachPhotoRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.handleAttachDocument=()=>{this.attachDocumentRef&&this.attachDocumentRef.current.click()},this.handleAttachDocumentComplete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=t.attachDocumentRef.current.files).length){e.next=3;break}return e.abrupt("return");case 3:if(1!==a.length){e.next=13;break}if(n=Array.from(a),i=Object(Gn.a)(n),r=i[0],i.slice(1),r){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.getNewItem(r,!1);case 9:o=e.sent,t.setState({openEditMedia:!0,newItem:o}),e.next=14;break;case 13:Array.from(a).forEach(e=>{var a={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:e.name,size:e.size,data:e}};t.handleSendDocument(a,e)});case 14:t.attachDocumentRef.current.value="";case 15:case"end":return e.stop()}}),e)}))),this.handleClear=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null)},this.handleBold=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("bold",!1,null)},this.handleItalic=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("italic",!1,null)},this.handleMono=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null);var e="",t=this.selection;t&&!t.isCollapsed&&(e=t.toString()),e&&(e="<code>".concat(e,"</code>"),document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,e))},this.handleUnderline=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("underline",!1,null)},this.handleStrikeThrough=()=>{document.execCommand("removeFormat",!1,null),document.execCommand("unlink",!1,null),document.execCommand("strikeThrough",!1,null)},this.handleUrl=()=>{this.openEditUrlDialog()},this.handleCancel=()=>{var e=this.state,t=e.chatId,a=e.editMessageId,n=e.replyToMessageId;return a?(Object(re.d)(t,0),!0):!!n&&(Object(re.l)(t,0),!0)},this.handleKeyDown=e=>{var t=e.altKey,a=e.ctrlKey,n=(e.key,e.keyCode,e.charCode,e.metaKey),s=e.shiftKey,i=e.repeat,r=e.nativeEvent,o=this.state,l=o.editMessageId,c=o.replyToMessageId;if(!r.isComposing)switch(r.code){case"Digit0":if(t&&a&&!n&&!s){if(l)return;if(c)return;e.preventDefault()}break;case"Enter":case"NumpadEnter":t||!(a||n||s)||i?t||a||n||s||i||(this.handleSubmit(!1),e.preventDefault(),e.stopPropagation()):(document.execCommand("insertLineBreak"),e.preventDefault(),e.stopPropagation());break;case"Escape":t||a||n||s||!i&&this.handleCancel()&&(e.preventDefault(),e.stopPropagation());break;case"ArrowUp":if(!i&&!t&&!a&&!n&&!s){var h=this.newMessageRef.current;if(h&&!h.innerText){if(this.state.editMessageId)return;x.a.clientUpdate({"@type":"clientUpdateTryEditMessage"}),e.preventDefault(),e.stopPropagation()}}break;case"KeyB":t||!a&&!n||s||i||(this.handleBold(),e.preventDefault(),e.stopPropagation());break;case"KeyI":t||!a&&!n||s||i||(this.handleItalic(),e.preventDefault(),e.stopPropagation());break;case"KeyK":t||!a&&!n||s||i?!t||!a&&!n||s||i||(this.handleMono(),e.preventDefault(),e.stopPropagation()):(this.handleUrl(),e.preventDefault(),e.stopPropagation());break;case"KeyN":!t||!a&&!n||s||i||(this.handleClear(),e.preventDefault(),e.stopPropagation())}},this.handleSendPhoto=(e,t)=>{e&&this.sendMessage(e,!0,e=>{var a=le.a.get(e.chat_id,e.id);null!=a&&this.handleSendingMessage(a,t),U.a.uploadFile(e.content.photo.sizes[0].photo.id,e)})},this.handleSendPoll=e=>{this.sendMessage(e,!0,()=>{})},this.handleSendDocument=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.document.document.id,e))},this.handleSendAudio=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.audio.audio.id,e))},this.handleSendVoiceNote=(e,t)=>{e&&this.sendMessage(e,!0,e=>U.a.uploadFile(e.content.voice_note.voice.id,e))},this.handlePaste=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.clipboardData||a.originalEvent.clipboardData,i=n.items){e.next=3;break}return e.abrupt("return");case 3:if(r=[],Array.from(i).forEach(e=>{if(0===e.kind.indexOf("file")){var t=e.getAsFile();t&&r.push(t)}}),!(r.length>0)){e.next=9;break}return a.preventDefault(),t.handleSendFiles(r),e.abrupt("return");case 9:if(!(o=a.clipboardData.getData("text/plain"))){e.next=14;break}return a.preventDefault(),document.execCommand("insertText",!1,o),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handlePasteConfirm=()=>{var e=this.state.files;e&&e.length&&(e.forEach(e=>{var t={"@type":"inputMessageDocument",document:{"@type":"inputFileBlob",name:e.name,data:e}};this.handleSendDocument(t,e)}),this.handlePasteCancel())},this.handlePasteCancel=()=>{this.setState({files:null})},this.handleUpdateDraftConfirm=()=>{this.state.newDraft&&(this.loadDraft(),this.handleUpdateDraftCancel())},this.handleUpdateDraftCancel=()=>{this.setState({newDraft:null})},this.handleSendingMessage=(e,t)=>{if(e){var a=e.sending_state,n=e.content,s=e.chat_id,i=e.id;if(a&&"messageSendingStatePending"===a["@type"]&&"messagePhoto"===n["@type"]){var r=n.photo;if(r){var o=Object(M.q)(r.sizes,u.K);if(o){var l=o.photo;l&&(U.a.setBlob(l.id,t),U.a.updatePhotoBlob(s,i,l.id))}}}}},this.sendMessage=function(){var e=Object(i.a)(s.a.mark((function e(a,n,i){var r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,o=r.chatId,l=r.replyToMessageId,o){e.next=3;break}return e.abrupt("return");case 3:if(a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,na.a.invokeScheduledAction("clientUpdateClearHistory chatId=".concat(o));case 8:return e.next=10,x.a.send({"@type":"sendMessage",chat_id:o,reply_to_message_id:l,input_message_content:a});case 10:c=e.sent,t.setState({replyToMessageId:0},()=>{n&&t.saveDraft()}),x.a.send({"@type":"viewMessages",chat_id:o,message_ids:[c.id]}),l&&Object(re.l)(o,0),i(c),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),alert("sendMessage error "+JSON.stringify(e.t0));case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleEmojiSelect=e=>{e&&(this.restoreSelection(),document.execCommand("insertText",!1,e.native),this.handleInput())},this.handleInput=function(){var e=Object(i.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setTyping(),t.setHints(),t.setRecordingReadyState();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.openEditUrlDialog=()=>{var e="",t="",a=this.selection,n=this.range;if(n){var s=n.startContainer;if(s===n.endContainer){var i=s.parentElement;i&&"A"===i.nodeName&&(e=i.innerText,t=i.href)}}e||!a||a.isCollapsed||(e=a.toString()),this.setState({openEditUrl:!0,defaultUrl:t,defaultText:e})},this.closeEditUrlDialog=()=>{this.setState({openEditUrl:!1},()=>{this.restoreSelection()})},this.focusInput=()=>{var e=this.newMessageRef.current;if(e)if(e.childNodes.length){var t=za(e);if(t){var a=document.createRange();a.setStart(t,t.length),a.collapse(!0);var n=window.getSelection();n.removeAllRanges(),n.addRange(a),e.focus()}}else e.focus()},this.handleCancelEditUrl=()=>{this.closeEditUrlDialog()},this.handleDoneEditUrl=(e,t)=>{this.closeEditUrlDialog(),setTimeout(()=>{var a=this.range;if(a){var n=a.startContainer,s=a.endContainer;if(n&&n===s){var i=n.parentNode;if(i&&"A"===i.nodeName){i.href=t,i.title=t,i.innerText=e;var r=i.lastChild;if(r){var o=document.createRange();o.setStart(r,r.textContent.length),o.setEnd(r,r.textContent.length);var l=document.getSelection();l.removeAllRanges(),l.addRange(o)}return}}}var c="<a href=".concat(t," title=").concat(t," rel='noopener noreferrer' target='_blank'>").concat(e,"</a>");document.execCommand("removeFormat",!1,null),document.execCommand("insertHTML",!1,c)},0)},this.handleCancelEditMedia=()=>{this.closeEditMediaDialog()},this.handleEditMedia=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i,r,o,l,c,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=25;break}return e.next=3,t.editMessageMedia(n);case 3:if(!(i=e.sent)){e.next=24;break}r=i.content,e.t0=r["@type"],e.next="messagePhoto"===e.t0?9:24;break;case 9:if(o=n.photo){e.next=12;break}return e.abrupt("break",24);case 12:if(l=o.data){e.next=15;break}return e.abrupt("break",24);case 15:if(c=r.photo){e.next=18;break}return e.abrupt("break",24);case 18:if(h=c.sizes.find(e=>"i"===e.type)){e.next=21;break}return e.abrupt("break",24);case 21:return(d=h.photo)&&U.a.setBlob(d.id,l),e.abrupt("break",24);case 24:return e.abrupt("return");case 25:t.editMessageCaption(a);case 26:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.handleSendMedia=(e,t)=>{switch(this.closeEditMediaDialog(!1),e["@type"]){case"inputMessageAudio":this.handleSendAudio(e,t);break;case"inputMessagePhoto":this.handleSendPhoto(e,t);break;case"inputMessageDocument":this.handleSendDocument(e,t)}},this.handleHeaderClick=()=>{setTimeout(()=>this.restoreSelection(),0)},this.handleStopRecord=(e=!1)=>{this.recorder&&(this.recorder.cancelled=e,this.recorder.stop(),this.recorder.stream.getAudioTracks().forEach(e=>e.stop()))},this.handleCancelRecord=()=>{this.handleStopRecord(!0)},this.handleRecord=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.recorder){e.next=2;break}return e.abrupt("return");case 2:return a=null,e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:if(a=e.sent,!t.recorder){e.next=9;break}return e.abrupt("return");case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(3);case 13:if(a){e.next=16;break}return t.setState({recordPermissionDenied:!0}),e.abrupt("return");case 16:n={channelCount:1,sampleRate:48e3},a.getAudioTracks()[0].applyConstraints(n),i={mimeType:"audio/ogg; codecs=opus",audioBitsPerSecond:64e3},r={encoderWorkerFactory:function(){return new Worker("/telegram-react/opus-media-recorder/encoderWorker.umd.js")},OggOpusEncoderWasmPath:"/telegram-react/opus-media-recorder/OggOpusEncoder.wasm"},o=new ar.a(a,i,r),l=[],o.ondataavailable=e=>{l.push(e.data)},o.onstart=()=>{},o.onstop=()=>{x.a.clientUpdate({"@type":"clientUpdateRecordStop"}),t.setState({recordingTime:null});var e=t.recorder.cancelled;if(t.recorder=null,t.loadDraft(),!e){var a=new Blob(l,{type:"audio/ogg; codecs=opus"}),n=window.URL.createObjectURL(a),s=new Audio(n);s.oncanplay=()=>{var e={"@type":"inputMessageVoiceNote",voice_note:{"@type":"inputFileBlob",name:"",size:a.size,data:a},duration:Math.trunc(s.duration),waveform:"",caption:null};t.handleSendVoiceNote(e,a)}}},o.onerror=()=>{x.a.clientUpdate({"@type":"clientUpdateRecordError"}),t.setState({recordingTime:null}),t.loadDraft()},t.recorder=o,t.recorder.start(50),t.startTime=new Date,x.a.clientUpdate({"@type":"clientUpdateRecordStart"}),t.setState({recordingTime:new Date});case 32:case"end":return e.stop()}}),e,null,[[3,11]])}))),this.handleClosePermission=()=>{this.setState({recordPermissionDenied:!1})},this.attachDocumentRef=o.a.createRef(),this.attachPhotoRef=o.a.createRef(),this.newMessageRef=o.a.createRef();var a=na.a.getChatId();this.state={chatId:a,replyToMessageId:Object(V.m)(a),editMessageId:0,recordingReady:!0,recordingTime:null,recordPermissionDenied:!1,sendFile:null},document.execCommand("defaultParagraphSeparator",!1,"br")}shouldComponentUpdate(e,t){var a=this.props.t,n=this.state,s=n.chatId,i=n.newDraft,r=n.files,o=n.replyToMessageId,l=n.editMessageId,c=n.openEditMedia,h=n.openEditUrl,d=n.sendFile,p=n.recordingReady,u=n.recordingTime,m=n.recordPermissionDenied,f=n.shook;return e.t!==a||(t.chatId!==s||(t.newDraft!==i||(t.files!==r||(t.replyToMessageId!==o||(t.editMessageId!==l||(t.sendFile!==d||(t.openEditUrl!==h||(t.openEditMedia!==c||(t.recordingTime!==u||(t.recordingReady!==p||(t.recordPermissionDenied!==m||t.shook!==f)))))))))))}loadDraft(){this.setDraft(),this.setInputFocus(),this.handleInput()}saveDraft(){var e=this.state,t=e.chatId,a=e.editMessageId,n=e.replyToMessageId,s=this.newMessageRef.current;if(s){var i=null;i=a?this.beforeEditText?this.beforeEditText.innerHTML:null:s.innerHTML;var r=this.getDraftMessage(t,n,i);this.setChatDraftMessage(r)}}componentDidMount(){document.addEventListener("selectionchange",this.selectionChangeListener,!0),Kr.a.on("clientUpdateAnimationSend",this.onClientUpdateAnimationSend),na.a.on("clientUpdateInputShake",this.onClientUpdateInputShake),na.a.on("clientUpdateChatId",this.onClientUpdateChatId),na.a.on("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),Z.a.on("updateChatDraftMessage",this.onUpdateChatDraftMessage),U.a.on("clientUpdateSendFiles",this.onClientUpdateSendFiles),le.a.on("clientUpdateEditMessage",this.onClientUpdateEditMessage),le.a.on("clientUpdateReply",this.onClientUpdateReply),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),Jr.a.on("clientUpdateStickerSend",this.onClientUpdateStickerSend),this.loadDraft()}componentWillUnmount(){this.saveDraft(),Kr.a.off("clientUpdateAnimationSend",this.onClientUpdateAnimationSend),na.a.off("clientUpdateInputShake",this.onClientUpdateInputShake),na.a.off("clientUpdateChatId",this.onClientUpdateChatId),na.a.off("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),Z.a.off("updateChatDraftMessage",this.onUpdateChatDraftMessage),U.a.off("clientUpdateSendFiles",this.onClientUpdateSendFiles),le.a.off("clientUpdateEditMessage",this.onClientUpdateEditMessage),le.a.off("clientUpdateReply",this.onClientUpdateReply),le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),Jr.a.off("clientUpdateStickerSend",this.onClientUpdateStickerSend),document.removeEventListener("selectionchange",this.selectionChangeListener,!0),this.handleCancelRecord()}restoreDraftAndSelection(){var e=this.newMessageRef.current;if(e){var t=this.beforeEditText;if(t){if(e.innerHTML=t.innerHTML,!t.range)return void this.focusInput();var a=document.getSelection();a.removeAllRanges(),a.addRange(t.range),e.focus()}else e.innerHTML=null,this.focusInput();this.handleInput()}}saveDraftAndSelection(){var e=this.newMessageRef.current;e&&(this.beforeEditText={innerHTML:e.innerHTML,range:this.range})}setEditMessage(){var e=this.state,t=e.chatId,a=e.editMessageId,n=le.a.get(t,a);if(n){var s=n.content;if(s){var i=s.text,r=s.caption;if(i||r){var o=this.newMessageRef.current;i?this.setFormattedText(i):r?this.setFormattedText(r):o.innerText=null}}}}setFormattedText(e){var t=this.props.t,a=this.newMessageRef.current;if(e){var n=e.text,s=e.entities;try{var i=Object(it.s)(n,s,t);a.innerHTML=null,i.forEach(e=>{a.appendChild(e)})}catch(r){a.innerText=n}}else a.innerText=null}getNewItem(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",null);case 2:if((i=a.newMessageRef.current.innerHTML)&&(a.newMessageRef.current.innerHTML=null,a.handleInput()),!t){n.next=10;break}return n.next=7,Object(at.h)(e);case 7:n.t0=n.sent,n.next=13;break;case 10:return n.next=12,Object(at.g)(e);case 12:n.t0=n.sent;case 13:return r=n.t0,n.abrupt("return",{file:e,media:r,caption:i});case 15:case"end":return n.stop()}}),n)})))()}setTyping(){var e=this.state,t=e.chatId,a=e.editMessageId,n=Z.a.get(t);if(n){var s=this.newMessageRef.current;if(s){var i=s.innerHTML;if("<br>"!==i&&"<div><br></div>"!==i||(s.innerHTML=null),s.innerText)if(!Object(V.cb)(t))if(!a)(n.OutputTypingManager||(n.OutputTypingManager=new qr(n.id))).setTyping({"@type":"chatActionTyping"})}}}setHints(){var e=this.state.editMessageId,t=this.newMessageRef.current.innerText;if(!t||t.length>11||e){Jr.a.hint&&x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null})}else{performance.now();var a=er()().exec(t);performance.now();if(a&&t===a[0]){var n=Date.now();x.a.send({"@type":"getStickers",emoji:a[0],limit:100}).then(e=>{x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:{timestamp:n,emoji:a[0],stickers:e}})}),x.a.send({"@type":"searchStickers",emoji:a[0],limit:100}).then(e=>{x.a.clientUpdate({"@type":"clientUpdateRemoteStickersHint",hint:{timestamp:n,emoji:a[0],stickers:e}})})}else{Jr.a.hint&&x.a.clientUpdate({"@type":"clientUpdateLocalStickersHint",hint:null})}}}handleSendFiles(e){var t=this;return Object(i.a)(s.a.mark((function a(){var n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:if(e.length){a.next=4;break}return a.abrupt("return");case 4:if(1!==e.length){a.next=13;break}return a.next=7,t.getNewItem(e[0],e[0].type.startsWith("image"));case 7:if(n=a.sent){a.next=10;break}return a.abrupt("return");case 10:t.setState({openEditMedia:!0,newItem:n}),a.next=14;break;case 13:t.setState({files:e});case 14:case"end":return a.stop()}}),a)})))()}editMessageMedia(e){var t=this;return Object(i.a)(s.a.mark((function a(){var n,i,r;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=t.state,i=n.chatId,r=n.editMessageId,i){a.next=3;break}return a.abrupt("return");case 3:if(r){a.next=5;break}return a.abrupt("return");case 5:if(e){a.next=7;break}return a.abrupt("return");case 7:return a.abrupt("return",x.a.send({"@type":"editMessageMedia",chat_id:i,message_id:r,input_message_content:e}));case 8:case"end":return a.stop()}}),a)})))()}editMessageCaption(e){var t=this.state,a=t.chatId,n=t.editMessageId;a&&n&&e&&x.a.send({"@type":"editMessageCaption",chat_id:a,message_id:n,caption:e})}editMessageText(e,t){var a=this;return Object(i.a)(s.a.mark((function n(){var i,r,o,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=a.state,r=i.chatId,o=i.editMessageId,r){n.next=3;break}return n.abrupt("return");case 3:if(o){n.next=5;break}return n.abrupt("return");case 5:if(e){n.next=7;break}return n.abrupt("return");case 7:return n.prev=7,n.next=10,x.a.send({"@type":"editMessageText",chat_id:r,message_id:o,input_message_content:e});case 10:l=n.sent,t(l);case 12:return n.prev=12,n.finish(12);case 14:case"end":return n.stop()}}),n,null,[[7,,12,14]])})))()}setRecordingReadyState(){var e=this.state.editMessageId;this.newMessageRef.current.innerText||e?this.setState({recordingReady:!1}):this.setState({recordingReady:!0})}saveSelection(){this.selection=document.getSelection(),this.selection&&this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}restoreSelection(){var e=this.range;if(e){var t=document.getSelection();t.removeAllRanges(),t.addRange(e),this.newMessageRef.current.focus()}else this.focusInput()}closeEditMediaDialog(e=!0){var t=this.state.newItem;this.setState({openEditMedia:!1,newItem:null},()=>{e&&t&&t.caption?(this.newMessageRef.current.innerHTML=t.caption,this.focusInput(),this.handleInput()):this.restoreSelection()})}render(){var e=this.props.t,t=this.state,a=t.chatId,n=t.editMessageId,s=t.newItem,i=t.replyToMessageId,r=t.files,l=(t.newDraft,t.defaultText),h=t.defaultUrl,d=t.openEditUrl,p=t.openEditMedia,u=t.recordingReady,m=t.recordingTime,f=t.recordPermissionDenied,g=t.shook,C=n>0&&!Object(it.Q)(a,n),v=o.a.createElement(jt.a,{open:!m&&u,openIcon:o.a.createElement(ir,null),icon:o.a.createElement(sr,null)});return n&&(v=o.a.createElement(cs,null)),o.a.createElement("div",{className:"inputbox-background"},o.a.createElement("div",{className:c()("inputbox",{"inputbox-recording":m},{shook:g})},o.a.createElement("div",{className:c()("inputbox-bubble")},o.a.createElement(Fr,{chatId:a,messageId:i,editMessageId:p?0:n,onClick:this.handleHeaderClick}),o.a.createElement("div",{className:"inputbox-wrapper"},o.a.createElement("div",{className:"inputbox-left-column"},o.a.createElement(o.a.Suspense,{fallback:o.a.createElement(P.a,{className:"inputbox-icon-button","aria-label":"Emoticon"},o.a.createElement(nr.a,null))},o.a.createElement(Yr,{onSelect:this.handleEmojiSelect}))),o.a.createElement("div",{className:"inputbox-middle-column"},o.a.createElement("div",{id:"inputbox-message",className:"scrollbars-hidden",ref:this.newMessageRef,placeholder:e(C?"Caption":"Message"),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onInput:this.handleInput})),o.a.createElement("div",{className:"inputbox-right-column"},o.a.createElement(Hr,null),o.a.createElement("input",{ref:this.attachDocumentRef,className:"inputbox-attach-button",type:"file",multiple:"multiple",onChange:this.handleAttachDocumentComplete}),o.a.createElement("input",{ref:this.attachPhotoRef,className:"inputbox-attach-button",type:"file",multiple:"multiple",accept:"image/*",onChange:this.handleAttachPhotoComplete}),!Boolean(n)&&!m&&o.a.createElement(hr,{chatId:a,onAttachPhoto:this.handleAttachPhoto,onAttachDocument:this.handleAttachDocument,onAttachPoll:this.handleAttachPoll})))),m&&o.a.createElement("div",{className:"inputbox-cancel-record-button-background"},o.a.createElement(P.a,{className:"inputbox-cancel-record-button","aria-label":"Delete",size:"small",color:"secondary",onClick:this.handleCancelRecord},o.a.createElement(Qe,null))),o.a.createElement("div",{className:"inputbox-send-button-background"},o.a.createElement(P.a,{className:c()("inputbox-send-button",{"inputbox-send-accent-button":m||!u}),"aria-label":"Send",size:"small",onClick:this.handleSubmit},v))),!Object(V.db)(a)&&o.a.createElement(Or,{onSend:this.handleSendPoll}),o.a.createElement(Br,{files:r,onConfirm:this.handlePasteConfirm,onCancel:this.handlePasteCancel}),o.a.createElement(Nr,{open:d,defaultText:l,defaultUrl:h,onDone:this.handleDoneEditUrl,onCancel:this.handleCancelEditUrl}),o.a.createElement(Zr,{open:p,chatId:a,messageId:n,newItem:s,onEdit:this.handleEditMedia,onSend:this.handleSendMedia,onCancel:this.handleCancelEditMedia}),o.a.createElement(j.a,{transitionDuration:0,open:f,onClose:this.handleClosePermission,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},e("RecordDeniedTitle")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,e("RecordDeniedDescription"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleClosePermission,color:"primary"},e("Ok")))))}}var Qr=Object(_.a)()(Xr),$r=a(224),eo=a.n($r);a(577);class to extends o.a.Component{render(){var e=this.props,t=e.command,a=e.onCommand;return o.a.createElement("div",{className:"footer-command-wrapper"},o.a.createElement("div",{className:"footer-command-actions"},o.a.createElement(eo.a,{color:"primary",className:"footer-command-button",onClick:a},t)))}}var ao=to;var no=Object(_.a)()(class extends Ve{render(){var e=this.props.t,t=e(this.state.isMuted?"ChatsUnmute":"ChatsMute");return o.a.createElement(ao,{command:t,onCommand:this.handleSetChatNotifications})}});a(578);class so extends o.a.Component{constructor(...e){super(...e),this.onUpdateBasicGroup=e=>{var t=this.props.chatId;Object(V.M)(t,e.basic_group.id)&&this.forceUpdate()},this.onUpdateSupergroup=e=>{var t=this.props.chatId;Object(V.O)(t,e.supergroup.id)&&this.forceUpdate()},this.handleJoin=()=>{var e=this.props.chatId;e&&x.a.send({"@type":"joinChat",chat_id:e})},this.handleDeleteAndExit=()=>{var e=this.props.chatId;e&&x.a.send({"@type":"deleteChatHistory",chat_id:e,remove_from_chat_list:!0})}}shouldComponentUpdate(e,t){var a=this.props,n=a.t,s=a.chatId;return e.chatId!==s||e.t!==n}componentDidMount(){we.a.on("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.on("updateSupergroup",this.onUpdateSupergroup)}componentWillUnmount(){we.a.off("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.off("updateSupergroup",this.onUpdateSupergroup)}render(){var e=this.props,t=e.chatId,a=e.t,n=Z.a.get(t);if(!n)return null;var s=n.type;if(!s)return null;switch(s["@type"]){case"chatTypeBasicGroup":var i=we.a.get(s.basic_group_id);if(!i)return null;var r=i.status;if(!r)return null;var l=r.is_member,c=r.permissions;switch(r["@type"]){case"chatMemberStatusAdministrator":return o.a.createElement(Qr,null);case"chatMemberStatusBanned":return o.a.createElement(ao,{command:a("DeleteChat"),onCommand:this.handleDeleteAndExit});case"chatMemberStatusCreator":return l?o.a.createElement(Qr,null):o.a.createElement(ao,{command:a("JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusLeft":return null;case"chatMemberStatusMember":return o.a.createElement(Qr,null);case"chatMemberStatusRestricted":return l?c&&c.can_send_messages?o.a.createElement(Qr,null):null:o.a.createElement(ao,{command:a("JoinGroup"),onCommand:this.handleJoin})}break;case"chatTypePrivate":case"chatTypeSecret":return o.a.createElement(Qr,null);case"chatTypeSupergroup":var h=Oe.a.get(s.supergroup_id);if(!h)return null;var d=h.is_channel,p=h.status;if(!p)return null;var u=p.is_member,m=p.permissions;switch(p["@type"]){case"chatMemberStatusAdministrator":return o.a.createElement(Qr,null);case"chatMemberStatusBanned":return o.a.createElement(ao,{command:a("DeleteChat"),onCommand:this.handleDeleteAndExit});case"chatMemberStatusCreator":return u?o.a.createElement(Qr,null):o.a.createElement(ao,{command:a(d?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusLeft":return o.a.createElement(ao,{command:a(d?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin});case"chatMemberStatusMember":return d?o.a.createElement(no,{chatId:t}):o.a.createElement(Qr,null);case"chatMemberStatusRestricted":return u?m&&m.can_send_messages?o.a.createElement(Qr,null):null:o.a.createElement(ao,{command:a(d?"ChannelJoin":"JoinGroup"),onCommand:this.handleJoin})}}return null}}var io=Object(_.a)()(so);a(579);class ro extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={anchorEl:null},this.handleButtonClick=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.currentTarget,i=na.a.getChatId(),e.next=4,x.a.send({"@type":"getChat",chat_id:i});case 4:r=e.sent,Z.a.set(r),t.setState({anchorEl:n});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleMenuClose=()=>{this.setState({anchorEl:null})},this.handleChatInfo=()=>{this.handleMenuClose(),setTimeout(()=>this.props.openChatDetails(),150)},this.handleClearHistory=()=>{this.handleMenuClose(),Object(Fe.c)(na.a.getChatId())},this.handleDeleteChat=()=>{this.handleMenuClose(),Object(Fe.e)(na.a.getChatId())},this.handleUnpin=()=>{this.handleMenuClose();var e=na.a.getChatId();x.a.clientUpdate({"@type":"clientUpdateUnpin",chatId:e})}}render(){var e=this.props.t,t=this.state.anchorEl,a=na.a.getChatId(),n=Object(V.b)(a),s=Object(V.c)(a),i=Object(V.B)(a,e),r=Object(V.h)(a);return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{"aria-owns":t?"simple-menu":null,"aria-haspopup":"true",className:"main-menu-button","aria-label":"Menu",onClick:this.handleButtonClick},o.a.createElement(jn,null)),o.a.createElement(Za.a,{id:"main-menu",anchorEl:t,open:Boolean(t),onClose:this.handleMenuClose,getContentAnchorEl:null,disableAutoFocusItem:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(Ke.a,{onClick:this.handleChatInfo},o.a.createElement(Ee.a,null,Object(V.db)(a)?o.a.createElement(_a,null):o.a.createElement(Na,null)),o.a.createElement(Se.a,{primary:Object(V.L)(a,e)})),n&&o.a.createElement(Ke.a,{onClick:this.handleClearHistory},o.a.createElement(Ee.a,null,o.a.createElement(ka,null)),o.a.createElement(Se.a,{primary:e("ClearHistory")})),s&&i&&o.a.createElement(Ke.a,{onClick:this.handleDeleteChat},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:i})),r&&o.a.createElement(Ke.a,{onClick:this.handleUnpin},o.a.createElement(Ee.a,null,o.a.createElement(wa,null)),o.a.createElement(Se.a,{primary:e("UnpinMessageAlertTitle")}))))}}var oo=Object(h.a)(p.b,Object(_.a)())(ro);a(580);class lo extends o.a.Component{constructor(...e){super(...e),this.onUpdateChatOnlineMemberCount=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateChatTitle=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateUserChatAction=e=>{this.props.chatId===e.chat_id&&this.forceUpdate()},this.onUpdateUserStatus=e=>{var t=this.props.chatId,a=Z.a.get(t);if(a&&a.type)switch(a.type["@type"]){case"chatTypeBasicGroup":var n=we.a.getFullInfo(a.type.basic_group_id);if(n&&n.members)n.members.find(t=>t.user_id===e.user_id)&&this.forceUpdate();break;case"chatTypePrivate":case"chatTypeSecret":a.type.user_id===e.user_id&&this.forceUpdate()}},this.onUpdateUserFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);a&&a.type&&("chatTypePrivate"!==a.type["@type"]&&"chatTypeSecret"!==a.type["@type"]||a.type.user_id!==e.user_id||this.forceUpdate())},this.onUpdateBasicGroupFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);a&&a.type&&"chatTypeBasicGroup"===a.type["@type"]&&a.type.basic_group_id===e.basic_group_id&&this.forceUpdate()},this.onUpdateSupergroupFullInfo=e=>{var t=this.props.chatId,a=Z.a.get(t);a&&a.type&&"chatTypeSupergroup"===a.type["@type"]&&a.type.supergroup_id===e.supergroup_id&&this.forceUpdate()},this.onUpdateBasicGroup=e=>{var t=this.props.chatId,a=Z.a.get(t);a&&a.type&&"chatTypeBasicGroup"===a.type["@type"]&&a.type.basic_group_id===e.basic_group.id&&this.forceUpdate()},this.onUpdateSupergroup=e=>{var t=this.props.chatId,a=Z.a.get(t);a&&a.type&&"chatTypeSupergroup"===a.type["@type"]&&a.type.supergroup_id===e.supergroup.id&&this.forceUpdate()}}componentDidMount(){Z.a.on("updateChatOnlineMemberCount",this.onUpdateChatOnlineMemberCount),Z.a.on("updateChatTitle",this.onUpdateChatTitle),H.a.on("updateUserStatus",this.onUpdateUserStatus),Z.a.on("updateUserChatAction",this.onUpdateUserChatAction),H.a.on("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.on("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.on("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo),we.a.on("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.on("updateSupergroup",this.onUpdateSupergroup)}componentWillUnmount(){Z.a.off("updateChatOnlineMemberCount",this.onUpdateChatOnlineMemberCount),Z.a.off("updateChatTitle",this.onUpdateChatTitle),H.a.off("updateUserStatus",this.onUpdateUserStatus),Z.a.off("updateUserChatAction",this.onUpdateUserChatAction),H.a.off("updateUserFullInfo",this.onUpdateUserFullInfo),we.a.off("updateBasicGroupFullInfo",this.onUpdateBasicGroupFullInfo),Oe.a.off("updateSupergroupFullInfo",this.onUpdateSupergroupFullInfo),we.a.off("updateBasicGroup",this.onUpdateBasicGroup),Oe.a.off("updateSupergroup",this.onUpdateSupergroup)}render(){var e=this.props.chatId,t=Object(V.t)(e,!0),a=Object(V.P)(e);return o.a.createElement("div",{className:c()("header-chat-subtitle",{"header-chat-subtitle-accent":a})},t)}}var co=lo;a(581);class ho extends o.a.Component{render(){var e=this.props,t=e.className,a=e.chatId,n=e.onClick;return o.a.createElement("div",{className:c()("header-chat",t),onClick:n},o.a.createElement(K,{chatId:a,size:44}),o.a.createElement("div",{className:"header-chat-content"},o.a.createElement(xe,{chatId:a}),o.a.createElement(co,{chatId:a})))}}var po=ho;a(582);class uo extends o.a.Component{constructor(...e){super(...e),this.handleCancel=()=>{Object(re.a)()},this.handleDelete=()=>{var e,t=0,a=[],n=Object(hs.a)(le.a.selectedItems.values());try{for(n.s();!(e=n.n()).done;){var s=e.value,i=s.chatId,r=s.messageId;t=i,a.push(r)}}catch(o){n.e(o)}finally{n.f()}Object(re.c)(t,a)},this.handleForward=()=>{var e,t,a=[],n=Object(hs.a)(le.a.selectedItems.values());try{for(n.s();!(t=n.n()).done;){var s=t.value,i=s.chatId,r=s.messageId;e=i,a.push(r)}}catch(o){n.e(o)}finally{n.f()}Object(re.f)(e,a)}}render(){var e,t=this.props,a=t.t,n=t.count,s=!0,i=Object(hs.a)(le.a.selectedItems.values());try{for(i.s();!(e=i.n()).done;){var r=e.value,l=r.chatId,c=r.messageId,h=le.a.get(l,c);if(!h){s=!1;break}if(!h.can_be_deleted_only_for_self&&!h.can_be_deleted_for_all_users){s=!1;break}}}catch(v){i.e(v)}finally{i.f()}var d,p=!0,u=Object(hs.a)(le.a.selectedItems.values());try{for(u.s();!(d=u.n()).done;){var m=d.value,f=m.chatId,g=m.messageId,C=le.a.get(f,g);if(!C){p=!1;break}if(!C.can_be_forwarded){p=!1;break}}}catch(v){u.e(v)}finally{u.f()}return o.a.createElement("div",{className:"header-command"},p&&o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleForward},n<=1?a("Forward"):"".concat(a("Forward")," ").concat(n)),s&&o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleDelete},n<=1?a("Delete"):"".concat(a("Delete")," ").concat(n)),o.a.createElement("div",{className:"header-command-space"}),o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleCancel},a("Cancel")))}}var mo=Object(_.a)()(uo),fo=a(77);a(583);class go extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateUnpin=e=>{var t=e.chatId;this.props.chatId===t&&this.handleDelete()},this.onClientUpdateDialogsReady=e=>{this.state.messageId&&this.loadContent()},this.onClientUpdateSetChatClientData=e=>{var t=e.chatId,a=e.clientData;this.props.chatId===t&&this.setState({clientData:a})},this.onUpdateChatPinnedMessage=e=>{var t=e.chat_id,a=e.pinned_message_id;this.props.chatId===t&&this.setState({messageId:a})},this.loadContent=()=>{var e=this.props.chatId,t=this.state.messageId;e&&(t&&(le.a.get(e,t)||x.a.send({"@type":"getMessage",chat_id:e,message_id:t}).then(e=>{le.a.set(e);var t=U.a.getStore();Object(G.B)(t,[e]),this.forceUpdate()}).catch(a=>{a.code;if("Chat not found"!==a.message){var n={"@type":"deletedMessage",chat_id:e,id:t,content:null};le.a.set(n),this.forceUpdate()}})))},this.handleClick=e=>{var t=this.props.chatId,a=this.state.messageId;a&&Object(re.i)(t,a)},this.handleDelete=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),n=t.props.chatId,i=t.state.messageId,!Object(V.d)(n)){e.next=8;break}t.setState({confirm:!0}),e.next=11;break;case 8:return r=Z.a.getClientData(n),e.next=11,x.a.clientUpdate({"@type":"clientUpdateSetChatClientData",chatId:n,clientData:Object.assign({},r,{unpinned_message_id:i})});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleUnpin=Object(i.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.props.chatId,t.handleClose(),x.a.send({"@type":"unpinChatMessage",chat_id:a});case 3:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{this.setState({confirm:!1})},this.state={}}static getDerivedStateFromProps(e,t){var a=t.prevPropsChatId,n=e.chatId;if(a!==n){var s=Z.a.get(n);return{prevPropsChatId:n,clientData:Z.a.getClientData(n),messageId:s&&s.pinned_message_id?s.pinned_message_id:0,confirm:!1}}return null}componentDidUpdate(e,t,a){var n=this.state.messageId;n&&t.messageId!==n&&this.loadContent()}componentDidMount(){this.loadContent(),na.a.on("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Z.a.on("clientUpdateSetChatClientData",this.onClientUpdateSetChatClientData),Z.a.on("clientUpdateUnpin",this.onClientUpdateUnpin),Z.a.on("updateChatPinnedMessage",this.onUpdateChatPinnedMessage)}componentWillUnmount(){na.a.off("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Z.a.off("clientUpdateSetChatClientData",this.onClientUpdateSetChatClientData),Z.a.off("clientUpdateUnpin",this.onClientUpdateUnpin),Z.a.off("updateChatPinnedMessage",this.onUpdateChatPinnedMessage)}shouldComponentUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.t,r=n.theme,o=this.state,l=o.clientData,c=o.confirm,h=o.messageId;return e.t!==i||(e.theme!==r||(e.chatId!==s||(t.clientData!==l||(t.confirm!==c||t.messageId!==h))))}render(){var e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.messageId,i=n.confirm;if(!t)return null;if(Z.a.getClientData(t).unpinned_message_id===s)return null;var r=le.a.get(t,s);if(!r)return null;var l=r?Object(it.i)(r,a):a("Loading"),c=Object(it.u)(t,s),h=Object(it.t)(t,s);return Object(it.J)(r)&&(l=a("DeletedMessage")),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"pinned-message",onMouseDown:this.handleClick},o.a.createElement("div",{className:"border reply-border"}),c&&o.a.createElement(jr,{chatId:t,messageId:s,photoSize:c,minithumbnail:h}),o.a.createElement("div",{className:"pinned-message-content"},o.a.createElement("div",{className:"pinned-message-title"},a("PinnedMessage")),o.a.createElement("div",{className:"pinned-message-subtitle"},l))),i&&o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:!0,onClose:this.handleClose,"aria-labelledby":"unpin-message-confirmation"},o.a.createElement(R.a,{id:"unpin-message-confirmation"},a("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,a("UnpinMessageAlert"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleClose,color:"primary"},a("Cancel")),o.a.createElement(N.a,{onClick:this.handleUnpin,color:"primary"},a("Ok")))))}}var Co=Object(_.a)()(go);class vo extends r.Component{constructor(...e){super(...e),this.state={authorizationState:na.a.getAuthorizationState(),connectionState:na.a.getConnectionState()},this.onClientUpdateMessageSelected=e=>{this.setState({selectionCount:le.a.selectedItems.size})},this.onClientUpdateChatId=e=>{this.forceUpdate()},this.onUpdateConnectionState=e=>{this.setState({connectionState:e.state})},this.onUpdateAuthorizationState=e=>{this.setState({authorizationState:e.authorization_state})},this.openChatDetails=()=>{var e=na.a.getChatId();Z.a.get(e)&&(na.a.isSmallWidth?Object(re.i)(e,null,!0):Object(Fe.b)(!0))},this.handleSearchChat=()=>{var e=na.a.getChatId();Z.a.get(e)&&Object(re.m)(e)},this.localize=e=>(0,this.props.t)(e).replace("...","").replace("\u2026","")}componentDidMount(){na.a.on("clientUpdateChatId",this.onClientUpdateChatId),na.a.on("updateAuthorizationState",this.onUpdateAuthorizationState),na.a.on("updateConnectionState",this.onUpdateConnectionState),le.a.on("clientUpdateClearSelection",this.onClientUpdateMessageSelected),le.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId),na.a.off("updateAuthorizationState",this.onUpdateAuthorizationState),na.a.off("updateConnectionState",this.onUpdateConnectionState),le.a.off("clientUpdateClearSelection",this.onClientUpdateMessageSelected),le.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected)}render(){var e=this.props.t,t=this.state,a=t.authorizationState,n=t.connectionState,s=t.selectionCount,i=null;s&&(i=o.a.createElement(mo,{count:s}));var r=na.a.getChatId(),l=Z.a.get(r),h=Object(V.P)(r),d=Object(V.v)(r,!0,e),p=Object(V.t)(r,!0),u=!1;if(n)switch(n["@type"]){case"connectionStateConnecting":d=this.localize("Connecting"),p="",u=!0;break;case"connectionStateConnectingToProxy":d=this.localize("Connecting to proxy"),p="",u=!0;break;case"connectionStateReady":break;case"connectionStateUpdating":d=this.localize("Updating"),p="",u=!0;break;case"connectionStateWaitingForNetwork":d=this.localize("Waiting for network"),p="",u=!0}else if(a)switch(a["@type"]){case"authorizationStateClosed":case" authorizationStateClosing":break;case"authorizationStateLoggingOut":d=this.localize("Logging out"),p="",u=!0;break;case"authorizationStateReady":case"authorizationStateWaitCode":break;case"authorizationStateWaitEncryptionKey":d=this.localize("Loading"),p="",u=!0;break;case"authorizationStateWaitPassword":case"authorizationStateWaitPhoneNumber":break;case"authorizationStateWaitTdlibParameters":d=this.localize("Loading"),p="",u=!0}else d=this.localize("Loading"),p="",u=!0;return i=i||o.a.createElement("div",{className:"header-details"},u?o.a.createElement("div",{className:c()("header-status","grow",l?"cursor-pointer":"cursor-default"),onClick:this.openChatDetails},o.a.createElement("span",{className:"header-status-content"},d),o.a.createElement(fo.a,null),o.a.createElement("span",{className:c()("header-status-title",{"header-status-accent":h})},p),o.a.createElement("span",{className:"header-status-tail"})):o.a.createElement(po,{className:c()("grow","cursor-pointer"),chatId:r,onClick:this.openChatDetails}),o.a.createElement(Co,{chatId:r}),l&&o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{className:"header-right-second-button","aria-label":"Search",onClick:this.handleSearchChat},o.a.createElement(Pt,null)),o.a.createElement(oo,{openChatDetails:this.openChatDetails})))}}var bo=Object(_.a)()(vo),Eo=a(592),So=a.n(Eo),yo=a(591),Mo=a.n(yo),Io=a(216),Uo=a.n(Io),ko=a(217),xo=a.n(ko),wo=a(218),Oo=a.n(wo),Lo=a(120),_o=a.n(Lo);a(584);class No extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null,value:k.b.volume,prevValue:k.b.volume,dragging:!1,buttonOver:!1,popupOver:!1},this.onClientUpdateMediaVolume=e=>{var t=e.volume,a=e.prevVolume;void 0===a?this.setState({value:t}):this.setState({value:t,prevValue:a})},this.handlePopoverOpen=e=>{this.setState({anchorEl:e})},this.handlePopoverClose=()=>{var e=this.state,t=e.dragging,a=e.buttonOver,n=e.popupOver;t||a||n||this.setState({anchorEl:null})},this.handleMouseEnter=(e,t)=>{this.setState({buttonOver:!0}),t&&this.handlePopoverOpen(e.currentTarget)},this.handleMouseLeave=()=>{this.setState({buttonOver:!1},()=>{this.handlePopoverClose()})},this.handlePopupMouseLeave=()=>{this.setState({popupOver:!1},()=>{this.handlePopoverClose()})},this.handleVoiceClick=()=>{var e=this.state,t=e.value,a=e.prevValue,n=t>0?0:a||u.cb;x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:n})},this.handleChange=(e,t)=>{var a=this.state,n=a.dragging,s=a.prevValue;n?x.a.clientUpdate({"@type":"clientUpdateMediaVolume",volume:t}):x.a.clientUpdate({"@type":"clientUpdateMediaVolume",prevVolume:t>0?t:s,volume:t})},this.handleDragStart=()=>{var e=this.state.value;this.setState({dragging:!0,prevValue:e})},this.handleDragEnd=()=>{var e=this.state,t=e.value,a=e.prevValue;this.setState({dragging:!1,prevValue:t>0?t:a},()=>{this.handlePopoverClose()})},this.getVolumeIcon=e=>0===e?o.a.createElement(_o.a,{fontSize:"small"}):e<.25?o.a.createElement(Uo.a,{fontSize:"small"}):e<.5?o.a.createElement(xo.a,{fontSize:"small"}):o.a.createElement(Oo.a,{fontSize:"small"})}componentDidMount(){k.b.on("clientUpdateMediaVolume",this.onClientUpdateMediaVolume)}componentWillUnmount(){k.b.off("clientUpdateMediaVolume",this.onClientUpdateMediaVolume)}render(){var e=this.state,t=e.anchorEl,a=e.value,n=Boolean(t);return o.a.createElement("div",{onMouseEnter:e=>this.handleMouseEnter(e,!0),onMouseLeave:this.handleMouseLeave,style:{position:"relative",background:"transparent"}},o.a.createElement(P.a,{className:"header-player-button",color:"primary",onClick:this.handleVoiceClick},this.getVolumeIcon(a)),o.a.createElement("div",{style:{position:"absolute",background:"transparent",visibility:n?"visible":"hidden",zIndex:1},onMouseEnter:e=>this.handleMouseEnter(e,!1),onMouseLeave:this.handlePopupMouseLeave},o.a.createElement("div",{className:"volume-button-panel"},o.a.createElement(f.a,{min:0,max:1,step:.01,value:a,onChange:this.handleChange,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,orientation:"vertical"}))))}}var Po=No,jo=a(585),Do=a.n(jo),Ro=a(586),To=a.n(Ro);class Fo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaRepeat=e=>{var t=e.repeat;this.setState({repeat:t})},this.handleRepeat=()=>{var e=this.state.repeat,t=e;switch(e){case k.a.NONE:t=k.a.REPEAT;break;case k.a.REPEAT:t=k.a.REPEAT_ONE;break;case k.a.REPEAT_ONE:t=k.a.NONE}x.a.clientUpdate({"@type":"clientUpdateMediaRepeat",repeat:t})},this.getIcon=e=>{switch(e){case k.a.NONE:case k.a.REPEAT:return o.a.createElement(Do.a,{fontSize:"small"});case k.a.REPEAT_ONE:return o.a.createElement(To.a,{fontSize:"small"});default:return o.a.createElement(Do.a,{fontSize:"small"})}};var t=k.b.repeat;this.state={repeat:t}}componentDidMount(){k.b.on("clientUpdateMediaRepeat",this.onClientUpdateMediaRepeat)}componentWillUnmount(){k.b.off("clientUpdateMediaRepeat",this.onClientUpdateMediaRepeat)}render(){var e=this.state.repeat;return o.a.createElement(P.a,{className:"header-player-button",color:e===k.a.NONE?"default":"primary",onClick:this.handleRepeat},this.getIcon(e))}}var Ao=Fo,Bo=a(587),Vo=a.n(Bo);class Ho extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaShuffle=e=>{var t=e.shuffle;this.setState({shuffle:t})},this.handleShuffle=()=>{var e=this.state.shuffle;x.a.clientUpdate({"@type":"clientUpdateMediaShuffle",shuffle:!e})};var t=k.b.shuffle;this.state={shuffle:t}}componentDidMount(){k.b.on("clientUpdateMediaShuffle",this.onClientUpdateMediaShuffle)}componentWillUnmount(){k.b.off("clientUpdateMediaShuffle",this.onClientUpdateMediaShuffle)}render(){var e=this.state.shuffle;return o.a.createElement(P.a,{className:"header-player-button",color:e?"primary":"default",onClick:this.handleShuffle},o.a.createElement(Vo.a,{fontSize:"small"}))}}var zo=Ho;class Wo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaPlaybackRate=e=>{var t=e.playbackRate;this.setState({playbackRate:t})},this.onClientUpdateMediaAudioPlaybackRate=e=>{var t=e.audioPlaybackRate;this.setState({audioPlaybackRate:t})},this.handlePlaybackRate=()=>{var e=this.props.audio,t=this.state,a=t.audioPlaybackRate,n=t.playbackRate,s=(e?a:n)===u.S?u.P:u.S;e?x.a.clientUpdate({"@type":"clientUpdateMediaAudioPlaybackRate",audioPlaybackRate:s}):x.a.clientUpdate({"@type":"clientUpdateMediaPlaybackRate",playbackRate:s})};var t=k.b.audioPlaybackRate,a=k.b.playbackRate;this.state={audioPlaybackRate:t,playbackRate:a}}componentDidMount(){k.b.on("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.on("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate)}componentWillUnmount(){k.b.off("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.off("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate)}render(){var e=this.props.audio,t=this.state,a=t.audioPlaybackRate,n=t.playbackRate,s=e?a:n;return o.a.createElement(P.a,{className:"header-player-button",color:s>u.S?"primary":"default",onClick:this.handlePlaybackRate},o.a.createElement("div",{className:"header-player-playback-icon"},"2X"))}}Wo.defaultProps={audio:!1};var Go=Wo;a(588);class Zo extends o.a.Component{constructor(e){super(e),this.onClientUpdateMediaTime=e=>{var t=e.currentTime,a=e.duration,n=this.state.reverse;this.setState({currentTime:t,duration:a,currentTimeString:Object(M.h)(Math.floor(t||0),a,n)})},this.handleReverse=e=>{e.stopPropagation(),e.preventDefault();var t=this.state,a=t.currentTime,n=t.duration,s=t.reverse;this.setState({reverse:!s,currentTimeString:Object(M.h)(Math.floor(a||0),n,!s)})};var t=this.props.duration;this.state={reverse:!1,currentTime:0,duration:t,currentTimeString:Object(M.h)(0,t,!1)}}componentDidMount(){k.b.on("clientUpdateMediaTime",this.onClientUpdateMediaTime)}componentWillUnmount(){k.b.off("clientUpdateMediaTime",this.onClientUpdateMediaTime)}render(){var e=this.state.currentTimeString;return o.a.createElement("div",{className:"header-player-time",onClick:this.handleReverse},e)}}var qo=Zo,Ko=a(32),Jo=a.n(Ko),Yo=a(131),Xo=a(133),Qo=a(27),$o=a(46);a(589);class el extends o.a.Component{constructor(e){super(e),this.scrollToActive=()=>{var e=this.listRef.current;if(e){var t=this.state,a=t.playlist,n=t.message,s=t.block;if((n||s)&&a){var i=[...a.items].reverse().findIndex(e=>Object(Qo.f)(e,n||s));if(-1!==i){var r=this.itemRefMap.get(i);if(r){var o=Ko.findDOMNode(r);o&&(e.scrollTop=o.offsetTop-15)}}}}},this.onClientUpdateMediaTitleMouseOver=e=>{var t=e.over;t?this.setState({playlistMouseOver:t},()=>{this.tryOpen()}):this.setState({playlistMouseOver:t},()=>{this.tryClose()})},this.onClientUpdateMediaActive=e=>{var t=e.source;switch(t["@type"]){case"message":this.setState({message:t,block:null});break;case"instantViewSource":this.setState({message:null,block:t.block})}},this.onClientUpdateMediaPlaylistLoading=e=>{var t=this.state,a=t.message,n=t.block,s=e.source,i=a?a.chat_id:0,r=a?a.id:0;Object(Qo.e)(i,r,n,s)&&this.setState({playlist:null})},this.onClientUpdateMediaPlaylist=e=>{var t=this.state,a=t.message,n=t.block,s=e.source,i=e.playlist,r=a?a.chat_id:0,o=a?a.id:0;Object(Qo.e)(r,o,n,s)&&this.setState({playlist:i})},this.tryOpen=()=>{clearTimeout(this.openTimeout),this.openTimeout=setTimeout(()=>{var e=this.state,t=e.titleMouseOver,a=e.playlistMouseOver;this.setState({open:t||a})},250)},this.tryClose=()=>{clearTimeout(this.timeout),this.timeout=setTimeout(()=>{var e=this.state,t=e.titleMouseOver,a=e.playlistMouseOver;this.setState({open:t||a})},250)},this.handleMouseEnter=()=>{this.setState({playlistMouseOver:!0,open:!0})},this.handleMouseLeave=()=>{this.setState({playlistMouseOver:!1},()=>{this.tryClose()})},this.handleScroll=()=>{var e=this.listRef.current;e&&(e.scrollTop<=u.yb?x.a.clientUpdate({"@type":"clientUpdateMediaPlaylistNext"}):e.scrollTop+e.offsetHeight>=e.scrollHeight-u.yb&&x.a.clientUpdate({"@type":"clientUpdateMediaPlaylistPrev"}))},this.listRef=o.a.createRef(),this.itemRefMap=new Map;var t=k.b.message,a=k.b.block,n=k.b.playlist;this.state={message:t,block:a,playlist:n,open:!1,titleMouseOver:!1,playlistMouseOver:!1}}componentDidUpdate(e,t,a){var n=this.state.open;!t.open&&n&&this.scrollToActive()}componentDidMount(){k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.on("clientUpdateMediaPlaylistLoading",this.onClientUpdateMediaPlaylistLoading),k.b.on("clientUpdateMediaTitleMouseOver",this.onClientUpdateMediaTitleMouseOver)}componentWillUnmount(){k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.off("clientUpdateMediaPlaylistLoading",this.onClientUpdateMediaPlaylistLoading),k.b.off("clientUpdateMediaTitleMouseOver",this.onClientUpdateMediaTitleMouseOver)}getPageBlock(e,t){if(!e)return null;var a=null;switch(e["@type"]){case"pageBlockAudio":a=o.a.createElement(Yo.a,{block:e,audio:e.audio,openMedia:()=>Object($o.o)(e.audio,e.caption,e,t,!0)});break;case"pageBlockVoiceNote":a=o.a.createElement(Xo.a,{block:e,voiceNote:e.voice_note,openMedia:()=>Object($o.o)(e.voice_note,e.caption,e,t,!0)})}return a}render(){var e=this.state,t=e.open,a=e.playlist;if(!t)return null;if(!a)return null;var n=a.items;if(!n)return null;if(n.length<=1)return null;this.itemRefMap.clear();var s=null;"instantViewSource"===n[0]["@type"]&&(s=a.source.instantView);var i="message"===n[0]["@type"]?e=>Object(at.f)(e,()=>Object(it.T)(e.chat_id,e.id)):e=>this.getPageBlock(e,s);return o.a.createElement("div",{className:"playlist"},o.a.createElement("div",{className:"playlist-wrapper"},o.a.createElement("div",{ref:this.listRef,className:"playlist-items",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onScroll:this.handleScroll},[...n].reverse().map((e,t)=>o.a.createElement("div",{key:e.id||t,ref:e=>this.itemRefMap.set(t,e),className:"playlist-item"},i(e))))))}}var tl=el;var al=null,nl=new Map,sl=new Map;function il(e){return rl.apply(this,arguments)}function rl(){return(rl=Object(i.a)(s.a.mark((function e(t){var a,n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=null,!nl.has(t)){e.next=6;break}a=nl.get(t),e.next=14;break;case 6:return n=al=new Date,e.next=9,x.a.send({"@type":"getWebPageInstantView",url:t,force_full:!0});case 9:if(a=e.sent,nl.set(t,a),sl.set(a,t),al===n){e.next=14;break}return e.abrupt("return");case 14:console.log("[IV] open",a),Object(G.z)(a),Object(re.o)({instantView:a,url:t}),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),(i=window.open()).opener=null,i.location=t;case 24:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}a(590);class ol extends o.a.Component{constructor(e){super(e),this.handleSeekForward=()=>{var e=this.videoRef.current;e&&this.handleSeek(e.currentTime+u.X)},this.handleSeekBackward=()=>{var e=this.videoRef.current;e&&this.handleSeek(e.currentTime-u.X)},this.handleSeekTo=e=>{this.videoRef.current&&this.handleSeek(e.seekTime)},this.handleSeek=e=>{var t=this.videoRef.current;t&&(e=Object(M.d)(e,0,t.duration||0),t.currentTime=e)},this.onClientUpdateRecordStart=e=>{var t=this.videoRef.current;t&&(t.paused||(this.fadeOutVolume(250),this.pausedForRecord=!0))},this.onClientUpdateRecordStop=e=>{var t=this.videoRef.current;t&&t.paused&&this.pausedForRecord&&(this.fadeInVolume(250),this.pausedForRecord=!1)},this.onClientUpdateMediaPlaybackRate=e=>{var t=e.playbackRate,a=this.state,n=a.message,s=a.block;if((n||s)&&!Object(it.E)(n||s)){var i=this.videoRef.current;i&&(i.playbackRate=t)}},this.onClientUpdateMediaAudioPlaybackRate=e=>{var t=e.audioPlaybackRate,a=this.state,n=a.message,s=a.block;if((n||s)&&Object(it.E)(n||s)&&Object(it.W)(n||s)){var i=this.videoRef.current;i&&(i.playbackRate=t)}},this.onClientUpdateMediaVolume=e=>{var t=e.volume,a=this.videoRef.current;a&&(a.volume=t)},this.onClientUpdateMediaSeek=e=>{var t=e.source,a=e.value,n=e.duration,s=this.state,i=s.message,r=s.block;if(Object(Qo.e)(i?i.chat_id:0,i?i.id:0,r,t)){var o=this.videoRef.current;o&&(o.duration?o.currentTime=a*o.duration:this.currentValue={value:a,duration:n})}},this.onClientUpdateMediaViewerContent=e=>{this.playingMediaViewer=Boolean(na.a.mediaViewerContent)},this.onClientUpdateMediaViewerEnded=e=>{this.playingMediaViewer=!1},this.onClientUpdateMediaViewerPause=e=>{this.playingMediaViewer=!1},this.onClientUpdateMediaViewerPlay=e=>{this.playingMediaViewer=!0,this.videoRef.current&&this.fadeOutVolume(250)},this.startPlayingFile=e=>{if(e){var t=k.b.playlist,a=this.state.src,n=Object(Qo.c)(e),s=Object(Qo.b)(e),i=Object(Qo.a)(e),r=i.currentTime,o=i.duration,l=Boolean(n),c="instantViewSource"===e["@type"]?{message:null,block:e.block,instantView:e.instantView}:{message:e,block:null,instantView:null};this.setState(Object(Ze.a)(Object(Ze.a)({currentTime:r,duration:o,playlist:t,playing:l,src:n},c),{},{mimeType:s}),()=>{var t=this.videoRef.current;t&&(a!==n&&(t.load(),this.currentValue?(t.currentTime=this.currentValue.value*this.currentValue.duration,this.currentValue=null):t.currentTime=r),this.playingMediaViewer?(t.pause(),x.a.clientUpdate({"@type":"clientUpdateMediaPause",source:e})):t.paused&&t.play())})}},this.onClientUpdateMediaBlob=e=>{var t=e.chatId,a=e.messageId,n=e.fileId,s=this.state,i=s.message,r=s.block,o=s.instantView;if(i){var l=i.chat_id,c=i.id,h=i.content;if(!h)return;if(t!==l||a!==c)return;var d=!1;switch(h["@type"]){case"messageText":var p=h.web_page;if(p){var u=p.audio,m=p.voice_note,f=p.video_note;if(u){if(Object(G.Q)())return;if(u.audio){d=!0;break}}if(m)if(m.voice){d=!0;break}if(f)if(f.video){d=!0;break}}break;case"messageAudio":var g=h.audio;if(g){if(Object(G.Q)())return;if(g.audio){d=!0;break}}break;case"messageVoiceNote":var C=h.voice_note;if(C)if(C.voice){d=!0;break}break;case"messageVideoNote":var v=h.video_note;if(v)if(v.video){d=!0;break}}d&&this.startPlayingFile(i)}else if(r){var b=!1;switch(r["@type"]){case"pageBlockAudio":var E=r.audio;if(E){if(Object(G.Q)())return;var S=E.audio;S&&S.id===n&&(b=!0)}break;case"pageBlockVoiceNote":var y=r.voice_note;if(y){var M=y.voice;M&&M.id===n&&(b=!0)}break;case"pageBlockVideoNote":var I=r.video_note;if(I){var U=I.video;U&&U.id===n&&(b=!0)}}b&&this.startPlayingFile({"@type":"instantViewSource",block:r,instantView:o})}},this.onClientUpdateMediaPlaylist=e=>{var t=e.playlist,a=e.source,n=this.state,s=n.message,i=n.block,r=s?s.chat_id:0,o=s?s.id:0;Object(Qo.e)(r,o,i,a)&&this.setState({playlist:t})},this.onClientUpdateMediaClose=e=>{this.setState({message:null,block:null,instantView:null,playlist:null,playing:!1,src:null,mimeType:null},()=>{var e=this.videoRef.current;e&&e.load()})},this.onClientUpdateMediaActive=e=>{var t=e.source,a=this.state,n=a.message,s=a.block,i=a.src;if(Object(Qo.e)(n?n.chat_id:0,n?n.id:0,s,t)){if(!i)return;var r=this.videoRef.current;if(!r)return;this.pausedForRecord=!1,r.paused?r.play():r.pause()}else this.startPlayingFile(t)},this.handlePrev=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaPrev"})},this.handlePlay=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;if(t||a){var s=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaActive",source:s})}},this.handleNext=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaNext"})},this.handleEnded=(e=!0)=>{var t=this.state,a=t.message,n=t.block,s=t.instantView;if(a||n){var i=a||{"@type":"instantViewSource",block:n,instantView:s};x.a.clientUpdate({"@type":"clientUpdateMediaEnding",source:i,moveNext:e}),this.setState({},()=>{x.a.clientUpdate({"@type":"clientUpdateMediaEnd",source:i,moveNext:e})})}},this.handleVideoEnded=()=>{var e=this.videoRef.current;this.setCurrentTime({currentTime:0,duration:e.duration}),this.handleEnded(!0)},this.handleClose=()=>{var e=this.videoRef.current;e&&e.pause(),this.handleEnded(!1)},this.handleLoadedMetadata=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView,s=e.currentTime;if(t||a){var i=this.videoRef.current;if(i){var r=k.b.audioPlaybackRate,o=k.b.playbackRate,l=k.b.volume,c=Object(it.E)(t||a),h=Object(it.G)(t||a),d=u.S;h?d=o:c&&Object(it.W)(t||a)&&(d=r),i.playbackRate=d,i.volume=l,i.muted=!1,this.currentValue?(i.currentTime=i.duration*this.currentValue.value,this.currentValue=null):i.currentTime=s,i.play();var p=i.buffered,m=i.duration,f=i.videoWidth,g=i.videoHeight,C=t||{"@type":"instantViewSource",block:a,instantView:n};if(x.a.clientUpdate({"@type":"clientUpdateMediaLoadedMetadata",source:C,buffered:p,duration:m,videoWidth:f,videoHeight:g}),!c&&!h){var v=null;"captureStream"in i?v=i.captureStream():"mozCaptureStream"in i&&(v=i.mozCaptureStream()),v&&x.a.clientUpdate({"@type":"clientUpdateMediaCaptureStream",chatId:t.chat_id,messageId:t.id,stream:v})}}}},this.handleProgress=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;if(t||a){var s=this.videoRef.current;if(s){var i=s.buffered,r=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaProgress",source:r,buffered:i})}}},this.handleTimeUpdate=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;if(t||a){var s=this.videoRef.current;if(s){var i=s.currentTime,r=s.buffered,o=s.duration;this.setState({currentTime:i});var l=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaTime",source:l,duration:o,currentTime:i,buffered:r,timestamp:Date.now()}),this.setCurrentTime({currentTime:i,duration:o})}}},this.handleCanPlay=()=>{},this.handleVideoPlay=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;if(t||a){this.setState({playing:!0});var s=this.videoRef.current;if(s){var i=s.currentTime,r=s.duration,o=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaPlay",source:o,currentTime:i,duration:r,timestamp:Date.now()})}}},this.handleVideoPause=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;if((t||a)&&(this.setState({playing:!1}),this.videoRef.current)){var s=t||{"@type":"instantViewSource",block:a,instantView:n};x.a.clientUpdate({"@type":"clientUpdateMediaPause",source:s})}},this.hasPrev=(e,t)=>{if(!e)return!1;if(!t||!t.items.length)return!1;var a=t.items.findIndex(t=>Object(Qo.f)(t,e));return-1!==a&&a+1<t.items.length},this.hasNext=(e,t)=>{if(!e)return!1;if(!t||!t.items.length)return!1;var a=t.items.findIndex(t=>Object(Qo.f)(t,e));return-1!==a&&a-1>=0},this.handleTitleMouseEnter=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaTitleMouseOver",over:!0})},this.handleTitleMouseLeave=()=>{x.a.clientUpdate({"@type":"clientUpdateMediaTitleMouseOver",over:!1})},this.handleTitleClick=()=>{var e=this.state,t=e.message,a=e.block,n=e.instantView;t?Object(re.i)(t.chat_id,t.id):a&&n&&function(e,t){var a=sl.get(e);a&&(console.log("[IV] open",e),Object(G.z)(e),Object(re.o)({instantView:e,block:t,url:a}))}(n,a)},this.setCurrentTime=e=>{var t=this.state,a=t.message,n=t.block;if((a||n)&&Object(it.W)(a||n)){var s=Object(it.q)(a.chat_id,a.id);if(s){var i=s.audio;if(i){var r=i.remote;if(r){var o=r.unique_id;o&&(e?k.b.setCurrentTime(o,e):k.b.clearCurrentTime(o))}}}}},this.videoRef=o.a.createRef();var t=k.b.message,a=k.b.block,n=k.b.instantView,s=k.b.playlist,i=Object(Qo.a)(t),r=i.currentTime,l=i.duration;this.state={currentTime:r,duration:l,message:t,block:a,instantView:n,playlist:s,playing:!1,src:Object(Qo.c)(t),mimeType:Object(Qo.b)(t)}}shouldComponentUpdate(e,t,a){var n=this.state,s=n.message,i=n.block,r=n.playlist,o=n.src,l=n.playing;return t.block!==i||(t.message!==s||(t.playlist!==r||(t.src!==o||t.playing!==l)))}componentDidMount(){this.addMediaSessionHandlers(),na.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),U.a.on("clientUpdateVoiceNoteBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoNoteBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAudioBlob",this.onClientUpdateMediaBlob),le.a.on("clientUpdateRecordStart",this.onClientUpdateRecordStart),le.a.on("clientUpdateRecordStop",this.onClientUpdateRecordStop),k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaClose",this.onClientUpdateMediaClose),k.b.on("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.on("clientUpdateMediaViewerPlay",this.onClientUpdateMediaViewerPlay),k.b.on("clientUpdateMediaViewerPause",this.onClientUpdateMediaViewerPause),k.b.on("clientUpdateMediaViewerEnded",this.onClientUpdateMediaViewerEnded),k.b.on("clientUpdateMediaVolume",this.onClientUpdateMediaVolume),k.b.on("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.on("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate),k.b.on("clientUpdateMediaSeek",this.onClientUpdateMediaSeek)}componentWillUnmount(){this.removeMediaSessionHandlers(),na.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),U.a.off("clientUpdateVoiceNoteBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoNoteBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAudioBlob",this.onClientUpdateMediaBlob),le.a.off("clientUpdateRecordStart",this.onClientUpdateRecordStart),le.a.off("clientUpdateRecordStop",this.onClientUpdateRecordStop),k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaClose",this.onClientUpdateMediaClose),k.b.off("clientUpdateMediaPlaylist",this.onClientUpdateMediaPlaylist),k.b.off("clientUpdateMediaViewerPlay",this.onClientUpdateMediaViewerPlay),k.b.off("clientUpdateMediaViewerPause",this.onClientUpdateMediaViewerPause),k.b.off("clientUpdateMediaViewerEnded",this.onClientUpdateMediaViewerEnded),k.b.off("clientUpdateMediaVolume",this.onClientUpdateMediaVolume),k.b.off("clientUpdateMediaPlaybackRate",this.onClientUpdateMediaPlaybackRate),k.b.off("clientUpdateMediaAudioPlaybackRate",this.onClientUpdateMediaAudioPlaybackRate),k.b.off("clientUpdateMediaSeek",this.onClientUpdateMediaSeek)}addMediaSessionHandlers(){var e=navigator.mediaSession;if(e)try{e.setActionHandler("nexttrack",this.handleNext),e.setActionHandler("previoustrack",this.handlePrev),e.setActionHandler("seekforward",this.handleSeekForward),e.setActionHandler("seekbackward",this.handleSeekBackward),e.setActionHandler("seekto",this.handleSeekTo)}catch(t){}}removeMediaSessionHandlers(){var e=navigator.mediaSession;if(e)try{e.setActionHandler("nexttrack",null),e.setActionHandler("previoustrack",null),e.setActionHandler("seekforward",null),e.setActionHandler("seekbackward",null),e.setActionHandler("seekto",null)}catch(t){}}fadeOutVolume(e){var t=this.videoRef.current;if(t){var a=0,n=t.volume;this.volumeInterval=setInterval(()=>{a>=20?(t.pause(),t.volume=n,clearInterval(this.volumeInterval)):(t.volume=n/(a+1),a++)},e/20)}}fadeInVolume(e){var t=this.videoRef.current;if(t){var a=0,n=t.volume;t.volume=0,t.play(),this.volumeInterval=setInterval(()=>{a>=20?(t.volume=n,clearInterval(this.volumeInterval)):(t.volume=n/20*(a+1),a++)},e/20)}}render(){var e=this.props.t,t=this.state,a=t.playing,n=t.message,s=t.block,i=t.duration,r=t.playlist,l=t.src,c=t.mimeType,h=Object(it.E)(n||s),d=Object(it.W)(n||s),p=n?n.date:null,u=Object(Qo.d)(n||s,e),m=(Object(it.k)(p),Object(it.j)(p),!h||d),f=h,b=h,E=this.hasPrev(n||s,r),S=this.hasNext(n||s,r),y=l?o.a.createElement("source",{src:l,type:c}):null;return o.a.createElement(o.a.Fragment,null,o.a.createElement("video",{className:"header-player-video",ref:this.videoRef,autoPlay:!0,controls:!1,width:44,height:44,disablePictureInPicture:!0,onLoadedMetadata:this.handleLoadedMetadata,onCanPlay:this.handleCanPlay,onPlay:this.handleVideoPlay,onPause:this.handleVideoPause,onEnded:this.handleVideoEnded,onTimeUpdate:this.handleTimeUpdate,onProgress:this.handleProgress},y),(n||s)&&o.a.createElement("div",{className:"header-player"},o.a.createElement(P.a,{disabled:!E,className:"header-player-button",color:"primary",onClick:this.handlePrev},o.a.createElement(Mo.a,{fontSize:"small"})),o.a.createElement(P.a,{className:"header-player-button",color:"primary",disabled:!l,onClick:this.handlePlay},a?o.a.createElement(C.a,null):o.a.createElement(v.a,null)),o.a.createElement(P.a,{disabled:!S,className:"header-player-button",color:"primary",onClick:this.handleNext},o.a.createElement(So.a,{fontSize:"small"})),o.a.createElement(tl,null),o.a.createElement("div",{className:"header-player-content",onMouseEnter:this.handleTitleMouseEnter,onMouseLeave:this.handleTitleMouseLeave,onClick:this.handleTitleClick},o.a.createElement("div",{className:"header-player-title"},u,!1),"\xa0"),o.a.createElement(qo,{duration:i}),o.a.createElement(Po,null),m&&o.a.createElement(Go,{audio:h}),f&&o.a.createElement(Ao,null),b&&o.a.createElement(zo,null),o.a.createElement(P.a,{className:"header-player-button",onClick:this.handleClose},o.a.createElement(g.a,{fontSize:"small"}))))}}var ll=Object(_.a)()(ol);a(593);class cl extends o.a.Component{constructor(...e){super(...e),this.onUpdateChatActionBar=e=>{var t=this.props.chatId;e.chat_id===t&&this.forceUpdate()},this.handleClose=()=>{var e=this.props.chatId;if(!Z.a.get(e))return null;x.a.send({"@type":"removeChatActionBar",chat_id:e})},this.handleReportSpam=()=>{var e=this.props.chatId;if(!Z.a.get(e))return null;x.a.send({"@type":"reportChat",chat_id:e,reason:{"@type":"chatReportReasonSpam"},message_ids:[]})},this.handleReportUnrelatedLocation=()=>{var e=this.props.chatId;if(!Z.a.get(e))return null;x.a.send({"@type":"reportChat",chat_id:e,reason:{"@type":"chatReportReasonUnrelatedLocation"},message_ids:[]})},this.handleSharePhoneNumber=()=>{var e=this.props.chatId,t=Object(V.z)(e);t&&x.a.send({"@type":"sharePhoneNumber",user_id:t})},this.handleAddContact=()=>{var e=this.props.chatId,t=Object(V.z)(e);if(t){var a=H.a.get(t);if(a){var n=a.user_id,s=a.phone_number,i=a.first_name,r=a.last_name;x.a.send({"@type":"addContact",contact:{"@type":"contact",phone_number:s,first_name:i,last_name:r,vcard:"",user_id:n},share_phone_number:!1})}}},this.handleBlockUser=()=>{var e=this.props.chatId,t=Object(V.z)(e);t&&x.a.send({"@type":"blockUser",user_id:t})}}componentDidMount(){Z.a.on("updateChatActionBar",this.onUpdateChatActionBar)}componentWillUnmount(){Z.a.off("updateChatActionBar",this.onUpdateChatActionBar)}render(){var e=this.props,t=e.chatId,a=e.t;if(!t)return null;var n=Z.a.get(t);if(!n)return null;var s=n.action_bar;if(!s)return null;var i=null;switch(s["@type"]){case"chatActionBarSharePhoneNumber":i=o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleSharePhoneNumber},a("ShareMyPhone"));break;case"chatActionBarAddContact":i=o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleAddContact},a("AddContactChat"));break;case"chatActionBarReportAddBlock":i=o.a.createElement(o.a.Fragment,null,o.a.createElement(N.a,{color:"primary",className:"header-command-button",onClick:this.handleAddContact},a("AddContactChat")),o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleBlockUser},a("ReportSpamUser")));break;case"chatActionBarUnrelatedLocation":i=o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleReportUnrelatedLocation},a("ReportSpamLocation"));break;case"chatActionBarReportSpam":i=o.a.createElement(N.a,{color:"secondary",className:"header-command-button",onClick:this.handleReportSpam},a("ReportSpam"))}return o.a.createElement("div",{className:"action-bar",onMouseDown:this.handleClick},o.a.createElement("div",{className:"action-bar-content"},i),o.a.createElement("div",{className:"action-bar-close-button"},o.a.createElement(P.a,{onClick:this.handleClose},o.a.createElement(g.a,null))))}}var hl=Object(_.a)()(cl),dl=a(443),pl=a.n(dl),ul=a(190),ml=a(98),fl=a(132),gl=(a(594),Object(T.a)(o.a.createElement("path",{d:"M18,5 C19.6568542,5 21,6.34314575 21,8 L21,20 C21,21.6568542 19.6568542,23 18,23 L9,23 C7.34314575,23 6,21.6568542 6,20 L6,8 C6,6.34314575 7.34314575,5 9,5 L18,5 Z M18,7 L9,7 C8.44771525,7 8,7.44771525 8,8 L8,20 C8,20.5522847 8.44771525,21 9,21 L18,21 C18.5522847,21 19,20.5522847 19,20 L19,8 C19,7.44771525 18.5522847,7 18,7 Z M15,1 C15.5522847,1 16,1.44771525 16,2 C16,2.55228475 15.5522847,3 15,3 L15,3 L5,3 C4.44771525,3 4,3.44771525 4,4 L4,4 L4,16 C4,16.5522847 3.55228475,17 3,17 C2.44771525,17 2,16.5522847 2,16 L2,16 L2,4 C2,2.34314575 3.34314575,1 5,1 L5,1 Z"}),"Copy")),Cl=Object(T.a)(o.a.createElement("path",{d:"M18,3 C19.6568542,3 21,4.34314575 21,6 L21,18 C21,19.6568542 19.6568542,21 18,21 L6,21 C4.34314575,21 3,19.6568542 3,18 L3,6 C3,4.34314575 4.34314575,3 6,3 L18,3 Z M18,5 L6,5 C5.44771525,5 5,5.44771525 5,6 L5,18 C5,18.5522847 5.44771525,19 6,19 L18,19 C18.5522847,19 19,18.5522847 19,18 L19,6 C19,5.44771525 18.5522847,5 18,5 Z M15.7928932,8.29289322 C16.1834175,7.90236893 16.8165825,7.90236893 17.2071068,8.29289322 C17.5976311,8.68341751 17.5976311,9.31658249 17.2071068,9.70710678 L17.2071068,9.70710678 L11.2071068,15.7071068 C10.8165825,16.0976311 10.1834175,16.0976311 9.79289322,15.7071068 L9.79289322,15.7071068 L7.29289322,13.2071068 C6.90236893,12.8165825 6.90236893,12.1834175 7.29289322,11.7928932 C7.68341751,11.4023689 8.31658249,11.4023689 8.70710678,11.7928932 L8.70710678,11.7928932 L10.5,13.5857864 Z"}),"FrameCheck"),vl=Object(T.a)(o.a.createElement("g",{stroke:"currentColor",strokeWidth:"2",fill:"none",fillRule:"evenodd",strokeLinecap:"round",transform:"translate(4, 1)"},o.a.createElement("path",{d:"M2,3 L14,3 C15.1045695,3 16,3.8954305 16,5 L16,17 C16,18.1045695 15.1045695,19 14,19 L2,19 C0.8954305,19 0,18.1045695 0,17 L0,10 L0,10"}),o.a.createElement("polyline",{strokeLinejoin:"round",points:"4 11.5 6.5 14 12.5 8"}),o.a.createElement("polyline",{strokeLinejoin:"round",points:"3 0 -2.87547763e-14 3 3 6"})),"RemoveCheck"),bl=a(204),El=a(165);a(595);class Sl extends o.a.PureComponent{constructor(...e){var t;super(...e),t=this,this.state={confirmStopPoll:!1},this.handleConfirmStopPoll=e=>{this.state.dialog||this.setState({confirmStopPoll:!0,contextMenu:!1})},this.handleCloseConfirm=e=>{e&&e.stopPropagation(),this.setState({confirmStopPoll:!1})},this.handleStopPoll=e=>{e.stopPropagation();var t=this.props,a=t.chatId,n=t.messageId;this.state.confirmStopPoll&&this.setState({confirmStopPoll:!1}),Object(El.c)(a,n)},this.handleUnvote=e=>{e&&e.stopPropagation();var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(El.a)(a,n)},this.handleCopyLink=e=>{var t=this.props,a=t.onClose,n=t.copyLink,s=t.t;a(e),n&&(X(n),this.handleScheduledAction(s("LinkCopied")))},this.handleCopyPublicMessageLink=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props,i=n.onClose,r=n.chatId,o=n.messageId,l=n.t,i(a),e.next=4,x.a.send({"@type":"getPublicMessageLink",chat_id:r,message_id:o,for_album:!1});case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(h=c.link){e.next=10;break}return e.abrupt("return");case 10:X(h),t.handleScheduledAction(l("LinkCopied"));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>{n(s)}},o.a.createElement(g.a,null))]})},this.handleReply=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(re.a)(),s(e),Object(re.l)(a,n)},this.handlePin=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(re.a)(),s(e),Object(it.N)(a,n)?function(e){x.a.send({"@type":"unpinChatMessage",chat_id:e})}(a):function(e,t,a=!1){x.a.send({"@type":"pinChatMessage",chat_id:e,message_id:t,disable_notification:a})}(a,n)},this.handleForward=e=>{var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(re.f)(a,[n])},this.handleEdit=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.onClose;Object(re.a)(),s(e),Object(re.d)(a,n)},this.handleSelect=e=>{var t=this.props,a=t.chatId,n=t.messageId;if((0,t.onClose)(e),!window.getSelection().toString()){var s=!le.a.selectedItems.has("chatId=".concat(a,"_messageId=").concat(n));Object(re.n)(a,n,s)}},this.handleDelete=e=>{var t=this.props,a=t.chatId,n=t.messageId;(0,t.onClose)(e),Object(re.c)(a,[n])},this.handleDownload=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=le.a.get(a,n);if(s){var i=s.content;if(i){var r=i.sticker;if(r){var o=r.sticker;if(o){var l=U.a.getBlob(o.id);l&&Object(G.N)(l,"sticker.tgs")}}}}}}render(){var e=this.props,t=e.t,a=e.chatId,n=e.messageId,s=e.anchorPosition,i=e.copyLink,r=e.open,l=e.onClose,c=this.state.confirmStopPoll;if(!c&&!r)return null;var h=Object(it.N)(a,n),d=Object(it.e)(a,n),p=Object(it.a)(a,n),u=Object(V.f)(a),m=Object(V.d)(a),f=Object(it.d)(a,n),g=Object(it.b)(a,n),C=Object(it.c)(a,n)&&!na.a.recording,v=!le.a.hasSelectedMessage(a,n),b=Boolean(i),E=Object(bl.b)(a);return o.a.createElement(o.a.Fragment,null,o.a.createElement(Je.a,{open:!0,onClose:l,anchorReference:"anchorPosition",anchorPosition:s,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},onMouseDown:e=>e.stopPropagation()},o.a.createElement(qe.a,{onClick:e=>e.stopPropagation()},v&&o.a.createElement(Ke.a,{onClick:this.handleSelect},o.a.createElement(Ee.a,null,o.a.createElement(Cl,null)),o.a.createElement(Se.a,{primary:t("Select")})),E&&o.a.createElement(Ke.a,{onClick:this.handleCopyPublicMessageLink},o.a.createElement(Ee.a,null,o.a.createElement(gl,null)),o.a.createElement(Se.a,{primary:t("CopyMessageLink")})),b&&o.a.createElement(Ke.a,{onClick:this.handleCopyLink},o.a.createElement(Ee.a,null,o.a.createElement(gl,null)),o.a.createElement(Se.a,{primary:t("CopyLink")})),u&&o.a.createElement(Ke.a,{onClick:this.handleReply},o.a.createElement(Ee.a,null,o.a.createElement($e,{style:{transform:"scaleX(-1)"}})),o.a.createElement(Se.a,{primary:t("Reply")})),m&&o.a.createElement(Ke.a,{onClick:this.handlePin},h?o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(wa,null)),o.a.createElement(Se.a,{primary:t("UnpinFromTop")})):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,null,o.a.createElement(wa,null)),o.a.createElement(Se.a,{primary:t("PinToTop")}))),f&&o.a.createElement(Ke.a,{onClick:this.handleForward},o.a.createElement(Ee.a,null,o.a.createElement($e,null)),o.a.createElement(Se.a,{primary:t("Forward")})),C&&o.a.createElement(Ke.a,{onClick:this.handleEdit},o.a.createElement(Ee.a,null,o.a.createElement(Nn,null)),o.a.createElement(Se.a,{primary:t("Edit")})),g&&o.a.createElement(Ke.a,{color:"secondary",onClick:this.handleDelete},o.a.createElement(Ee.a,null,o.a.createElement(Qe,null)),o.a.createElement(Se.a,{primary:t("Delete")})),d&&o.a.createElement(Ke.a,{onClick:this.handleUnvote},o.a.createElement(Ee.a,null,o.a.createElement(vl,null)),o.a.createElement(Se.a,{primary:t("Unvote")})),p&&o.a.createElement(Ke.a,{onClick:this.handleConfirmStopPoll},o.a.createElement(Ee.a,null,o.a.createElement(hi,null)),o.a.createElement(Se.a,{primary:t("StopPoll")})))),o.a.createElement(j.a,{transitionDuration:0,open:c,onClose:this.handleCloseConfirm,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},t("StopPollAlertTitle")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,t("StopPollAlertText"))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleCloseConfirm,color:"primary"},t("Cancel")),o.a.createElement(N.a,{onClick:this.handleStopPoll,color:"primary"},t("Stop")))))}}var yl=Object(h.a)(Object(_.a)(),p.b)(Sl),Ml=a(223),Il=a.n(Ml);a(596);class Ul extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateMessageEdited=e=>{var t=e.chat_id,a=e.message_id,n=e.edit_date,s=this.props,i=s.chatId,r=s.messageId;t===i&&a===r&&this.setState({editDate:n})},this.onUpdateMessageViews=e=>{var t=e.chat_id,a=e.message_id,n=e.views,s=this.props,i=s.chatId,r=s.messageId;t===i&&a===r&&this.setState({views:n})}}static getDerivedStateFromProps(e,t){var a=e.chatId,n=e.messageId,s=t.prevChatId,i=t.prevMessageId;if(s!==a||i!==n){var r=le.a.get(a,n);return r?{prevChatId:a,prevMessageId:n,date:r.date,editDate:r.edit_date,views:r.views,isOutgoing:r.is_outgoing}:null}return null}componentDidMount(){le.a.on("updateMessageEdited",this.onUpdateMessageEdited),le.a.on("updateMessageViews",this.onUpdateMessageViews)}componentWillUnmount(){le.a.off("updateMessageEdited",this.onUpdateMessageEdited),le.a.off("updateMessageViews",this.onUpdateMessageViews)}render(){var e=this.props,t=e.className,a=e.chatId,n=e.messageId,s=e.onDateClick,i=e.t,r=e.style,l=this.state,h=l.date,d=l.editDate,p=l.views,u=l.isOutgoing,m=Object(it.j)(h),f=Object(it.k)(h),g=Object(it.C)(p);return o.a.createElement("div",{className:c()("meta",t),style:r},o.a.createElement("span",null,"\u2002"),p>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Il.a,{className:"meta-views-icon"}),o.a.createElement("span",{className:"meta-views",title:p},"\xa0",g,"\xa0 \xa0")),d>0&&o.a.createElement("span",null,i("EditedMessage"),"\xa0"),o.a.createElement("a",{onClick:s},o.a.createElement("span",{title:f},m)),u&&o.a.createElement(ya,{chatId:a,messageId:n}))}}var kl=Object(_.a)()(Ul);class xl extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.state={contextMenu:!1},this.getAlbumItem=(e,t)=>{var a=e.chat_id,n=e.id,s=e.content,i=e.date,r=e.edit_date,l=e.views;switch(s["@type"]){case"messagePhoto":return o.a.createElement(ml.a,{type:"message",chatId:a,messageId:n,photo:s.photo,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia});case"messageVideo":return o.a.createElement(fl.a,{type:"message",chatId:a,messageId:n,video:s.video,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia});case"messageDocument":var c=o.a.createElement(kl,{className:"meta-hidden",key:"".concat(a,"_").concat(n,"_meta"),chatId:a,messageId:n,date:i,editDate:r,views:l}),h=Object(it.D)(e),d=Object(it.y)(e,h?null:c,e=>e);return o.a.createElement(o.a.Fragment,null,o.a.createElement(ul.a,{type:"message",chatId:a,messageId:n,document:s.document,displaySize:t,style:{width:"100%",height:"100%"},openMedia:this.openMedia}),d&&d.length>0&&o.a.createElement("div",{className:"message-text"},d))}return null},this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onClientUpdateMessageSelected=e=>{var t=this.props.message,a=t.chat_id,n=t.id,s=e.selected;a===e.chatId&&n===e.messageId&&this.setState({selected:s,highlighted:!1})},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(a.preventDefault(),a.stopPropagation()),t.state.contextMenu?t.setState({contextMenu:!1}):(console.log("[cm] handleOpenContextMenu"),n=a.clientX,i=a.clientY,r=a.target&&"A"===a.target.tagName&&a.target.href?a.target.href:null,t.setState({contextMenu:!0,copyLink:r,left:n,top:i}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})},this.openMedia=e=>{if(!(le.a.selectedItems.size>0)){e&&(e.preventDefault(),e.stopPropagation());var t=this.props.message;if(t){var a=t.chat_id,n=t.id;Object(it.T)(a,n)}}},this.handleSelection=e=>{if(!window.getSelection().toString()){var t=this.props.message,a=t.chat_id,n=t.id;if(0!==le.a.selectedItems.size){var s=!le.a.selectedItems.has("chatId=".concat(a,"_messageId=").concat(n));Object(re.n)(a,n,s),e.preventDefault(),e.stopPropagation()}}}}componentDidMount(){le.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection)}componentWillUnmount(){le.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection)}render(){var e=this.props,t=e.message,a=e.position,n=e.displaySize,s=this.state,i=s.contextMenu,r=s.copyLink,l=s.top,h=s.left,d=s.selected,p=t.chat_id,u=t.id,m={},f="album-document-item";return a&&(m={width:a.width,height:a.height*n},f="album-item"),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:c()(f,{"item-selected":d}),onClick:this.handleSelection,onContextMenu:this.handleOpenContextMenu,style:m},o.a.createElement("div",{className:"album-item-wrapper"},this.getAlbumItem(t,n)),d&&o.a.createElement("div",{className:"album-item-selection"},o.a.createElement("div",{className:"album-item-selection-mark"},o.a.createElement(pl.a,{className:"album-item-select-tick"})))),o.a.createElement(yl,{chatId:p,messageId:u,anchorPosition:{top:l,left:h},open:i,onClose:this.handleCloseContextMenu,copyLink:r}))}}var wl=xl;a(597);class Ol extends o.a.Component{constructor(...e){super(...e),this.onClientUpdateLanguage=()=>{this.forceUpdate()}}componentDidMount(){ln.a.on("clientUpdateLanguageChange",this.onClientUpdateLanguage)}componentWillUnmount(){ln.a.off("clientUpdateLanguageChange",this.onClientUpdateLanguage)}render(){var e=this.props,t=e.date,a=e.i18n,n=new Date(1e3*t)<(new Date).setMonth((new Date).getMonth()-3)?{day:"numeric",month:"long",year:"numeric"}:{day:"numeric",month:"long"};return o.a.createElement("div",{className:"day-meta"},o.a.createElement("div",{className:"day-meta-wrapper"},o.a.createElement("div",null,new Date(1e3*t).toLocaleDateString([a.language],n))))}}var Ll=Object(_.a)()(Ol);a(598);class _l extends o.a.Component{constructor(...e){super(...e),this.state={arrowRef:null},this.handleArrowRef=e=>{this.setState({arrowRef:e})},this.openForward=e=>{e.stopPropagation();var t=this.props.forwardInfo;if(!t)return null;var a=t.origin;switch(a["@type"]){case"messageForwardOriginUser":var n=a.sender_user_id;Object(re.k)(n,!0);break;case"messageForwardOriginHiddenUser":break;case"messageForwardOriginChannel":var s=a.chat_id,i=a.message_id;Object(re.i)(s,i)}}}render(){var e=this.props,t=e.t,a=e.forwardInfo,n=(this.state.arrowRef,Object(it.o)(a,t));Object(it.L)(a)&&(o.a.Fragment,t("HidAccount"),this.handleArrowRef);return o.a.createElement("div",{className:c()("message-author","forward")},o.a.createElement("div",null,t("ForwardedMessage")),o.a.createElement("div",{className:"forward-subtitle"},t("From")+" ",o.a.createElement("a",{onClick:this.openForward},n)))}}var Nl=Object(_.a)()(_l);class Pl{constructor(e,t){this.lineCounts=e,this.heights=t}}class jl{set(e,t,a,n,s,i,r){this.minX=e,this.maxX=t,this.minY=a,this.maxY=n,this.spanSize=s,this.width=s,this.height=i,this.flags=r}getInfo(){return"minX=".concat(this.minX,"\nmaxX=").concat(this.maxX,"\nminY=").concat(this.minY,"\nmaxY=").concat(this.maxY,"\nspanSize=").concat(this.spanSize,"\nwidth=").concat(this.width,"\nheight=").concat(this.height,"\nflags=").concat(this.flags,"\nsiblingHeights=").concat(this.siblingHeights,"\nleftSpanOffset=").concat(this.leftSpanOffset)}}class Dl{constructor(){this.posArray=[],this.positions=new Map,this.maxSizeWidth=800,this.hasSibling=!1,this.scale=1}multiHeight(e,t,a){for(var n=0,s=t;s<a;s++)n+=e[s];return 800*this.scale/n}calculate(e,t){if(this.posArray=[],this.positions=new Map,this.messages=e,e){var a=e.length;if(!(a<=1)){this.totalWidth=0,this.totalHeight=0,this.scale=t/this.maxSizeWidth,this.maxSizeWidth=t;Math.trunc(200*this.scale);for(var n=Math.trunc(120*this.scale),s=Math.trunc(96*this.scale),i=Math.trunc(32*this.scale),r=814*this.scale,o=1,l="",c=0,h=!1,d=0;d<a;d++){var p=e[d],u=Dl.getWidthHeight(p),m=u.w,f=u.h,g=new jl;g.isLast=d===e.length-1,g.aspectRatio=m/f,g.aspectRatio>1.2?l+="w":g.aspectRatio<.8?l+="n":l+="q",o+=g.aspectRatio,g.aspectRatio>2&&(h=!0),this.positions.set(p,g),this.posArray.push(g)}var C=this.maxSizeWidth/r;if(o/=a,h||2!==a&&3!==a&&4!==a){for(var v,b,E,S,y=new Array(this.posArray.length),M=0;M<a;M++)y[M]=o>1.1?Math.max(1,this.posArray[M].aspectRatio):Math.min(1,this.posArray[M].aspectRatio),y[M]=Math.max(.66667,Math.min(1.7,y[M]));var I=[];for(v=1;v<y.length;v++)b=y.length-v,v>3||b>3||I.push(new Pl([v,b],[this.multiHeight(y,0,v),this.multiHeight(y,v,y.length)]));for(v=1;v<y.length-1;v++)for(b=1;b<y.length-v;b++)E=y.length-v-b,v>3||b>(o<.85?4:3)||E>3||I.push(new Pl([v,b,E],[this.multiHeight(y,0,v),this.multiHeight(y,v,v+b),this.multiHeight(y,v+b,y.length)]));for(v=1;v<y.length-2;v++)for(b=1;b<y.length-v;b++)for(E=1;E<y.length-v-b;E++)S=y.length-v-b-E,v>3||b>3||E>3||S>3||I.push(new Pl([v,b,E,S],[this.multiHeight(y,0,v),this.multiHeight(y,v,v+b),this.multiHeight(y,v+b,v+b+E),this.multiHeight(y,v+b+E,y.length)]));for(var U=null,k=0,x=this.maxSizeWidth/3*4,w=0;w<I.length;w++){for(var O=I[w],L=0,_=Number.MAX_VALUE,N=0;N<O.heights.length;N++)L+=O.heights[N],O.heights[N]<_&&(_=O.heights[N]);var P=Math.abs(L-x);O.lineCounts.length>1&&(O.lineCounts[0]>O.lineCounts[1]||O.lineCounts.length>2&&O.lineCounts[1]>O.lineCounts[2]||O.lineCounts.length>3&&O.lineCounts[2]>O.lineCounts[3])&&(P*=1.5),_<s&&(P*=1.5),(null===U||P<k)&&(U=O,k=P)}if(null===U)return;for(var j=0,D=0,R=0;R<U.lineCounts.length;R++){var T=U.lineCounts[R],F=U.heights[R],A=this.maxSizeWidth,B=null;c=Math.max(c,T-1);for(var V=0;V<T;V++){var H=y[j],z=Math.trunc(H*F);A-=z;var W=this.posArray[j],G=0;0===R&&(G|=4),R===U.lineCounts.length-1&&(G|=8),0===V&&(G|=1),V===T-1&&(G|=2,B=W),W.set(V,V,R,R,z,F/r,G),j++}B.width+=A,B.spanSize+=A,D+=F}this.totalWidth=this.maxSizeWidth,this.totalHeight=D/r}else switch(a){case 2:var Z=this.posArray[0],q=this.posArray[1];if("ww"===l&&o>1.4*C&&Z.aspectRatio-q.aspectRatio<.2){var K=Math.round(Math.min(this.maxSizeWidth/Z.aspectRatio,Math.min(this.maxSizeWidth/q.aspectRatio,r/2)))/r;Z.set(0,0,0,0,this.maxSizeWidth,K,7),q.set(0,0,1,1,this.maxSizeWidth,K,11),this.totalWidth=this.maxSizeWidth,this.totalHeight=2*K}else if("ww"===l||"qq"===l){var J=this.maxSizeWidth/2,Y=Math.round(Math.min(J/Z.aspectRatio,Math.min(J/q.aspectRatio,r)))/r;Z.set(0,0,0,0,J,Y,13),q.set(1,1,0,0,J,Y,14),c=1,this.totalWidth=J+J,this.totalHeight=Y}else{var X=Math.max(.4*this.maxSizeWidth,Math.round(this.maxSizeWidth/Z.aspectRatio/(1/Z.aspectRatio+1/q.aspectRatio))),Q=this.maxSizeWidth-X;if(Q<s){var $=s-Q;Q=s,X-=$}var ee=Math.min(r,Math.round(Math.min(Q/Z.aspectRatio,X/q.aspectRatio)))/r;Z.set(0,0,0,0,Q,ee,13),q.set(1,1,0,0,X,ee,14),c=1,this.totalWidth=Q+X,this.totalHeight=ee}break;case 3:var te=this.posArray[0],ae=this.posArray[1],ne=this.posArray[2];if("n"===l[0]){var se=Math.min(.5*r,Math.round(ae.aspectRatio*this.maxSizeWidth/(ne.aspectRatio+ae.aspectRatio))),ie=r-se,re=Math.max(s,Math.min(.5*this.maxSizeWidth,Math.round(Math.min(se*ne.aspectRatio,ie*ae.aspectRatio)))),oe=Math.round(Math.min(r*te.aspectRatio+i,this.maxSizeWidth-re));te.set(0,0,0,1,oe,1,13),ae.set(1,1,0,0,re,ie/r,6),ne.set(0,1,1,1,re,se/r,10),ne.spanSize=this.maxSizeWidth,te.siblingHeights=[se/r,ie/r],ae.spanSize=this.maxSizeWidth-oe,ne.leftSpanOffset=oe,this.hasSibling=!0,c=1,this.totalWidth=oe+re,this.totalHeight=1}else{var le=Math.round(Math.min(this.maxSizeWidth/te.aspectRatio,.66*r))/r;te.set(0,1,0,0,this.maxSizeWidth,le,7);var ce=this.maxSizeWidth/2,he=Math.min(r-le,Math.round(Math.min(ce/ae.aspectRatio,ce/ne.aspectRatio)))/r;ae.set(0,0,1,1,ce,he,9),ne.set(1,1,1,1,ce,he,10),c=1,this.totalWidth=this.maxSizeWidth,this.totalHeight=le+he}break;case 4:var de=this.posArray[0],pe=this.posArray[1],ue=this.posArray[2],me=this.posArray[3];if("w"===l[0]){var fe=Math.round(Math.min(this.maxSizeWidth/de.aspectRatio,.66*r))/r;de.set(0,2,0,0,this.maxSizeWidth,fe,7);var ge=Math.round(this.maxSizeWidth/(pe.aspectRatio+ue.aspectRatio+me.aspectRatio)),Ce=Math.max(s,Math.min(.4*this.maxSizeWidth,ge*pe.aspectRatio)),ve=Math.max(Math.max(s,.33*this.maxSizeWidth),ge*me.aspectRatio),be=this.maxSizeWidth-Ce-ve;ge=Math.min(r-fe,ge),ge/=r,pe.set(0,0,1,1,Ce,ge,9),ue.set(1,1,1,1,be,ge,8),me.set(2,2,1,1,ve,ge,10),c=2,this.totalWidth=this.maxSizeWidth,this.totalHeight=fe+ge}else{var Ee=Math.max(s,Math.round(r/(1/pe.aspectRatio+1/ue.aspectRatio+1/me.aspectRatio))),Se=Math.min(.33,Math.max(n,Ee/pe.aspectRatio)/r),ye=Math.min(.33,Math.max(n,Ee/ue.aspectRatio)/r),Me=1-Se-ye,Ie=Math.round(Math.min(r*de.aspectRatio+i,this.maxSizeWidth-Ee));de.set(0,0,0,2,Ie,Se+ye+Me,13),pe.set(1,1,0,0,Ee,Se,6),ue.set(0,1,1,1,Ee,ye,2),ue.spanSize=this.maxSizeWidth,me.set(0,1,2,2,Ee,Me,10),me.spanSize=this.maxSizeWidth,pe.spanSize=this.maxSizeWidth-Ie,ue.leftSpanOffset=Ie,me.leftSpanOffset=Ie,de.siblingHeights=[Se,ye,Me],this.hasSibling=!0,c=1,this.totalWidth=Ee+Ie,this.totalHeight=Se+ye+Me}}}}}static getWidthHeight(e){var t=0,a=0,n=[];switch(e.content["@type"]){case"messagePhoto":var s=e.content,i=s.photo,r=s.minithumbnail;i?n=i.sizes:r&&n.push(r);break;case"messageVideo":var o=e.content,l=o.video,c=o.thumbnail,h=o.minithumbnail;if(l){var d=l.width,p=l.height;n.push({width:d,height:p})}else h?n.push(h):c&&n.push(c);break;case"messageDocument":var u=e.content,m=u.thumbnail,f=u.minithumbnail;f?n.push(f):m?n.push(m):n.push({width:90,height:90})}var g=Dl.getPhotoSize(n,1280);return g&&(t=g.width,a=g.height),{w:t,h:a}}static getPhotoSize(e,t,a){if(!e||!e.length)return null;for(var n=0,s=null,i=0;i<e.length;i++){var r=e[i],o=r.width,l=r.height;if(a){var c=l>=o?o:l;(!s||t>100&&t>n&&n<c)&&(n=c,s=e[i])}else{var h=o>=l?o:l;(!s||t>100&&h<=t&&n<h)&&(n=h,s=e[i])}}return s}}var Rl=Dl;a(599);var Tl=Object(_.a)()((function(e){var t=e.t;return o.a.createElement("div",{className:"unread-separator"},t("UnreadMessages"))}));a(600);var Fl=function(e){var t=e.dialog,a=e.small,n=e.big,s=e.style;return o.a.createElement("div",{className:c()("chat-tile",{"tile-dialog":t},{"tile-small":a},{"tile-big":n}),style:s})};a(601);class Al extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateMessageSelected=e=>{var t=this.props,a=t.chatId,n=t.messageIds;e.selected;a===e.chatId&&n.some(t=>t===e.messageId)&&this.setState({selected:n.every(e=>le.a.hasSelectedMessage(a,e))})},this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onUpdateMessageContent=e=>{var t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageIds,r=n.displaySize,o=this.state.emojiMatches;if(s===t&&i.some(e=>e===a)){var l=new Rl;l.calculate(i.map(e=>le.a.get(s,e)),r);null!==o?this.setState({emojiMatches:null,grouped:l}):this.setState({grouped:l})}},this.handleSelection=()=>{if(!window.getSelection().toString()){var e=this.props,t=e.chatId,a=e.messageIds;if(this.state.selected)for(var n=0;n<a.length;n++)Object(re.n)(t,a[n],!1);else for(var s=0;s<a.length;s++)Object(re.n)(t,a[s],!0)}}}shouldComponentUpdate(e,t,a){var n=this.props,s=n.messageIds,i=n.emojiMatches,r=n.selected;return!Object(M.a)(e.messageIds,s)||(t.emojiMatches!==i||t.selected!==r)}static getDerivedStateFromProps(e,t){var a=e.displaySize,n=e.chatId,s=e.messageIds;if(s!==t.prevMessageIds){var i=new Rl;return i.calculate(s.map(e=>le.a.get(n,e)),a),{grouped:i,prevMessageIds:s}}return null}componentDidMount(){le.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){le.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){var e=this.props.showTail,t=this.props,a=t.chatId,n=t.messageIds,s=t.displaySize,i=t.showUnreadSeparator,r=t.showTitle,l=t.showDate,h=(t.t,this.state),d=h.emojiMatches,p=h.selected,u=h.highlighted,m=h.shook,f=(h.copyLink,h.contextMenu,h.left,h.top,this.state.grouped);if(!f)return null;if(!n.length)return null;var g=n[n.length-1],C=le.a.get(a,g);if(!C)return o.a.createElement("div",null,"[empty message]");for(var v=C.content,b=C.is_outgoing,E=C.views,S=C.date,y=C.edit_date,M=C.reply_to_message_id,I=C.forward_info,U=C.sender_user_id,k=b&&!Object(V.R)(a),x=o.a.createElement(kl,{className:"meta-hidden",key:"".concat(a,"_").concat(g,"_meta"),chatId:a,messageId:g,date:S,editDate:y,views:E}),w=Object(it.D)(C),O=null,L=0;L<n.length;L++){var _=le.a.get(a,n[L]),N=Object(it.y)(_,w?null:x,N);if(N&&N.length){if(null!==O){O=null;break}O=N,g=n[L]}}var P=null!==O&&O.length>0,j=o.a.createElement(kl,{className:c()("meta-text",{"meta-bubble":!P}),chatId:a,messageId:g,date:S,editDate:y,views:E,onDateClick:this.handleDateClick}),D=Object(it.U)(a,g),R=Boolean(M),T=Object(V.db)(a),F=!T&&r||D||R,A=Object(V.R)(a),B=Object(V.db)(a),H=null;e&&(H=B||A||b?o.a.createElement(Fl,{small:!0}):U?o.a.createElement(yn.a,{small:!0,userId:U,onSelect:this.handleSelectUser}):o.a.createElement(K,{small:!0,chatId:a,onSelect:this.handleSelectChat}));var z={width:f.totalWidth-2-2},W="messageSticker"!==v["@type"]&&"messageVideoNote"!==v["@type"],G=!P&&("messageAnimation"===v["@type"]||"messageVideo"===v["@type"]||"messagePhoto"===v["@type"]),Z=f.messages.map(e=>o.a.createElement(wl,{key:e.id,message:e,position:f.positions.get(e),displaySize:s}));return o.a.createElement("div",null,l&&o.a.createElement(Ll,{date:S}),o.a.createElement("div",{className:c()("message","message-album",{"message-rounded":r&&e&&G,"message-short":!H,"message-out":k,"message-selected":p,"message-highlighted":u&&!p,"message-group-title":r&&!e,"message-group":!r&&!e,"message-group-tail":!r&&e&&!G,"message-group-tail-rounded":!r&&e&&G,"message-bubble-hidden":!W}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},i&&o.a.createElement(Tl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(pl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:m})},H,o.a.createElement("div",{className:c()("message-content",{"message-bubble":W,"message-bubble-out":W&&k}),style:z},W&&(r&&!T||D)&&o.a.createElement("div",{className:"message-title"},r&&!D&&o.a.createElement(gt.a,{chatId:a,openChat:!0,userId:U,openUser:!0}),D&&o.a.createElement(Nl,{forwardInfo:I})),R&&o.a.createElement(Rr,{chatId:a,messageId:M,onClick:this.handleReplyClick}),o.a.createElement("div",{className:c()("album",{"album-caption":P},{"album-title":F})},o.a.createElement("div",{className:"album-wrapper",style:{width:f.totalWidth}},Z)),o.a.createElement("div",{className:c()("message-text",{"message-text-1emoji":1===d,"message-text-2emoji":2===d,"message-text-3emoji":3===d})},O),W&&j),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))))}}Al.defaultProps={displaySize:u.I,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showData:!1};var Bl=Al;a(602);class Vl extends o.a.Component{constructor(e){super(e),this.onClientUpdateDragging=e=>{var t=na.a.dragParams;this.setState({dragParams:t})},this.handleDragEnter=e=>{e.preventDefault(),e.stopPropagation()},this.handleDrop=e=>{e.preventDefault(),e.stopPropagation(),x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!1}),this.handleAttachDocumentComplete(e.dataTransfer.files)},this.handleDragLeave=e=>{e.preventDefault(),e.stopPropagation(),x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!1})},this.handleAttachDocumentComplete=e=>{0!==e.length&&x.a.clientUpdate({"@type":"clientUpdateSendFiles",files:e})};var t=na.a.dragParams;this.state={dragParams:t}}componentDidMount(){na.a.on("clientUpdateDragging",this.onClientUpdateDragging)}componentWillUnmount(){na.a.off("clientUpdateDragging",this.onClientUpdateDragging)}render(){return this.state.dragParams?o.a.createElement("div",{className:"files-drop-target",onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},o.a.createElement("div",{className:"files-drop-target-wrapper"},o.a.createElement("div",{className:"files-drop-target-text"},o.a.createElement("div",{className:"files-drop-target-title"},"Drop files here"),o.a.createElement("div",{className:"files-drop-target-subtitle"},"to send them")))):null}}var Hl=Vl;a(603);o.a.Component;var zl=a(150),Wl=a(97),Gl=a(158),Zl=a(220);a(604);class ql extends o.a.Component{constructor(...e){var t;super(...e),t=this,this.getMedia=()=>{var e=this.props,t=e.chatId,a=e.messageId,n=e.size,s=(e.displaySize,e.displaySmallSize),i=e.displayExtraSmallSize,r=e.openMedia,l=le.a.get(t,a);if(!l)return null;var c=l.content;if(!c)return null;var h=c.web_page;if(!h)return null;var d=h.site_name,p=h.title,m=h.description,f=(h.url,h.photo),g=h.animation,C=h.video,v=h.audio,b=h.document,E=h.voice_note,S=h.video_note,y=h.sticker,I=h.type;if(y)return[null,o.a.createElement(Gl.b,{chatId:t,messageId:a,sticker:y,openMedia:r,source:Gl.a.MESSAGE})];if(E)return[null,o.a.createElement(Xo.a,{chatId:t,messageId:a,voiceNote:E,openMedia:r})];if(S)return[null,o.a.createElement(Zl.a,{chatId:t,messageId:a,videoNote:S,openMedia:r})];if(v)return[null,o.a.createElement(Yo.a,{chatId:t,messageId:a,audio:v,openMedia:r})];if(b)return[null,o.a.createElement(ul.a,{chatId:t,messageId:a,document:b,openMedia:r})];if(g&&(Object(G.m)(g.animation)||g.thumbnail))return[null,o.a.createElement(Wl.a,{stretch:!0,chatId:t,messageId:a,animation:g,openMedia:r})];if(C&&C.thumbnail)return[null,o.a.createElement(fl.a,{stretch:!0,chatId:t,messageId:a,video:C,openMedia:r})];if(f){var U=Object(M.q)(f.sizes,n),k=("article"===I||"photo"===I||"telegram_megagroup"===I||"telegram_channel"===I)&&(d||p||m&&m.text.length>0)&&U&&(U.width===U.height||Math.max(U.width,U.height)<u.I),x=k&&(!m||m.text.length<50),w=k||x?{float:"right",marginLeft:6}:{};return[k?o.a.createElement(ml.a,{displaySize:x?i:s,style:w,chatId:t,messageId:a,photo:f,openMedia:r}):null,k?null:o.a.createElement(ml.a,{stretch:!0,chatId:t,messageId:a,photo:f,openMedia:r})]}return[null,null]},this.handleInstantViewClick=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),a.stopPropagation(),n=t.props,i=n.chatId,r=n.messageId,o=le.a.get(i,r)){e.next=6;break}return e.abrupt("return",null);case 6:if(l=o.content){e.next=9;break}return e.abrupt("return",null);case 9:if(c=l.web_page){e.next=12;break}return e.abrupt("return",null);case 12:il(c.url);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}getWebPage(){var e=this.props,t=e.chatId,a=e.messageId,n=e.t,s=le.a.get(t,a);if(!s)return null;var i=s.content;if(!i)return null;var r=i.web_page;if(!r)return null;var l=r.instant_view_version,c=r.site_name,h=r.description,d=r.title;if("formattedText"===h["@type"])h=Object(it.n)(h);else if("string"===typeof h&&c&&("twitter"===c.toLowerCase()||"instagram"===c.toLowerCase())){var p=Object(it.A)("instagram"===c.toLowerCase()?1:2,h,[]),u=(p.text,p.entities);h=Object(it.n)({"@type":"formattedText",text:h,entities:u})}var m=o.a.createElement(o.a.Fragment,null,c&&o.a.createElement("div",{className:"web-page-site-name"},c),d&&o.a.createElement("div",{className:"web-page-title"},d),h&&o.a.createElement("div",{className:"web-page-description"},h)),f=this.getMedia(),g=Object(L.a)(f,2),C=g[0],v=g[1],b=l>0&&o.a.createElement(N.a,{variant:"outlined",color:"primary",classes:{outlinedPrimary:"message-control",disabled:"message-control-disabled"},fullWidth:!0,onClick:this.handleInstantViewClick,className:"web-page-button"},o.a.createElement(zl.a,null,o.a.createElement("path",{d:"M10.5159727,16.7438514 C10.1741929,18.1203636 10.687342,18.4055299 11.6053255,17.4005852 L15.4613785,12.9698209 C16.3535455,11.8808642 16.1300862,11.0059438 14.8452805,10.7872179 L12.9861121,10.4429102 L12.9861121,10.4429102 C12.8775019,10.4227962 12.8057616,10.3184447 12.8258756,10.2098345 C12.8265392,10.2062511 12.8273007,10.2026864 12.8281591,10.1991446 L13.5436135,7.24719783 C13.8863521,5.8619451 13.3150978,5.61107807 12.4582164,6.59275159 C11.2270125,7.98097123 10.2913754,9.02966176 9.65130514,9.73882318 C9.42814828,9.98606827 9.06894462,10.3719875 8.57369417,10.8965808 C7.48829706,12.1010165 8.05955136,12.9745105 9.31498713,13.1932365 L11.0917769,13.5117472 L11.0917769,13.5117472 C11.2005008,13.5312372 11.2728391,13.6351751 11.253349,13.743899 C11.2525988,13.7480841 11.2517153,13.7522442 11.2506999,13.756373 L10.5159727,16.7438514 Z"})),n("InstantView"));return o.a.createElement(o.a.Fragment,null,C,m,v,b)}render(){var e=this.props.meta;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"web-page"},o.a.createElement("div",{className:"border"}),o.a.createElement("div",{className:"web-page-wrapper"},this.getWebPage())),e)}}ql.defaultProps={size:u.K,displaySize:u.I,displaySmallSize:u.J,displayExtraSmallSize:u.H};var Kl=Object(_.a)()(ql);a(605);class Jl extends r.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onClientUpdateMessageShake=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=this.state.shook;a===e.chatId&&n===e.messageId&&(s?this.setState({shook:!1},()=>{setTimeout(()=>{this.setState({shook:!0})},0)}):this.setState({shook:!0}))},this.onClientUpdateMessageHighlighted=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n===e.messageId?r?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):r&&this.setState({highlighted:!1}))},this.onClientUpdateMessageSelected=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=e.selected;a===e.chatId&&n===e.messageId&&this.setState({selected:s,highlighted:!1})},this.onUpdateMessageContent=e=>{var t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageId,r=this.state.emojiMatches;s===t&&(i===a&&(Object(it.l)(s,i)!==r?this.setState({emojiMatches:Object(it.l)(s,i)}):this.forceUpdate()))},this.handleSelectUser=e=>{Object(re.k)(e,!0)},this.handleSelectChat=e=>{Object(re.i)(e,null,!0)},this.handleSelection=()=>{if(this.mouseDown&&!window.getSelection().toString()){var e=this.props,t=e.chatId,a=e.messageId,n=!le.a.selectedItems.has("chatId=".concat(t,"_messageId=").concat(a));Object(re.n)(t,a,n)}},this.handleDateClick=e=>{e.preventDefault(),e.stopPropagation();var t=this.props,a=t.chatId,n=t.messageId;Object(V.f)(a)?Object(re.l)(a,n):Object(it.d)(a,n)&&Object(re.f)(a,[n])},this.openMedia=e=>{e&&(e.preventDefault(),e.stopPropagation());var t=this.props,a=t.chatId,n=t.messageId;Object(it.T)(a,n)},this.handleAnimationEnd=()=>{this.setState({highlighted:!1})},this.handleMouseDown=()=>{this.mouseDown=!0},this.handleMouseOver=()=>{this.mouseDown=!1},this.handleMouseOut=()=>{this.mouseOut=!1},this.handleReplyClick=()=>{var e=this.props,t=e.chatId,a=e.messageId;Object(re.j)(t,a)},this.handleOpenContextMenu=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&(a.preventDefault(),a.stopPropagation()),!t.state.contextMenu){e.next=6;break}t.setState({contextMenu:!1}),e.next=12;break;case 6:if(!(le.a.selectedItems.size>1)){e.next=8;break}return e.abrupt("return");case 8:n=a.clientX,i=a.clientY,r=a.target&&"A"===a.target.tagName&&a.target.href?a.target.href:null,t.setState({contextMenu:!0,copyLink:r,left:n,top:i});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleCloseContextMenu=e=>{e&&e.stopPropagation(),this.setState({contextMenu:!1})};var a=this.props,n=a.chatId,r=a.messageId;this.state={message:le.a.get(n,r),emojiMatches:Object(it.l)(n,r),selected:!1,highlighted:!1,shook:!1,contextMenu:!1,copyLink:null,left:0,top:0}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId,i=a.sendingState,r=a.showUnreadSeparator,o=a.showTail,l=a.showTitle,c=this.state,h=c.contextMenu,d=c.selected,p=c.highlighted,u=c.shook,m=c.emojiMatches;return e.chatId!==n||(e.messageId!==s||(e.sendingState!==i||(e.showUnreadSeparator!==r||(e.showTail!==o||(e.showTitle!==l||(t.contextMenu!==h||(t.selected!==d||(t.highlighted!==p||(t.shook!==u||t.emojiMatches!==m)))))))))}componentDidMount(){le.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),le.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.on("clientUpdateMessageShake",this.onClientUpdateMessageShake),le.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){le.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),le.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.off("clientUpdateMessageShake",this.onClientUpdateMessageShake),le.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){var e=this.props.showTail,t=this.props,a=t.t,n=t.chatId,s=t.messageId,i=t.showUnreadSeparator,r=t.showTitle,l=t.showDate,h=this.state,d=h.emojiMatches,p=h.selected,u=h.highlighted,m=h.shook,f=h.copyLink,g=h.contextMenu,C=h.left,v=h.top,b=le.a.get(n,s);if(!b)return o.a.createElement("div",null,"[empty message]");var E=b.content,S=b.is_outgoing,y=b.views,M=b.date,I=b.edit_date,U=b.reply_to_message_id,k=b.forward_info,x=b.sender_user_id,w=S&&!Object(V.R)(n),O=o.a.createElement(kl,{className:"meta-hidden",key:"".concat(n,"_").concat(s,"_meta"),chatId:n,messageId:s,date:M,editDate:I,views:y}),L=o.a.createElement(kl,{className:c()("meta-text",{"meta-bubble":Object(it.P)(n,s)}),chatId:n,messageId:s,date:M,editDate:I,views:y,onDateClick:this.handleDateClick}),_=Object(it.D)(b),N=Object(it.y)(b,_?null:O,a),P=null!==N&&N.length>0,j=Object(it.U)(n,s),D=Boolean(U),R=Object(V.db)(n),T=!R&&r||j||D,F=Object(at.f)(b,this.openMedia,{hasTitle:T,hasCaption:P,inlineMeta:O,meta:L}),A=Object(V.R)(n),B=Object(V.db)(n),H=null;e&&(H=B||A||S?o.a.createElement(Fl,{small:!0}):x?o.a.createElement(yn.a,{small:!0,userId:x,onSelect:this.handleSelectUser}):o.a.createElement(K,{small:!0,chatId:n,onSelect:this.handleSelectChat}));var z=Object(it.r)(n,s),W="messageSticker"!==E["@type"]&&"messageVideoNote"!==E["@type"],G=!P&&("messageAnimation"===E["@type"]||"messageVideo"===E["@type"]||"messagePhoto"===E["@type"]);return o.a.createElement("div",null,l&&o.a.createElement(Ll,{date:M}),o.a.createElement("div",{className:c()("message",{"message-rounded":r&&e&&G,"message-short":!H,"message-out":w,"message-selected":p,"message-highlighted":u&&!p,"message-group-title":r&&!e,"message-group":!r&&!e,"message-group-tail":!r&&e&&!G,"message-group-tail-rounded":!r&&e&&G,"message-bubble-hidden":!W}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},i&&o.a.createElement(Tl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(pl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:m})},H,o.a.createElement("div",{className:c()("message-content",{"message-bubble":W,"message-bubble-out":W&&w}),style:z},W&&(r&&!R||j)&&o.a.createElement("div",{className:"message-title"},r&&!j&&o.a.createElement(gt.a,{chatId:n,openChat:!0,userId:x,openUser:!0}),j&&o.a.createElement(Nl,{forwardInfo:k})),D&&o.a.createElement(Rr,{chatId:n,messageId:U,onClick:this.handleReplyClick}),F,o.a.createElement("div",{className:c()("message-text",{"message-text-1emoji":1===d,"message-text-2emoji":2===d,"message-text-3emoji":3===d})},N),_&&o.a.createElement(Kl,{chatId:n,messageId:s,openMedia:this.openMedia,meta:O}),W&&L),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))),o.a.createElement(yl,{chatId:n,messageId:s,anchorPosition:{top:v,left:C},open:g,onClose:this.handleCloseContextMenu,copyLink:f}))}}Jl.defaultProps={sendingState:null,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showDate:!1};var Yl=Object(_.a)(["translation","local"],{withRef:!0})(Jl),Xl=a(31),Ql=(a(606),{width:64,height:64,borderRadius:"50%",margin:"0 auto 5px"});class $l extends o.a.Component{constructor(e){super(e),this.onClientUpdateMessageHighlighted=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n===e.messageId?r?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):r&&this.setState({highlighted:!1}))},this.handleAnimationEnd=()=>{this.setState({highlighted:!1})},this.openMedia=e=>{e&&(e.preventDefault(),e.stopPropagation());var t=this.props,a=t.chatId,n=t.messageId;Object(it.T)(a,n)};var t=this.props,a=t.chatId,n=t.messageId;this.state={message:le.a.get(a,n),highlighted:!1}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId,i=a.sendingState,r=a.showUnreadSeparator,o=this.state.highlighted;return e.chatId!==n||(e.messageId!==s||(e.sendingState!==i||(e.showUnreadSeparator!==r||t.highlighted!==o)))}componentDidMount(){le.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted)}componentWillUnmount(){le.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=e.showUnreadSeparator,s=e.showDate,i=this.state.highlighted,r=le.a.get(t,a);if(!r)return null;var l=r.content,h=r.date;if(!l)return null;var d=l.photo,p=Object(Xl.a)(r,!0);return o.a.createElement("div",null,s&&o.a.createElement(Ll,{date:h}),o.a.createElement("div",{className:c()("service-message",{"message-highlighted":i}),onAnimationEnd:this.handleAnimationEnd},n&&o.a.createElement(Tl,null),o.a.createElement("div",{className:"service-message-wrapper"},o.a.createElement("div",{className:"service-message-content"},o.a.createElement("div",null,p))),d&&o.a.createElement(ml.a,{chatId:t,messageId:a,photo:d,displaySize:64,style:Ql,openMedia:this.openMedia})))}}$l.defaultProps={showTitle:!1,showTail:!1,showUnreadSeparator:!1};var ec=Object(h.a)(Object(h.d)(),Object(_.a)(),Object(h.c)())($l);a(607);class tc extends o.a.Component{constructor(e){super(e),this.onClientUpdateCacheLoaded=e=>{var t=na.a.cacheLoaded;this.setState({cacheLoaded:t})},this.onClientUpdateChatId=e=>{var t=e.nextChatId;this.setState({chatId:t})},this.onClientUpdateDialogsReady=e=>{var t=na.a.dialogsReady;this.setState({dialogsReady:t})};var t=na.a.chatId,a=na.a.dialogsReady,n=na.a.cacheLoaded;this.state={chatId:t,dialogsReady:a,cacheLoaded:n}}shouldComponentUpdate(e,t,a){return t.chatId!==this.state.chatId||(t.dialogsReady!==this.state.dialogsReady||(t.cacheLoaded!==this.state.cacheLoaded||e.t!==this.props.t))}componentDidMount(){na.a.on("clientUpdateChatId",this.onClientUpdateChatId),na.a.on("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),na.a.on("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded)}componentWillUnmount(){na.a.off("clientUpdateChatId",this.onClientUpdateChatId),na.a.off("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),na.a.off("clientUpdateCacheLoaded",this.onClientUpdateCacheLoaded)}render(){var e=this.props,t=e.t,a=(e.force,this.state),n=a.chatId;a.dialogsReady,a.cacheLoaded;return n?null:o.a.createElement("div",{className:"placeholder"},o.a.createElement("div",{className:"placeholder-wrapper"},o.a.createElement("div",{className:"placeholder-meta"},t("SelectChatToStartMessaging"))))}}var ac=Object(_.a)()(tc),nc=a(609),sc=a.n(nc);a(608);class ic extends o.a.Component{render(){var e=this.props.onClick;return o.a.createElement("div",{className:"scroll-down-button"},o.a.createElement(P.a,{disableRipple:!0,onMouseDown:e},o.a.createElement(sc.a,null)))}}var rc=ic,oc=a(445);a(610);class lc extends o.a.Component{constructor(e){super(e),this.onClientUpdateRemoteStickersHint=e=>{var t=e.hint,a=this.state.hint;if(!a||t.timestamp===a.timestamp){this.setState({hint:Jr.a.hint,items:this.getItems(Jr.a.hint)});var n=U.a.getStore(),s=t.stickers;Object(G.H)(n,s.stickers)}},this.onClientUpdateLocalStickersHint=e=>{var t=e.hint;if(this.setState({hint:t,items:this.getItems(t),previewStickerId:0,showPreview:!1,cancelSend:!1}),t){var a=U.a.getStore(),n=t.stickers;Object(G.H)(a,n.stickers)}},this.handleSend=e=>{this.state.cancelSend||e&&x.a.clientUpdate({"@type":"clientUpdateStickerSend",sticker:e})},this.loadPreviewContent=e=>{var t=this.state.items,a=t.find(t=>t.sticker.id===e);if(a){var n=U.a.getStore();Object(G.E)(n,a,null);var s=8;this.hintsRef&&this.hintsRef.current&&(s=Math.floor(this.hintsRef.current.clientWidth/u.Cb)),this.getNeighborStickers(e,t,s).forEach(e=>{Object(G.E)(n,e,null)})}},this.getNeighborStickers=(e,t,a)=>{if(!t)return[];var n=[],s=t.findIndex(t=>t.sticker.id===e);if(-1===s)return[];var i=Math.floor(s/a),r=s%a,o=i-1,l=i+1,c=r-1,h=r+1;return o>=0&&(c>=0&&n.push(a*o+c),n.push(a*o+r),h<a&&n.push(a*o+h)),c>=0&&n.push(a*i+c),h<a&&n.push(a*i+h),l<Math.ceil(t.length/a)&&(c>=0&&n.push(a*l+c),n.push(a*l+r),h<a&&n.push(a*l+h)),n.map(e=>t[e])},this.handleMouseEnter=e=>{var t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);a&&this.mouseDown&&(this.mouseDownStickerId!==t&&(this.mouseDownStickerId=null),this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t))},this.handleMouseDown=e=>{var t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);if(a){this.mouseDownStickerId=t;var n=Date.now();return this.setState({sticker:a,timestamp:n,showPreview:!1,cancelSend:!1}),setTimeout(()=>{this.state.timestamp===n&&(this.setState({showPreview:!0,cancelSend:!0}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}))},500),this.loadPreviewContent(t),this.mouseDown=!0,document.addEventListener("mouseup",this.handleMouseUp),e.preventDefault(),e.stopPropagation(),!1}},this.handleMouseUp=()=>{this.setState({sticker:null,timestamp:0,showPreview:!1}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:null}),this.mouseDown=!1,document.removeEventListener("mouseup",this.handleMouseUp)},this.getItems=e=>{var t=[];if(!e)return t;var a=new Map,n=e.stickers,s=e.foundStickers;return n&&n.stickers.forEach(e=>{t.push(e),a.set(e.sticker.id,e.sticker.id)}),s&&s.stickers.forEach(e=>{a.has(e.sticker.id)||(t.push(e),a.set(e.sticker.id,e.sticker.id))}),t},this.hintsRef=o.a.createRef(),this.state={hint:null,items:[],previewStickerId:0,showPreview:!1,cancelSend:!1}}componentDidMount(){Jr.a.on("clientUpdateLocalStickersHint",this.onClientUpdateLocalStickersHint),Jr.a.on("clientUpdateRemoteStickersHint",this.onClientUpdateRemoteStickersHint)}componentWillUnmount(){Jr.a.off("clientUpdateLocalStickersHint",this.onClientUpdateLocalStickersHint),Jr.a.off("clientUpdateRemoteStickersHint",this.onClientUpdateRemoteStickersHint)}getSticker(e){var t=this.state.items,a=t.findIndex(t=>t.sticker.id===e);return-1!==a?t[a]:null}render(){var e=this.state,t=e.hint,a=e.items,n=e.sticker,s=e.showPreview;if(!t)return null;if(!a)return null;if(!a.length)return null;var i=a.map(e=>o.a.createElement("div",{className:"sticker-set-dialog-item",key:e.sticker.id,"data-sticker-id":e.sticker.id,style:{width:u.Cb,height:u.Cb},onClick:()=>this.handleSend(e),onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown},o.a.createElement(Gl.b,{key:e.sticker.id,className:"sticker-set-dialog-item-sticker",sticker:e,autoplay:!1,blur:!1,displaySize:u.Eb,preview:!0,source:Gl.a.HINTS})));return o.a.createElement("div",{ref:this.hintsRef,className:"stickers-hint scrollbars-hidden"},i,Boolean(n)&&s&&o.a.createElement(oc.a,{sticker:n}))}}var cc=lc;a(611),a(612);class hc extends o.a.Component{constructor(...e){super(...e),this.state={},this.onClientUpdateMessageHighlighted=e=>{var t=this.props,a=t.chatId,n=t.messageIds,s=this.state,i=s.selected,r=s.highlighted;i||(a===e.chatId&&n.some(t=>t===e.messageId)?r?this.setState({highlighted:!1},()=>{setTimeout(()=>{this.setState({highlighted:!0})},0)}):this.setState({highlighted:!0}):r&&this.setState({highlighted:!1}))},this.onClientUpdateMessageSelected=e=>{var t=this.props,a=t.chatId,n=t.messageIds;e.selected;a===e.chatId&&n.some(t=>t===e.messageId)&&this.setState({selected:n.every(e=>le.a.hasSelectedMessage(a,e)),lastSelected:n.length>0&&le.a.hasSelectedMessage(a,n[n.length-1])})},this.onClientUpdateClearSelection=e=>{this.state.selected&&this.setState({selected:!1})},this.onUpdateMessageContent=e=>{var t=e.chat_id,a=e.message_id,n=this.props,s=n.chatId,i=n.messageIds,r=(n.displaySize,this.state.emojiMatches);if(s===t&&i.some(e=>e===a)){null!==r?this.setState({emojiMatches:null}):this.forceUpdate()}},this.handleSelection=()=>{if(!window.getSelection().toString()){var e=this.props,t=e.chatId,a=e.messageIds;if(this.state.selected)for(var n=0;n<a.length;n++)Object(re.n)(t,a[n],!1);else for(var s=0;s<a.length;s++)Object(re.n)(t,a[s],!0)}}}shouldComponentUpdate(e,t,a){var n=this.props,s=n.messageIds,i=n.emojiMatches,r=n.selected;return!Object(M.a)(e.messageIds,s)||(t.emojiMatches!==i||t.selected!==r)}static getDerivedStateFromProps(e,t){e.displaySize,e.chatId;var a=e.messageIds;return a!==t.prevMessageIds?{prevMessageIds:a}:null}componentDidMount(){le.a.on("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),le.a.on("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.on("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){le.a.off("clientUpdateMessageHighlighted",this.onClientUpdateMessageHighlighted),le.a.off("clientUpdateMessageSelected",this.onClientUpdateMessageSelected),le.a.off("clientUpdateClearSelection",this.onClientUpdateClearSelection),le.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){var e=this.props.showTail,t=this.props,a=t.chatId,n=t.messageIds,s=t.displaySize,i=t.showUnreadSeparator,r=t.showTitle,l=t.showDate,h=(t.t,this.state),d=(h.emojiMatches,h.selected),p=h.lastSelected,u=h.highlighted,m=h.shook;h.copyLink,h.contextMenu,h.left,h.top;if(!n.length)return null;var f=n[n.length-1],g=le.a.get(a,f);if(!g)return o.a.createElement("div",null,"[empty message]");for(var C=g.content,v=g.is_outgoing,b=g.views,E=g.date,S=g.edit_date,y=g.reply_to_message_id,M=g.forward_info,I=g.sender_user_id,U=v&&!Object(V.R)(a),k=o.a.createElement(kl,{className:"meta-hidden",key:"".concat(a,"_").concat(f,"_meta"),chatId:a,messageId:f,date:E,editDate:S,views:b}),x=Object(it.D)(g),w=null,O=0;O<n.length;O++){var L=le.a.get(a,n[O]),_=Object(it.y)(L,x?null:k,_);if(_&&_.length){if(null!==w){w=null;break}w=_,f=n[O]}}var N=null!==w&&w.length>0,P=o.a.createElement(kl,{className:c()("meta-text",{"meta-bubble":!1}),chatId:a,messageId:f,date:E,editDate:S,views:b,onDateClick:this.handleDateClick}),j=Object(it.U)(a,f),D=Boolean(y),R=Object(V.db)(a),T=!R&&r||j||D,F=Object(V.R)(a),A=Object(V.db)(a),B=null;e&&(B=A||F||v?o.a.createElement(Fl,{small:!0}):I?o.a.createElement(yn.a,{small:!0,userId:I,onSelect:this.handleSelectUser}):o.a.createElement(K,{small:!0,chatId:a,onSelect:this.handleSelectChat}));var H="messageSticker"!==C["@type"]&&"messageVideoNote"!==C["@type"],z=!N&&("messageAnimation"===C["@type"]||"messageVideo"===C["@type"]||"messagePhoto"===C["@type"]),W=n.map(e=>le.a.get(a,e)).map(e=>o.a.createElement(wl,{key:e.id,message:e,position:null,displaySize:s}));return o.a.createElement("div",null,l&&o.a.createElement(Ll,{date:E}),o.a.createElement("div",{className:c()("message","message-album",{"message-rounded":r&&e&&z,"message-short":!B,"message-out":U,"message-selected":d,"message-album-last-selected":p,"message-highlighted":u&&!d,"message-group-title":r&&!e,"message-group":!r&&!e,"message-group-tail":!r&&e&&!z,"message-group-tail-rounded":!r&&e&&z,"message-bubble-hidden":!H}),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:this.handleMouseDown,onClick:this.handleSelection,onAnimationEnd:this.handleAnimationEnd,onContextMenu:this.handleOpenContextMenu},i&&o.a.createElement(Tl,null),o.a.createElement("div",{className:"message-body"},o.a.createElement("div",{className:"message-padding"},o.a.createElement(pl.a,{className:"message-select-tick"})),o.a.createElement("div",{className:c()("message-wrapper",{shook:m})},B,o.a.createElement("div",{className:c()("message-content",{"message-bubble":H,"message-bubble-out":H&&U}),style:{}},H&&(r&&!R||j)&&o.a.createElement("div",{className:"message-title"},r&&!j&&o.a.createElement(gt.a,{chatId:a,openChat:!0,userId:I,openUser:!0}),j&&o.a.createElement(Nl,{forwardInfo:M})),D&&o.a.createElement(Rr,{chatId:a,messageId:y,onClick:this.handleReplyClick}),o.a.createElement("div",{className:c()("album","document-album",{"album-caption":!1},{"album-title":T})},o.a.createElement("div",{className:"album-wrapper"},W)),H&&P),o.a.createElement("div",{className:"message-tile-padding"})),o.a.createElement("div",{className:"message-padding"}))))}}hc.defaultProps={displaySize:u.I,showTitle:!1,showTail:!1,showUnreadSeparator:!1,showData:!1};var dc=Object.freeze({SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",SCROLL_TO_MESSAGE:"SCROLL_TO_MESSAGE",SCROLL_TO_POSITION:"SCROLL_TO_POSITION",KEEP_SCROLL_POSITION:"KEEP_SCROLL_POSITION",NONE:"NONE"});class pc extends o.a.Component{constructor(e){var t;super(e),t=this,this.onKeyDown=e=>{},this.onClientUpdateTryEditMessage=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasLastMessage()){e.next=11;break}n=t.state.history,i=n.length-1;case 3:if(!(i>=0)){e.next=11;break}if(r=n[i],!Object(it.c)(r.chat_id,r.id)){e.next=8;break}return Object(re.d)(r.chat_id,r.id),e.abrupt("return");case 8:i--,e.next=3;break;case 11:return e.next=13,x.a.send({"@type":"searchChatMessages",chat_id:t.props.chatId,query:"",sender_user_id:H.a.getMyId(),from_message_id:0,offset:0,limit:100,filter:{"@type":"searchMessagesFilterEmpty"}});case 13:o=e.sent,l=0;case 15:if(!(l<o.messages.length)){e.next=23;break}if(c=o.messages[l],!Object(it.c)(c.chat_id,c.id)){e.next=20;break}return Object(re.d)(c.chat_id,c.id),e.abrupt("return");case 20:l++,e.next=15;break;case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateDialogsReady=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.list){e.next=3;break}return e.abrupt("return");case 3:if("chatListMain"===n["@type"]){e.next=5;break}return e.abrupt("return");case 5:if(!((r=t.state.history)&&r.length>0)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,U.a.initDB(Object(i.a)(s.a.mark((function e(){var a,n,i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,!n){e.next=18;break}if(!(r=Z.a.get(n))){e.next=18;break}o=r.type,e.t0=o["@type"],e.next="chatTypePrivate"===e.t0||"chatTypeSecret"===e.t0?8:"chatTypeBasicGroup"===e.t0?11:"chatTypeSupergroup"===e.t0?14:17;break;case 8:return e.next=10,x.a.send({"@type":"createPrivateChat",user_id:o.user_id,force:!1});case 10:return e.abrupt("break",17);case 11:return e.next=13,x.a.send({"@type":"createBasicGroupChat",basic_group_id:o.basic_group_id,force:!1});case 13:return e.abrupt("break",17);case 14:return e.next=16,x.a.send({"@type":"createSupergroupChat",supergroup_id:o.supergroup_id,force:!1});case 16:return e.abrupt("break",17);case 17:t.handleSelectChat(n,0,i,0);case 18:case"end":return e.stop()}}),e)}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientUpdateFocusWindow=e=>{e.focused&&(this.defferedActions.forEach(e=>e()),this.defferedActions=[])},this.onClientUpdateOpenReply=e=>{var t=e.chatId,a=e.messageId,n=this.state.replyHistory;if(this.props.chatId===t){var s=n.length>0?n[n.length-1]:null;s&&s.chatId===t&&s.messageId===a||n.push({chatId:t,messageId:a})}},this.onClientUpdateMediaActive=e=>{var t=this.listRef.current,a=t.offsetHeight,n=t.scrollTop;this.setState({playerOpened:!0},()=>{t.scrollTop===n&&(t.scrollTop+=Math.abs(a-t.offsetHeight))})},this.onClientUpdateMediaEnding=e=>{var t=this.listRef.current;this.prevOffsetHeight=t.offsetHeight,this.prevScrollTop=t.scrollTop},this.onClientUpdateMediaEnd=e=>{var t=this.listRef.current;this.setState({playerOpened:!1},()=>{t.scrollTop===this.prevScrollTop&&(t.scrollTop-=Math.abs(this.prevOffsetHeight-t.offsetHeight))})},this.onClientUpdateSelection=e=>{this.setState({selectionActive:le.a.selectedItems.size>0})},this.onClientUpdateClearHistory=e=>{this.props.chatId===e.chatId&&this.setState({clearHistory:e.inProgress})},this.onUpdateMessageContent=e=>{var t=this.props.chatId,a=this.state.history,n=e.chat_id,s=e.message_id;if(t===n&&-1!==a.findIndex(e=>e.id===s)){var i=le.a.get(n,s);if(!i)return;var r=U.a.getStore();Object(G.B)(r,[i])}},this.onUpdateMessageSendSucceeded=e=>{if(this.hasLastMessage()){var t=e.message,a=e.old_message_id;if(this.props.chatId===t.chat_id){var n=t.is_outgoing?dc.SCROLL_TO_BOTTOM:dc.KEEP_SCROLL_POSITION;this.replaceMessage(a,t,()=>{n!==dc.KEEP_SCROLL_POSITION&&this.handleScrollBehavior(n,this.snapshot),this.updateItemsInView()});var s=U.a.getStore();Object(G.B)(s,[t]),this.viewMessages([t])}}},this.onUpdateNewMessage=e=>{if(this.hasLastMessage()){var t=e.message;if(this.props.chatId===t.chat_id)if(0!==t.date){var a=this.listRef.current,n=t.is_outgoing?dc.SCROLL_TO_BOTTOM:dc.NONE;a.scrollTop+a.offsetHeight>=a.scrollHeight&&(n=dc.SCROLL_TO_BOTTOM);var s=t.is_outgoing?{scrollDownVisible:!1}:{},i=[t];this.scrollBehaviorNone=!0,this.insertPrevious(Object(it.g)(i),s,()=>{this.scrollBehaviorNone=!1,this.handleScrollBehavior(n,this.snapshot)});var r=U.a.getStore();Object(G.B)(r,i),this.viewMessages(i)}}},this.onUpdateDeleteMessages=e=>{var t=this.props.chatId,a=e.chat_id,n=e.is_permanent,s=e.message_ids;t===a&&n&&this.deleteHistory(s)},this.updateItemsInView=()=>{if(this.messages){for(var e=new Map,t=Object(M.z)(this.listRef,this.itemsRef),a=0;a<t.length;a++){var n=this.messages[t[a]];if(n){var s=n.props,i=s.chatId,r=s.messageId,o="".concat(i,"_").concat(r);e.set(o,o)}}x.a.clientUpdate({"@type":"clientUpdateMessagesInView",messages:e})}},this.loadIncompleteHistory=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=5,i=a&&a.messages.length>0&&a.messages.length<u.x,r=0;case 3:if(!(r<n&&i)){e.next=11;break}return e.next=6,t.onLoadNext();case 6:a=e.sent,i=a&&a.messages.length>0&&a.messages.length<u.x;case 8:r++,e.next=3;break;case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onLoadNext=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,a){e.next=4;break}return e.abrupt("return");case 4:if(!t.loading){e.next=6;break}return e.abrupt("return");case 6:if(!t.loadMigratedHistory){e.next=9;break}return t.onLoadMigratedHistory(),e.abrupt("return");case 9:return i=n&&n.length>0?n[0].id:0,r=n.length<u.x?2*u.x:u.x,t.loading=!0,o=t.sessionId,e.next=15,x.a.send({"@type":"getChatHistory",chat_id:a,from_message_id:i,offset:0,limit:r}).finally(()=>{t.loading=!1});case 15:if(l=e.sent,o===t.sessionId){e.next=18;break}return e.abrupt("return");case 18:if(t.props.chatId===a){e.next=20;break}return e.abrupt("return");case 20:le.a.setItems(l.messages),l.messages.reverse(),t.loading=!0,requestAnimationFrame(()=>{t.loading=!1,t.insertNext(Object(it.g)(l.messages),e=>{Object(it.g)(l.messages).length>0&&(t.handleScrollBehavior(dc.KEEP_SCROLL_POSITION,t.snapshot),setTimeout(()=>{var e=t.state.history;e.length>=3*u.x&&t.setState({history:e.slice(0,3*u.x)})},100)),l.messages.length||t.onLoadMigratedHistory()});var e=U.a.getStore();return Object(G.B)(e,l.messages),t.viewMessages(l.messages),l});case 24:case"end":return e.stop()}}),e)}))),this.onLoadMigratedHistory=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,a){e.next=4;break}return e.abrupt("return");case 4:if(!t.loading){e.next=6;break}return e.abrupt("return");case 6:if(i=Object(V.K)(a)){e.next=9;break}return e.abrupt("return");case 9:if(r=Oe.a.getFullInfo(i)){e.next=12;break}return e.abrupt("return");case 12:if(r.upgraded_from_basic_group_id){e.next=14;break}return e.abrupt("return");case 14:return t.loadMigratedHistory=!0,e.next=17,x.a.send({"@type":"createBasicGroupChat",basic_group_id:r.upgraded_from_basic_group_id});case 17:if(o=e.sent){e.next=20;break}return e.abrupt("return");case 20:return l=n.length>0&&n[0].chat_id===o.id?n[0].id:0,t.loading=!0,c=t.sessionId,e.next=25,x.a.send({"@type":"getChatHistory",chat_id:o.id,from_message_id:l,offset:0,limit:0===l?2*u.x:u.x}).finally(()=>{t.loading=!1});case 25:if(h=e.sent,c===t.sessionId){e.next=28;break}return e.abrupt("return");case 28:if(t.props.chatId===a){e.next=30;break}return e.abrupt("return");case 30:le.a.setItems(h.messages),h.messages.reverse(),t.insertNext(Object(it.g)(h.messages),e=>{Object(it.g)(h.messages).length>0&&t.handleScrollBehavior(dc.KEEP_SCROLL_POSITION,t.snapshot)}),d=U.a.getStore(),Object(G.B)(d,h.messages),t.viewMessages(h.messages);case 36:case"end":return e.stop()}}),e)}))),this.onLoadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state.history,Z.a.get(a)){e.next=5;break}return e.abrupt("return");case 5:if(!t.loading){e.next=7;break}return e.abrupt("return");case 7:if(!t.hasLastMessage()){e.next=9;break}return e.abrupt("return");case 9:return i=n&&n.length>0?n[n.length-1].id:0,r=n.length<u.x?2*u.x:u.x,t.loading=!0,o=t.sessionId,e.next=15,x.a.send({"@type":"getChatHistory",chat_id:a,from_message_id:i,offset:-r-1,limit:r+1}).finally(()=>{t.loading=!1});case 15:if(l=e.sent,o===t.sessionId){e.next=18;break}return e.abrupt("return");case 18:if(t.props.chatId===a){e.next=20;break}return e.abrupt("return");case 20:return Object(it.f)(l,t.state.history),le.a.setItems(l.messages),l.messages.reverse(),t.scrollBehaviorNone=!0,t.insertPrevious(Object(it.g)(l.messages),{},()=>{t.scrollBehaviorNone=!1,Object(it.g)(l.messages).length>0&&setTimeout(()=>{var e=t.state.history;e.length>3*u.x&&t.setState({history:e.slice(e.length-3*u.x)},()=>{t.handleScrollBehavior(dc.KEEP_SCROLL_POSITION,t.snapshot)})},0)}),c=U.a.getStore(),Object(G.B)(c,l.messages),t.viewMessages(l.messages),e.abrupt("return",l);case 29:case"end":return e.stop()}}),e)}))),this.handleScroll=()=>{var e=this.state,t=e.scrollDownVisible,a=e.replyHistory,n=e.history,s=this.listRef.current;this.updateItemsInView(),s.scrollTop<=u.yb&&this.onLoadNext(),s.scrollTop+s.offsetHeight>=s.scrollHeight-u.yb&&this.onLoadPrevious(),s.scrollTop+s.offsetHeight>=s.scrollHeight-u.yb?this.hasLastMessage()&&t&&(this.prevScrollTop!==s.scrollTop&&this.prevScrollTop&&this.prevHistory===n?this.setState({scrollDownVisible:!1,replyHistory:[]}):a.length||this.setState({scrollDownVisible:!1})):t||this.setState({scrollDownVisible:!0}),this.prevScrollTop=s.scrollTop,this.prevHistory=n},this.handleScrollBehavior=(e,t,a)=>{var n=this.props,s=(n.chatId,n.messageId,t||{scrollTop:0,scrollHeight:0,offsetHeight:0});s.scrollTop,s.scrollHeight,s.offsetHeight;switch(e){case dc.SCROLL_TO_BOTTOM:this.scrollToBottom();break;case dc.SCROLL_TO_MESSAGE:this.scrollToMessage();break;case dc.SCROLL_TO_UNREAD:this.scrollToUnread();break;case dc.SCROLL_TO_POSITION:this.scrollToPosition(a);break;case dc.KEEP_SCROLL_POSITION:this.keepScrollPosition(t);break;case dc.NONE:}},this.keepScrollPosition=e=>{var t=e.scrollTop,a=e.scrollHeight,n=(e.offsetHeight,this.listRef.current);n.scrollTop=t+(n.scrollHeight-a)},this.scrollToUnread=()=>{for(var e=this.props,t=e.chatId,a=(e.messageId,this.state.history),n=this.listRef.current,s=(Z.a.get(t),!1),i=0;i<a.length;i++){var r=this.itemsMap.get(i),o=Ko.findDOMNode(r);if(o&&r.props.showUnreadSeparator){n.scrollTop=o.offsetTop-0,s=!0;break}}s||this.scrollToBottom()},this.scrollToPosition=e=>{console.log("[scroll] scrollToPosition",this.props.chatId,e);for(var t=e.messageId,a=e.offset,n=this.state.history,s=this.listRef.current,i=0;i<n.length;i++){var r=this.itemsMap.get(i),o=Ko.findDOMNode(r);if(o&&r.props.messageId===t){s.scrollTop=o.offsetTop-a,!0;break}}},this.scrollToMessage=()=>{for(var e=this.props,t=(e.chatId,e.messageId),a=this.state.history,n=this.listRef.current,s=0;s<a.length;s++){var i=this.itemsMap.get(s),r=Ko.findDOMNode(i);if(r&&i.props.messageId===t){n.offsetHeight<r.offsetHeight?n.scrollTop=r.offsetTop:n.scrollTop=r.offsetTop-n.offsetHeight/2+r.offsetHeight/2,!0;break}}},this.scrollToBottom=()=>{var e=this.props,t=(e.chatId,e.messageId,this.listRef.current);t.scrollHeight-t.offsetHeight!==t.scrollTop&&(t.scrollTop=t.scrollHeight-t.offsetHeight)},this.scrollToStart=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=Z.a.get(a)){e.next=4;break}return e.abrupt("return");case 4:return t.sessionId=Date.now(),t.loading=!1,0,0,i=u.x,t.loading=!0,r=t.sessionId,e.next=13,x.a.send({"@type":"getChatHistory",chat_id:n.id,from_message_id:0,offset:0,limit:i}).finally(()=>{t.loading=!1});case 13:if(o=e.sent,r===t.sessionId){e.next=16;break}return e.abrupt("return");case 16:if(t.props.chatId===a){e.next=18;break}return e.abrupt("return");case 18:t.setState({scrollDownVisible:!1,replyHistory:[]}),le.a.setItems(o.messages),o.messages.reverse(),t.replace(t.state.separatorMessageId,o.messages,()=>{t.handleScrollBehavior(dc.SCROLL_TO_BOTTOM,t.snapshot)}),l=U.a.getStore(),Object(G.B)(l,o.messages),t.viewMessages(o.messages),t.loadIncompleteHistory(o);case 26:case"end":return e.stop()}}),e)}))),this.handleListDragEnter=e=>{e.preventDefault(),e.stopPropagation();var t=this.props.chatId;Object(V.e)(t)&&x.a.clientUpdate({"@type":"clientUpdateDragging",dragging:!0,files:e.dataTransfer.files})},this.handleScrollDownClick=e=>{var t=this.state.replyHistory;if(t.length>0){var a=t.pop();if(a){var n=a.chatId,s=a.messageId;n===this.props.chatId&&Object(re.i)(n,s)}}else this.scrollToStart()},this.sessionId=Date.now(),this.state={prevChatId:0,prevMessageId:null,playerOpened:!1,history:[],clearHistory:!1,selectionActive:!1,separatorMessageId:0,scrollDownVisible:!1,replyHistory:[]},this.listRef=o.a.createRef(),this.itemsRef=o.a.createRef(),this.scrollDownButtonRef=o.a.createRef(),this.defferedActions=[],this.itemsMap=new Map,this.updateItemsInView=Object(M.D)(this.updateItemsInView,500)}hasLastMessage(){var e=this.props.chatId,t=this.state.history,a=Z.a.get(e);if(!a)return!1;var n=a.last_message;return!n||t.length>0&&t[t.length-1].id===n.id}static getDerivedStateFromProps(e,t){return e.chatId!==t.prevChatId||e.messageId!==t.prevMessageId?{prevChatId:e.chatId,prevMessageId:e.messageId,clearHistory:!1,selectionActive:!1,separatorMessageId:e.chatId!==t.prevChatId?0:t.separatorMessageId,scrollDownVisible:e.chatId===t.prevChatId&&(t.scrollDownVisible||t.replyHistory.length>0),replyHistory:e.chatId!==t.prevChatId?[]:t.replyHistory}:null}getSnapshotBeforeUpdate(e,t){var a=this.listRef.current,n={scrollTop:a.scrollTop,scrollHeight:a.scrollHeight,offsetHeight:a.offsetHeight};return this.snapshot=n,n}componentDidUpdate(e,t,a){var n=this.props,s=n.chatId,i=n.messageId;this.state.scrollDownVisible,this.listRef.current;e.chatId===s&&e.messageId===i||this.handleSelectChat(s,e.chatId,i,e.messageId)}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId,i=a.theme,r=this.state,o=r.playerOpened,l=r.history,c=r.dragging,h=r.clearHistory,d=r.selectionActive,p=r.scrollDownVisible;return e.theme!==i||(e.chatId!==n||(e.messageId!==s||(t.scrollDownVisible!==p||(t.playerOpened!==o||(!Object(M.r)(t.history,l)||(t.dragging!==c||(t.clearHistory!==h||t.selectionActive!==d)))))))}componentDidMount(){na.a.on("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),na.a.on("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Z.a.on("clientUpdateClearHistory",this.onClientUpdateClearHistory),le.a.on("clientUpdateClearSelection",this.onClientUpdateSelection),le.a.on("clientUpdateMessageSelected",this.onClientUpdateSelection),le.a.on("clientUpdateOpenReply",this.onClientUpdateOpenReply),le.a.on("clientUpdateTryEditMessage",this.onClientUpdateTryEditMessage),le.a.on("updateNewMessage",this.onUpdateNewMessage),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.on("updateMessageContent",this.onUpdateMessageContent),le.a.on("updateMessageSendSucceeded",this.onUpdateMessageSendSucceeded),k.b.on("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.on("clientUpdateMediaEnding",this.onClientUpdateMediaEnding),k.b.on("clientUpdateMediaEnd",this.onClientUpdateMediaEnd)}componentWillUnmount(){na.a.off("clientUpdateFocusWindow",this.onClientUpdateFocusWindow),na.a.off("clientUpdateDialogsReady",this.onClientUpdateDialogsReady),Z.a.off("clientUpdateClearHistory",this.onClientUpdateClearHistory),le.a.off("clientUpdateClearSelection",this.onClientUpdateSelection),le.a.off("clientUpdateMessageSelected",this.onClientUpdateSelection),le.a.off("clientUpdateOpenReply",this.onClientUpdateOpenReply),le.a.off("clientUpdateTryEditMessage",this.onClientUpdateTryEditMessage),le.a.off("updateNewMessage",this.onUpdateNewMessage),le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.off("updateMessageContent",this.onUpdateMessageContent),le.a.off("updateMessageSendSucceeded",this.onUpdateMessageSendSucceeded),k.b.off("clientUpdateMediaActive",this.onClientUpdateMediaActive),k.b.off("clientUpdateMediaEnding",this.onClientUpdateMediaEnding),k.b.off("clientUpdateMediaEnd",this.onClientUpdateMediaEnd)}handleSelectChat(e,t,a,n){var r=this;return Object(i.a)(s.a.mark((function n(){var i,o,l,c,h,d,p,m,f,g,C,v,b,E,S,y,I,k,w;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=Z.a.get(e),o=Z.a.get(t),r.sessionId=Date.now(),r.loading=!1,r.loadMigratedHistory=!1,r.defferedActions=[],l=null,!i){n.next=51;break}return x.a.send({"@type":"openChat",chat_id:i.id}),c=!a&&i.unread_count>1,h=0,c&&i.last_read_inbox_message_id?h=i.last_read_inbox_message_id:a?h=a:l&&(h=l.messageId),d=c||a||l?-1-u.x:0,p=c||a||l?2*u.x:u.x,r.loading=!0,m=r.sessionId,n.next=18,x.a.send({"@type":"getChatHistory",chat_id:i.id,from_message_id:h,offset:d,limit:p}).catch(e=>({"@type":"messages",messages:[],total_count:0})).finally(()=>{r.loading=!1});case 18:if(f=n.sent,m===r.sessionId){n.next=21;break}return n.abrupt("return");case 21:if(le.a.setItems(f.messages),f.messages.reverse(),g=r.state.separatorMessageId,e===t){n.next=39;break}if(g=Number.MAX_VALUE,!(i&&i.unread_count>1)){n.next=38;break}C=f.messages.length-1;case 28:if(!(C>=0)){n.next=38;break}if(v=f.messages[C].id,!(!f.messages[C].is_outgoing&&v>i.last_read_inbox_message_id&&v<g)){n.next=34;break}g=v,n.next=35;break;case 34:return n.abrupt("break",38);case 35:C--,n.next=28;break;case 38:g=g===Number.MAX_VALUE?0:g;case 39:b=dc.SCROLL_TO_BOTTOM,a?b=dc.SCROLL_TO_MESSAGE:c&&g?b=dc.SCROLL_TO_UNREAD:l&&(b=dc.SCROLL_TO_POSITION),r.replace(g,f.messages,()=>{r.handleScrollBehavior(b,r.snapshot,l),a&&Object(re.g)(e,a)}),E=U.a.getStore(),Object(G.B)(E,f.messages),r.viewMessages(f.messages),Object(G.x)(E,[e]),Object(G.y)(E,e),r.loadIncompleteHistory(f),t!==e&&(Object(V.n)(e),Object(V.p)(e)),n.next=53;break;case 51:r.loading=!0,r.replace(0,[],()=>{r.loading=!1});case 53:t!==e&&o&&(x.a.send({"@type":"closeChat",chat_id:t}),S=Object(M.p)(r.snapshot,r.itemsRef),console.log("[scroll] start setScrollPosition",[t,o,r.snapshot,S]),(y=r.messages[S.index])&&(I=y.props,k=I.chatId,w=I.messageId,console.log("[scroll] stop setScrollPosition",[t,o],{chatId:k,messageId:w,offset:S.offset}),Z.a.setScrollPosition(t,{chatId:k,messageId:w,offset:S.offset})));case 54:case"end":return n.stop()}}),n)})))()}viewMessages(e){if(e&&0!==e.length&&e[0].chat_id){var t=()=>{x.a.send({"@type":"viewMessages",chat_id:e[0].chat_id,message_ids:e.map(e=>e.id)})};window.hasFocus?t():this.defferedActions.push(t)}}cancelLoadMessageContents(e){for(var t=e.length-1;t>=0;t--){var a=e[t];if(a&&a.content)switch(a.content["@type"]){case"messagePhoto":var n=this.getMessagePhoto(a),s=Object(L.a)(n,2),i=s[0];if(s[1])Object(M.m)(a.content.photo.sizes).blob||U.a.cancelGetRemoteFile(i,a);break;case"messageSticker":var r=this.getMessageSticker(a),o=Object(L.a)(r,2),l=o[0];if(o[1])a.content.sticker.sticker.blob||U.a.cancelGetRemoteFile(l,a)}}}replace(e,t,a){this.setState({separatorMessageId:e,history:t},a)}replaceMessage(e,t,a){t?this.setState({history:this.state.history.filter(t=>t.id!==e).concat([t])},a):a&&a()}insertNext(e,t){0!==e.length?this.setState({history:e.concat(this.state.history)},t):t&&t()}insertPrevious(e,t,a){0!==e.length?this.setState(Object(Ze.a)({history:this.state.history.concat(e)},t),a):a&&a()}deleteHistory(e,t){var a=this.state.history;if(0!==a.length){var n=new Map(e.map(e=>[e,e]));this.setState({history:a.filter(e=>!n.has(e.id))},t)}else t&&t()}showMessageTitle(e,t,a,n){if(!e)return!1;var s=e.chat_id,i=e.date,r=e.is_outgoing,o=e.sender_user_id;e.content;return!!a||(!!n||(!!Object(V.R)(s)||t&&(Object(Xl.b)(t)||"messageSticker"===t.content["@type"]||"messageVideoNote"===t.content["@type"]||o!==t.sender_user_id||r!==t.is_outgoing||i-t.date>u.y)))}showMessageDate(e,t,a){if(a)return!0;var n=new Date(1e3*e.date),s=t?new Date(1e3*t.date):n;return n.getFullYear()!==s.getFullYear()||n.getMonth()!==s.getMonth()||n.getDate()!==s.getDate()}render(){var e=this,t=this.props.chatId,a=this.state,n=a.history,s=a.separatorMessageId,i=a.clearHistory,r=a.selectionActive,l=a.scrollDownVisible;if(this.itemsMap.clear(),i)this.messages=null;else{this.messages=[];for(var h=function(t){var a=n[t],i=a.chat_id,r=a.media_album_id,l=a.ttl,c=(a.content,a.is_outgoing,!1);if("0"!==r&&!l){for(var h=[a],p=t+1;p<t+u.a&&p<n.length&&n[p].media_album_id===r;p++)h.push(n[p]);if(h.length>1){var m=a,f=t>0?n[t-1]:null,g=t+h.length<n.length?n[t+h.length]:null,C=e.showMessageDate(m,f,0===t),v=s===m.id,b=!!g&&s===g.id,E=e.showMessageTitle(m,f,0===t,v),S=e.showMessageTitle(g,m,!1,b),y=!g||Object(Xl.b)(g)||"messageSticker"===g.content["@type"]||"messageVideoNote"===g.content["@type"]||m.sender_user_id!==g.sender_user_id||m.is_outgoing!==g.is_outgoing||S;e.messages.push(o.a.createElement(Bl,{key:"chat_id=".concat(i," media_album_id=").concat(r," date=").concat(C," title=").concat(E," tail=").concat(y),chatId:i,messageIds:h.map(e=>e.id),showTitle:E,showTail:y,showUnreadSeparator:h.map(e=>e.id).some(e=>e.id===s),showDate:C})),t+=h.length-1,c=!0}}if(!c){var M=a,I=t>0?n[t-1]:null,U=t<n.length-1?n[t+1]:null,k=e.showMessageDate(M,I,0===t),x=null;if(Object(Xl.b)(M))x=o.a.createElement(ec,{key:"chat_id=".concat(M.chat_id," id=").concat(M.id," date=").concat(k),ref:a=>e.itemsMap.set(t,a),chatId:M.chat_id,messageId:M.id,showUnreadSeparator:s===M.id});else{var w=s===M.id,O=U&&s===U.id,L=e.showMessageTitle(M,I,0===t,w),_=e.showMessageTitle(U,M,!1,O),N=!U||Object(Xl.b)(U)||"messageSticker"===U.content["@type"]||"messageVideoNote"===U.content["@type"]||M.sender_user_id!==U.sender_user_id||M.is_outgoing!==U.is_outgoing||_;x=o.a.createElement(Yl,{key:"chat_id=".concat(M.chat_id," id=").concat(M.id," date=").concat(k," title=").concat(L," tail=").concat(N),ref:a=>e.itemsMap.set(t,a),chatId:M.chat_id,messageId:M.id,sendingState:M.sending_state,showTitle:L,showTail:N,showUnreadSeparator:s===M.id,showDate:k})}e.messages.push(x)}d=t},d=0;d<n.length;d++)h(d)}return o.a.createElement("div",{className:c()("messages-list",{"messages-list-selection-active":r}),onDragEnter:this.handleListDragEnter},o.a.createElement("div",{ref:this.listRef,className:"messages-list-wrapper",onScroll:this.handleScroll},o.a.createElement("div",{className:"messages-list-top"}),o.a.createElement("div",{ref:this.itemsRef,className:"messages-list-items"},this.messages)),o.a.createElement(hl,{chatId:t}),o.a.createElement(ac,null),l&&o.a.createElement(rc,{ref:this.scrollDownButtonRef,onClick:this.handleScrollDownClick}),o.a.createElement(Hl,null),o.a.createElement(cc,null))}}var uc=pc,mc=a(613),fc=a.n(mc),gc=a(614),Cc=a.n(gc);class vc extends o.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleMenuClick=e=>{this.handleOpen(e.currentTarget)},this.handleOpen=e=>{this.setState({anchorEl:e})},this.handleClose=()=>{this.setState({anchorEl:null})},this.handleCopyLink=()=>{this.handleClose();var e=this.props.t,t=this.getStickersLink(Jr.a.stickerSet);t&&(X(t),this.handleScheduledAction(e("LinkCopied")))},this.getStickersLink=e=>{if(!e)return"";var t=e.name;if(!t)return"";var a=ee.a.get("t_me_url");return(a?a.value:"https://telegram.org/")+"addstickers/"+t},this.handleScheduledAction=e=>{var t=this.props,a=t.enqueueSnackbar,n=t.closeSnackbar,s=a(e,{autoHideDuration:u.C,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"close","aria-label":"Close",color:"inherit",className:"notification-close-button",onClick:()=>n(s)},o.a.createElement(g.a,null))]})},this.handleShare=()=>{this.handleClose();var e=this.getStickersLink(Jr.a.stickerSet);if(e){x.a.clientUpdate({"@type":"clientUpdateStickerSet",stickerSet:null});var t={"@type":"inputMessageText",text:{"@type":"formattedText",text:e,entities:null},disable_web_page_preview:!1,clear_draft:!1};Object(re.e)(t)}}}render(){var e=this.props,t=e.t,a=e.className,n=this.state.anchorEl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(P.a,{className:a,"aria-label":"Share",open:Boolean(n),onClick:this.handleMenuClick},o.a.createElement(jn,null)),o.a.createElement(Za.a,{id:"sticker-set-menu",anchorEl:n,open:Boolean(n),getContentAnchorEl:null,disableAutoFocusItem:!0,disableEnforceFocus:!0,disableRestoreFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},o.a.createElement(Ke.a,{onClick:this.handleCopyLink},o.a.createElement(Ee.a,null,o.a.createElement(fc.a,null)),o.a.createElement(Se.a,{primary:t("CopyLink")})),o.a.createElement(Ke.a,{onClick:this.handleShare},o.a.createElement(Ee.a,null,o.a.createElement(Cc.a,null)),o.a.createElement(Se.a,{primary:t("StickersShare")}))))}}var bc=Object(h.a)(Object(_.a)(),p.b)(vc);a(615);class Ec extends o.a.Component{constructor(e){super(e),this.handleUpdateInstalledStickerSets=e=>{var t=Jr.a.stickerSet;this.setState({stickerSet:t})},this.handleClientUpdateStickerSet=e=>{var t=e.stickerSet;if(this.setState({stickerSet:t},()=>{setTimeout(()=>{this.handleScroll()},0)}),t){var a=U.a.getStore();Object(G.F)(a,t)}},this.handleClose=()=>{x.a.clientUpdate({"@type":"clientUpdateStickerSet",stickerSet:null})},this.handleDone=()=>{var e=this.state.stickerSet;if(e){var t=e.is_installed;x.a.send({"@type":"changeStickerSet",set_id:e.id,is_installed:!t}),this.handleClose()}},this.loadPreviewContent=e=>{var t=this.state.stickerSet.stickers.find(t=>t.sticker.id===e);if(t){var a=U.a.getStore();Object(G.E)(a,t,null),this.getNeighborStickers(e).forEach(e=>{Object(G.E)(a,e,null)})}},this.getNeighborStickers=e=>{var t=this.state.stickerSet;if(!t)return[];var a=t.stickers;if(!a)return[];var n=[],s=a.findIndex(t=>t.sticker.id===e);if(-1===s)return[];var i=Math.floor(s/5),r=s%5,o=i-1,l=i+1,c=r-1,h=r+1;return o>=0&&(c>=0&&n.push(5*o+c),n.push(5*o+r),h<5&&n.push(5*o+h)),c>=0&&n.push(5*i+c),h<5&&n.push(5*i+h),l<Math.ceil(a.length/5)&&(c>=0&&n.push(5*l+c),n.push(5*l+r),h<5&&n.push(5*l+h)),n.map(e=>a[e])},this.handleMouseUp=()=>{this.setState({sticker:null}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:null}),this.mouseDown=!1,document.removeEventListener("mouseup",this.handleMouseUp)},this.handleMouseEnter=e=>{var t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);a&&this.mouseDown&&(this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t))},this.handleMouseDown=e=>{var t=Number(e.currentTarget.dataset.stickerId),a=this.getSticker(t);if(a)return this.setState({sticker:a}),x.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:a}),this.loadPreviewContent(t),this.mouseDown=!0,document.addEventListener("mouseup",this.handleMouseUp),e.preventDefault(),e.stopPropagation(),!1},this.handleScroll=()=>{var e=this.contentRef.current;if(e){var t=e.scrollHeight>e.offsetHeight,a=t&&0===e.scrollTop,n=t&&e.scrollTop+e.offsetHeight===e.scrollHeight,s=t&&e.scrollTop>0&&e.scrollTop+e.offsetHeight<e.scrollHeight;this.setState({scrollTop:a,scrollBottom:n,scroll:s})}},this.handleInViewport=(e,t)=>{var a=this.contentRef.current;if(!a)return!1;var n=a.getBoundingClientRect(),s=t.top-n.top,i=t.bottom-n.bottom;return!(s>n.height)&&!(i<-n.height)},this.contentRef=o.a.createRef(),this.state={stickerSet:Jr.a.stickerSet,stickerId:0,scroll:!1,scrollTop:!1,scrollBottom:!1}}shouldComponentUpdate(e,t,a){var n=this.state,s=n.stickerSet,i=n.sticker,r=n.scroll,o=n.scrollTop,l=n.scrollBottom;return s!==t.stickerSet||(i!==t.sticker||(r!==t.scroll||(o!==t.scrollTop||l!==t.scrollBottom)))}componentDidMount(){Jr.a.on("clientUpdateStickerSet",this.handleClientUpdateStickerSet),Jr.a.on("updateInstalledStickerSets",this.handleUpdateInstalledStickerSets)}componentWillUnmount(){Jr.a.off("clientUpdateStickerSet",this.handleClientUpdateStickerSet),Jr.a.off("updateInstalledStickerSets",this.handleUpdateInstalledStickerSets)}getSticker(e){var t=this.state.stickerSet;if(!t)return null;var a=t.stickers,n=a.findIndex(t=>t.sticker.id===e);return-1!==n?a[n]:null}render(){var e=this.props.t,t=this.state,a=t.stickerSet,n=t.sticker,s=t.scroll,i=t.scrollTop,r=t.scrollBottom;if(!a)return null;var l=a.title,h=a.stickers,d=a.is_installed,p=h.map(e=>o.a.createElement("div",{className:"sticker-set-dialog-item",key:e.sticker.id,"data-sticker-id":e.sticker.id,onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown},o.a.createElement(Gl.b,{key:e.sticker.id,className:"sticker-set-dialog-item-sticker",sticker:e,autoplay:!0,blur:!1,displaySize:u.Eb,preview:!0,source:Gl.a.STICKER_SET,inViewportFunc:this.handleInViewport}),o.a.createElement("div",{className:"sticker-set-dialog-item-emoji"},e.emoji)));return o.a.createElement(j.a,{className:c()("sticker-set-dialog",{"sticker-set-dialog-scroll":s},{"sticker-set-dialog-scroll-top":i},{"sticker-set-dialog-scroll-bottom":r}),open:!0,manager:oe.a,transitionDuration:0,onClose:this.handleClose,"aria-labelledby":"sticker-set-dialog-title-text",classes:{paper:"sticker-set-dialog-paper"}},o.a.createElement(R.a,{className:c()("sticker-set-dialog-title",{"sticker-set-dialog-disabled":Boolean(n)}),disableTypography:!0},o.a.createElement(P.a,{"aria-label":"Close",onClick:this.handleClose},o.a.createElement(g.a,null)),o.a.createElement(Me.a,{variant:"h6",id:"sticker-set-dialog-title-text",className:"sticker-set-dialog-title-typography",noWrap:!0},l),o.a.createElement(bc,null)),o.a.createElement(Dn.a,{ref:this.contentRef,classes:{root:c()("sticker-set-dialog-content-root","scrollbars-hidden")},onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onScroll:this.handleScroll},p),o.a.createElement(D.a,{className:c()("sticker-set-dialog-actions",{"sticker-set-dialog-disabled":Boolean(n)})},o.a.createElement(N.a,{className:"sticker-set-dialog-action-button",disableElevation:!0,variant:"contained",color:d?"secondary":"primary",onClick:this.handleDone},e(d?"StickersRemove":"AddStickers"))),o.a.createElement(oc.a,{sticker:n}))}}var Sc=Object(_.a)()(Ec);a(616);class yc extends r.Component{constructor(e){super(e),this.onClientUpdateDocumentBlob=e=>{var t=this.state.wallpaper;if(t){var a=t.document;if(a){var n=a.document;if(n){var s=e.fileId;if(n.id===s){if(this.thumbnailTime)if(this.thumbnailTime.wallpaper===t)if(new Date-this.thumbnailTime.time<250)return void setTimeout(()=>{this.forceUpdate()},250);this.forceUpdate()}}}}},this.onClientUpdateDocumentThumbnailBlob=e=>{var t=this.state.wallpaper;if(t){var a=t.document;if(a){var n=a.thumbnail;if(n){var s=n.file;if(s){var i=e.fileId;s.id===i&&(this.thumbnailTime={wallpaper:t,time:new Date},this.forceUpdate())}}}}},this.onClientUpdateChatBackground=e=>{var t=e.wallpaper;this.thumbnailTime={wallpaper:t,time:new Date},this.setState({wallpaper:t})},this.onClientUpdateChatDetailsVisibility=e=>{this.forceUpdate()},this.onClientUpdateChatId=e=>{this.setState({chatId:e.nextChatId,messageId:e.nextMessageId})},this.scrollToBottom=()=>{this.messagesList.scrollToBottom()},this.scrollToStart=()=>{this.messagesList.scrollToStart()},this.scrollToMessage=()=>{this.messagesList.scrollToMessage()},this.state={chatId:na.a.getChatId(),messageId:na.a.getMessageId(),selectedCount:0,wallpaper:null,wallpaperSrc:null}}shouldComponentUpdate(e,t){var a=this.state,n=a.chatId,s=a.messageId,i=a.selectedCount,r=a.wallpaper;return t.chatId!==n||(t.messageId!==s||(t.selectedCount!==i||t.wallpaper!==r))}componentDidMount(){na.a.on("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),na.a.on("clientUpdateChatId",this.onClientUpdateChatId),Z.a.on("clientUpdateChatBackground",this.onClientUpdateChatBackground),U.a.on("clientUpdateDocumentBlob",this.onClientUpdateDocumentBlob),U.a.on("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}componentWillUnmount(){na.a.off("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),na.a.off("clientUpdateChatId",this.onClientUpdateChatId),Z.a.off("clientUpdateChatBackground",this.onClientUpdateChatBackground),U.a.off("clientUpdateDocumentBlob",this.onClientUpdateDocumentBlob),U.a.off("clientUpdateDocumentThumbnailBlob",this.onClientUpdateDocumentThumbnailBlob)}render(){var e=this.state,t=e.chatId,a=e.messageId,n=e.wallpaper,s=null,i=null;if(n){var r=n.document;if(r){var l=r.thumbnail,c=r.document;c&&(i=Object(G.m)(c)),!i&&l&&(i=Object(G.m)(l.file))}s={backgroundImage:i?"url(".concat(i,")"):null}}return o.a.createElement("div",{className:"dialog-details",style:s},o.a.createElement("div",{className:"dialog-background"}),o.a.createElement(ll,null),o.a.createElement(bo,{chatId:t}),o.a.createElement(uc,{ref:e=>this.messagesList=e,chatId:t,messageId:a}),o.a.createElement(io,{chatId:t}),o.a.createElement(Sc,null),o.a.createElement(Qi,null))}}var Mc=yc,Ic=a(49),Uc=(a(617),new Map);class kc extends o.a.PureComponent{render(){var e=this.props,t=e.forwardedRef,a=e.iv;if(!a)return null;var n=a.page_blocks,s=a.is_rtl;if(n){Uc.clear();var i=n.map((e,t)=>Object($o.g)(e,a,t,t=>{Uc.set(e,t)}));return o.a.createElement("article",{ref:t,dir:s?"rtl":"ltr"},i)}}}var xc=Object(h.a)(Object(h.d)(),Ic.b)(kc),wc=Object(T.a)(o.a.createElement("path",{d:"M9.91421356,11.5 L16.2071068,5.20710678 C16.5976311,4.81658249 16.5976311,4.18341751 16.2071068,3.79289322 C15.8165825,3.40236893 15.1834175,3.40236893 14.7928932,3.79289322 L7.79289322,10.7928932 C7.40236893,11.1834175 7.40236893,11.8165825 7.79289322,12.2071068 L14.7928932,19.2071068 C15.1834175,19.5976311 15.8165825,19.5976311 16.2071068,19.2071068 C16.5976311,18.8165825 16.5976311,18.1834175 16.2071068,17.7928932 L9.91421356,11.5 Z"}),"Left");a(618);class Oc extends o.a.Component{constructor(e){super(e),this.handleClick=e=>{e.stopPropagation()},this.handleScroll=()=>{var e=this.scrollRef.current;if(e){var t=0===e.scrollTop&&e.scrollHeight>e.offsetHeight,a=e.scrollTop+e.offsetHeight===e.scrollHeight&&e.scrollHeight>e.offsetHeight;this.setState({top:t,bottom:a})}},this.state={top:!1,bottom:!1},this.scrollRef=o.a.createRef()}shouldComponentUpdate(e,t,a){var n=this.props.text,s=this.state,i=s.top,r=s.bottom;return e.text!==n||(t.top!==i||t.bottom!==r)}componentDidMount(){this.handleScroll()}componentDidUpdate(e,t,a){var n=this.props.text;e.text!==n&&this.handleScroll()}render(){var e=this.props.text,t=this.state,a=t.top,n=t.bottom;return o.a.createElement("div",{className:"media-caption",onClick:this.handleClick},o.a.createElement("div",{ref:this.scrollRef,className:c()("scrollbars-hidden","media-caption-wrapper",{"media-caption-wrapper-top":a,"media-caption-wrapper-bottom":n,"media-caption-wrapper-both":!a&&!n}),onScroll:this.handleScroll},o.a.createElement("div",{className:"media-caption-text"},e)))}}Oc.defaultProps={};var Lc=Oc,_c=a(42);class Nc extends o.a.Component{constructor(e){super(e),this.onClientUpdatePictureInPicture=e=>{var t=e.videoInfo;t&&(this.state.file.id===t.fileId&&x.a.clientUpdate({"@type":"clientUpdateInstantViewViewerContent",content:null}))},this.onClientUpdateMediaBlob=e=>{var t=e.fileId,a=this.props,n=a.media,s=a.size,i=this.state.file;if(i&&i.id===t){var r=Object(G.o)(n,s),o=Object(L.a)(r,5),l=o[0],c=o[1],h=o[2],d=o[3],p=o[4];this.setState({width:l,height:c,file:h,src:Object(G.m)(h),supportsStreaming:p,mimeType:d})}},this.onClientUpdateMediaThumbnailBlob=e=>{var t=e.fileId,a=this.state.thumbnail;a&&a.file.id===t&&this.forceUpdate()},this.videoRef=o.a.createRef(),this.state={}}static getDerivedStateFromProps(e,t){var a=e.media,n=e.size;e.caption,e.url;if(a!==t.prevMedia){var s=Object(G.q)(a),i=Object(G.p)(a),r=Object(G.o)(a,n),o=Object(L.a)(r,5),l=o[0],c=o[1],h=o[2],d=o[3],p=o[4];h=U.a.get(h.id)||h;var u=Object(G.m)(h);if(!u&&p){var m=a.video;m&&(u="/streaming/file?id=".concat(h.id,"&size=").concat(h.size,"&mime_type=").concat(m.mime_type))}return{prevMedia:a,speed:1,isPlaying:!1,width:l,height:c,file:h,src:u,source:null,supportsStreaming:p,mimeType:d,thumbnail:s,minithumbnail:i}}return null}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentDidUpdate(e,t,a){var n=this.state.src;if(t.src!==n){var s=this.videoRef.current;if(!s)return;s.load()}}render(){var e=this.props,t=e.media,a=e.caption,n=e.url;if(!t)return null;var s=this.state,i=s.width,r=s.height,l=s.file,c=s.src,h=s.mimeType,d=s.thumbnail,p=s.minithumbnail,m=s.isPlaying,f=s.supportsStreaming;if(!l)return null;var g=p?"data:image/jpeg;base64, "+p.data:null,C=Object(G.m)(d),v=i,b=r,E=u.w/Math.max(v,b),y=v>b?u.w:Math.floor(v*E),M=b>v?u.w:Math.floor(b*E);v=y,b=M;var I=null,U=c?o.a.createElement("source",{src:c,type:h}):null,k=Object(at.l)(d,p,v,b);switch(t["@type"]){case"video":I=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement(S.a,{ref:this.videoRef,className:"media-viewer-content-video-player",fileId:l.id,width:v,height:b,poster:f?C||g:null,onPlay:()=>{this.setState({isPlaying:!0})}},U),!m&&!f&&k);break;case"animation":I=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("video",{ref:this.videoRef,className:"media-viewer-content-video-player",onClick:this.handleContentClick,loop:!0,autoPlay:!0,width:v,height:b,onPlay:()=>{this.setState({isPlaying:!0})}},U),!m&&k);break;default:I=o.a.createElement("img",{className:"media-viewer-content-image",src:c,alt:"",onClick:this.handleContentClick})}return o.a.createElement("div",{className:"media-viewer-content"},I,!f&&o.a.createElement(Ps.a,{file:l,zIndex:2}),a&&(!Object($o.k)(a.text)||!Object($o.k)(a.credit)||n)&&o.a.createElement(Lc,{text:o.a.createElement(o.a.Fragment,null,o.a.createElement(_c.a,{text:a.text,credit:a.credit}),o.a.createElement(lt.a,{url:n}))}))}}var Pc=Nc;a(619);class jc extends o.a.Component{constructor(...e){super(...e),this.handleClick=e=>{e.stopPropagation();var t=this.props,a=t.disabled,n=t.onClick;a||n(e)}}render(){var e=this.props,t=e.disabled,a=e.grow,n=e.children,s=e.className,i=e.style,r=c()(t?"media-viewer-button-disabled":"media-viewer-button",{grow:a},s);return o.a.createElement("div",{className:r,style:i,onClick:this.handleClick},n)}}var Dc=jc;a(620);class Rc extends o.a.Component{render(){var e=this.props,t=e.title,a=e.subtitle,n=e.style;return o.a.createElement("div",{className:"media-viewer-footer-text",style:n},o.a.createElement("div",{className:"media-viewer-footer-text-wrapper"},o.a.createElement("span",null,t),Boolean(a)&&o.a.createElement("span",null,"\xa0",a)))}}var Tc=Rc;a(456);class Fc extends o.a.Component{constructor(...e){super(...e),this.handleClick=e=>{e.stopPropagation();var t=this.props,a=t.onClick;t.disabled||a(e)}}render(){var e=this.props,t=e.checked,a=e.children,n=e.disabled,s=e.title;return o.a.createElement("div",{className:c()("media-viewer-footer-button",{"media-viewer-footer-button-checked":t,"media-viewer-footer-button-disabled":n}),title:s,onClick:this.handleClick},a)}}var Ac=Fc;class Bc extends o.a.Component{constructor(...e){super(...e),this.state={},this.onUpdateFile=e=>{var t=this.props.fileId,a=e.file;a.id===t&&a.local.is_downloading_completed&&this.checkFileLoaded()},this.onClientUpdateMediaBlob=e=>{var t=this.state.fileId;t===e.fileId&&this.setState({disabled:Bc.saveDisabled(t)})},this.handleClick=e=>{e.stopPropagation();var t=this.props.onClick;this.state.disabled||t(e)}}static getDerivedStateFromProps(e,t){var a=e.fileId;return a!==t.prevPropsFileId?{prevPropsFileId:a,fileId:a,disabled:Bc.saveDisabled(a)}:null}componentDidUpdate(e,t,a){e.fileId!==this.props.chatId&&this.checkFileLoaded()}checkFileLoaded(){var e=this.props.fileId;if(!U.a.getBlob(e)){var t=U.a.get(e);if(t){var a=t.local;if(a&&a.is_downloading_completed){var n=U.a.getStore();U.a.getLocalFile(n,t,null,()=>{this.setState({disabled:Bc.saveDisabled(e)})})}}}}componentDidMount(){this.checkFileLoaded(),U.a.on("updateFile",this.onUpdateFile),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateChatBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateDocumentBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateUserBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob)}componentWillUnmount(){U.a.off("updateFile",this.onUpdateFile),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateChatBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateDocumentBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateUserBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob)}render(){var e=this.props,t=e.title,a=e.children,n=e.disabled,s=this.state.disabled;return o.a.createElement(Ac,{disabled:s||n,title:t,onClick:this.handleClick},a||o.a.createElement(Oi.a,null))}}Bc.saveDisabled=e=>!Boolean(U.a.getBlob(e));var Vc=Bc;a(621);class Hc extends o.a.Component{constructor(e){super(e),this.onKeyDown=e=>{if(!(oe.a.modals.length>0)&&!e.isComposing){var t=this.state,a=t.index,n=t.blocks;if(!n)return null;if(-1===a)return null;var s=n[a],i=Object($o.c)(s);if(i){switch(e.key){case"Escape":return this.handleClose(),e.stopPropagation(),void e.preventDefault();case"ArrowLeft":return this.handleNext(),e.stopPropagation(),void e.preventDefault();case"ArrowRight":return this.handlePrevious(),e.stopPropagation(),void e.preventDefault()}"video"===i["@type"]&&x.a.clientUpdate({"@type":"clientUpdateMediaShortcut",event:e})}}},this.handlePrevious=e=>{e&&e.stopPropagation();var t=this.state,a=t.index,n=t.blocks,s=a+1;if(this.hasPreviousMedia(a,n))return this.loadMedia(s)},this.handleNext=e=>{e&&e.stopPropagation();var t=this.state,a=t.index,n=t.blocks,s=a-1;if(this.hasNextMedia(a,n))return this.loadMedia(s)},this.loadMedia=e=>{var t=this.state.blocks;return!(e<0)&&(!(e>=t.length)&&(this.setState({index:e,hasPreviousMedia:this.hasPreviousMedia(e,t),hasNextMedia:this.hasNextMedia(e,t)}),Object(G.K)(e,t),!0))},this.handleClose=()=>{Object(re.p)(null);var e=this.state,t=e.index,a=e.blocks;-1!==t&&Object(G.a)(t,a)},this.handleForward=()=>{var e=this.props.media,t=Object(at.e)(e,null);t&&Object(re.e)(t)},this.handleSave=()=>{var e=this.props.media;Object(G.O)(e,null)},this.handleWrapperMouseDown=e=>{this.mouseDownTarget=e.currentTarget},this.handleWrapperClick=e=>{var t=this.mouseDownTarget;this.mouseDownTarget=null,e.currentTarget===t&&this.handleClose()},this.state={index:-1,hasPreviousMedia:!1,hasNextMedia:!1,blocks:[]},this.keyboardHandler=new I.a(this.onKeyDown)}componentDidMount(){this.loadContent(),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}loadContent(){var e=this.props,t=e.iv,a=e.media,n=Object($o.i)(t,$o.m),s=n.findIndex(e=>Object($o.c)(e)===a);this.setState({blocks:n,index:s,hasPreviousMedia:this.hasPreviousMedia(s,n),hasNextMedia:this.hasNextMedia(s,n)}),Object(G.K)(s,n)}hasPreviousMedia(e,t){return-1!==e&&e+1<t.length}hasNextMedia(e,t){return-1!==e&&e-1>=0}render(){var e=this.props,t=e.size,a=e.t,n=this.state,s=n.index,i=n.blocks,r=n.hasNextMedia,l=n.hasPreviousMedia;if(!i)return null;if(-1===s)return null;var h=i[s],d=Object($o.c)(h),p=Object($o.b)(h),u=Object($o.d)(h),m=Object(G.o)(d,t),f=Object(L.a)(m,3),C=(f[0],f[1],f[2]),v="";"photo"===d["@type"]&&(v=a("AttachPhoto")),"video"===d["@type"]?v=a("AttachVideo"):"animation"===d["@type"]&&(v=a("AttachGif"));var b=i.length;return o.a.createElement("div",{className:c()("instant-view-media-viewer","media-viewer-default")},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(Tc,{title:v,subtitle:b&&s>=0?"".concat(s+1," of ").concat(b):null,style:{marginLeft:128}}),o.a.createElement(Vc,{title:a("Save"),fileId:C.id,onClick:this.handleSave}),o.a.createElement(Ac,{title:a("Forward"),onClick:this.handleForward},o.a.createElement($e,null)),o.a.createElement(Ac,{title:a("Close"),onClick:this.handleClose},o.a.createElement(g.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onMouseDown:this.handleWrapperMouseDown,onClick:this.handleWrapperClick},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(Dc,{disabled:!r,grow:!0,onClick:this.handleNext},o.a.createElement(wc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(Pc,{media:d,size:t,caption:p,url:u})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(Dc,{disabled:!l,grow:!0,onClick:this.handlePrevious},o.a.createElement(wc,{style:{transform:"rotate(180deg)"}})))))}}var zc=Object(h.a)(Object(_.a)(),Ic.b)(Hc),Wc=a(41);a(622);class Gc extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateInstantViewViewerContent=e=>{var t=e.content;if(t){var a=t.media,n=t.caption,s=t.url,i=t.instantView;this.props.instantView===i&&this.setState({media:a,caption:n,url:s})}else this.setState({media:null,caption:null,url:null})},this.onClientUpdateInstantViewUrl=function(){var e=Object(i.a)(s.a.mark((function e(a){var n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.url,i=Wc.a.getCurrent(),r=t.props,o=r.instantView,l=r.url,i===o){e.next=5;break}return e.abrupt("return");case 5:if(!o||!n.startsWith(l)){e.next=14;break}if(c=new URL(n).hash,n.indexOf("#")!==n.length-1){e.next=12;break}return t.scrollTop("smooth"),e.abrupt("return");case 12:if(!c||!t.scrollToHash(c,"smooth")){e.next=14;break}return e.abrupt("return");case 14:il(n);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onKeyDown=e=>{if(!(oe.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":if(e.stopPropagation(),e.preventDefault(),this.state.media)return void Object(re.p)(null);this.handleClose()}},this.handleBack=()=>{var e=this.state,t=e.hasPrev;e.hasScroll?this.scrollTop("smooth"):t?x.a.clientUpdate({"@type":"clientUpdatePrevInstantView"}):this.handleClose()},this.handleScroll=()=>{var e=this.instantViewerRef.current;this.setState({hasScroll:e.scrollTop>50}),this.updateItemsInView()},this.keyboardHandler=new I.a(this.onKeyDown),this.articleRef=o.a.createRef(),this.instantViewerRef=o.a.createRef(),this.state={},this.updateItemsInView=Object(M.D)(this.updateItemsInView,500)}static getDerivedStateFromProps(e,t){return e.instantView!==t.prevInstantView?{prevInstantView:e.instantView,hasPrev:Wc.a.hasPrev(),hasScroll:!1,media:null,caption:null,url:null}:null}shouldComponentUpdate(e,t,a){var n=this.props.instantView,s=this.state,i=s.hasScroll,r=s.hasPrev,o=s.media,l=s.caption,c=s.url;return n!==e.instantView||(i!==t.hasScroll||(r!==t.hasPrev||(o!==t.media||(l!==t.caption||c!==t.url))))}componentDidMount(){this.mounted=!0,this.handleScroll(),this.scrollToBlock(this.props.block,"smooth"),I.b.add(this.keyboardHandler),Wc.a.on("clientUpdateInstantViewUrl",this.onClientUpdateInstantViewUrl),Wc.a.on("clientUpdateInstantViewViewerContent",this.onClientUpdateInstantViewViewerContent)}componentWillUnmount(){this.mounted=!1,I.b.remove(this.keyboardHandler),Wc.a.off("clientUpdateInstantViewUrl",this.onClientUpdateInstantViewUrl),Wc.a.off("clientUpdateInstantViewViewerContent",this.onClientUpdateInstantViewViewerContent)}scrollToBlock(e,t){if(!e)return!1;if(!Uc)return!1;var a=Uc.get(e);if(!a)return!1;var n=Jo.a.findDOMNode(a);return this.scrollToElement(n,t)}scrollToElement(e,t){if(!e)return!1;var a=[],n=!1,s=e;do{(s=s.parentNode)?"DETAILS"===s.nodeName?a.push(s):"ARTICLE"===s.nodeName&&(n=!0):n=!0}while(!n);return a.forEach(e=>e.open=!0),e.scrollIntoView({block:"center",behavior:t}),!0}scrollToHash(e,t){if(!e)return!1;var a=document.getElementById(e.substr(1));return this.scrollToElement(a,t)}scrollTop(e){var t=this.instantViewerRef.current;switch(e){case"smooth":Ga(t);break;default:t.scrollTo({top:0,behavior:e})}}componentDidUpdate(e,t,a){var n=this.props,s=n.instantView,i=(n.block,n.url),r=new URL(i).hash;e.instantView!==s&&(e.url!==i?i.indexOf("#")===i.length-1?this.scrollTop("auto"):r?this.scrollToHash(r,"auto"):this.scrollTop("auto"):r?this.scrollToHash(r,"auto"):this.scrollTop("smooth"),this.handleScroll())}handleClose(){Object(re.o)(null)}updateItemsInView(){if(this.mounted){var e=this.props.instantView;if(e){for(var t=e.page_blocks,a=new Map,n=Object(M.z)(this.instantViewerRef,this.articleRef),s=0;s<n.length;s++){var i=t[n[s]];a.set(i,i),Object($o.f)(i).forEach(e=>a.set(e,e))}x.a.clientUpdate({"@type":"clientUpdateBlocksInView",blocks:a})}}}render(){var e=this.props.instantView,t=this.state,a=(t.hasPrev,t.hasScroll),n=t.media,s=t.caption,i=t.url;return e?o.a.createElement(Ic.a.Provider,{value:e},o.a.createElement("div",{ref:this.instantViewerRef,className:"instant-viewer",onScroll:this.handleScroll},o.a.createElement("div",{className:"instant-viewer-left-column",onClick:this.handleBack},o.a.createElement(Dc,{className:"instant-viewer-left-button",style:{alignItems:"flex-start"},onClick:this.handleBack},o.a.createElement(wc,{style:{transition:"transform 0.25s ease-out",transform:a?"rotate(90deg)":"rotate(0deg)"}}))),o.a.createElement("div",{className:"instant-viewer-content-column"},o.a.createElement("div",null,o.a.createElement(xc,{ref:this.articleRef}))),o.a.createElement("div",{className:"instant-viewer-right-column"},o.a.createElement(Dc,{className:"instant-viewer-right-button",onClick:this.handleClose},o.a.createElement(g.a,null)))),n&&o.a.createElement(zc,{media:n,size:u.n,caption:s,url:i})):null}}var Zc=Object(_.a)()(Gc);a(457);class qc extends o.a.Component{constructor(e){super(e)}render(){var e=this.props,t=e.chatId,a=e.messageId,n=le.a.get(t,a);if(!n)return null;var s=n.date,i=Object(it.w)(n),r=Object(it.k)(s),l=i?o.a.createElement(yn.a,{userId:i}):o.a.createElement(K,{chatId:t});return o.a.createElement("div",{className:"media-info"},o.a.createElement("div",{className:"media-info-wrapper"},l,o.a.createElement("div",{className:"media-info-content"},o.a.createElement("div",{className:"media-info-row"},o.a.createElement(gt.a,{chatId:t,userId:i})),o.a.createElement("div",{className:"media-info-row meta"},o.a.createElement("span",null,r)))))}}var Kc=qc;a(623);class Jc extends o.a.Component{constructor(e){super(e),this.onClientUpdatePictureInPicture=e=>{var t=e.videoInfo;t&&(this.state.file.id===t.fileId&&x.a.clientUpdate({"@type":"clientUpdateMediaViewerContent",content:null}))},this.onClientUpdateMediaBlob=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.size;if(a===e.chatId&&n===e.messageId){var i=Object(G.i)(a,n,s),r=Object(L.a)(i,5),o=r[0],l=r[1],c=r[2],h=r[3],d=r[4];c=U.a.get(c.id)||c;var p=Object(G.m)(c);!p&&d&&Object(it.R)(a,n)&&(p="/streaming/file?id=".concat(c.id,"&size=").concat(c.size,"&mime_type=").concat(h)),this.setState({width:o,height:l,file:c,src:p,source:null,supportsStreaming:d,mimeType:h})}},this.onClientUpdateMediaThumbnailBlob=e=>{var t=this.props,a=t.chatId,n=t.messageId;if(a===e.chatId&&n===e.messageId){var s=Object(G.k)(a,n);this.setState({thumbnail:s})}},this.onUpdateMessageContent=e=>{var t=this.props,a=t.chatId,n=t.messageId,s=t.size,i=t.t,r=e.chat_id,o=e.message_id;if(a===r&&n===o){var l=le.a.get(a,n),c=Object(it.y)(l,null,i),h=Object(G.i)(a,n,s),d=Object(L.a)(h,5),p=d[0],u=d[1],m=d[2],f=d[3],g=d[4],C=Object(G.m)(m);!C&&g&&Object(it.R)(a,n)&&(C="/streaming/file?id=".concat(m.id,"&size=").concat(m.size,"&mime_type=").concat(f)),this.setState({width:p,height:u,file:m,src:C,source:null,supportsStreaming:g,mimeType:f,text:c})}},this.handleContentClick=e=>{e&&e.stopPropagation()},this.handleClick=e=>{e.preventDefault(),e.stopPropagation();var t=this.state.source;t&&t.loadNextBuffer()},this.state={},this.videoRef=o.a.createRef()}static getDerivedStateFromProps(e,t){var a=e.chatId,n=e.messageId,s=e.size,i=e.t;if(a!==t.prevChatId||n!==t.prevMessageId){var r=Object(G.k)(a,n),o=Object(G.j)(a,n),l=le.a.get(a,n),c=Object(it.y)(l,null,i),h=Object(G.i)(a,n,s),d=Object(L.a)(h,5),p=d[0],u=d[1],m=d[2],f=d[3],g=d[4];m=U.a.get(m.id)||m;var C=Object(G.m)(m);return!C&&g&&Object(it.R)(a,n)&&(C="/streaming/file?id=".concat(m.id,"&size=").concat(m.size,"&mime_type=").concat(f)),{prevChatId:a,prevMessageId:n,speed:1,isPlaying:!1,width:p,height:u,file:m,src:C,source:null,supportsStreaming:g,mimeType:f,text:c,thumbnail:r,minithumbnail:o,webPage:l.content.web_page}}return null}componentDidMount(){U.a.on("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.on("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.on("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),le.a.on("updateMessageContent",this.onUpdateMessageContent),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){U.a.off("clientUpdatePhotoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateAnimationBlob",this.onClientUpdateMediaBlob),U.a.off("clientUpdateVideoThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),U.a.off("clientUpdateAnimationThumbnailBlob",this.onClientUpdateMediaThumbnailBlob),le.a.off("updateMessageContent",this.onUpdateMessageContent),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentDidUpdate(e,t,a){var n=this.state.src;if(t.src!==n){var s=this.videoRef.current;if(!s)return;s.load()}}render(){var e=this.props,t=e.chatId,a=e.messageId,n=this.state,s=n.width,i=n.height,r=n.file,l=n.src,c=n.supportsStreaming,h=n.mimeType,d=n.text,p=n.minithumbnail,m=n.thumbnail,f=n.webPage,g=n.isPlaying;if(!r)return null;var C=p?"data:image/jpeg;base64, "+p.data:null,v=Object(G.m)(m?m.file:null),b=Object(it.K)(t,a),E=Object(it.R)(t,a),y=Object(it.H)(t,a),M=s,I=i,U=u.w/Math.max(M,I),k=M>I?u.w:Math.floor(M*U),x=I>M?u.w:Math.floor(I*U);M=k,I=x;var w=null,O=l?o.a.createElement("source",{src:l,type:h}):null,L=Object(at.l)(m,p,M,I);if(E)w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement(S.a,{ref:this.videoRef,className:"media-viewer-content-video-player",fileId:r.id,width:M,height:I,poster:c?v||C:null,onPlay:()=>{this.setState({isPlaying:!0})}},O),!g&&!c&&L);else if(y)w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("video",{ref:this.videoRef,className:"media-viewer-content-video-player",onClick:this.handleContentClick,loop:!0,autoPlay:!0,width:M,height:I,onPlay:()=>{this.setState({isPlaying:!0})}},O),!g&&L);else if(f&&f.embed_url){var _=f.embed_url;switch(f.site_name){case"Coub":case"SoundCloud":case"Spotify":break;case"Twitch":_+="&parent=".concat(window.location.hostname);break;case"YouTube":_+="?iv_load_policy=3&controls=2&playsinline=1&rel=0&modestbranding=0&autoplay=1&enablejsapi=0&widgetid=1&showinfo=0";break;case"Vimeo":_+="?playsinline=true&autoplay=true&dnt=true&title=false"}w=o.a.createElement("div",{className:"media-viewer-content-wrapper"},o.a.createElement("iframe",{src:_,width:M,height:I,frameBorder:0,allowFullScreen:!0,scrolling:"no",style:{background:"black"}}))}else w=o.a.createElement("img",{className:"media-viewer-content-image",src:l,alt:"",onClick:this.handleContentClick});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"media-viewer-content"},w,!c&&o.a.createElement(Ps.a,{file:r,zIndex:2})),d&&d.length>0&&!E&&!b&&o.a.createElement(Lc,{text:d}))}}var Yc=Object(_.a)()(Jc);a(624);class Xc extends o.a.Component{constructor(e){var t;super(e),t=this,this.onKeyDown=e=>{var t=this.props.chatId,a=this.state.currentMessageId;if(!(oe.a.modals.length>0)&&!e.isComposing){var n=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;switch(e.key){case"Escape":return this.handleClose(),e.stopPropagation(),void e.preventDefault();case"ArrowLeft":if(!n)return this.handlePrevious(),e.stopPropagation(),void e.preventDefault();break;case"ArrowRight":if(!n)return this.handleNext(),e.stopPropagation(),void e.preventDefault()}Object(it.R)(t,a)&&x.a.clientUpdate({"@type":"clientUpdateMediaShortcut",event:e})}},this.onUpdateMessageContent=e=>{var t=e.chat_id,a=e.message_id,n=e.new_content,s=e.old_content,i=this.props.chatId,r=this.state,o=r.currentMessageId,l=r.totalCount;if(i===t){var c=le.a.get(t,a);if(c){if(Object(G.A)([c]),Object(it.M)(n)&&!Object(it.M)(s)){if(this.history.length>=2&&(this.firstSliceLoaded||Object(M.c)(a,this.history[0].id,this.history[this.history.length-1].id))){for(var h=!1,d=[],p=0;p<this.history.length;p++)this.history[p].id>a||h||(h=!0,d.push(c)),d.push(this.history[p]);this.history=d}var u=this.history.findIndex(e=>e.id===o);this.setState({hasNextMedia:this.hasNextMedia(u),hasPreviousMedia:this.hasPreviousMedia(u),totalCount:l+1})}if(!Object(it.M)(n)&&Object(it.M)(s)){var m=this.history;if(this.history=this.history.filter(e=>e.id!==a),o===a){var f=new Map;f.set(a,a),this.moveToNextMedia(m,f),this.setState({totalCount:Math.max(l-1,0)})}else{var g=this.history.findIndex(e=>e.id===o);this.setState({hasNextMedia:this.hasNextMedia(g),hasPreviousMedia:this.hasPreviousMedia(g),totalCount:Math.max(l-1,0)})}}}}},this.onUpdateDeleteMessages=e=>{var t=e.chat_id,a=e.message_ids,n=e.is_permanent,s=this.props.chatId,i=this.state,r=i.currentMessageId,o=i.totalCount;if(n&&s===t){var l=a.reduce((e,t)=>(e.set(t,t),e),new Map),c=this.history,h=c.length;this.history=this.history.filter(e=>!l.has(e.id)),h-=this.history.length,this.setState({totalCount:Math.max(o-h,0)}),this.history.length?l.has(r)&&this.moveToNextMedia(c,l):Object(re.q)(null)}},this.onUpdateNewMessage=e=>{var t=this.props.chatId,a=this.state,n=a.currentMessageId,s=a.totalCount,i=e.message;if(i&&Object(it.M)(i.content)&&i.chat_id===t&&this.firstSliceLoaded){this.history=[i].concat(this.history);var r=this.history.findIndex(e=>e.id===n);this.setState({hasNextMedia:this.hasNextMedia(r),hasPreviousMedia:this.hasPreviousMedia(r),totalCount:s+1})}},this.getFilter=(e,t)=>{var a=le.a.get(e,t);if(!a)return null;var n=a.content;if(!n)return null;switch(n["@type"]){case"messageChatChangePhoto":return{"@type":"searchMessagesFilterChatPhoto"};case"messagePhoto":case"messageVideo":return{"@type":"searchMessagesFilterPhotoAndVideo"};default:return null}},this.loadHistory=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d,p,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.getFilter(n,i),o={"@type":"messages",messages:[],total_count:0},!r){e.next=7;break}return e.next=6,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:i,offset:-u.v,limit:2*u.v,filter:r});case 6:o=e.sent;case 7:if(Object(it.f)(o,t.history),le.a.setItems(o.messages),t.history=o.messages,t.firstSliceLoaded=0===o.messages.length,l=t.state.currentMessageId,c=t.history.findIndex(e=>e.id===l),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c)}),-1!==c){e.next=19;break}t.history=[le.a.get(n,l)],Object(G.L)(0,t.history),e.next=30;break;case 19:if(Object(G.L)(c,t.history),h=t.getFilter(n,i)){e.next=23;break}return e.abrupt("return");case 23:d=1500,p=0,m=s.a.mark((function e(){var a,i,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:t.history.length>0?t.history[0].id:0,offset:-99,limit:100,filter:h});case 2:a=e.sent,p+=a.messages.length,Object(it.f)(a,t.history),le.a.setItems(a.messages),t.history=a.messages.concat(t.history),t.firstSliceLoaded=0===a.messages.length,i=t.state.currentMessageId,r=t.history.findIndex(e=>e.id===i),t.setState({hasNextMedia:t.hasNextMedia(r),hasPreviousMedia:t.hasPreviousMedia(r),firstSliceLoaded:t.firstSliceLoaded,totalCount:a.total_count});case 11:case"end":return e.stop()}}),e)}));case 26:if(t.firstSliceLoaded||!(p<d)){e.next=30;break}return e.delegateYield(m(),"t0",28);case 28:e.next=26;break;case 30:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(re.q)(null);var e=this.state.currentMessageId,t=this.history.findIndex(t=>t.id===e);-1!==t&&Object(G.b)(t,this.history)},this.handleSave=()=>{var e=this.props.chatId,t=this.state.currentMessageId,a=le.a.get(e,t);if(a){var n=a.content;if(n){var s=null;switch(n["@type"]){case"messageAnimation":s=n.animation;break;case"messageChatChangePhoto":s=n.photo;break;case"messageDocument":s=n.document;break;case"messagePhoto":s=n.photo;break;case"messageText":var i=n.web_page;if(!i)return;var r=i.animation,o=i.document,l=i.photo,c=i.video;if(r){s=r;break}if(o){s=o;break}if(l){s=l;break}if(c){s=c;break}break;case"messageVideo":s=n.video}Object(G.O)(s,a)}}},this.handleForward=()=>{var e=this.props.chatId,t=this.state.currentMessageId;Object(re.f)(e,[t])},this.handleDelete=()=>{this.handleDialogOpen()},this.hasPreviousMedia=e=>-1!==e&&e+1<this.history.length,this.handlePrevious=e=>{e&&e.stopPropagation();var t=this.state.currentMessageId,a=this.history.findIndex(e=>e.id===t)+1;return this.loadMedia(a,()=>{a===this.history.length-1&&this.loadPrevious()})},this.loadPrevious=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.state.currentMessageId,o=t.getFilter(n,i),l={"@type":"messages",messages:[],total_count:0},!o){e.next=8;break}return e.next=7,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:r,offset:0,limit:u.v,filter:o});case 7:l=e.sent;case 8:Object(it.f)(l,t.history),le.a.setItems(l.messages),t.history=t.history.concat(l.messages),c=t.history.findIndex(e=>e.id===r),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c),totalCount:l.total_count});case 13:case"end":return e.stop()}}),e)}))),this.hasNextMedia=e=>-1!==e&&e-1>=0,this.handleNext=e=>{e&&e.stopPropagation();var t=this.state.currentMessageId,a=this.history.findIndex(e=>e.id===t)-1;return this.loadMedia(a,()=>{0===a&&this.loadNext()})},this.loadNext=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props,n=a.chatId,i=a.messageId,r=t.state.currentMessageId,o=t.getFilter(n,i),l={"@type":"messages",messages:[],total_count:0},!o){e.next=8;break}return e.next=7,x.a.send({"@type":"searchChatMessages",chat_id:n,query:"",sender_user_id:0,from_message_id:r,offset:-u.v,limit:u.v+1,filter:o});case 7:l=e.sent;case 8:Object(it.f)(l,t.history),le.a.setItems(l.messages),t.firstSliceLoaded=0===l.messages.length,t.history=l.messages.concat(t.history),c=t.history.findIndex(e=>e.id===r),t.setState({hasNextMedia:t.hasNextMedia(c),hasPreviousMedia:t.hasPreviousMedia(c),firstSliceLoaded:t.firstSliceLoaded,totalCount:l.total_count});case 14:case"end":return e.stop()}}),e)}))),this.loadMedia=(e,t)=>!(e<0)&&(!(e>=this.history.length)&&(this.setState({currentMessageId:this.history[e].id,hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e)},t),Object(G.L)(e,this.history),!0)),this.moveToNextMedia=(e,t)=>{for(var a=this.state.currentMessageId,n=e.findIndex(e=>e.id===a),s=0,i=n-1;i>=0;i--)if(t&&!t.has(e[i].id)){s=e[i].id;break}if(!s)for(var r=n+1;r<e.length;r++)if(t&&!t.has(e[r].id)){s=e[r].id;break}if(s){var o=this.history.findIndex(e=>e.id===s);return this.loadMedia(o,()=>{0===o?this.loadNext():o===this.history.length-1&&this.loadPrevious()})}},this.handleDialogOpen=()=>{this.setState({deleteConfirmationOpened:!0})},this.handleDialogClose=()=>{this.setState({deleteConfirmationOpened:!1})},this.handleDone=()=>{this.setState({deleteConfirmationOpened:!1});var e=this.props.chatId,t=this.state,a=t.currentMessageId,n=t.deleteForAll,s=le.a.get(e,a);if(s){var i=s.can_be_deleted_only_for_self,r=s.can_be_deleted_for_all_users;(i||r)&&x.a.send({"@type":"deleteMessages",chat_id:e,message_ids:[a],revoke:r&&n})}},this.handleChangeDeleteForAll=e=>{this.setState({deleteForAll:e.target.checked})},this.handleInvertColors=()=>{var e="media-viewer-default";switch(this.state.background){case"media-viewer-default":e="media-viewer-dark";break;case"media-viewer-dark":e="media-viewer-light";break;case"media-viewer-light":e="media-viewer-default"}this.setState({background:e})},this.canBeForwarded=(e,t)=>{var a=le.a.get(e,t);if(!a)return!1;var n=a.can_be_forwarded,s=a.content;if(!s)return!1;switch(s["@type"]){case"messageChatChangePhoto":return!0;default:return n}},this.handleWrapperMouseDown=e=>{this.mouseDownTarget=e.currentTarget},this.handleWrapperClick=e=>{var t=this.mouseDownTarget;this.mouseDownTarget=null,e.currentTarget===t&&this.handleClose()},this.keyboardHandler=new I.a(this.onKeyDown),this.history=[];var a=this.props,n=a.chatId,r=a.messageId;this.state={background:"media-viewer-default",prevChatId:n,prevMessageId:r,currentMessageId:r,hasNextMedia:!1,hasPreviousMedia:!1,deleteConfirmationOpened:!1,deleteForAll:!0}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId,i=this.state,r=i.background,o=i.currentMessageId,l=i.deleteConfirmationOpened,c=i.firstSliceLoaded,h=i.hasNextMedia,d=i.hasPreviousMedia,p=i.totalCount;return t.background!==r||(e.chatId!==n||(e.messageId!==s||(t.currentMessageId!==o||(t.hasPrevousMedia!==d||(t.hasNextMedia!==h||(t.firstSliceLoaded!==c||(t.totalCount!==p||t.deleteConfirmationOpened!==l)))))))}componentDidMount(){this.loadHistory(),I.b.add(this.keyboardHandler),le.a.on("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.on("updateNewMessage",this.onUpdateNewMessage),le.a.on("updateMessageContent",this.onUpdateMessageContent)}componentWillUnmount(){I.b.remove(this.keyboardHandler),le.a.off("updateDeleteMessages",this.onUpdateDeleteMessages),le.a.off("updateNewMessage",this.onUpdateNewMessage),le.a.off("updateMessageContent",this.onUpdateMessageContent)}render(){var e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.background,i=n.currentMessageId,r=n.deleteConfirmationOpened,l=n.deleteForAll,h=n.firstSliceLoaded,d=n.hasNextMedia,p=n.hasPreviousMedia,m=n.totalCount,f=-1;m&&h&&(f=this.history.findIndex(e=>e.id===i));var C=Math.max(this.history.length,m),v=le.a.get(t,i).can_be_deleted_for_all_users,b=Object(it.b)(t,i),E=this.canBeForwarded(t,i),S="";S=Object(it.R)(t,i)?a("AreYouSureDeleteVideo"):Object(it.H)(t,i)?a("AreYouSureDeleteGIF"):a("AreYouSureDeletePhoto");var y=r?o.a.createElement(j.a,{manager:oe.a,transitionDuration:0,open:r,onClose:this.handleDialogClose,"aria-labelledby":"form-dialog-title"},o.a.createElement(R.a,{id:"form-dialog-title"},a("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,S),v&&o.a.createElement(Vs.a,{label:a("DeleteForAll"),control:o.a.createElement(Te.a,{color:"primary",value:"deleteAll",onChange:this.handleChangeDeleteForAll}),checked:l})),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:this.handleDialogClose,color:"primary"},a("Cancel")),o.a.createElement(N.a,{onClick:this.handleDone,color:"primary"},a("Ok")))):null,M=Object(G.i)(t,i,u.G),I=Object(L.a)(M,4),U=(I[0],I[1],I[2]),k=(I[3],U?U.id:0),x=a("AttachPhoto");return Object(it.K)(t,i)?x="":Object(it.R)(t,i)?x=a("AttachVideo"):Object(it.H)(t,i)&&(x=a("AttachGif")),o.a.createElement("div",{className:c()("media-viewer",s)},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(Kc,{chatId:t,messageId:i}),o.a.createElement(Tc,{title:x,subtitle:C&&f>=0?"".concat(C-f," of ").concat(C):null}),o.a.createElement(Vc,{title:a("Save"),fileId:k,disabled:Object(it.K)(t,i),onClick:this.handleSave}),o.a.createElement(Ac,{title:a("Forward"),disabled:!E,onClick:this.handleForward},o.a.createElement($e,null)),o.a.createElement(Ac,{title:a("Delete"),disabled:!b,onClick:this.handleDelete},o.a.createElement(Qe,null)),o.a.createElement(Ac,{title:a("Close"),onClick:this.handleClose},o.a.createElement(g.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onMouseDown:this.handleWrapperMouseDown,onClick:this.handleWrapperClick},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(Dc,{disabled:!p,grow:!0,onClick:this.handlePrevious},o.a.createElement(wc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(Yc,{chatId:t,messageId:i,size:u.G,onClick:this.handlePrevious})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(Dc,{disabled:!d,grow:!0,onClick:this.handleNext},o.a.createElement(wc,{style:{transform:"rotate(180deg)"}})))),o.a.createElement("div",{className:"media-viewer-footer"}),y)}}var Qc=Object(_.a)()(Xc);a(458);class $c extends o.a.Component{constructor(e){super(e),this.onClientUpdateChatBlob=e=>{var t=this.props,a=t.chatId,n=t.photo;if(a===e.chatId&&n.big.id===e.fileId){var s=U.a.get(e.fileId)||this.state.file;this.setState({file:s})}},this.onClientUpdateUserBlob=e=>{var t=this.props,a=t.chatId,n=t.photo;if(Object(V.z)(a)===e.userId&&n.big.id===e.fileId){var s=U.a.get(e.fileId)||this.state.file;this.setState({file:s})}},this.handleContentClick=e=>{e&&e.stopPropagation();var t=this.props.onClose;t&&t(e)},this.handlePhotoClick=e=>{e&&e.stopPropagation();var t=this.props.onPrevious;t&&t(e)};var t=this.props,a=t.chatId,n=t.photo,s=n.big;s=U.a.get(s.id)||s,this.state={prevChatId:a,prevPhoto:n,width:u.vb,height:u.vb,file:s}}static getDerivedStateFromProps(e,t){var a=e.chatId,n=e.photo;return a!==t.prevChatId||n!==t.prevPhoto?{prevChatId:a,prevPhoto:n,width:u.vb,height:u.vb,file:n.big}:null}componentDidMount(){U.a.on("clientUpdateChatBlob",this.onClientUpdateChatBlob),U.a.on("clientUpdateUserBlob",this.onClientUpdateUserBlob)}componentWillUnmount(){U.a.off("clientUpdateChatBlob",this.onClientUpdateChatBlob),U.a.off("clientUpdateUserBlob",this.onClientUpdateUserBlob)}render(){var e=this.state.file;if(!e)return null;var t=U.a.getBlob(e.id)||e.blob,a=U.a.getBlobUrl(t);return o.a.createElement("div",{className:"media-viewer-content",onClick:this.handleContentClick},o.a.createElement("img",{className:"media-viewer-content-image",src:a,alt:"",onClick:this.handlePhotoClick}),o.a.createElement(Ps.a,{file:e}))}}var eh=$c;class th extends o.a.Component{constructor(e){super(e)}render(){var e=this.props,t=e.chatId,a=e.date;return o.a.createElement("div",{className:"media-info"},o.a.createElement("div",{className:"media-info-wrapper"},o.a.createElement(K,{chatId:t,showSavedMessages:!1}),o.a.createElement("div",{className:"media-info-content"},o.a.createElement("div",{className:"media-info-row"},o.a.createElement(gt.a,{chatId:t})),a&&o.a.createElement("div",{className:"media-info-row meta"},o.a.createElement("span",null,a)))))}}var ah=th;class nh extends o.a.Component{constructor(e){var t;super(e),t=this,this.handleKeyDown=e=>{if(!(oe.a.modals.length>0)&&!e.isComposing)switch(e.key){case"Escape":return this.handleClose(),e.preventDefault(),void e.stopPropagation();case"ArrowLeft":return this.handleNext(),e.stopPropagation(),void e.preventDefault();case"ArrowRight":return this.handlePrevious(),e.stopPropagation(),void e.preventDefault()}},this.loadHistory=Object(i.a)(s.a.mark((function e(){var a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,Object(V.db)(a)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,x.a.send({"@type":"getUserProfilePhotos",user_id:Object(V.z)(a),offset:0,limit:100});case 5:n=e.sent,t.history=n.photos,t.firstSliceLoaded=0===n.photos.length,0,t.setState({currentIndex:0,hasNextMedia:t.hasNextMedia(0),hasPreviousMedia:t.hasPreviousMedia(0),totalCount:n.total_count}),Object(G.M)(a,0,t.history);case 11:case"end":return e.stop()}}),e)}))),this.handleClose=()=>{Object(re.r)(null)},this.handleSave=()=>{var e=this.props.chatId,t=this.state,a=t.currentIndex,n=t.totalCount,s=Z.a.get(e);if(s){var i=-1;n&&(i=a);var r=i>0&&i<this.history.length?Object(B.a)(this.history[i]):Object(V.J)(e);if(r&&r.big){var o=U.a.get(r.big.id)||r.big;o&&Object(G.P)(o,o.id+".jpg",s,()=>U.a.updateChatPhotoBlob(e,o.id))}}},this.handleForward=()=>{var e=this.props.chatId,t=this.state,a=t.currentIndex,n=-1;t.totalCount&&(n=a);var s=null;if(this.history&&n>=0&&n<this.history.length){var i=Object(B.a)(this.history[n]);if(!i)return;var r=i.big;if(!r)return;s={"@type":"inputFileId",id:r.id}}else{var o=Object(V.J)(e);if(!o)return;var l=o.big;if(!l)return;var c=U.a.getBlob(l.id);if(!c)return;s={"@type":"inputFileBlob",data:c,name:""}}if(s){var h={"@type":"inputMessagePhoto",photo:s,thumbnail:null,added_sticker_file_ids:[],width:u.vb,height:u.vb,caption:{"@type":"formattedText",text:"",entities:null},ttl:0};Object(re.e)(h)}},this.handleDelete=Object(i.a)(s.a.mark((function e(){var a,n,i,r,o,l,c,h,d,p,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.chatId,n=t.state,i=n.currentIndex,r=n.totalCount,o=n.hasNextMedia,l=n.hasPreviousMedia,c=-1,r&&(c=i),h=c>0&&c<t.history.length?Object(B.a)(t.history[c]):Object(V.J)(a)){e.next=7;break}return e.abrupt("return");case 7:if(d=h.id){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,x.a.send({"@type":"deleteProfilePhoto",profile_photo_id:d});case 12:if(t.history.splice(c,1),t.history.length){e.next=16;break}return t.handleClose(),e.abrupt("return");case 16:if(t.setState({totalCount:r-1}),!o){e.next=20;break}return p=i-1,e.abrupt("return",t.loadMedia(p,{totalCount:r-1},()=>{0===p&&t.loadNext()}));case 20:if(!l){e.next=23;break}return u=i,e.abrupt("return",t.loadMedia(u,{totalCount:r-1},()=>{u===t.history.length-1&&t.loadPrevious()}));case 23:case"end":return e.stop()}}),e)}))),this.hasPreviousMedia=e=>-1!==e&&e+1<this.history.length,this.handlePrevious=e=>{e&&e.stopPropagation();var t=this.state.currentIndex+1;return this.loadMedia(t,{},()=>{t===this.history.length-1&&this.loadPrevious()})},this.loadPrevious=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),this.hasNextMedia=e=>-1!==e&&e-1>=0,this.handleNext=e=>{e&&e.stopPropagation();var t=this.state.currentIndex-1;return this.loadMedia(t,{},()=>{0===t&&this.loadNext()})},this.loadNext=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),this.loadMedia=(e,t,a)=>{if(e<0)return!1;if(e>=this.history.length)return!1;this.setState(Object(Ze.a)(Object(Ze.a)({currentIndex:e},t),{},{hasNextMedia:this.hasNextMedia(e),hasPreviousMedia:this.hasPreviousMedia(e)}),a);var n=this.props.chatId;return Object(G.M)(n,e,this.history),!0},this.history=[],this.keyboardHandler=new I.a(this.handleKeyDown);var a=this.props,n=a.chatId,r=a.fileId;this.state={prevChatId:n,prevFileId:r,currentIndex:0,hasNextMedia:!1,hasPreviousMedia:!1,deleteConfirmationOpened:!1}}shouldComponentUpdate(e,t){var a=this.props,n=a.chatId,s=a.messageId,i=this.state,r=i.currentFileId,o=i.hasPreviousMedia,l=i.hasNextMedia,c=i.firstSliceLoaded,h=i.totalCount,d=i.deleteConfirmationOpened;return e.chatId!==n||(e.messageId!==s||(t.currentFileId!==r||(t.hasPrevousMedia!==o||(t.hasNextMedia!==l||(t.firstSliceLoaded!==c||(t.totalCount!==h||t.deleteConfirmationOpened!==d))))))}componentDidMount(){var e=this.props.chatId,t=Object(V.J)(e);Object(G.C)(e,[t]),this.loadHistory(t),I.b.add(this.keyboardHandler)}componentWillUnmount(){I.b.remove(this.keyboardHandler)}render(){var e=this.props,t=e.chatId,a=e.t,n=this.state,s=n.currentIndex,i=n.hasNextMedia,r=n.hasPreviousMedia,l=n.totalCount,h=-1;l&&(h=s);var d=h>=0&&h<this.history.length,p=d?Object(B.a)(this.history[h]):null,u=p?p.big:null,m=(u?u.blob||U.a.getBlob(u.id):null)?p:Object(V.J)(t),f=d?this.history[h]:null,C=m.big,v=Object(V.cb)(t);return o.a.createElement("div",{className:c()("media-viewer","media-viewer-default")},o.a.createElement("div",{className:"media-viewer-footer"},o.a.createElement(ah,{chatId:t,date:Object(B.b)(f)}),o.a.createElement(Tc,{title:a("AttachPhoto"),subtitle:l&&h>=0?"".concat(h+1," of ").concat(l):null}),o.a.createElement(Vc,{title:a("Save"),fileId:C.id,onClick:this.handleSave}),o.a.createElement(Vc,{title:a("Forward"),fileId:C.id,onClick:this.handleForward},o.a.createElement($e,null)),v&&o.a.createElement(Ac,{title:a("Delete"),onClick:this.handleDelete},o.a.createElement(Qe,null)),o.a.createElement(Ac,{title:a("Close"),onClick:this.handleClose},o.a.createElement(g.a,null))),o.a.createElement("div",{className:"media-viewer-wrapper",onClick:this.handlePrevious},o.a.createElement("div",{className:"media-viewer-left-column"},o.a.createElement(Dc,{disabled:!i,grow:!0,onClick:this.handleNext},o.a.createElement(wc,null))),o.a.createElement("div",{className:"media-viewer-content-column"},o.a.createElement(eh,{chatId:t,photo:m,onClose:this.handleClose,onPrevious:this.handlePrevious})),o.a.createElement("div",{className:"media-viewer-right-column"},o.a.createElement(Dc,{disabled:!r,grow:!0,onClick:this.handlePrevious},o.a.createElement(wc,{style:{transform:"rotate(180deg)"}})))))}}var sh=Object(_.a)()(nh);a(260);class ih extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleRevokeChange=()=>{var e=this.state.revoke;this.setState({revoke:!e})}}static getDerivedStateFromProps(e,t){var a=e.chatId,n=t.prevChatId,s=Z.a.get(a).can_be_deleted_for_all_users;return n!==a?{prevChatId:a,canBeDeletedForAllUsers:s,revoke:s}:null}render(){var e=this.props,t=e.chatId,a=e.onClose,n=e.t,s=this.state,i=s.canBeDeletedForAllUsers,r=s.revoke;return o.a.createElement(j.a,{open:!0,transitionDuration:0,onClose:()=>a(!1,r),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},Object(V.s)(t,!1,n)),o.a.createElement(Dn.a,null,o.a.createElement("div",{className:"delete-dialog-content"},o.a.createElement(K,{chatId:t}),o.a.createElement("div",null,o.a.createElement(Rn.a,{id:"delete-dialog-description"},"Are you sure you want clear history?"),i&&o.a.createElement(Vs.a,{control:o.a.createElement(Te.a,{checked:r,onChange:this.handleRevokeChange,color:"primary"}),label:Object(V.db)(t)?"Also delete for ".concat(Object(V.s)(t,!1,n)):"Delete for all members",style:{marginLeft:0}})))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:()=>a(!1,r),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0,r),color:"primary"},n("Ok"))))}}var rh=Object(_.a)()(ih);class oh extends o.a.Component{constructor(...e){super(...e),this.state={},this.handleRevokeChange=()=>{var e=this.state.revoke;this.setState({revoke:!e})}}static getDerivedStateFromProps(e,t){var a,n=e.chatId,s=e.messageIds,i=t.prevChatId,r=t.prevMessageIds,o=!0,l=Object(hs.a)(s);try{for(l.s();!(a=l.n()).done;){var c=a.value,h=le.a.get(n,c);if(!h){o=!1;break}if(!h.can_be_deleted_for_all_users){o=!1;break}}}catch(d){l.e(d)}finally{l.f()}return i!==n&&r!==s?{prevChatId:n,prevMessageIds:s,canBeDeletedForAllUsers:o,revoke:o}:null}render(){var e=this.props,t=e.chatId,a=e.messageIds,n=e.onClose,s=e.t,i=this.state,r=i.canBeDeletedForAllUsers,l=i.revoke,c=a?a.length:0;return o.a.createElement(j.a,{transitionDuration:0,open:!0,onClose:()=>n(!1,l),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},s("Confirm")),o.a.createElement(Dn.a,null,o.a.createElement(Rn.a,null,1===c?"Do you want to delete this message?":"Do you want to delete ".concat(c," messages?")),Object(V.eb)(t)?o.a.createElement(Rn.a,null,!Object(V.R)(t)&&(1===c?"This will delete it for everyone in this chat":"This will delete them for everyone in this chat")):o.a.createElement(o.a.Fragment,null,r&&o.a.createElement(Vs.a,{control:o.a.createElement(Te.a,{checked:l,onChange:this.handleRevokeChange,color:"primary"}),label:Object(V.db)(t)?"Delete for ".concat(Object(V.s)(t,!1,s)):"Delete for all"}))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:()=>n(!1,l),color:"primary"},s("Cancel")),o.a.createElement(N.a,{onClick:()=>n(!0,l),color:"primary"},s("Ok"))))}}var lh=Object(_.a)()(oh);class ch extends o.a.Component{constructor(...e){super(...e),this.getDeleteDialogText=(e,t)=>{var a=Z.a.get(e);if(!a)return null;if(!a.type)return null;switch(a.type["@type"]){case"chatTypeBasicGroup":return"Are you sure you want to leave group ".concat(a.title,"?");case"chatTypeSupergroup":var n=Oe.a.get(a.type.supergroup_id);return n?n.is_channel?"Are you sure you want to leave channel ".concat(a.title,"?"):"Are you sure you want to leave group ".concat(a.title,"?"):null;case"chatTypePrivate":case"chatTypeSecret":return"Are you sure you want to delete chat with ".concat(Object(V.s)(e,!1,t),"?")}return null}}render(){var e=this.props,t=e.chatId,a=e.onClose,n=e.t;return o.a.createElement(j.a,{open:!0,transitionDuration:0,onClose:()=>a(!1),"aria-labelledby":"delete-dialog-title"},o.a.createElement(R.a,{id:"delete-dialog-title"},Object(V.s)(t,!1,n)),o.a.createElement(Dn.a,null,o.a.createElement("div",{className:"delete-dialog-content"},o.a.createElement(K,{chatId:t}),o.a.createElement(Rn.a,{id:"delete-dialog-description"},this.getDeleteDialogText(t,n)))),o.a.createElement(D.a,null,o.a.createElement(N.a,{onClick:()=>a(!1),color:"primary"},n("Cancel")),o.a.createElement(N.a,{onClick:()=>a(!0),color:"primary",autoFocus:!0},n("Ok"))))}}var hh=Object(_.a)()(ch),dh=a(249);a(625);class ph extends o.a.Component{constructor(e){super(e),this.handleTimer=()=>{var e=new Date,t=this.expire-e,a=100-t/this.props.timeout*100;if(this.setState({seconds:t>0?t:0,value:a>100?100:a}),e>=this.expire&&this.timerId){clearInterval(this.timerId),this.timerId=null;var n=this.props.onTimeout;n&&n()}},this.state={seconds:this.props.timeout/1e3,value:0}}componentDidMount(){this.startTime=new Date,this.expire=this.startTime,this.expire.setMilliseconds(this.expire.getMilliseconds()+this.props.timeout),this.timerId=setInterval(this.handleTimer,100)}componentWillUnmount(){this.timerId&&(clearInterval(this.timerId),this.timerId=null)}render(){var e=this.state,t=e.value,a=e.seconds;return o.a.createElement("div",{className:"notification-timer"},o.a.createElement("div",{className:"notification-timer-text"},o.a.createElement(ur.a,{color:"inherit"},(a/1e3).toFixed())),o.a.createElement("div",{className:"notification-timer-progress"},o.a.createElement(dh.a,{size:32,value:100-t,variant:"static"})))}}var uh=ph;class mh extends o.a.PureComponent{constructor(...e){super(...e),this.state={leaveChat:null,clearHistory:null,deleteMessages:null},this.onClientUpdateDeleteMessages=e=>{var t=e.chatId,a=e.messageIds;this.setState({deleteMessages:{chatId:t,messageIds:a}})},this.onClientUpdateLeaveChat=e=>{var t=e.chatId;this.setState({leaveChat:{chatId:t}})},this.onClientUpdateClearHistory=e=>{var t=e.chatId;this.setState({clearHistory:{chatId:t}})},this.handleClearHistoryContinue=(e,t)=>{var a=this.props.t;if(this.state.clearHistory&&(this.setState({clearHistory:null}),e)){var n=na.a.getChatId(),s=a("HistoryClearedUndo"),i={"@type":"deleteChatHistory",chat_id:n,remove_from_chat_list:!1,revoke:t};this.handleScheduledAction(n,"clientUpdateClearHistory",s,[i])}},this.handleLeaveContinue=e=>{var t=this.state.leaveChat;if(t){var a=t.chatId,n=Z.a.get(a);if(n&&(this.setState({leaveChat:null}),e)){var s=this.getLeaveChatNotification(a),i=[];switch(n.type["@type"]){case"chatTypeBasicGroup":Object(V.T)(a)&&i.push({"@type":"leaveChat",chat_id:a}),i.push({"@type":"deleteChatHistory",chat_id:a,remove_from_chat_list:!0});case"chatTypeSupergroup":Object(V.Z)(a)?i.push({"@type":"setChatMemberStatus",chat_id:a,user_id:H.a.getMyId(),status:{"@type":"chatMemberStatusCreator",is_member:!1}}):Object(V.T)(a)&&i.push({"@type":"leaveChat",chat_id:a});case"chatTypePrivate":case"chatTypeSecret":i.push({"@type":"deleteChatHistory",chat_id:a,remove_from_chat_list:!0})}this.handleScheduledAction(a,"clientUpdateLeaveChat",s,i)}}},this.handleDeleteMessagesContinue=(e,t)=>{var a=this.state.deleteMessages;if(a){var n=a.chatId,s=a.messageIds;Object(re.a)(),this.setState({deleteMessages:null}),e&&x.a.send({"@type":"deleteMessages",chat_id:n,message_ids:s,revoke:t})}},this.getLeaveChatNotification=e=>{var t=this.props.t,a=Z.a.get(e);if(!a)return t("ChatDeletedUndo");if(!a.type)return t("ChatDeletedUndo");switch(a.type["@type"]){case"chatTypeBasicGroup":return t("ChatDeletedUndo");case"chatTypeSupergroup":var n=Oe.a.get(a.type.supergroup_id);return n?n.is_channel?"Left channel":"Left group":t("ChatDeletedUndo");case"chatTypePrivate":case"chatTypeSecret":return t("ChatDeletedUndo")}return t("ChatDeletedUndo")},this.handleScheduledAction=(e,t,a,n)=>{var r=this.props.t;if(t){var l="".concat(t," chatId=").concat(e),c=function(){var a=Object(i.a)(s.a.mark((function a(){var i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,i=0;case 2:if(!(i<n.length)){a.next=8;break}return a.next=5,x.a.send(n[i]);case 5:i++,a.next=2;break;case 8:return a.prev=8,x.a.clientUpdate({"@type":t,chatId:e,inProgress:!1}),a.finish(8);case 11:case"end":return a.stop()}}),a,null,[[0,,8,11]])})));return function(){return a.apply(this,arguments)}}(),h=this.props,d=h.enqueueSnackbar,p=h.closeSnackbar;x.a.clientUpdate({"@type":t,chatId:e,inProgress:!0});var m=d(a,{persist:!0,key:l,preventDuplicate:!0,action:[o.a.createElement(P.a,{key:"progress",color:"inherit",className:"progress-button"},o.a.createElement(uh,{timeout:u.C,onTimeout:()=>{c(),p(m)}})),o.a.createElement(N.a,{key:"undo",color:"primary",size:"small",onClick:()=>{x.a.clientUpdate({"@type":t,chatId:e,inProgress:!1}),p(m)}},r("Undo"))]})}}}componentDidMount(){na.a.on("clientUpdateRequestLeaveChat",this.onClientUpdateLeaveChat),na.a.on("clientUpdateRequestClearHistory",this.onClientUpdateClearHistory),na.a.on("clientUpdateDeleteMessages",this.onClientUpdateDeleteMessages)}componentWillUnmount(){na.a.off("clientUpdateRequestLeaveChat",this.onClientUpdateLeaveChat),na.a.off("clientUpdateRequestClearHistory",this.onClientUpdateClearHistory),na.a.off("clientUpdateDeleteMessages",this.onClientUpdateDeleteMessages)}render(){var e=this.state,t=e.leaveChat,a=e.clearHistory,n=e.deleteMessages;if(t){var s=t.chatId;return o.a.createElement(hh,{chatId:s,onClose:this.handleLeaveContinue})}if(a){var i=a.chatId;return o.a.createElement(rh,{chatId:i,onClose:this.handleClearHistoryContinue})}if(n){var r=n.chatId,l=n.messageIds;return o.a.createElement(lh,{chatId:r,messageIds:l,onClose:this.handleDeleteMessagesContinue})}return null}}var fh=Object(h.a)(p.b,Object(_.a)())(mh);class gh extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdatePictureInPicture=e=>{var t=e.videoInfo;this.setState({videoInfo:t})},this.onClientUpdatePageWidth=e=>{var t=e.isSmallWidth;this.setState({isSmallWidth:t})},this.onClientUpdateInstantViewContent=e=>{var t=e.content;this.setState({instantViewContent:t})},this.onClientUpdateOpenChat=e=>{var t=e.chatId,a=e.messageId,n=e.popup;this.handleSelectChat(t,a,n)},this.onClientUpdateOpenUser=e=>{var t=e.userId,a=e.popup;this.handleSelectUser(t,a)},this.onClientUpdateChatDetailsVisibility=e=>{var t=na.a.isChatDetailsVisible;this.setState({isChatDetailsVisible:t})},this.onClientUpdateMediaViewerContent=e=>{var t=na.a.mediaViewerContent;this.setState({mediaViewerContent:t})},this.onClientUpdateProfileMediaViewerContent=e=>{var t=na.a.profileMediaViewerContent;this.setState({profileMediaViewerContent:t})},this.onClientUpdateForward=e=>{var t=e.info;this.setState({forwardInfo:t})},this.handleSelectChat=(e,t=null,a=!1)=>{var n=na.a.getChatId(),s=na.a.dialogChatId,i=na.a.getMessageId();a?s!==e&&x.a.clientUpdate({"@type":"clientUpdateDialogChatId",chatId:e}):n===e&&t&&i===t?(this.dialogDetailsRef.current.scrollToMessage(),t&&Object(re.g)(e,t)):n!==e||t?x.a.setChatId(e,t):this.dialogDetailsRef.current.scrollToStart()},this.handleSelectUser=function(){var e=Object(i.a)(s.a.mark((function e(a,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,x.a.send({"@type":"createPrivateChat",user_id:a,force:!0});case 4:i=e.sent,t.handleSelectChat(i.id,null,n);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.dialogDetailsRef=o.a.createRef();var a=na.a.isChatDetailsVisible,n=na.a.mediaViewerContent,r=na.a.profileMediaViewerContent,l=na.a.isSmallWidth;this.state={isChatDetailsVisible:a,mediaViewerContent:n,profileMediaViewerContent:r,isSmallWidth:l,forwardInfo:null,instantViewContent:null,videoInfo:null}}componentDidMount(){H.a.on("clientUpdateOpenUser",this.onClientUpdateOpenUser),Z.a.on("clientUpdateOpenChat",this.onClientUpdateOpenChat),na.a.on("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),na.a.on("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),na.a.on("clientUpdatePageWidth",this.onClientUpdatePageWidth),na.a.on("clientUpdateProfileMediaViewerContent",this.onClientUpdateProfileMediaViewerContent),na.a.on("clientUpdateForward",this.onClientUpdateForward),Wc.a.on("clientUpdateInstantViewContent",this.onClientUpdateInstantViewContent),k.b.on("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}componentWillUnmount(){H.a.off("clientUpdateOpenUser",this.onClientUpdateOpenUser),Z.a.off("clientUpdateOpenChat",this.onClientUpdateOpenChat),na.a.off("clientUpdateChatDetailsVisibility",this.onClientUpdateChatDetailsVisibility),na.a.off("clientUpdateMediaViewerContent",this.onClientUpdateMediaViewerContent),na.a.off("clientUpdatePageWidth",this.onClientUpdatePageWidth),na.a.off("clientUpdateProfileMediaViewerContent",this.onClientUpdateProfileMediaViewerContent),na.a.off("clientUpdateForward",this.onClientUpdateForward),Wc.a.off("clientUpdateInstantViewContent",this.onClientUpdateInstantViewContent),k.b.off("clientUpdatePictureInPicture",this.onClientUpdatePictureInPicture)}render(){var e=this.state,t=e.instantViewContent,a=e.isChatDetailsVisible,n=e.mediaViewerContent,s=e.profileMediaViewerContent,i=e.forwardInfo,r=e.videoInfo,l=e.isSmallWidth;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:c()("page",{"page-small":l,"page-third-column":a})},o.a.createElement(Yi,null),o.a.createElement(Mc,{ref:this.dialogDetailsRef}),a&&o.a.createElement(ia,null)),o.a.createElement(fh,null),t&&o.a.createElement(Zc,t),n&&o.a.createElement(Qc,n),s&&o.a.createElement(sh,s),i&&o.a.createElement(he,i),r&&o.a.createElement(O,r))}}var Ch=Object(h.a)(d.a,m);t.default=Ch(gh)}])]);
//# sourceMappingURL=3.b3c9c4cc.chunk.js.map